{"id":"tilt_ui-0xg","title":"Design and implement BrewSignal Recipe Format v1.0","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-09T18:41:26.319589488+11:00","updated_at":"2025-12-09T18:41:26.319589488+11:00"}
{"id":"tilt_ui-1w4","title":"Integrate ML Pipeline with Main Application","description":"The ML pipeline is complete and tested (PR #61) but not yet integrated with the main application. This issue tracks connecting the ML components to the live reading pipeline.\n\n**Current State:**\n✅ Complete:\n- ML pipeline implementation in backend/ml/\n- 48/48 tests passing\n- Per-device state isolation\n- Kalman filtering, anomaly detection, curve fitting, MPC\n\n❌ Not Connected:\n- Not called from backend/main.py reading handler\n- Not exposed via API endpoints\n- Not displayed in frontend UI\n- State lost on service restart\n\n**Proposed Integration:**\n\nPhase 1: Basic Integration\n1. Add MLPipelineManager to backend/main.py\n2. Process readings through ML pipeline in handle_tilt_reading()\n3. Broadcast ML results via WebSocket\n4. Display filtered values on dashboard\n\nPhase 2: State Persistence\n5. Hydrate ML state from database on startup (last 48 hours)\n6. Ensures predictions work immediately after restart\n7. Option: Store ML results in new ml_results table\n\nPhase 3: UI Integration\n8. Show Kalman-filtered values on dashboard\n9. Display FG predictions and completion estimates\n10. Anomaly alerts (stuck fermentation, temperature spikes)\n11. MPC temperature trajectory visualization\n\n**Acceptance Criteria:**\n- ML pipeline processes all live Tilt readings\n- Filtered values broadcast via WebSocket\n- ML state survives service restarts\n- Dashboard shows filtered SG/temp\n- Predictions visible on batch detail page\n- Anomaly alerts displayed to user\n- No performance degradation (\u003c10ms overhead)\n\n**GitHub Issue:** #62","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T19:54:47.785215585+11:00","updated_at":"2025-12-09T20:21:17.845011679+11:00","closed_at":"2025-12-09T20:21:17.845011679+11:00"}
{"id":"tilt_ui-50q","title":"Bug: Batch views sometimes unresponsive or return 500 errors","description":"## Description\nBatch views (create/edit) are sometimes unresponsive or return 500 errors. The issue is intermittent.\n\n## Steps to Reproduce\n1. Navigate to batch pages\n2. Try to create or edit batches\n3. Sometimes get no response or 500 errors\n\n## Expected Behavior\n- Batch create/edit should work reliably\n- Should return proper error messages if validation fails\n\n## Actual Behavior\n- Intermittent failures\n- 500 server errors\n- Unresponsive UI\n\n## Investigation Plan\n- Use Playwright MCP to test batch workflows\n- Check browser console for errors\n- Analyze network requests for failures\n- Review backend logs for error traces","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-09T21:01:12.557372504+11:00","updated_at":"2025-12-09T21:06:44.932862383+11:00","closed_at":"2025-12-09T21:06:44.932862383+11:00"}
{"id":"tilt_ui-87t","title":"Implement thermal model learning for MPC","description":"Query historical readings and heater/cooler states to learn thermal model parameters for each batch.\n\n**Data needed:**\n- temp_history (from readings.temp_calibrated or temp_filtered)\n- time_history (from readings.timestamp)\n- heater_history (from control_events or batch heater state)\n- cooler_history (from control_events or batch cooler state)\n- ambient_history (from ambient_readings)\n\n**Learning trigger:**\n- Learn model once when MPC first used for batch (if enough history exists)\n- Optionally re-learn periodically (e.g., every 6 hours)\n\n**Location:** backend/temp_controller.py (new helper function)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:18.286190407+11:00","updated_at":"2025-12-09T23:11:30.263186473+11:00","closed_at":"2025-12-09T23:11:30.263186473+11:00"}
{"id":"tilt_ui-8xe","title":"Bug: Batch device selection shows unpaired Tilt instead of paired GravityMon","description":"## Description\nWhen creating a new batch, the device dropdown shows a single unpaired Tilt device instead of showing the paired GravityMon device.\n\n## Steps to Reproduce\n1. Pair a GravityMon device (visible in /devices)\n2. Ensure zero Tilt devices are paired\n3. Start to plan a new batch\n4. Check device dropdown\n\n## Expected Behavior\n- Should show paired GravityMon device\n- Should NOT show unpaired Tilt devices\n\n## Actual Behavior\n- Shows single unpaired Tilt device\n- GravityMon not visible in dropdown\n\n## Possible Causes\n- Device filtering logic not checking paired status\n- Query excluding non-Tilt device types\n- Frontend device list not including all device types","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-09T20:53:12.026094986+11:00","updated_at":"2025-12-09T20:55:49.354647889+11:00","closed_at":"2025-12-09T20:55:49.354647889+11:00"}
{"id":"tilt_ui-crx","title":"Enhance recipe CRUD frontend with better UX","description":"Current recipe CRUD frontend is minimal and functional but could be improved with:\n- Better form validation and error messages\n- Ingredient list display and editing (fermentables, hops, yeasts)\n- Richer recipe detail view with all BeerJSON fields\n- Batch size conversion tools (L/gal)\n- Temperature unit conversion display (C/F)\n- Recipe cloning/duplication\n- Recipe search and filtering\n- Style guide integration\n- Print/export functionality\n\nCurrent implementation covers basic recipe metadata (name, author, style, OG, FG, ABV, IBU, color, batch size, notes) but BeerJSON import includes much more detail that isn't exposed in the UI yet.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-09T19:50:26.932820447+11:00","updated_at":"2025-12-09T19:50:26.932820447+11:00"}
{"id":"tilt_ui-hgv","title":"Initialize MPC controller in temp_controller.py","description":"Create MPCTemperatureController instances and manage their lifecycle in the temperature control loop.\n\n**Approach:**\n- One MPC instance per batch (stored in dict similar to _batch_heater_states)\n- Initialize on first control check for batch\n- Clean up when batch leaves fermenting/conditioning\n\n**Location:** backend/temp_controller.py (add _batch_mpc_controllers dict)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:17.397976768+11:00","updated_at":"2025-12-09T23:11:30.262626673+11:00","closed_at":"2025-12-09T23:11:30.262626673+11:00"}
{"id":"tilt_ui-og0","title":"Add MPC logging and observability","description":"Log MPC decisions and predictions for debugging and monitoring.\n\n**What to log:**\n- MPC thermal model parameters (heating_rate, cooling_rate, ambient_coeff)\n- Control decisions (heater_on, cooler_on, reason, predicted_temp, cost)\n- Fallback events (when MPC unavailable, falls back to hysteresis)\n\n**How:**\n- logger.info() for key decisions\n- logger.debug() for detailed predictions\n- Consider adding MPC state to get_batch_control_status() for UI visibility\n\n**Location:** backend/temp_controller.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:21.155564426+11:00","updated_at":"2025-12-09T23:11:30.264126503+11:00","closed_at":"2025-12-09T23:11:30.264126503+11:00"}
{"id":"tilt_ui-pzu","title":"Build frontend UI for recipe management","description":"Create comprehensive frontend UI for the recipe CRUD system implemented in PR #87 (now merged).\n\n**Backend Capabilities (Already Built):**\n✅ Multi-format recipe import (BeerXML, BeerJSON, Brewfather JSON)\n✅ Full CRUD API endpoints (GET, POST, PUT, DELETE)\n✅ BeerJSON 2.06 schema support\n✅ Recipe serializer for BeerJSON output\n✅ Database migrations complete\n\n**PR Reference:** https://github.com/machug/brewsignal/pull/87\n\n---\n\n## Frontend Work Required\n\n### 1. Recipe List Page (`/recipes`)\n- [ ] Table/card view of all recipes\n- [ ] Filter/search by name, style\n- [ ] Sort by name, date created\n- [ ] Quick actions: View, Edit, Delete\n- [ ] Import button (multi-format)\n\n### 2. Recipe Detail Page (`/recipes/[id]`)\n- [ ] Display all BeerJSON fields:\n  - Name, style, brewer, batch size\n  - OG, FG, ABV, IBU, color (SRM)\n  - Boil time, efficiency\n  - Carbonation volumes\n- [ ] Show ingredients (fermentables, hops, cultures/yeasts, misc)\n- [ ] Display mash/fermentation/packaging steps\n- [ ] Edit/Delete actions\n- [ ] \"Create Batch from Recipe\" button\n\n### 3. Recipe Import UI\n- [ ] Multi-format file picker (.xml for BeerXML, .json for BeerJSON/Brewfather)\n- [ ] Format detection help text\n- [ ] Import progress/error feedback\n- [ ] Handle array error responses from backend\n\n### 4. Recipe Create/Edit Forms\n- [ ] Basic info: name, style, brewer, batch size\n- [ ] Gravity/alcohol: OG, FG, ABV\n- [ ] Color/bitterness: SRM, IBU\n- [ ] Brewing params: boil time, efficiency, carbonation\n- [ ] Ingredients sections (fermentables, hops, cultures, misc)\n- [ ] Mash/fermentation/packaging steps\n- [ ] Format extensions field (JSON)\n- [ ] Field validation (updateRecipe uses whitelist)\n\n### 5. Integration Points\n- [ ] Update batch create flow to select from recipes\n- [ ] Link recipe detail to associated batches\n- [ ] Handle temperature unit conversion (C/F)\n- [ ] Use existing TailwindCSS styling conventions\n\n---\n\n## Technical Notes\n\n**API Endpoints Available:**\n- GET /api/recipes - List all recipes\n- GET /api/recipes/{id} - Get recipe details\n- POST /api/recipes - Create recipe\n- PUT /api/recipes/{id} - Update recipe (uses field whitelist)\n- DELETE /api/recipes/{id} - Delete recipe\n- POST /api/recipes/import - Import from file (BeerXML/BeerJSON/Brewfather)\n- GET /api/recipes/{id}/beerjson - Export as BeerJSON\n\n**Frontend API Functions (Already Created):**\n```typescript\n// From frontend/src/lib/api.ts\ncreateRecipe(data: RecipeCreate): Promise\u003cRecipeResponse\u003e\nupdateRecipe(id: number, data: RecipeUpdate): Promise\u003cRecipeResponse\u003e\nimportRecipe(file: File): Promise\u003cRecipeResponse\u003e\n```\n\n**BeerJSON Field Names:**\n- Use `og`, `fg`, `abv` (NOT og_target, fg_target)\n- Use `color_srm`, `batch_size_liters`\n- Cultures table (was yeasts)\n\n**Security:**\n- updateRecipe uses field whitelist (can't update arbitrary fields)\n- Handle both string and array error formats\n\n---\n\n## Acceptance Criteria\n- [ ] Can view list of all recipes\n- [ ] Can import recipe from BeerXML, BeerJSON, or Brewfather JSON\n- [ ] Can view recipe details with all fields\n- [ ] Can create new recipe manually\n- [ ] Can edit existing recipe (respects backend field whitelist)\n- [ ] Can delete recipe\n- [ ] Can create batch from recipe (integration point)\n- [ ] Temperature units respect user preferences (C/F)\n- [ ] Error handling for import failures\n- [ ] Responsive design (mobile-friendly)\n","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T10:52:36.617912412+11:00","updated_at":"2025-12-09T11:35:47.274967461+11:00","closed_at":"2025-12-09T11:35:47.274970341+11:00"}
{"id":"tilt_ui-r43","title":"Test MPC integration with real batch data","description":"Validate MPC integration using production batch data to ensure it prevents overshoot.\n\n**Test scenarios:**\n1. Heater-only mode (no cooler)\n2. Dual-mode (heater + cooler)\n3. MPC disabled (should use basic hysteresis)\n4. Insufficient history (should fall back gracefully)\n\n**Success criteria:**\n- No overshoot beyond ±0.5°C of target\n- Smooth transitions (no rapid cycling)\n- Falls back to hysteresis when MPC unavailable\n\n**Location:** Manual testing on RPi deployment","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:22.163280576+11:00","updated_at":"2025-12-09T23:11:30.264595883+11:00","closed_at":"2025-12-09T23:11:30.264595883+11:00"}
{"id":"tilt_ui-vl5","title":"Add MPC configuration settings","description":"Add config settings to enable/disable MPC and configure MPC parameters (horizon, learning window, etc). This allows users to toggle MPC on/off and tune behavior.\n\n**Config fields:**\n- mpc_enabled (bool, default=False for backward compat)\n- mpc_horizon_hours (float, default=4.0)\n- mpc_learning_window_hours (float, default=24.0)\n\n**Location:** backend/database.py config migrations + backend/routers/config.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:16.101929656+11:00","updated_at":"2025-12-09T23:11:30.262001074+11:00","closed_at":"2025-12-09T23:11:30.262001074+11:00"}
{"id":"tilt_ui-vpd","title":"Modify control_batch_temperature to use MPC compute_action","description":"Replace basic hysteresis thresholds with MPC compute_action() when MPC is enabled and model is available.\n\n**Logic flow:**\n1. Check if mpc_enabled config is true\n2. Get or create MPC controller for batch\n3. If model not learned yet, learn from history\n4. Call mpc.compute_action(current_temp, target_temp, ambient_temp, heater_state, cooler_state)\n5. Use returned heater_on/cooler_on decisions\n6. Fall back to basic hysteresis if MPC unavailable or fails\n\n**Location:** backend/temp_controller.py:control_batch_temperature()","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:19.89570758+11:00","updated_at":"2025-12-09T23:11:30.263686693+11:00","closed_at":"2025-12-09T23:11:30.263686693+11:00"}
{"id":"tilt_ui-xlz","title":"AI Brewing Assistant with Recipe Generation","description":"## Overview\nAdd an AI-powered brewing assistant to help users create recipes, troubleshoot fermentation issues, and get brewing advice.\n\n## Features\n\n### 1. LLM Backend Options\n- **Local SLM**: Support for local small language models (Ollama, llama.cpp)\n  - Privacy-first option (no data leaves user's network)\n  - Works offline\n  - Models: Llama 3, Mistral, Phi-3, etc.\n  \n- **Cloud LLM APIs**: Optional integration with commercial APIs\n  - OpenAI (GPT-4, GPT-3.5)\n  - Anthropic (Claude)\n  - DeepSeek\n  - User provides their own API key\n  - Stored securely in app config\n\n### 2. Recipe Generation from Prompts\n- Natural language recipe creation\n- Examples:\n  - \"Create a Pliny the Elder clone for my 5-gallon system\"\n  - \"Design a hazy IPA with Citra and Mosaic hops\"\n  - \"Make a Belgian Tripel targeting 9% ABV\"\n  \n- **Context-Aware**:\n  - Uses user's equipment profile (batch size, efficiency)\n  - Considers available inventory (if implemented)\n  - Respects system constraints (mash tun capacity, etc.)\n  \n- **Output**: BrewSignal recipe schema (BeerJSON compatible)\n  - Can be imported directly into recipe library\n  - Includes all standard fields (grains, hops, yeast, mash schedule)\n\n### 3. Fermentation Assistant\n- Answer brewing questions\n- Troubleshoot fermentation issues\n  - \"My gravity is stuck at 1.020, what should I do?\"\n  - \"Is this fermentation curve normal?\"\n- Provide style-specific advice\n- Suggest recipe modifications based on historical batch data\n\n### 4. Context Integration\n- Access to user's batch history\n- Current fermentation data (gravity curves, temperature profiles)\n- Recipe library for learning user preferences\n- Equipment profile for accurate calculations\n\n## Technical Considerations\n\n### Backend Architecture\n- New router: \n- Service layer: \n  -  - Abstract LLM interface\n  -  - Ollama/llama.cpp integration\n  -  - API client for OpenAI/Anthropic/DeepSeek\n  -  - Recipe generation logic\n  -  - Structured prompts for recipe generation\n  \n### Configuration\n- Settings page for LLM configuration\n  - Choose backend (local vs cloud)\n  - API key management (encrypted storage)\n  - Model selection\n  - Temperature/creativity controls\n\n### Recipe Schema Output\n- Generate valid BeerJSON 2.0 format\n- Include calculated values (OG, FG, IBU, SRM, ABV)\n- Validate against schema before presenting to user\n- Allow user to review/modify before saving\n\n### UI Components\n- Chat interface for assistant\n- Recipe generation form with prompt input\n- Preview pane for generated recipes\n- One-click import to recipe library\n\n## Dependencies\n- LLM integration library (e.g., LangChain, LiteLLM for unified API)\n- Ollama server (optional, for local LLM)\n- Recipe calculation engine (reuse existing BrewSignal logic)\n\n## Future Enhancements\n- Multi-turn conversation for recipe refinement\n- Learn from user's successful batches\n- Suggest recipe adjustments based on fermentation telemetry\n- Batch prediction (\"How will this recipe turn out based on my history?\")\n- Integration with ingredients database (when available)\n\n## Security \u0026 Privacy\n- API keys encrypted at rest\n- Local LLM option for privacy-conscious users\n- User data never sent to cloud without explicit consent\n- Rate limiting for API calls to prevent cost overruns","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-09T20:49:49.775721886+11:00","updated_at":"2025-12-09T20:49:49.775721886+11:00"}
{"id":"tilt_ui-yt6","title":"Fix temperature overshoot with asymmetric hysteresis","description":"## Problem\nCurrent symmetric hysteresis causes 1°C overshoot:\n- Heater ON at target - 1°C (19°C)\n- Heater OFF at target + 1°C (21°C) ← overshoots by 1°C\n\n## Solution\nUse asymmetric hysteresis - turn OFF at target instead of target + hysteresis:\n- Heater ON at target - hysteresis (19°C)\n- Heater OFF at target (20°C) ← no overshoot\n\n## Implementation\nChange 2 lines in backend/temp_controller.py:\n\n```python\n# Line 413-414 (heating)\nheat_on_threshold = round(target_temp - hysteresis, 1)\nheat_off_threshold = round(target_temp, 1)  # Changed from target_temp + hysteresis\n\n# Line 446-447 (cooling) \ncool_on_threshold = round(target_temp + hysteresis, 1)\ncool_off_threshold = round(target_temp, 1)  # Changed from target_temp - hysteresis\n```\n\n## Testing\n- Deploy to RPi\n- Monitor one batch through full fermentation\n- Verify temperature stays within ±0.5°C of target\n\n## Rollback\nIf this causes issues, revert to symmetric hysteresis (restore + hysteresis)\n\n## Related\n- Issue #69 - original overshoot problem\n- MPC integration deferred until this simpler approach tested","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2025-12-09T23:11:31.13656325+11:00","updated_at":"2025-12-09T23:14:19.903812663+11:00"}
