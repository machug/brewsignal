{"id":"tilt_ui-0xg","title":"Design and implement BrewSignal Recipe Format v1.0","description":"## Completed: BrewSignal Recipe Format v1.0 Specification\n\n**Status**: Specification complete, ready for review\n\n**Location**: `docs/BREWSIGNAL_RECIPE_FORMAT_V1.md`\n\n**JSON Schema**: `backend/schemas/brewsignal-recipe-v1.0.schema.json`\n\n---\n\n## Summary\n\nAfter comprehensive review by specialized agents (spec-flow-analyzer, best-practices-researcher, architecture-strategist), we determined that creating a custom format is **justified** with the following approach:\n\n### Decision: Formalize Current API Format as \"BrewSignal Recipe Format v1.0\"\n\n**Key Finding**: BrewSignal's database and API already use a **simpler format** than BeerJSON 1.0:\n- `og: 1.050` (not `{\"value\": 1.050, \"unit\": \"sg\"}`)\n- `fg: 1.012` (not verbose BeerJSON wrapping)\n- `batch_size_liters: 19.0` (direct field names)\n\n**Strategy**: \n1. **Formalize existing API format** as official BrewSignal Recipe Format v1.0\n2. **Keep BeerJSON compatibility** for imports/exports (ecosystem interop)\n3. **Add BrewSignal extensions** for fermentation-specific features\n4. **Best of both worlds**: Simple for our app, compatible with ecosystem\n\n---\n\n## Specification Highlights\n\n### Core Principles\n- **Simplicity**: Raw numbers for gravity (`1.050` not wrapped objects)\n- **Readability**: Short field names (`og`, `fg`, `abv`)\n- **Fermentation-First**: Optimized for tracking, not brew day complexity\n- **Celsius-Native**: All temps in Celsius (internal standard)\n- **Extensible**: `brewsignal_extensions` for custom features\n\n### File Format\n- **Extension**: `.brewsignal`\n- **MIME Type**: `application/vnd.brewsignal.v1+json`\n- **Encoding**: UTF-8\n\n### BrewSignal Extensions\nFermentation-specific features not in standard formats:\n\n```json\n{\n  \"brewsignal_extensions\": {\n    \"fermentation_tracking\": {\n      \"og_validation\": { \"enabled\": true, \"tolerance_sg\": 0.003 },\n      \"fg_prediction\": { \"enabled\": true, \"ml_model\": \"kalman_exponential\" },\n      \"anomaly_detection\": { \"stuck_fermentation\": true }\n    },\n    \"batch_defaults\": {\n      \"auto_link_device\": true,\n      \"temperature_control\": {\n        \"target_c\": 18.0,\n        \"hysteresis_c\": 1.0\n      }\n    }\n  }\n}\n```\n\n### Conversion to/from BeerJSON\n- Lossless round-trip conversion\n- Preserves unknown fields in extensions\n- Import: BeerXML/BeerJSON/Brewfather ‚Üí BrewSignal\n- Export: BrewSignal ‚Üí BeerJSON/BeerXML (for ecosystem compatibility)\n\n---\n\n## Implementation Status\n\n### ‚úÖ Completed\n- [x] Full specification document (13 sections, 12 pages)\n- [x] JSON Schema for validation\n- [x] Minimal and complete recipe examples\n- [x] Conversion strategy (BeerJSON ‚Üî BrewSignal)\n- [x] API integration plan (no breaking changes)\n\n### üîÑ Next Steps (New Issues)\n- [ ] Backend validation utilities (`backend/services/brewsignal_format.py`)\n- [ ] Export endpoint (`GET /api/recipes/{id}/export?format=brewsignal`)\n- [ ] Validation endpoint (`POST /api/recipes/validate`)\n- [ ] Round-trip tests (BrewSignal ‚Üí BeerJSON ‚Üí BrewSignal)\n- [ ] Example recipes in `/examples` directory\n\n---\n\n## Review Findings\n\n### Architecture Analysis (Score: 9.20/10)\n- **Ecosystem Compatibility**: ‚úÖ Maintains BeerJSON import/export\n- **Migration Cost**: ‚úÖ Zero (formalizes existing format)\n- **Maintenance Burden**: ‚úÖ 93% lower than custom-only approach\n- **User Experience**: ‚úÖ Simple + compatible\n\n### Best Practices Research\n- BeerJSON 1.0 is verbose but stable (not actively maintained)\n- Custom format justified when:\n  - ‚úÖ Existing simple format already in use\n  - ‚úÖ Interop maintained via converters\n  - ‚úÖ Domain-specific features needed (fermentation tracking)\n\n### Spec Flow Analysis\n- All critical questions answered\n- Privacy/security guidelines defined (NEVER export HA entities, calibration)\n- Validation rules specified\n- User flows documented\n\n---\n\n## Files\n\n1. **docs/BREWSIGNAL_RECIPE_FORMAT_V1.md** - Complete specification\n2. **backend/schemas/brewsignal-recipe-v1.0.schema.json** - JSON Schema for validation\n\n---\n\n## Recommendation\n\n**Close this issue** and create implementation tasks:\n- `tilt_ui-xxx`: Backend validation utilities\n- `tilt_ui-yyy`: Export endpoint\n- `tilt_ui-zzz`: Validation endpoint\n- `tilt_ui-aaa`: Example recipes\n\nOr mark as **Ready for Review** if stakeholder approval needed before implementation.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T18:41:26.319589488+11:00","updated_at":"2025-12-10T09:38:10.19327653+11:00","closed_at":"2025-12-10T09:38:10.19327653+11:00"}
{"id":"tilt_ui-1w4","title":"Integrate ML Pipeline with Main Application","description":"The ML pipeline is complete and tested (PR #61) but not yet integrated with the main application. This issue tracks connecting the ML components to the live reading pipeline.\n\n**Current State:**\n‚úÖ Complete:\n- ML pipeline implementation in backend/ml/\n- 48/48 tests passing\n- Per-device state isolation\n- Kalman filtering, anomaly detection, curve fitting, MPC\n\n‚ùå Not Connected:\n- Not called from backend/main.py reading handler\n- Not exposed via API endpoints\n- Not displayed in frontend UI\n- State lost on service restart\n\n**Proposed Integration:**\n\nPhase 1: Basic Integration\n1. Add MLPipelineManager to backend/main.py\n2. Process readings through ML pipeline in handle_tilt_reading()\n3. Broadcast ML results via WebSocket\n4. Display filtered values on dashboard\n\nPhase 2: State Persistence\n5. Hydrate ML state from database on startup (last 48 hours)\n6. Ensures predictions work immediately after restart\n7. Option: Store ML results in new ml_results table\n\nPhase 3: UI Integration\n8. Show Kalman-filtered values on dashboard\n9. Display FG predictions and completion estimates\n10. Anomaly alerts (stuck fermentation, temperature spikes)\n11. MPC temperature trajectory visualization\n\n**Acceptance Criteria:**\n- ML pipeline processes all live Tilt readings\n- Filtered values broadcast via WebSocket\n- ML state survives service restarts\n- Dashboard shows filtered SG/temp\n- Predictions visible on batch detail page\n- Anomaly alerts displayed to user\n- No performance degradation (\u003c10ms overhead)\n\n**GitHub Issue:** #62","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T19:54:47.785215585+11:00","updated_at":"2025-12-09T20:21:17.845011679+11:00","closed_at":"2025-12-09T20:21:17.845011679+11:00"}
{"id":"tilt_ui-2s1","title":"Fix FG validator field-order dependency","description":"FG validator uses @field_validator which can be bypassed if fields are in wrong order. Use @model_validator(mode='after') instead. See todo 001.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T11:32:02.013332577+11:00","updated_at":"2025-12-10T11:36:27.248911871+11:00","closed_at":"2025-12-10T11:36:27.248911871+11:00"}
{"id":"tilt_ui-40f","title":"Add recipe export endpoint with format selection","description":"Add API endpoint to export recipes in multiple formats (BrewSignal, BeerJSON, BeerXML).\n\n## Endpoint\n`GET /api/recipes/{id}/export`\n\n## Query Parameters\n- `format`: \"brewsignal\" (default), \"beerjson\", \"beerxml\", \"brewfather\"\n- `include_extensions`: true/false (include BrewSignal extensions, default: true)\n\n## Response Headers\n- `Content-Type`: Format-specific MIME type\n  - BrewSignal: `application/vnd.brewsignal.v1+json`\n  - BeerJSON: `application/json`\n  - BeerXML: `application/xml`\n- `Content-Disposition`: `attachment; filename=\"{recipe-name}-{date}.{ext}\"`\n\n## Implementation\n\n### Router (`backend/routers/recipes.py`)\n\n```python\n@router.get(\"/{id}/export\")\nasync def export_recipe(\n    id: int,\n    format: str = \"brewsignal\",\n    include_extensions: bool = True,\n    db: AsyncSession = Depends(get_db)\n):\n    # Fetch recipe with all relationships\n    recipe = await get_recipe_with_relationships(db, id)\n    \n    # Convert to requested format\n    if format == \"brewsignal\":\n        data = recipe_to_brewsignal(recipe, include_extensions)\n        content_type = \"application/vnd.brewsignal.v1+json\"\n        filename = f\"{sanitize_filename(recipe.name)}-{date.today()}.brewsignal\"\n    elif format == \"beerjson\":\n        data = recipe_to_beerjson(recipe)\n        content_type = \"application/json\"\n        filename = f\"{sanitize_filename(recipe.name)}-{date.today()}.json\"\n    # ... other formats\n    \n    return Response(\n        content=json.dumps(data, indent=2),\n        media_type=content_type,\n        headers={\"Content-Disposition\": f'attachment; filename=\"{filename}\"'}\n    )\n```\n\n## Tasks\n- [ ] Add export endpoint to recipes router\n- [ ] Implement BrewSignal format export\n- [ ] Implement BeerJSON format export (reuse existing serializer)\n- [ ] Implement BeerXML format export (future - optional)\n- [ ] Add filename sanitization (remove special chars)\n- [ ] Add proper Content-Type headers\n- [ ] Add Content-Disposition with smart filename\n\n## Testing\n- [ ] Test export for each format\n- [ ] Test filename generation (special chars, dates)\n- [ ] Test include_extensions flag\n- [ ] Test with recipes that have/don't have extensions\n- [ ] Verify Content-Type headers\n- [ ] Verify downloadable file in browser\n\n## Dependencies\n- Requires: tilt_ui-4hu (validation utilities)\n\n## Acceptance Criteria\n- Export BrewSignal format with proper MIME type\n- Export BeerJSON format (existing functionality)\n- Generate clean filenames (no special chars)\n- Include/exclude extensions based on flag\n- Download works in browser (Content-Disposition header)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T09:35:14.301788965+11:00","updated_at":"2025-12-10T09:35:14.301788965+11:00","dependencies":[{"issue_id":"tilt_ui-40f","depends_on_id":"tilt_ui-4hu","type":"blocks","created_at":"2025-12-10T09:37:59.545063582+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tilt_ui-4hu","title":"Backend validation utilities for BrewSignal Recipe Format v1.0","description":"Create backend utilities for validating and working with BrewSignal Recipe Format v1.0.\n\n## Location\n`backend/services/brewsignal_format.py`\n\n## Tasks\n\n### Validation\n- [ ] `validate_brewsignal_recipe(data: dict) -\u003e ValidationResult`\n  - Load JSON Schema from `backend/schemas/brewsignal-recipe-v1.0.schema.json`\n  - Validate using jsonschema library\n  - Return validation errors with field paths\n  - Check for warnings (unusual values)\n\n### Conversion Helpers\n- [ ] `beerjson_to_brewsignal(beerjson: dict) -\u003e dict`\n  - Unwrap BeerJSON unit objects to raw values\n  - Map field names (original_gravity ‚Üí og)\n  - Extract extensions from _extensions.brewsignal\n  \n- [ ] `brewsignal_to_beerjson(brewsignal: dict) -\u003e dict`\n  - Wrap values in unit objects\n  - Map field names back (og ‚Üí original_gravity)\n  - Preserve extensions in _extensions.brewsignal\n\n### Model Integration\n- [ ] Add property methods to `Recipe` model in `backend/models.py`:\n  - `@property brewsignal_extensions(self) -\u003e dict`\n  - `@property fermentation_tracking_config(self) -\u003e dict`\n  - `@property batch_defaults(self) -\u003e dict`\n  - `@property yeast_management_config(self) -\u003e dict`\n\n## Dependencies\n- jsonschema library (already in requirements)\n- Specification: `docs/BREWSIGNAL_RECIPE_FORMAT_V1.md`\n- Schema: `backend/schemas/brewsignal-recipe-v1.0.schema.json`\n\n## Testing\n- [ ] Unit tests for validation (valid/invalid recipes)\n- [ ] Round-trip tests (BeerJSON ‚Üí BrewSignal ‚Üí BeerJSON)\n- [ ] Test with example recipes in `examples/recipes/`\n\n## Acceptance Criteria\n- Validation catches all schema violations\n- Conversion preserves all data (lossless round-trip)\n- Model properties provide easy access to extensions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T09:34:56.074862127+11:00","updated_at":"2025-12-10T10:15:20.299499424+11:00","closed_at":"2025-12-10T10:15:20.299499424+11:00"}
{"id":"tilt_ui-50q","title":"Bug: Batch views sometimes unresponsive or return 500 errors","description":"## Description\nBatch views (create/edit) are sometimes unresponsive or return 500 errors. The issue is intermittent.\n\n## Steps to Reproduce\n1. Navigate to batch pages\n2. Try to create or edit batches\n3. Sometimes get no response or 500 errors\n\n## Expected Behavior\n- Batch create/edit should work reliably\n- Should return proper error messages if validation fails\n\n## Actual Behavior\n- Intermittent failures\n- 500 server errors\n- Unresponsive UI\n\n## Investigation Plan\n- Use Playwright MCP to test batch workflows\n- Check browser console for errors\n- Analyze network requests for failures\n- Review backend logs for error traces","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-09T21:01:12.557372504+11:00","updated_at":"2025-12-09T21:06:44.932862383+11:00","closed_at":"2025-12-09T21:06:44.932862383+11:00"}
{"id":"tilt_ui-87t","title":"Implement thermal model learning for MPC","description":"Query historical readings and heater/cooler states to learn thermal model parameters for each batch.\n\n**Data needed:**\n- temp_history (from readings.temp_calibrated or temp_filtered)\n- time_history (from readings.timestamp)\n- heater_history (from control_events or batch heater state)\n- cooler_history (from control_events or batch cooler state)\n- ambient_history (from ambient_readings)\n\n**Learning trigger:**\n- Learn model once when MPC first used for batch (if enough history exists)\n- Optionally re-learn periodically (e.g., every 6 hours)\n\n**Location:** backend/temp_controller.py (new helper function)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:18.286190407+11:00","updated_at":"2025-12-09T23:11:30.263186473+11:00","closed_at":"2025-12-09T23:11:30.263186473+11:00"}
{"id":"tilt_ui-8o5","title":"Add diverse example recipes in BrewSignal format","description":"Create a collection of example recipes showcasing different styles and BrewSignal format features.\n\n## Goal\nProvide real-world recipe examples for:\n- Testing validation and conversion\n- Documentation and demos\n- User reference\n- Different brewing styles\n\n## Recipe Collection\n\n### 1. `pilsner.brewsignal` - Lager Example\n- **Style**: Czech Pilsner\n- **Features**:\n  - Lager yeast with temp ranges\n  - Multi-stage fermentation (primary ‚Üí diacetyl rest ‚Üí lagering)\n  - Simple grain bill\n  - Noble hops\n  - Extensions: temperature control defaults\n\n### 2. `imperial-stout.brewsignal` - High Gravity Example\n- **Style**: Imperial Stout\n- **Features**:\n  - High OG (1.090+)\n  - Complex grain bill (6+ malts)\n  - Multiple yeast strains (future: multi-yeast support)\n  - Long fermentation schedule\n  - Extensions: FG prediction, high attenuation warnings\n\n### 3. `hazy-ipa.brewsignal` - Modern IPA\n- **Style**: New England IPA\n- **Features**:\n  - Heavy dry hopping (multiple additions)\n  - Whirlpool/hopstand additions with temps\n  - Flaked adjuncts (oats, wheat)\n  - Extensions: anomaly detection for oxidation\n\n### 4. `sour-berliner-weisse.brewsignal` - Kettle Sour\n- **Style**: Berliner Weisse\n- **Features**:\n  - Lactobacillus souring step\n  - Low IBU\n  - Simple grain bill\n  - Fruit additions (misc ingredients)\n  - Extensions: pH monitoring (future)\n\n### 5. `extract-amber-ale.brewsignal` - Extract Recipe\n- **Style**: American Amber Ale\n- **Features**:\n  - Extract brewing (no mash)\n  - Liquid/dry malt extract\n  - Specialty grains (steeping)\n  - Beginner-friendly\n  - No extensions (simple recipe)\n\n### 6. `session-ipa.brewsignal` - Low ABV Example\n- **Style**: Session IPA\n- **Features**:\n  - Low OG (~1.045)\n  - High IBU for style (50+)\n  - Hop-forward but drinkable\n  - Quick fermentation (7 days)\n\n## File Structure\n```\nexamples/recipes/\n‚îú‚îÄ‚îÄ README.md (updated with new recipes)\n‚îú‚îÄ‚îÄ minimal-pale-ale.brewsignal (existing)\n‚îú‚îÄ‚îÄ west-coast-ipa-complete.brewsignal (existing)\n‚îú‚îÄ‚îÄ pilsner.brewsignal (new)\n‚îú‚îÄ‚îÄ imperial-stout.brewsignal (new)\n‚îú‚îÄ‚îÄ hazy-ipa.brewsignal (new)\n‚îú‚îÄ‚îÄ sour-berliner-weisse.brewsignal (new)\n‚îú‚îÄ‚îÄ extract-amber-ale.brewsignal (new)\n‚îî‚îÄ‚îÄ session-ipa.brewsignal (new)\n```\n\n## Recipe Requirements\n\nEach recipe must:\n- [ ] Validate against JSON Schema\n- [ ] Include realistic OG/FG/ABV values\n- [ ] Use actual hop varieties and malts\n- [ ] Include appropriate yeast for style\n- [ ] Add style-specific notes\n- [ ] Demonstrate at least one BrewSignal extension\n- [ ] Include fermentation schedule where relevant\n- [ ] Use proper timing objects for hops\n\n## BrewSignal Extensions to Showcase\n\n### Fermentation Tracking\n- **Pilsner**: Temperature control for lagering\n- **Imperial Stout**: FG prediction for high gravity\n- **Hazy IPA**: Anomaly detection for oxidation\n\n### Batch Defaults\n- **All recipes**: Auto-link device when creating batch\n- **Pilsner**: Multi-stage temp control defaults\n- **Session IPA**: Quick turnaround settings\n\n### Yeast Management\n- **Imperial Stout**: High pitch rate requirement\n- **Pilsner**: Starter calculation\n- **Extract Amber**: Dry yeast rehydration\n\n## Testing\n- [ ] Validate all new recipes against schema\n- [ ] Test import via API\n- [ ] Verify conversions (BrewSignal ‚Üî BeerJSON)\n- [ ] Check for typos and formatting\n\n## Documentation\n- [ ] Update `examples/recipes/README.md` with:\n  - New recipe descriptions\n  - Style coverage matrix\n  - Feature showcase table\n  - Brewing method coverage (All Grain, Extract, BIAB)\n\n## Acceptance Criteria\n- 6+ diverse recipes covering major styles\n- All recipes validate successfully\n- Each recipe demonstrates different features\n- README updated with recipe descriptions\n- Recipes importable via API","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T09:36:58.36071642+11:00","updated_at":"2025-12-10T09:36:58.36071642+11:00"}
{"id":"tilt_ui-8we","title":"Fix unbounded text fields DoS vulnerability","description":"Notes field has no max_length, allows 100+ MB DoS payloads. Add max_length=10_000 constraint. See todo 003.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T11:32:15.855508678+11:00","updated_at":"2025-12-10T11:36:27.254251369+11:00","closed_at":"2025-12-10T11:36:27.254251369+11:00"}
{"id":"tilt_ui-8xe","title":"Bug: Batch device selection shows unpaired Tilt instead of paired GravityMon","description":"## Description\nWhen creating a new batch, the device dropdown shows a single unpaired Tilt device instead of showing the paired GravityMon device.\n\n## Steps to Reproduce\n1. Pair a GravityMon device (visible in /devices)\n2. Ensure zero Tilt devices are paired\n3. Start to plan a new batch\n4. Check device dropdown\n\n## Expected Behavior\n- Should show paired GravityMon device\n- Should NOT show unpaired Tilt devices\n\n## Actual Behavior\n- Shows single unpaired Tilt device\n- GravityMon not visible in dropdown\n\n## Possible Causes\n- Device filtering logic not checking paired status\n- Query excluding non-Tilt device types\n- Frontend device list not including all device types","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-09T20:53:12.026094986+11:00","updated_at":"2025-12-09T20:55:49.354647889+11:00","closed_at":"2025-12-09T20:55:49.354647889+11:00"}
{"id":"tilt_ui-a6v","title":"Add recipe validation endpoint","description":"Add API endpoint to validate recipe data before import/creation.\n\n## Endpoint\n`POST /api/recipes/validate`\n\n## Request Body\n```json\n{\n  \"format\": \"brewsignal\",\n  \"data\": { /* recipe data */ }\n}\n```\n\n## Response (Valid)\n```json\n{\n  \"valid\": true,\n  \"warnings\": [\n    {\n      \"field\": \"recipe.boil_time_minutes\",\n      \"value\": 180,\n      \"warning\": \"Unusual boil time of 180 minutes\"\n    }\n  ]\n}\n```\n\n## Response (Invalid)\n```json\n{\n  \"valid\": false,\n  \"errors\": [\n    {\n      \"field\": \"recipe.og\",\n      \"value\": 1.250,\n      \"error\": \"Value 1.250 exceeds maximum 1.200\"\n    },\n    {\n      \"field\": \"recipe.yeast.temp_min_c\",\n      \"value\": \"cold\",\n      \"error\": \"Expected number, got string\"\n    }\n  ],\n  \"warnings\": []\n}\n```\n\n## Implementation\n\n### Router (`backend/routers/recipes.py`)\n\n```python\nclass RecipeValidationRequest(BaseModel):\n    format: str  # \"brewsignal\", \"beerjson\", \"beerxml\"\n    data: dict\n\nclass ValidationError(BaseModel):\n    field: str\n    value: Any\n    error: str\n\nclass ValidationWarning(BaseModel):\n    field: str\n    value: Optional[Any] = None\n    warning: str\n\nclass RecipeValidationResponse(BaseModel):\n    valid: bool\n    errors: list[ValidationError] = []\n    warnings: list[ValidationWarning] = []\n\n@router.post(\"/validate\", response_model=RecipeValidationResponse)\nasync def validate_recipe(request: RecipeValidationRequest):\n    errors = []\n    warnings = []\n    \n    # Schema validation\n    if request.format == \"brewsignal\":\n        validation_result = validate_brewsignal_recipe(request.data)\n        errors.extend(validation_result.errors)\n    \n    # Business logic validation\n    if request.data.get(\"recipe\", {}).get(\"og\"):\n        og = request.data[\"recipe\"][\"og\"]\n        fg = request.data[\"recipe\"].get(\"fg\")\n        if fg and fg \u003e= og:\n            errors.append({\n                \"field\": \"recipe.fg\",\n                \"value\": fg,\n                \"error\": f\"FG ({fg}) must be less than OG ({og})\"\n            })\n    \n    # Warnings for unusual values\n    boil_time = request.data.get(\"recipe\", {}).get(\"boil_time_minutes\")\n    if boil_time and boil_time \u003e 120:\n        warnings.append({\n            \"field\": \"recipe.boil_time_minutes\",\n            \"value\": boil_time,\n            \"warning\": f\"Unusual boil time of {boil_time} minutes\"\n        })\n    \n    return {\n        \"valid\": len(errors) == 0,\n        \"errors\": errors,\n        \"warnings\": warnings\n    }\n```\n\n## Validation Rules\n\n### Schema Validation\n- JSON Schema validation (types, ranges, required fields)\n- Field format validation (ISO dates, etc.)\n\n### Business Logic Validation\n- [ ] FG must be less than OG\n- [ ] ABV calculation matches OG/FG (within tolerance)\n- [ ] Fermentable percentages sum to ~100% (warning if not)\n- [ ] Hop alpha acids in valid range (0-20%)\n- [ ] Yeast temp ranges valid (min \u003c max)\n- [ ] Fermentation step temperatures in valid range\n\n### Warnings (Not Errors)\n- [ ] Unusual boil time (\u003c 30 or \u003e 120 minutes)\n- [ ] Very high/low OG (\u003c 1.030 or \u003e 1.100)\n- [ ] Very high IBU (\u003e 100)\n- [ ] Very high ABV (\u003e 12%)\n- [ ] Missing recommended fields (batch_size, efficiency)\n\n## Tasks\n- [ ] Add validation endpoint to recipes router\n- [ ] Implement Pydantic request/response models\n- [ ] Schema validation (reuse from tilt_ui-4hu)\n- [ ] Business logic validation rules\n- [ ] Warning detection for unusual values\n- [ ] Error message formatting (user-friendly)\n\n## Testing\n- [ ] Test valid BrewSignal recipe (no errors, no warnings)\n- [ ] Test invalid recipe (schema violations)\n- [ ] Test business logic errors (FG \u003e= OG)\n- [ ] Test warnings (unusual values)\n- [ ] Test with example recipes\n- [ ] Test error message clarity\n\n## Dependencies\n- Requires: tilt_ui-4hu (validation utilities)\n\n## Acceptance Criteria\n- Returns valid=true for valid recipes\n- Returns clear error messages for invalid recipes\n- Detects business logic errors (FG \u003e= OG)\n- Provides helpful warnings for unusual values\n- Works with all supported formats (BrewSignal, BeerJSON)","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-10T09:35:38.520086132+11:00","updated_at":"2025-12-10T09:35:38.520086132+11:00","dependencies":[{"issue_id":"tilt_ui-a6v","depends_on_id":"tilt_ui-4hu","type":"blocks","created_at":"2025-12-10T09:37:59.550640694+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tilt_ui-c7s","title":"Fix percentage scale ambiguity in conversion","description":"Percentage conversion logic 'if value \u003c= 1' is ambiguous for 1.0. Always convert with validation instead. See todo 004.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T11:32:22.892295926+11:00","updated_at":"2025-12-10T11:36:27.25455782+11:00","closed_at":"2025-12-10T11:36:27.25455782+11:00"}
{"id":"tilt_ui-crx","title":"Enhance recipe CRUD frontend with better UX","description":"Current recipe CRUD frontend is minimal and functional but could be improved with:\n- Better form validation and error messages\n- Ingredient list display and editing (fermentables, hops, yeasts)\n- Richer recipe detail view with all BeerJSON fields\n- Batch size conversion tools (L/gal)\n- Temperature unit conversion display (C/F)\n- Recipe cloning/duplication\n- Recipe search and filtering\n- Style guide integration\n- Print/export functionality\n\nCurrent implementation covers basic recipe metadata (name, author, style, OG, FG, ABV, IBU, color, batch size, notes) but BeerJSON import includes much more detail that isn't exposed in the UI yet.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-09T19:50:26.932820447+11:00","updated_at":"2025-12-09T19:50:26.932820447+11:00"}
{"id":"tilt_ui-hgv","title":"Initialize MPC controller in temp_controller.py","description":"Create MPCTemperatureController instances and manage their lifecycle in the temperature control loop.\n\n**Approach:**\n- One MPC instance per batch (stored in dict similar to _batch_heater_states)\n- Initialize on first control check for batch\n- Clean up when batch leaves fermenting/conditioning\n\n**Location:** backend/temp_controller.py (add _batch_mpc_controllers dict)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:17.397976768+11:00","updated_at":"2025-12-09T23:11:30.262626673+11:00","closed_at":"2025-12-09T23:11:30.262626673+11:00"}
{"id":"tilt_ui-og0","title":"Add MPC logging and observability","description":"Log MPC decisions and predictions for debugging and monitoring.\n\n**What to log:**\n- MPC thermal model parameters (heating_rate, cooling_rate, ambient_coeff)\n- Control decisions (heater_on, cooler_on, reason, predicted_temp, cost)\n- Fallback events (when MPC unavailable, falls back to hysteresis)\n\n**How:**\n- logger.info() for key decisions\n- logger.debug() for detailed predictions\n- Consider adding MPC state to get_batch_control_status() for UI visibility\n\n**Location:** backend/temp_controller.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:21.155564426+11:00","updated_at":"2025-12-09T23:11:30.264126503+11:00","closed_at":"2025-12-09T23:11:30.264126503+11:00"}
{"id":"tilt_ui-pbp","title":"Round-trip conversion tests (BrewSignal ‚Üî BeerJSON)","description":"Create comprehensive tests for lossless conversion between BrewSignal and BeerJSON formats.\n\n## Test Goal\nEnsure **lossless round-trip** conversion:\n```\nBeerJSON ‚Üí BrewSignal ‚Üí BeerJSON (must be identical)\nBrewSignal ‚Üí BeerJSON ‚Üí BrewSignal (must be identical)\n```\n\n## Test Cases\n\n### 1. BeerJSON ‚Üí BrewSignal ‚Üí BeerJSON\n```python\ndef test_beerjson_roundtrip():\n    # Load original BeerJSON\n    original = load_beerjson_recipe('test_data/original.json')\n    \n    # Convert to BrewSignal\n    brewsignal = beerjson_to_brewsignal(original)\n    \n    # Convert back to BeerJSON\n    result = brewsignal_to_beerjson(brewsignal)\n    \n    # Assert identical (deep equality)\n    assert_deep_equal(original, result)\n```\n\n### 2. BrewSignal ‚Üí BeerJSON ‚Üí BrewSignal\n```python\ndef test_brewsignal_roundtrip():\n    # Load original BrewSignal\n    original = load_brewsignal_recipe('examples/recipes/west-coast-ipa-complete.brewsignal')\n    \n    # Convert to BeerJSON\n    beerjson = brewsignal_to_beerjson(original)\n    \n    # Convert back to BrewSignal\n    result = beerjson_to_brewsignal(beerjson)\n    \n    # Assert identical\n    assert_deep_equal(original, result)\n```\n\n### 3. Database Round-Trip\n```python\nasync def test_database_roundtrip():\n    # Import BrewSignal recipe to DB\n    recipe = await import_brewsignal_recipe(brewsignal_data)\n    \n    # Export from DB as BrewSignal\n    exported = await export_recipe_as_brewsignal(recipe.id)\n    \n    # Assert identical to original\n    assert_deep_equal(brewsignal_data, exported)\n```\n\n## Test Data\n\n### Minimal Recipe\n- Use `examples/recipes/minimal-pale-ale.brewsignal`\n- Test required fields only\n- Verify no data loss on minimal input\n\n### Complete Recipe\n- Use `examples/recipes/west-coast-ipa-complete.brewsignal`\n- Test all optional fields\n- Test BrewSignal extensions\n\n### Complex BeerJSON\n- Multi-hop schedule (mash, boil, whirlpool, dry hop)\n- Multi-stage fermentation\n- Water chemistry\n- Mash schedule\n- All optional fields populated\n\n### Edge Cases\n- [ ] Empty arrays (no hops, no fermentables)\n- [ ] Null/missing optional fields\n- [ ] Maximum field values\n- [ ] Minimum field values\n- [ ] Special characters in names\n- [ ] Unicode characters (emoji in notes)\n\n## Extension Preservation\n\n### BrewSignal Extensions\n- [ ] Fermentation tracking config preserved\n- [ ] Batch defaults preserved\n- [ ] Yeast management config preserved\n\n### BeerJSON Extensions\n- [ ] Unknown BeerJSON fields stored in format_extensions\n- [ ] Preserved on round-trip export\n- [ ] Not lost during conversion\n\n## File Location\n`backend/tests/test_recipe_conversion.py`\n\n## Tasks\n- [ ] Create test file with pytest fixtures\n- [ ] Test BeerJSON ‚Üí BrewSignal ‚Üí BeerJSON\n- [ ] Test BrewSignal ‚Üí BeerJSON ‚Üí BrewSignal\n- [ ] Test database import/export round-trip\n- [ ] Test with minimal recipe\n- [ ] Test with complete recipe\n- [ ] Test with complex BeerJSON\n- [ ] Test edge cases (empty arrays, nulls, etc.)\n- [ ] Test extension preservation\n- [ ] Test field mapping (og ‚Üî original_gravity)\n- [ ] Test unit unwrapping/wrapping\n- [ ] Add assertion helpers (deep_equal with tolerance for floats)\n\n## Assertion Helpers\n```python\ndef assert_deep_equal(a: dict, b: dict, path: str = \"root\"):\n    \"\"\"Deep equality with float tolerance and helpful error messages.\"\"\"\n    # Compare keys\n    assert set(a.keys()) == set(b.keys()), f\"{path}: Key mismatch\"\n    \n    for key in a.keys():\n        val_a = a[key]\n        val_b = b[key]\n        current_path = f\"{path}.{key}\"\n        \n        if isinstance(val_a, dict):\n            assert_deep_equal(val_a, val_b, current_path)\n        elif isinstance(val_a, list):\n            assert len(val_a) == len(val_b), f\"{current_path}: List length mismatch\"\n            for i, (item_a, item_b) in enumerate(zip(val_a, val_b)):\n                assert_deep_equal(item_a, item_b, f\"{current_path}[{i}]\")\n        elif isinstance(val_a, float):\n            assert abs(val_a - val_b) \u003c 0.0001, f\"{current_path}: {val_a} != {val_b}\"\n        else:\n            assert val_a == val_b, f\"{current_path}: {val_a} != {val_b}\"\n```\n\n## Dependencies\n- Requires: tilt_ui-4hu (conversion functions)\n\n## Acceptance Criteria\n- All round-trip tests pass\n- No data loss in conversions\n- Extensions preserved correctly\n- Edge cases handled gracefully\n- Test coverage \u003e 90% for conversion code","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T09:36:28.4210199+11:00","updated_at":"2025-12-10T11:45:48.687190081+11:00","closed_at":"2025-12-10T11:45:48.687190081+11:00","dependencies":[{"issue_id":"tilt_ui-pbp","depends_on_id":"tilt_ui-4hu","type":"blocks","created_at":"2025-12-10T09:37:59.555512563+11:00","created_by":"daemon","metadata":"{}"}]}
{"id":"tilt_ui-pzu","title":"Build frontend UI for recipe management","description":"Create comprehensive frontend UI for the recipe CRUD system implemented in PR #87 (now merged).\n\n**Backend Capabilities (Already Built):**\n‚úÖ Multi-format recipe import (BeerXML, BeerJSON, Brewfather JSON)\n‚úÖ Full CRUD API endpoints (GET, POST, PUT, DELETE)\n‚úÖ BeerJSON 2.06 schema support\n‚úÖ Recipe serializer for BeerJSON output\n‚úÖ Database migrations complete\n\n**PR Reference:** https://github.com/machug/brewsignal/pull/87\n\n---\n\n## Frontend Work Required\n\n### 1. Recipe List Page (`/recipes`)\n- [ ] Table/card view of all recipes\n- [ ] Filter/search by name, style\n- [ ] Sort by name, date created\n- [ ] Quick actions: View, Edit, Delete\n- [ ] Import button (multi-format)\n\n### 2. Recipe Detail Page (`/recipes/[id]`)\n- [ ] Display all BeerJSON fields:\n  - Name, style, brewer, batch size\n  - OG, FG, ABV, IBU, color (SRM)\n  - Boil time, efficiency\n  - Carbonation volumes\n- [ ] Show ingredients (fermentables, hops, cultures/yeasts, misc)\n- [ ] Display mash/fermentation/packaging steps\n- [ ] Edit/Delete actions\n- [ ] \"Create Batch from Recipe\" button\n\n### 3. Recipe Import UI\n- [ ] Multi-format file picker (.xml for BeerXML, .json for BeerJSON/Brewfather)\n- [ ] Format detection help text\n- [ ] Import progress/error feedback\n- [ ] Handle array error responses from backend\n\n### 4. Recipe Create/Edit Forms\n- [ ] Basic info: name, style, brewer, batch size\n- [ ] Gravity/alcohol: OG, FG, ABV\n- [ ] Color/bitterness: SRM, IBU\n- [ ] Brewing params: boil time, efficiency, carbonation\n- [ ] Ingredients sections (fermentables, hops, cultures, misc)\n- [ ] Mash/fermentation/packaging steps\n- [ ] Format extensions field (JSON)\n- [ ] Field validation (updateRecipe uses whitelist)\n\n### 5. Integration Points\n- [ ] Update batch create flow to select from recipes\n- [ ] Link recipe detail to associated batches\n- [ ] Handle temperature unit conversion (C/F)\n- [ ] Use existing TailwindCSS styling conventions\n\n---\n\n## Technical Notes\n\n**API Endpoints Available:**\n- GET /api/recipes - List all recipes\n- GET /api/recipes/{id} - Get recipe details\n- POST /api/recipes - Create recipe\n- PUT /api/recipes/{id} - Update recipe (uses field whitelist)\n- DELETE /api/recipes/{id} - Delete recipe\n- POST /api/recipes/import - Import from file (BeerXML/BeerJSON/Brewfather)\n- GET /api/recipes/{id}/beerjson - Export as BeerJSON\n\n**Frontend API Functions (Already Created):**\n```typescript\n// From frontend/src/lib/api.ts\ncreateRecipe(data: RecipeCreate): Promise\u003cRecipeResponse\u003e\nupdateRecipe(id: number, data: RecipeUpdate): Promise\u003cRecipeResponse\u003e\nimportRecipe(file: File): Promise\u003cRecipeResponse\u003e\n```\n\n**BeerJSON Field Names:**\n- Use `og`, `fg`, `abv` (NOT og_target, fg_target)\n- Use `color_srm`, `batch_size_liters`\n- Cultures table (was yeasts)\n\n**Security:**\n- updateRecipe uses field whitelist (can't update arbitrary fields)\n- Handle both string and array error formats\n\n---\n\n## Acceptance Criteria\n- [ ] Can view list of all recipes\n- [ ] Can import recipe from BeerXML, BeerJSON, or Brewfather JSON\n- [ ] Can view recipe details with all fields\n- [ ] Can create new recipe manually\n- [ ] Can edit existing recipe (respects backend field whitelist)\n- [ ] Can delete recipe\n- [ ] Can create batch from recipe (integration point)\n- [ ] Temperature units respect user preferences (C/F)\n- [ ] Error handling for import failures\n- [ ] Responsive design (mobile-friendly)\n","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-09T10:52:36.617912412+11:00","updated_at":"2025-12-09T11:35:47.274967461+11:00","closed_at":"2025-12-09T11:35:47.274970341+11:00"}
{"id":"tilt_ui-r43","title":"Test MPC integration with real batch data","description":"Validate MPC integration using production batch data to ensure it prevents overshoot.\n\n**Test scenarios:**\n1. Heater-only mode (no cooler)\n2. Dual-mode (heater + cooler)\n3. MPC disabled (should use basic hysteresis)\n4. Insufficient history (should fall back gracefully)\n\n**Success criteria:**\n- No overshoot beyond ¬±0.5¬∞C of target\n- Smooth transitions (no rapid cycling)\n- Falls back to hysteresis when MPC unavailable\n\n**Location:** Manual testing on RPi deployment","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:22.163280576+11:00","updated_at":"2025-12-09T23:11:30.264595883+11:00","closed_at":"2025-12-09T23:11:30.264595883+11:00"}
{"id":"tilt_ui-vl5","title":"Add MPC configuration settings","description":"Add config settings to enable/disable MPC and configure MPC parameters (horizon, learning window, etc). This allows users to toggle MPC on/off and tune behavior.\n\n**Config fields:**\n- mpc_enabled (bool, default=False for backward compat)\n- mpc_horizon_hours (float, default=4.0)\n- mpc_learning_window_hours (float, default=24.0)\n\n**Location:** backend/database.py config migrations + backend/routers/config.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:16.101929656+11:00","updated_at":"2025-12-09T23:11:30.262001074+11:00","closed_at":"2025-12-09T23:11:30.262001074+11:00"}
{"id":"tilt_ui-vpd","title":"Modify control_batch_temperature to use MPC compute_action","description":"Replace basic hysteresis thresholds with MPC compute_action() when MPC is enabled and model is available.\n\n**Logic flow:**\n1. Check if mpc_enabled config is true\n2. Get or create MPC controller for batch\n3. If model not learned yet, learn from history\n4. Call mpc.compute_action(current_temp, target_temp, ambient_temp, heater_state, cooler_state)\n5. Use returned heater_on/cooler_on decisions\n6. Fall back to basic hysteresis if MPC unavailable or fails\n\n**Location:** backend/temp_controller.py:control_batch_temperature()","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-09T21:11:19.89570758+11:00","updated_at":"2025-12-09T23:11:30.263686693+11:00","closed_at":"2025-12-09T23:11:30.263686693+11:00"}
{"id":"tilt_ui-xlz","title":"AI Brewing Assistant with Recipe Generation","description":"## Overview\nAdd an AI-powered brewing assistant to help users create recipes, troubleshoot fermentation issues, and get brewing advice.\n\n## Features\n\n### 1. LLM Backend Options\n- **Local SLM**: Support for local small language models (Ollama, llama.cpp)\n  - Privacy-first option (no data leaves user's network)\n  - Works offline\n  - Models: Llama 3, Mistral, Phi-3, etc.\n  \n- **Cloud LLM APIs**: Optional integration with commercial APIs\n  - OpenAI (GPT-4, GPT-3.5)\n  - Anthropic (Claude)\n  - DeepSeek\n  - User provides their own API key\n  - Stored securely in app config\n\n### 2. Recipe Generation from Prompts\n- Natural language recipe creation\n- Examples:\n  - \"Create a Pliny the Elder clone for my 5-gallon system\"\n  - \"Design a hazy IPA with Citra and Mosaic hops\"\n  - \"Make a Belgian Tripel targeting 9% ABV\"\n  \n- **Context-Aware**:\n  - Uses user's equipment profile (batch size, efficiency)\n  - Considers available inventory (if implemented)\n  - Respects system constraints (mash tun capacity, etc.)\n  \n- **Output**: BrewSignal recipe schema (BeerJSON compatible)\n  - Can be imported directly into recipe library\n  - Includes all standard fields (grains, hops, yeast, mash schedule)\n\n### 3. Fermentation Assistant\n- Answer brewing questions\n- Troubleshoot fermentation issues\n  - \"My gravity is stuck at 1.020, what should I do?\"\n  - \"Is this fermentation curve normal?\"\n- Provide style-specific advice\n- Suggest recipe modifications based on historical batch data\n\n### 4. Context Integration\n- Access to user's batch history\n- Current fermentation data (gravity curves, temperature profiles)\n- Recipe library for learning user preferences\n- Equipment profile for accurate calculations\n\n## Technical Considerations\n\n### Backend Architecture\n- New router: \n- Service layer: \n  -  - Abstract LLM interface\n  -  - Ollama/llama.cpp integration\n  -  - API client for OpenAI/Anthropic/DeepSeek\n  -  - Recipe generation logic\n  -  - Structured prompts for recipe generation\n  \n### Configuration\n- Settings page for LLM configuration\n  - Choose backend (local vs cloud)\n  - API key management (encrypted storage)\n  - Model selection\n  - Temperature/creativity controls\n\n### Recipe Schema Output\n- Generate valid BeerJSON 2.0 format\n- Include calculated values (OG, FG, IBU, SRM, ABV)\n- Validate against schema before presenting to user\n- Allow user to review/modify before saving\n\n### UI Components\n- Chat interface for assistant\n- Recipe generation form with prompt input\n- Preview pane for generated recipes\n- One-click import to recipe library\n\n## Dependencies\n- LLM integration library (e.g., LangChain, LiteLLM for unified API)\n- Ollama server (optional, for local LLM)\n- Recipe calculation engine (reuse existing BrewSignal logic)\n\n## Future Enhancements\n- Multi-turn conversation for recipe refinement\n- Learn from user's successful batches\n- Suggest recipe adjustments based on fermentation telemetry\n- Batch prediction (\"How will this recipe turn out based on my history?\")\n- Integration with ingredients database (when available)\n\n## Security \u0026 Privacy\n- API keys encrypted at rest\n- Local LLM option for privacy-conscious users\n- User data never sent to cloud without explicit consent\n- Rate limiting for API calls to prevent cost overruns","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-09T20:49:49.775721886+11:00","updated_at":"2025-12-09T20:49:49.775721886+11:00"}
{"id":"tilt_ui-xmv","title":"Fix type coercion security bypass (CVSS 7.5)","description":"Pydantic auto-converts strings to floats, bypassing type safety. Add @field_validator(mode='before') to reject non-numeric types. See todo 002.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T11:32:08.891258349+11:00","updated_at":"2025-12-10T11:36:27.253919919+11:00","closed_at":"2025-12-10T11:36:27.253919919+11:00"}
{"id":"tilt_ui-yt6","title":"Fix temperature overshoot with asymmetric hysteresis","description":"## Problem\nCurrent symmetric hysteresis causes 1¬∞C overshoot:\n- Heater ON at target - 1¬∞C (19¬∞C)\n- Heater OFF at target + 1¬∞C (21¬∞C) ‚Üê overshoots by 1¬∞C\n\n## Solution\nUse asymmetric hysteresis - turn OFF at target instead of target + hysteresis:\n- Heater ON at target - hysteresis (19¬∞C)\n- Heater OFF at target (20¬∞C) ‚Üê no overshoot\n\n## Implementation\nChange 2 lines in backend/temp_controller.py:\n\n```python\n# Line 413-414 (heating)\nheat_on_threshold = round(target_temp - hysteresis, 1)\nheat_off_threshold = round(target_temp, 1)  # Changed from target_temp + hysteresis\n\n# Line 446-447 (cooling) \ncool_on_threshold = round(target_temp + hysteresis, 1)\ncool_off_threshold = round(target_temp, 1)  # Changed from target_temp - hysteresis\n```\n\n## Testing\n- Deploy to RPi\n- Monitor one batch through full fermentation\n- Verify temperature stays within ¬±0.5¬∞C of target\n\n## Rollback\nIf this causes issues, revert to symmetric hysteresis (restore + hysteresis)\n\n## Related\n- Issue #69 - original overshoot problem\n- MPC integration deferred until this simpler approach tested","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-09T23:11:31.13656325+11:00","updated_at":"2025-12-09T23:15:26.724352427+11:00","closed_at":"2025-12-09T23:15:26.724352427+11:00"}
{"id":"tilt_ui-zv4","title":"Update documentation for BrewSignal Recipe Format v1.0","description":"Update project documentation to reference the new BrewSignal Recipe Format v1.0.\n\n## Files to Update\n\n### 1. CLAUDE.md (Project Instructions)\n\nAdd section after \"Recipe \u0026 Batch Pydantic Schemas\":\n\n```markdown\n## BrewSignal Recipe Format v1.0\n\nBrewSignal has its own recipe format optimized for fermentation monitoring:\n\n**Specification**: `docs/BREWSIGNAL_RECIPE_FORMAT_V1.md`\n**JSON Schema**: `backend/schemas/brewsignal-recipe-v1.0.schema.json`\n**Examples**: `examples/recipes/`\n\n### Key Differences from BeerJSON\n\n- **Simpler**: Raw numbers instead of unit objects (`og: 1.050` vs `{\"value\": 1.050, \"unit\": \"sg\"}`)\n- **Shorter field names**: `og`, `fg`, `abv` (not `original_gravity`, `final_gravity`, `alcohol_by_volume`)\n- **Fermentation-focused**: Optimized for tracking, not brew day\n- **Extensions**: `brewsignal_extensions` for fermentation tracking, temp control, yeast management\n\n### Format Usage\n\n**Internal storage**: Database uses simple format (matches BrewSignal)\n**API responses**: Pydantic schemas return BrewSignal format (simple, not verbose)\n**Import pipeline**: BeerXML/Brewfather/BeerJSON ‚Üí BrewSignal ‚Üí Database\n**Export**: Database ‚Üí BrewSignal or BeerJSON (for ecosystem compatibility)\n\n### When to Use Which Format\n\n- **BrewSignal format**: Manual recipe creation, API responses, internal storage\n- **BeerJSON format**: Import/export for compatibility with other brewing software\n- **BeerXML format**: Legacy import only (not recommended for new recipes)\n\n### BrewSignal Extensions\n\nUse `format_extensions.brewsignal` in Recipe model for:\n- Fermentation tracking config (OG validation, FG prediction, anomaly detection)\n- Batch defaults (auto-link device, temperature control settings)\n- Yeast management (pitch rates, starter calculations, rehydration)\n\nExample:\n```python\nrecipe = await db.get(Recipe, recipe_id)\nextensions = recipe.format_extensions.get('brewsignal', {})\nfermentation_config = extensions.get('fermentation_tracking', {})\nif fermentation_config.get('fg_prediction', {}).get('enabled'):\n    # Enable ML-based FG prediction\n    pass\n```\n```\n\n### 2. API Documentation (docs/API.md or OpenAPI spec)\n\nAdd new endpoints:\n\n```markdown\n## Recipe Export\n\n**GET** `/api/recipes/{id}/export`\n\nExport recipe in various formats.\n\n**Query Parameters**:\n- `format`: \"brewsignal\" (default), \"beerjson\", \"beerxml\"\n- `include_extensions`: true/false (default: true)\n\n**Response**:\n- Content-Type: `application/vnd.brewsignal.v1+json` (for BrewSignal format)\n- Content-Disposition: `attachment; filename=\"recipe-name-2025-12-09.brewsignal\"`\n\n**Example**:\n```bash\ncurl -O http://localhost:8080/api/recipes/1/export?format=brewsignal\n```\n\n## Recipe Validation\n\n**POST** `/api/recipes/validate`\n\nValidate recipe data before import.\n\n**Request Body**:\n```json\n{\n  \"format\": \"brewsignal\",\n  \"data\": { /* recipe data */ }\n}\n```\n\n**Response (Valid)**:\n```json\n{\n  \"valid\": true,\n  \"warnings\": []\n}\n```\n\n**Response (Invalid)**:\n```json\n{\n  \"valid\": false,\n  \"errors\": [\n    {\"field\": \"recipe.og\", \"error\": \"Value exceeds maximum\"}\n  ]\n}\n```\n```\n\n### 3. README.md (if exists)\n\nAdd section on recipe management:\n\n```markdown\n## Recipe Management\n\nBrewSignal supports multiple recipe formats:\n\n- **Import**: BeerXML, BeerJSON, Brewfather JSON\n- **Native Format**: BrewSignal Recipe Format v1.0 (simplified JSON)\n- **Export**: BrewSignal, BeerJSON, BeerXML\n\n### Recipe Features\n\n- ‚úÖ Multi-format import (auto-detection)\n- ‚úÖ Fermentation-specific extensions (OG validation, FG prediction, anomaly detection)\n- ‚úÖ Temperature control defaults per recipe\n- ‚úÖ Yeast management (pitch rates, starters, rehydration)\n- ‚úÖ Full CRUD via API\n- ‚úÖ Batch-to-recipe linking\n\nSee `docs/BREWSIGNAL_RECIPE_FORMAT_V1.md` for specification.\n```\n\n### 4. Frontend Documentation (if exists)\n\nAdd recipe format info for frontend developers:\n\n```markdown\n## Working with Recipes\n\nThe API returns recipes in BrewSignal format (simple, not verbose BeerJSON):\n\n```typescript\ninterface RecipeResponse {\n  id: number;\n  name: string;\n  og: number;          // Not wrapped in {value, unit}\n  fg: number;\n  abv: number;         // Percent (0-100), not 0-1\n  batch_size_liters: number;\n  // ...\n}\n```\n\n### Recipe Import\n\nSupported formats (auto-detected):\n- `.xml` ‚Üí BeerXML\n- `.json` ‚Üí BeerJSON or Brewfather JSON (auto-detected)\n- `.brewsignal` ‚Üí BrewSignal native format\n\n### Recipe Export\n\n```typescript\n// Export as BrewSignal format\nconst response = await fetch(`/api/recipes/${id}/export?format=brewsignal`);\nconst blob = await response.blob();\ndownloadFile(blob, `${recipeName}.brewsignal`);\n\n// Export as BeerJSON (for other apps)\nconst response = await fetch(`/api/recipes/${id}/export?format=beerjson`);\n```\n```\n\n## Tasks\n\n- [ ] Update CLAUDE.md with BrewSignal format section\n- [ ] Update API documentation (docs/API.md or OpenAPI spec)\n- [ ] Update README.md with recipe features\n- [ ] Update frontend documentation (if exists)\n- [ ] Add format comparison table (BrewSignal vs BeerJSON)\n- [ ] Add migration guide (\"How to convert existing recipes\")\n- [ ] Update architecture diagram (if exists)\n\n## Testing\n\n- [ ] Review all updated docs for accuracy\n- [ ] Check all code examples compile/run\n- [ ] Verify all links work\n- [ ] Check formatting (markdown linting)\n\n## Acceptance Criteria\n\n- CLAUDE.md includes BrewSignal format reference\n- API docs include new endpoints (export, validate)\n- Documentation explains when to use each format\n- Code examples are accurate and complete\n- Links to specification are correct","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T09:37:48.849634433+11:00","updated_at":"2025-12-10T09:37:48.849634433+11:00"}
