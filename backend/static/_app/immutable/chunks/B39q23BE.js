import{d as Ia,f as n,a as s,c as pe,s as p,e as Aa,t as ze}from"./mIejMQ-v.js";import{ah as Na,aq as _,p as D,ao as Ra,aj as Ya,ak as l,al as r,s as v,c as e,ai as j,an as t,at as G,ar as f,aw as Ma,ap as aa,as as ta,au as Ba}from"./TUuJpABw.js";import{e as Re,i as ga}from"./BMkmvfmB.js";import{i as c}from"./BpxQuLsu.js";import{r as Ne,s as Sa}from"./DZF_q5Xf.js";import{b as De}from"./CyJrDIBB.js";import{b as ra}from"./BF1BgN8s.js";import{s as Oa,b as Pa,d as ja,t as Ga,v as Ua}from"./BfEIqWbI.js";import{c as Le,a as Qa,f as Wa,g as za}from"./DUUrw8cp.js";import{f as Ja}from"./gKtBTYkw.js";import{s as Ha}from"./C9UR_sB3.js";import{p as Ka}from"./CfpcYks5.js";var Xa=n('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),Za=n('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),Va=n('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),$a=n('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),et=n('<p class="recipe-gravity svelte-1m8neh9"> </p>'),at=n('<p class="recipe-yeast svelte-1m8neh9"> </p>'),tt=n('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),rt=n('<span class="recipe-item-og svelte-1m8neh9"> </span>'),st=n('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),lt=n('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),ot=n('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function it(sa,u){Na(u,!0);let J=_(D([])),U=_(!0),he=_(null),te=_(""),be=j(()=>e(J).filter(b=>!e(te)||b.name.toLowerCase().includes(e(te).toLowerCase())||b.author?.toLowerCase().includes(e(te).toLowerCase()))),q=j(()=>u.selectedRecipeId?e(J).find(b=>b.id===u.selectedRecipeId):null);Ra(async()=>{try{v(J,await Oa(),!0)}catch(b){v(he,b instanceof Error?b.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",b)}finally{v(U,!1)}});function re(b){u.onSelect(b)}function ce(){u.onSelect(null)}var ge=ot(),de=r(ge),x=l(r(de),2);{var la=b=>{var A=Xa();A.__click=ce,s(b,A)};c(x,b=>{e(q)&&b(la)})}t(de);var oa=l(de,2);{var Je=b=>{var A=Za();s(b,A)},Ke=b=>{var A=pe(),se=G(A);{var fe=le=>{var ue=Va(),oe=r(ue),_e=r(oe,!0);t(oe),t(ue),f(()=>p(_e,e(he))),s(le,ue)},Ee=le=>{var ue=pe(),oe=G(ue);{var _e=o=>{var m=$a();s(o,m)},Ye=o=>{var m=pe(),K=G(m);{var He=M=>{var k=tt(),F=r(k),B=r(F),P=r(B,!0);t(B);var O=l(B,2);{var C=Q=>{var E=et(),R=r(E);t(E),f((W,X)=>p(R,`${W??""} → ${X??""}`),[()=>e(q).og.toFixed(3),()=>e(q).fg.toFixed(3)]),s(Q,E)};c(O,Q=>{e(q).og&&e(q).fg&&Q(C)})}var ye=l(O,2);{var Oe=Q=>{var E=at(),R=r(E,!0);t(E),f(()=>p(R,e(q).yeast_name)),s(Q,E)};c(ye,Q=>{e(q).yeast_name&&Q(Oe)})}t(F),t(k),f(()=>p(P,e(q).name)),s(M,k)},ia=M=>{var k=lt(),F=G(k);Ne(F);var B=l(F,2);Re(B,21,()=>e(be),P=>P.id,(P,O)=>{var C=st();C.__click=()=>re(e(O));var ye=r(C),Oe=r(ye,!0);t(ye);var Q=l(ye,2);{var E=R=>{var W=rt(),X=r(W,!0);t(W),f(Z=>p(X,Z),[()=>e(O).og.toFixed(3)]),s(R,W)};c(Q,R=>{e(O).og&&R(E)})}t(C),f(()=>p(Oe,e(O).name)),s(P,C)}),t(B),De(F,()=>e(te),P=>v(te,P)),s(M,k)};c(K,M=>{e(q)?M(He):M(ia,!1)})}s(o,m)};c(oe,o=>{e(J).length===0?o(_e):o(Ye,!1)},!0)}s(le,ue)};c(se,le=>{e(he)?le(fe):le(Ee,!1)},!0)}s(b,A)};c(oa,b=>{e(U)?b(Je):b(Ke,!1)})}t(ge),s(sa,ge),Ya()}Ia(["click"]);var nt=n('<button type="button" class="clear-btn svelte-1qv5788">Clear Selection</button>'),vt=n('<div class="loading svelte-1qv5788"><div class="spinner svelte-1qv5788"></div> <p>Loading yeast strains...</p></div>'),ct=n('<div class="error-box svelte-1qv5788"><p class="error-text svelte-1qv5788"> </p></div>'),dt=n('<div class="empty svelte-1qv5788"><p class="empty-text svelte-1qv5788">No yeast strains available.</p></div>'),ut=n('<span class="yeast-type svelte-1qv5788"> </span>'),_t=n('<p class="yeast-producer svelte-1qv5788"> </p>'),pt=n('<span class="spec svelte-1qv5788"> </span>'),ft=n('<span class="spec svelte-1qv5788"> </span>'),mt=n('<span class="spec svelte-1qv5788"> </span>'),ht=n('<div class="selected-yeast svelte-1qv5788"><div class="yeast-info svelte-1qv5788"><div class="yeast-header svelte-1qv5788"><p class="yeast-name svelte-1qv5788"> </p> <!></div> <!> <div class="yeast-specs svelte-1qv5788"><!> <!> <!></div></div></div>'),bt=n("<option> </option>"),gt=n('<span class="strain-type svelte-1qv5788"> </span>'),yt=n('<span class="detail svelte-1qv5788"> </span>'),xt=n('<span class="detail svelte-1qv5788"> </span>'),wt=n('<button type="button" class="strain-item svelte-1qv5788"><div class="strain-main svelte-1qv5788"><span class="strain-name svelte-1qv5788"> </span> <!></div> <div class="strain-details svelte-1qv5788"><!> <!></div></button>'),Ft=n('<div class="producer-group svelte-1qv5788"><h4 class="producer-name svelte-1qv5788"> </h4> <!></div>'),St=n('<div class="no-results svelte-1qv5788"><p class="svelte-1qv5788">No strains match your filters</p></div>'),qt=n('<div class="filters svelte-1qv5788"><input id="yeast-search" type="text" placeholder="Search yeast strains..." class="search-input svelte-1qv5788"/> <div class="filter-row svelte-1qv5788"><select class="filter-select svelte-1qv5788"><option>All Types</option><option>Ale</option><option>Lager</option><option>Wine</option><option>Wild</option></select> <select class="filter-select svelte-1qv5788"><option>All Producers</option><!></select></div></div> <div class="strain-list svelte-1qv5788"><!> <!></div>',1),Ct=n('<div class="yeast-selector svelte-1qv5788"><div class="selector-header svelte-1qv5788"><label for="yeast-search" class="selector-label svelte-1qv5788"> </label> <!></div> <!></div>');function Tt(sa,u){Na(u,!0);let J=Ka(u,"label",3,"Select Yeast Strain (Optional)"),U=_(D([])),he=_(D([])),te=_(!0),be=_(null),q=_(""),re=_(""),ce=_(""),ge=j(()=>()=>e(U).filter(o=>{const m=!e(q)||o.name.toLowerCase().includes(e(q).toLowerCase())||o.producer?.toLowerCase().includes(e(q).toLowerCase())||o.product_id?.toLowerCase().includes(e(q).toLowerCase()),K=!e(re)||o.type===e(re),He=!e(ce)||o.producer===e(ce);return m&&K&&He})),de=j(()=>()=>{const o={};for(const m of e(ge)()){const K=m.producer||"Other";o[K]||(o[K]=[]),o[K].push(m)}return Object.fromEntries(Object.entries(o).sort(([m],[K])=>m.localeCompare(K)))}),x=j(()=>u.selectedYeastId?e(U).find(o=>o.id===u.selectedYeastId):null);Ra(async()=>{try{const[o,m]=await Promise.all([Pa(),ja()]);v(U,o,!0),v(he,m,!0)}catch(o){v(be,o instanceof Error?o.message:"Failed to load yeast strains",!0),console.error("Failed to load yeast strains:",o)}finally{v(te,!1)}});function la(o){u.onSelect(o)}function oa(){u.onSelect(null)}function Je(o,m){return o==null&&m==null?"":o!=null&&m!=null?`${o.toFixed(0)}-${m.toFixed(0)}°C`:o!=null?`>${o.toFixed(0)}°C`:`<${m.toFixed(0)}°C`}function Ke(o,m){return o==null&&m==null?"":o!=null&&m!=null?`${o.toFixed(0)}-${m.toFixed(0)}%`:o!=null?`>${o.toFixed(0)}%`:`<${m.toFixed(0)}%`}function b(o){switch(o){case"ale":return"var(--positive)";case"lager":return"var(--info)";case"wine":return"var(--warning)";case"wild":return"var(--negative)";default:return"var(--text-secondary)"}}var A=Ct(),se=r(A),fe=r(se),Ee=r(fe,!0);t(fe);var le=l(fe,2);{var ue=o=>{var m=nt();m.__click=oa,s(o,m)};c(le,o=>{e(x)&&o(ue)})}t(se);var oe=l(se,2);{var _e=o=>{var m=vt();s(o,m)},Ye=o=>{var m=pe(),K=G(m);{var He=M=>{var k=ct(),F=r(k),B=r(F,!0);t(F),t(k),f(()=>p(B,e(be))),s(M,k)},ia=M=>{var k=pe(),F=G(k);{var B=O=>{var C=dt();s(O,C)},P=O=>{var C=pe(),ye=G(C);{var Oe=E=>{var R=ht(),W=r(R),X=r(W),Z=r(X),me=r(Z,!0);t(Z);var xe=l(Z,2);{var Ae=w=>{var d=ut(),S=r(d,!0);t(d),f(I=>{Ha(d,`color: ${I??""}`),p(S,e(x).type)},[()=>b(e(x).type)]),s(w,d)};c(xe,w=>{e(x).type&&w(Ae)})}t(X);var we=l(X,2);{var Me=w=>{var d=_t(),S=r(d,!0);t(d),f(()=>p(S,e(x).producer)),s(w,d)};c(we,w=>{e(x).producer&&w(Me)})}var ke=l(we,2),Ie=r(ke);{var Fe=w=>{var d=pt(),S=r(d);t(d),f(I=>p(S,`Attn: ${I??""}`),[()=>Ke(e(x).attenuation_low,e(x).attenuation_high)]),s(w,d)};c(Ie,w=>{(e(x).attenuation_low||e(x).attenuation_high)&&w(Fe)})}var Be=l(Ie,2);{var Pe=w=>{var d=ft(),S=r(d);t(d),f(I=>p(S,`Temp: ${I??""}`),[()=>Je(e(x).temp_low,e(x).temp_high)]),s(w,d)};c(Be,w=>{(e(x).temp_low||e(x).temp_high)&&w(Pe)})}var Xe=l(Be,2);{var Ze=w=>{var d=mt(),S=r(d);t(d),f(()=>p(S,`Floc: ${e(x).flocculation??""}`)),s(w,d)};c(Xe,w=>{e(x).flocculation&&w(Ze)})}t(ke),t(W),t(R),f(()=>p(me,e(x).name)),s(E,R)},Q=E=>{var R=qt(),W=G(R),X=r(W);Ne(X);var Z=l(X,2),me=r(Z),xe=r(me);xe.value=xe.__value="";var Ae=l(xe);Ae.value=Ae.__value="ale";var we=l(Ae);we.value=we.__value="lager";var Me=l(we);Me.value=Me.__value="wine";var ke=l(Me);ke.value=ke.__value="wild",t(me);var Ie=l(me,2),Fe=r(Ie);Fe.value=Fe.__value="";var Be=l(Fe);Re(Be,17,()=>e(he),ga,(d,S)=>{var I=bt(),je=r(I,!0);t(I);var Ve={};f(()=>{p(je,e(S)),Ve!==(Ve=e(S))&&(I.value=(I.__value=e(S))??"")}),s(d,I)}),t(Ie),t(Z),t(W);var Pe=l(W,2),Xe=r(Pe);Re(Xe,17,()=>Object.entries(e(de)()),([d,S])=>d,(d,S)=>{var I=j(()=>Ma(e(S),2));let je=()=>e(I)[0],Ve=()=>e(I)[1];var na=Ft(),va=r(na),ca=r(va,!0);t(va);var ya=l(va,2);Re(ya,17,Ve,Ge=>Ge.id,(Ge,Y)=>{var Ue=wt();Ue.__click=()=>la(e(Y));var da=r(Ue),ua=r(da),xa=r(ua,!0);t(ua);var qa=l(ua,2);{var wa=V=>{var z=gt(),a=r(z,!0);t(z),f(i=>{Ha(z,`color: ${i??""}`),p(a,e(Y).type)},[()=>b(e(Y).type)]),s(V,z)};c(qa,V=>{e(Y).type&&V(wa)})}t(da);var _a=l(da,2),pa=r(_a);{var fa=V=>{var z=yt(),a=r(z,!0);t(z),f(i=>p(a,i),[()=>Ke(e(Y).attenuation_low,e(Y).attenuation_high)]),s(V,z)};c(pa,V=>{(e(Y).attenuation_low||e(Y).attenuation_high)&&V(fa)})}var ma=l(pa,2);{var Ca=V=>{var z=xt(),a=r(z,!0);t(z),f(i=>p(a,i),[()=>Je(e(Y).temp_low,e(Y).temp_high)]),s(V,z)};c(ma,V=>{(e(Y).temp_low||e(Y).temp_high)&&V(Ca)})}t(_a),t(Ue),f(()=>p(xa,e(Y).name)),s(Ge,Ue)}),t(na),f(()=>p(ca,je())),s(d,na)});var Ze=l(Xe,2);{var w=d=>{var S=St();s(d,S)};c(Ze,d=>{Object.keys(e(de)()).length===0&&d(w)})}t(Pe),De(X,()=>e(q),d=>v(q,d)),ra(me,()=>e(re),d=>v(re,d)),ra(Ie,()=>e(ce),d=>v(ce,d)),s(E,R)};c(ye,E=>{e(x)?E(Oe):E(Q,!1)})}s(O,C)};c(F,O=>{e(U).length===0?O(B):O(P,!1)},!0)}s(M,k)};c(K,M=>{e(be)?M(He):M(ia,!1)},!0)}s(o,m)};c(oe,o=>{e(te)?o(_e):o(Ye,!1)})}t(A),f(()=>p(Ee,J())),s(sa,A),Ya()}Ia(["click"]);var Lt=n('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Dt=n('<p class="reference-text svelte-8ou9a2"> <!></p>'),Et=n('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),kt=n("<option> </option>"),It=n('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),Nt=n('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),Rt=n("<option><!> <!></option>"),Yt=n('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a device to track live gravity and temperature</span>',1),Ht=n('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),Ot=n("<option> </option>"),At=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),Mt=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),Bt=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),Pt=n("<option> </option>"),jt=n('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),Gt=n('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),Ut=n('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the cooler</span>'),Qt=n('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),Wt=n('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link heater and/or cooler switches from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="coolerEntity">Cooler Switch</label> <select id="coolerEntity" class="form-select svelte-8ou9a2"><option>No cooler assigned</option><!></select> <!></div> <!>',1),zt=n('<span class="spinner svelte-8ou9a2"></span> Saving...',1),Jt=n('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function ir(sa,u){Na(u,!0);let J=_(D(u.batch?.name||"")),U=_(D(u.batch?.recipe_id||null)),he=_(D(u.batch?.yeast_strain_id||null)),te=_(D(u.batch?.device_id||null)),be=_(D(u.batch?.status||"planning")),q=_(D(u.batch?.brew_date?u.batch.brew_date.split("T")[0]:"")),re=_(D(u.batch?.measured_og?.toString()||"")),ce=_(D(u.batch?.measured_fg?.toString()||"")),ge=_(D(u.batch?.notes||"")),de=_(D(u.batch?.heater_entity_id||"")),x=_(D(u.batch?.cooler_entity_id||""));function la(a){return a==null?"":Le.config.temp_units==="F"?Qa(a).toFixed(1):a.toFixed(1)}function oa(a){return a==null?"":Le.config.temp_units==="F"?(a*9/5).toFixed(1):a.toFixed(1)}function Je(a){if(!a)return;const i=parseFloat(a);if(!isNaN(i))return Le.config.temp_units==="F"?Wa(i):i}function Ke(a){if(!a)return;const i=parseFloat(a);if(!isNaN(i))return Le.config.temp_units==="F"?i*5/9:i}let b=_(D(la(u.batch?.temp_target))),A=_(D(oa(u.batch?.temp_hysteresis))),se=_(D([])),fe=_(D([])),Ee=_(D([])),le=_(D([])),ue=_(!0),oe=_(!1),_e=_(!1),Ye=_(!1),o=_(!1),m=j(za),K=j(()=>Le.config.temp_units==="C"?0:32),He=j(()=>Le.config.temp_units==="C"?38:100),ia=j(()=>Le.config.temp_units==="C"?.3:.5),M=j(()=>Le.config.temp_units==="C"?5.5:10),k=_(null),F=_(null),B=_(null),P=j(()=>Le.config.ha_enabled);const O=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let C=j(()=>!!u.batch);async function ye(){v(ue,!0);try{v(se,await Oa(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{v(ue,!1)}}async function Oe(){v(Ye,!0);try{v(le,await Ja(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{v(Ye,!1)}}async function Q(){if(e(P)){v(oe,!0);try{v(fe,await Ga(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{v(oe,!1)}}}async function E(){if(e(P)){v(_e,!0);try{v(Ee,await Ua(),!0)}catch(a){console.error("Failed to load cooler entities:",a)}finally{v(_e,!1)}}}function R(a){v(F,a,!0),a?(v(J,a.name,!0),v(U,a.id,!0),a.og&&v(re,a.og.toString(),!0)):v(U,null)}function W(a){v(B,a,!0),v(he,a?.id||null,!0)}async function X(a){if(a.preventDefault(),!e(o)){v(o,!0),v(k,null);try{const i={name:e(J)||void 0,status:e(be),device_id:e(te)||void 0,yeast_strain_id:e(he)||void 0,brew_date:e(q)?new Date(e(q)).toISOString():void 0,measured_og:e(re)?parseFloat(e(re)):void 0,notes:e(ge)||void 0,heater_entity_id:e(de)||void 0,cooler_entity_id:e(x)||void 0,temp_target:Je(e(b)),temp_hysteresis:Ke(e(A))};e(C)?i.recipe_id=e(U)||void 0:i.recipe_id=e(U)||void 0,e(C)&&e(ce)&&(i.measured_fg=parseFloat(e(ce))),await u.onSubmit(i)}catch(i){v(k,i instanceof Error?i.message:"Failed to save batch",!0)}finally{v(o,!1)}}}aa(()=>{if(!e(C)&&e(U)&&!e(J)){const a=e(se).find(i=>i.id===e(U));a&&v(J,a.name,!0)}}),aa(()=>{e(P)&&e(fe).length===0&&!e(oe)&&Q()}),aa(()=>{e(P)&&e(Ee).length===0&&!e(_e)&&E()}),aa(()=>{if(u.initialRecipeId&&e(se).length>0&&!e(F)){const a=e(se).find(i=>i.id===u.initialRecipeId);a&&R(a)}}),aa(()=>{if(e(C)&&u.batch?.recipe&&e(se).length>0&&!e(F)){const a=e(se).find(i=>i.id===u.batch.recipe_id);a&&v(F,a,!0)}}),aa(()=>{e(C)&&u.batch?.yeast_strain&&!e(B)&&v(B,u.batch.yeast_strain,!0)}),Ra(()=>{ye(),Oe(),Q(),E()});var Z=Jt(),me=r(Z),xe=r(me),Ae=r(xe,!0);t(xe);var we=l(xe,2),Me=r(we,!0);t(we),t(me);var ke=l(me,2);{var Ie=a=>{var i=Lt(),N=l(r(i));t(i),f(()=>p(N,` ${e(k)??""}`)),s(a,i)};c(ke,a=>{e(k)&&a(Ie)})}var Fe=l(ke,2),Be=r(Fe);{let a=j(()=>e(F)?.id);it(Be,{get selectedRecipeId(){return e(a)},onSelect:R})}var Pe=l(Be,2);{var Xe=a=>{var i=Et(),N=l(r(i),2);{var $=ie=>{var ne=Dt(),Se=r(ne),Qe=l(Se);{var We=qe=>{var ve=ze();f((T,Ce)=>p(ve,`(${T??""}-${Ce??""}°C)`),[()=>e(F).yeast_temp_min.toFixed(0),()=>e(F).yeast_temp_max.toFixed(0)]),s(qe,ve)};c(Qe,qe=>{e(F).yeast_temp_min&&e(F).yeast_temp_max&&qe(We)})}t(ne),f(()=>p(Se,`Yeast: ${e(F).yeast_name??""} `)),s(ie,ne)};c(N,ie=>{e(F).yeast_name&&ie($)})}t(i),s(a,i)};c(Pe,a=>{e(F)&&a(Xe)})}var Ze=l(Pe,2);{let a=j(()=>e(B)?.id);Tt(Ze,{get selectedYeastId(){return e(a)},onSelect:W,label:"Override Yeast Strain (Optional)"})}var w=l(Ze,2),d=l(r(w),2);Ne(d),ta(2),t(w);var S=l(w,2),I=l(r(S),2);Re(I,21,()=>O,ga,(a,i)=>{var N=kt(),$=r(N,!0);t(N);var ie={};f(()=>{p($,e(i).label),ie!==(ie=e(i).value)&&(N.value=(N.__value=e(i).value)??"")}),s(a,N)}),t(I),t(S);var je=l(S,2),Ve=l(r(je),2);{var na=a=>{var i=It();s(a,i)},va=a=>{var i=pe(),N=G(i);{var $=ne=>{var Se=Nt();s(ne,Se)},ie=ne=>{var Se=Yt(),Qe=G(Se),We=r(Qe);We.value=(We.__value=null)??"";var qe=l(We);Re(qe,17,()=>e(le),ga,(ve,T)=>{var Ce=Rt(),Fa=r(Ce);{var Ta=h=>{var y=ze();f(()=>p(y,`${e(T).color??""} Tilt`)),s(h,y)},La=h=>{var y=pe(),ee=G(y);{var ae=H=>{var Te=ze();f(()=>p(Te,`iSpindel ${(e(T).display_name||e(T).name)??""}`)),s(H,Te)},L=H=>{var Te=pe(),ka=G(Te);{var $e=ea=>{var ba=ze();f(()=>p(ba,`GravityMon ${(e(T).display_name||e(T).name)??""}`)),s(ea,ba)},ha=ea=>{var ba=ze();f(()=>p(ba,e(T).display_name||e(T).name)),s(ea,ba)};c(ka,ea=>{e(T).device_type==="gravitymon"?ea($e):ea(ha,!1)},!0)}s(H,Te)};c(ee,H=>{e(T).device_type==="ispindel"?H(ae):H(L,!1)},!0)}s(h,y)};c(Fa,h=>{e(T).device_type==="tilt"?h(Ta):h(La,!1)})}var Da=l(Fa,2);{var Ea=h=>{var y=ze();f(()=>p(y,`- ${e(T).beer_name??""}`)),s(h,y)};c(Da,h=>{e(T).beer_name&&e(T).beer_name!=="Untitled"&&h(Ea)})}t(Ce);var g={};f(()=>{g!==(g=e(T).id)&&(Ce.value=(Ce.__value=e(T).id)??"")}),s(ve,Ce)}),t(Qe),ta(2),ra(Qe,()=>e(te),ve=>v(te,ve)),s(ne,Se)};c(N,ne=>{e(le).length===0?ne($):ne(ie,!1)},!0)}s(a,i)};c(Ve,a=>{e(Ye)?a(na):a(va,!1)})}t(je);var ca=l(je,2),ya=l(r(ca),2);Ne(ya),ta(2),t(ca);var Ge=l(ca,2),Y=r(Ge),Ue=l(r(Y),2);Ne(Ue),t(Y);var da=l(Y,2);{var ua=a=>{var i=Ht(),N=l(r(i),2);Ne(N),t(i),De(N,()=>e(ce),$=>v(ce,$)),s(a,i)};c(da,a=>{e(C)&&a(ua)})}t(Ge);var xa=l(Ge,2);{var qa=a=>{var i=Wt(),N=l(G(i),2),$=l(r(N),2),ie=r($);ie.value=ie.__value="";var ne=l(ie);Re(ne,17,()=>e(fe),ga,(g,h)=>{var y=Ot(),ee=r(y);t(y);var ae={};f(()=>{p(ee,`${e(h).friendly_name??""} (${e(h).state??""})`),ae!==(ae=e(h).entity_id)&&(y.value=(y.__value=e(h).entity_id)??"")}),s(g,y)}),t($);var Se=l($,2);{var Qe=g=>{var h=At();s(g,h)},We=g=>{var h=pe(),y=G(h);{var ee=L=>{var H=Mt();s(L,H)},ae=L=>{var H=Bt();s(L,H)};c(y,L=>{e(fe).length===0?L(ee):L(ae,!1)},!0)}s(g,h)};c(Se,g=>{e(oe)?g(Qe):g(We,!1)})}t(N);var qe=l(N,2),ve=l(r(qe),2),T=r(ve);T.value=T.__value="";var Ce=l(T);Re(Ce,17,()=>e(Ee),ga,(g,h)=>{var y=Pt(),ee=r(y);t(y);var ae={};f(()=>{p(ee,`${e(h).friendly_name??""} (${e(h).state??""})`),ae!==(ae=e(h).entity_id)&&(y.value=(y.__value=e(h).entity_id)??"")}),s(g,y)}),t(ve);var Fa=l(ve,2);{var Ta=g=>{var h=jt();s(g,h)},La=g=>{var h=pe(),y=G(h);{var ee=L=>{var H=Gt();s(L,H)},ae=L=>{var H=Ut();s(L,H)};c(y,L=>{e(Ee).length===0?L(ee):L(ae,!1)},!0)}s(g,h)};c(Fa,g=>{e(_e)?g(Ta):g(La,!1)})}t(qe);var Da=l(qe,2);{var Ea=g=>{var h=Qt(),y=r(h),ee=r(y),ae=r(ee);t(ee);var L=l(ee,2);Ne(L),ta(2),t(y);var H=l(y,2),Te=r(H),ka=r(Te);t(Te);var $e=l(Te,2);Ne($e),ta(2),t(H),t(h),f(()=>{p(ae,`Target Temperature (${e(m)??""})`),Sa(L,"min",e(K)),Sa(L,"max",e(He)),p(ka,`Hysteresis (${e(m)??""})`),Sa($e,"min",e(ia)),Sa($e,"max",e(M))}),De(L,()=>e(b),ha=>v(b,ha)),De($e,()=>e(A),ha=>v(A,ha)),s(g,h)};c(Da,g=>{(e(de)||e(x))&&g(Ea)})}f(()=>{$.disabled=e(oe),ve.disabled=e(_e)}),ra($,()=>e(de),g=>v(de,g)),ra(ve,()=>e(x),g=>v(x,g)),s(a,i)};c(xa,a=>{e(P)&&a(qa)})}var wa=l(xa,2),_a=l(r(wa),2);Ba(_a),t(wa),t(Fe);var pa=l(Fe,2),fa=r(pa);fa.__click=function(...a){u.onCancel?.apply(this,a)};var ma=l(fa,2),Ca=r(ma);{var V=a=>{var i=zt();ta(),s(a,i)},z=a=>{var i=ze();f(()=>p(i,e(C)?"Save Changes":"Create Batch")),s(a,i)};c(Ca,a=>{e(o)?a(V):a(z,!1)})}t(ma),t(pa),t(Z),f(()=>{p(Ae,e(C)?"Edit Batch":"New Batch"),p(Me,e(C)?"Update batch details and measurements":"Create a new fermentation batch"),fa.disabled=e(o),ma.disabled=e(o)}),Aa("submit",Z,X),De(d,()=>e(J),a=>v(J,a)),ra(I,()=>e(be),a=>v(be,a)),De(ya,()=>e(q),a=>v(q,a)),De(Ue,()=>e(re),a=>v(re,a)),De(_a,()=>e(ge),a=>v(ge,a)),s(sa,Z),Ya()}Ia(["click"]);export{ir as B};
