import{d as Ge,f as p,e as Pe,a as m,s as b,t as oe}from"./Bospfddm.js";import{aa as Ue,an as v,p as f,ai as qe,b as e,ao as ie,s as i,ap as je,ad as r,aq as h,ab as ze,ac as s,af as l,ar as x,as as Je,at as Ke}from"./Ct6guFls.js";import{e as ne,i as ve}from"./BWBMZIDk.js";import{i as w}from"./CwTVp2do.js";import{r as T,c as Qe}from"./DFNIqi1n.js";import{b as S}from"./Bj4KDKTr.js";import{b as ue}from"./D_0YX2-N.js";import{f as Ve}from"./CLbiyCc-.js";import{t as We}from"./BThCPn6b.js";var Xe=p('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),Ze=p("<option> <!></option>"),$e=p('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="recipe">Recipe</label> <select id="recipe" class="form-select svelte-8ou9a2"><option>No recipe (manual batch)</option><!></select> <span class="form-hint svelte-8ou9a2">Select a recipe to auto-fill targets</span></div>'),ea=p("<option> </option>"),aa=p("<option> <!></option>"),ta=p('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),sa=p('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget">Target Temperature (°F)</label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis">Hysteresis (°F)</label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),la=p('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch Entity</label> <input type="text" id="heaterEntity" class="form-input svelte-8ou9a2" placeholder="switch.fermenter_heater"/> <span class="form-hint svelte-8ou9a2">e.g., switch.fermenter_heater_1</span></div> <!>',1),ra=p('<span class="spinner svelte-8ou9a2"></span> Saving...',1),oa=p('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function _a(we,n){Ue(n,!0);let C=v(f(n.batch?.name||"")),E=v(f(n.batch?.recipe_id||null)),P=v(f(n.batch?.device_id||null)),U=v(f(n.batch?.status||"planning")),H=v(f(n.batch?.brew_date?n.batch.brew_date.split("T")[0]:"")),M=v(f(n.batch?.measured_og?.toString()||"")),O=v(f(n.batch?.measured_fg?.toString()||"")),q=v(f(n.batch?.notes||"")),I=v(f(n.batch?.heater_entity_id||"")),N=v(f(n.batch?.temp_target?.toString()||"")),A=v(f(n.batch?.temp_hysteresis?.toString()||"")),j=v(f([])),z=v(!0),B=v(!1),L=v(null),Se=ie(()=>Array.from(We.tilts.values())),Fe=ie(()=>Qe.config.ha_enabled);const De=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let g=ie(()=>!!n.batch);async function Te(){i(z,!0);try{i(j,await Ve(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{i(z,!1)}}async function Be(a){if(a.preventDefault(),!e(B)){i(B,!0),i(L,null);try{const t={name:e(C)||void 0,status:e(U),device_id:e(P)||void 0,brew_date:e(H)?new Date(e(H)).toISOString():void 0,measured_og:e(M)?parseFloat(e(M)):void 0,notes:e(q)||void 0,heater_entity_id:e(I)||void 0,temp_target:e(N)?parseFloat(e(N)):void 0,temp_hysteresis:e(A)?parseFloat(e(A)):void 0};e(g)||(t.recipe_id=e(E)||void 0),e(g)&&e(O)&&(t.measured_fg=parseFloat(e(O))),await n.onSubmit(t)}catch(t){i(L,t instanceof Error?t.message:"Failed to save batch",!0)}finally{i(B,!1)}}}qe(()=>{if(!e(g)&&e(E)&&!e(C)){const a=e(j).find(t=>t.id===e(E));a&&i(C,a.name,!0)}}),je(()=>{Te()});var R=oa(),J=r(R),K=r(J),Ce=r(K,!0);l(K);var de=s(K,2),Ee=r(de,!0);l(de),l(J);var ce=s(J,2);{var ke=a=>{var t=Xe(),o=s(r(t));l(t),h(()=>b(o,` ${e(L)??""}`)),m(a,t)};w(ce,a=>{e(L)&&a(ke)})}var Q=s(ce,2),me=r(Q);{var He=a=>{var t=$e(),o=s(r(t),2),d=r(o);d.value=(d.__value=null)??"";var y=s(d);ne(y,17,()=>e(j),ve,(F,u)=>{var c=Ze(),_=r(c),Y=s(_);{var G=D=>{var xe=oe();h(Ye=>b(xe,`(OG: ${Ye??""})`),[()=>e(u).og_target.toFixed(3)]),m(D,xe)};w(Y,D=>{e(u).og_target&&D(G)})}l(c);var k={};h(()=>{b(_,`${e(u).name??""} `),k!==(k=e(u).id)&&(c.value=(c.__value=e(u).id)??"")}),m(F,c)}),l(o),x(2),l(t),h(()=>o.disabled=e(z)),ue(o,()=>e(E),F=>i(E,F)),m(a,t)};w(me,a=>{e(g)||a(He)})}var V=s(me,2),fe=s(r(V),2);T(fe),x(2),l(V);var W=s(V,2),X=s(r(W),2);ne(X,21,()=>De,ve,(a,t)=>{var o=ea(),d=r(o,!0);l(o);var y={};h(()=>{b(d,e(t).label),y!==(y=e(t).value)&&(o.value=(o.__value=e(t).value)??"")}),m(a,o)}),l(X),l(W);var Z=s(W,2),$=s(r(Z),2),ee=r($);ee.value=(ee.__value=null)??"";var Me=s(ee);ne(Me,17,()=>e(Se),ve,(a,t)=>{var o=aa(),d=r(o),y=s(d);{var F=c=>{var _=oe();h(()=>b(_,`- ${e(t).beer_name??""}`)),m(c,_)};w(y,c=>{e(t).beer_name&&e(t).beer_name!=="Untitled"&&c(F)})}l(o);var u={};h(()=>{b(d,`${e(t).color??""} Tilt `),u!==(u=e(t).id)&&(o.value=(o.__value=e(t).id)??"")}),m(a,o)}),l($),x(2),l(Z);var ae=s(Z,2),pe=s(r(ae),2);T(pe),x(2),l(ae);var te=s(ae,2),se=r(te),_e=s(r(se),2);T(_e),l(se);var Oe=s(se,2);{var Ie=a=>{var t=ta(),o=s(r(t),2);T(o),l(t),S(o,()=>e(O),d=>i(O,d)),m(a,t)};w(Oe,a=>{e(g)&&a(Ie)})}l(te);var be=s(te,2);{var Ne=a=>{var t=la(),o=s(Ke(t),2),d=s(r(o),2);T(d),x(2),l(o);var y=s(o,2);{var F=u=>{var c=sa(),_=r(c),Y=s(r(_),2);T(Y),x(2),l(_);var G=s(_,2),k=s(r(G),2);T(k),x(2),l(G),l(c),S(Y,()=>e(N),D=>i(N,D)),S(k,()=>e(A),D=>i(A,D)),m(u,c)};w(y,u=>{e(I)&&u(F)})}S(d,()=>e(I),u=>i(I,u)),m(a,t)};w(be,a=>{e(Fe)&&a(Ne)})}var he=s(be,2),ge=s(r(he),2);Je(ge),l(he),l(Q);var ye=s(Q,2),le=r(ye);le.__click=function(...a){n.onCancel?.apply(this,a)};var re=s(le,2),Ae=r(re);{var Le=a=>{var t=ra();x(),m(a,t)},Re=a=>{var t=oe();h(()=>b(t,e(g)?"Save Changes":"Create Batch")),m(a,t)};w(Ae,a=>{e(B)?a(Le):a(Re,!1)})}l(re),l(ye),l(R),h(()=>{b(Ce,e(g)?"Edit Batch":"New Batch"),b(Ee,e(g)?"Update batch details and measurements":"Create a new fermentation batch"),le.disabled=e(B),re.disabled=e(B)}),Pe("submit",R,Be),S(fe,()=>e(C),a=>i(C,a)),ue(X,()=>e(U),a=>i(U,a)),ue($,()=>e(P),a=>i(P,a)),S(pe,()=>e(H),a=>i(H,a)),S(_e,()=>e(M),a=>i(M,a)),S(ge,()=>e(q),a=>i(q,a)),m(we,R),ze()}Ge(["click"]);export{_a as B};
