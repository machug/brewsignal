import{d as Qe,f as _,e as Ve,a as n,s as x,t as be,c as We}from"./shYhah8v.js";import{aa as Xe,an as d,p,ai as Ce,b as e,ao as he,s as i,ap as Ze,ad as r,aq as h,ab as $e,ac as s,af as l,ar as C,as as ea,at as ke}from"./DtKnEsEX.js";import{e as J,i as K}from"./hU7ve28I.js";import{i as w}from"./DprM_ape.js";import{c as aa,r as A}from"./BfFIEfaM.js";import{b as k}from"./CKCRqHsA.js";import{b as Q}from"./BG8ESxBY.js";import{f as ta,a as sa}from"./BCxjSaTI.js";import{t as la}from"./BgHGPi20.js";var ra=_('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),oa=_("<option> <!></option>"),ia=_('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="recipe">Recipe</label> <select id="recipe" class="form-select svelte-8ou9a2"><option>No recipe (manual batch)</option><!></select> <span class="form-hint svelte-8ou9a2">Select a recipe to auto-fill targets</span></div>'),na=_("<option> </option>"),va=_("<option> <!></option>"),ua=_('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),da=_("<option> </option>"),ca=_('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),fa=_('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),ma=_('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),_a=_('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget">Target Temperature (°F)</label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5" min="32" max="100"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis">Hysteresis (°F)</label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5" min="0.5" max="10"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),pa=_('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link a heater switch from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <!>',1),ba=_('<span class="spinner svelte-8ou9a2"></span> Saving...',1),ha=_('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a Tilt to track live gravity and temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Ta(Ne,c){Xe(c,!0);let M=d(p(c.batch?.name||"")),O=d(p(c.batch?.recipe_id||null)),V=d(p(c.batch?.device_id||null)),W=d(p(c.batch?.status||"planning")),L=d(p(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),R=d(p(c.batch?.measured_og?.toString()||"")),Y=d(p(c.batch?.measured_fg?.toString()||"")),X=d(p(c.batch?.notes||"")),G=d(p(c.batch?.heater_entity_id||"")),P=d(p(c.batch?.temp_target?.toString()||"")),U=d(p(c.batch?.temp_hysteresis?.toString()||"")),Z=d(p([])),q=d(p([])),$=d(!0),I=d(!1),N=d(!1),j=d(null),Ae=he(()=>Array.from(la.tilts.values())),ee=he(()=>aa.config.ha_enabled);const Me=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let F=he(()=>!!c.batch);async function Oe(){i($,!0);try{i(Z,await sa(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{i($,!1)}}async function ge(){if(e(ee)){i(I,!0);try{i(q,await ta(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{i(I,!1)}}}async function Ie(a){if(a.preventDefault(),!e(N)){i(N,!0),i(j,null);try{const t={name:e(M)||void 0,status:e(W),device_id:e(V)||void 0,brew_date:e(L)?new Date(e(L)).toISOString():void 0,measured_og:e(R)?parseFloat(e(R)):void 0,notes:e(X)||void 0,heater_entity_id:e(G)||void 0,temp_target:e(P)?parseFloat(e(P)):void 0,temp_hysteresis:e(U)?parseFloat(e(U)):void 0};e(F)||(t.recipe_id=e(O)||void 0),e(F)&&e(Y)&&(t.measured_fg=parseFloat(e(Y))),await c.onSubmit(t)}catch(t){i(j,t instanceof Error?t.message:"Failed to save batch",!0)}finally{i(N,!1)}}}Ce(()=>{if(!e(F)&&e(O)&&!e(M)){const a=e(Z).find(t=>t.id===e(O));a&&i(M,a.name,!0)}}),Ce(()=>{e(ee)&&e(q).length===0&&!e(I)&&ge()}),Ze(()=>{Oe(),ge()});var z=ha(),ae=r(z),te=r(ae),Le=r(te,!0);l(te);var ye=s(te,2),Re=r(ye,!0);l(ye),l(ae);var xe=s(ae,2);{var Ye=a=>{var t=ra(),o=s(r(t));l(t),h(()=>x(o,` ${e(j)??""}`)),n(a,t)};w(xe,a=>{e(j)&&a(Ye)})}var se=s(xe,2),we=r(se);{var Ge=a=>{var t=ia(),o=s(r(t),2),f=r(o);f.value=(f.__value=null)??"";var g=s(f);J(g,17,()=>e(Z),K,(D,y)=>{var b=oa(),E=r(b),_e=s(E);{var pe=u=>{var m=be();h(H=>x(m,`(OG: ${H??""})`),[()=>e(y).og_target.toFixed(3)]),n(u,m)};w(_e,u=>{e(y).og_target&&u(pe)})}l(b);var v={};h(()=>{x(E,`${e(y).name??""} `),v!==(v=e(y).id)&&(b.value=(b.__value=e(y).id)??"")}),n(D,b)}),l(o),C(2),l(t),h(()=>o.disabled=e($)),Q(o,()=>e(O),D=>i(O,D)),n(a,t)};w(we,a=>{e(F)||a(Ge)})}var le=s(we,2),Se=s(r(le),2);A(Se),C(2),l(le);var re=s(le,2),oe=s(r(re),2);J(oe,21,()=>Me,K,(a,t)=>{var o=na(),f=r(o,!0);l(o);var g={};h(()=>{x(f,e(t).label),g!==(g=e(t).value)&&(o.value=(o.__value=e(t).value)??"")}),n(a,o)}),l(oe),l(re);var ie=s(re,2),ne=s(r(ie),2),ve=r(ne);ve.value=(ve.__value=null)??"";var Pe=s(ve);J(Pe,17,()=>e(Ae),K,(a,t)=>{var o=va(),f=r(o),g=s(f);{var D=b=>{var E=be();h(()=>x(E,`- ${e(t).beer_name??""}`)),n(b,E)};w(g,b=>{e(t).beer_name&&e(t).beer_name!=="Untitled"&&b(D)})}l(o);var y={};h(()=>{x(f,`${e(t).color??""} Tilt `),y!==(y=e(t).id)&&(o.value=(o.__value=e(t).id)??"")}),n(a,o)}),l(ne),C(2),l(ie);var ue=s(ie,2),Fe=s(r(ue),2);A(Fe),C(2),l(ue);var de=s(ue,2),ce=r(de),He=s(r(ce),2);A(He),l(ce);var Ue=s(ce,2);{var qe=a=>{var t=ua(),o=s(r(t),2);A(o),l(t),k(o,()=>e(Y),f=>i(Y,f)),n(a,t)};w(Ue,a=>{e(F)&&a(qe)})}l(de);var De=s(de,2);{var je=a=>{var t=pa(),o=s(ke(t),2),f=s(r(o),2),g=r(f);g.value=g.__value="";var D=s(g);J(D,17,()=>e(q),K,(v,u)=>{var m=da(),H=r(m);l(m);var T={};h(()=>{x(H,`${e(u).friendly_name??""} (${e(u).state??""})`),T!==(T=e(u).entity_id)&&(m.value=(m.__value=e(u).entity_id)??"")}),n(v,m)}),l(f);var y=s(f,2);{var b=v=>{var u=ca();n(v,u)},E=v=>{var u=We(),m=ke(u);{var H=S=>{var B=fa();n(S,B)},T=S=>{var B=ma();n(S,B)};w(m,S=>{e(q).length===0?S(H):S(T,!1)},!0)}n(v,u)};w(y,v=>{e(I)?v(b):v(E,!1)})}l(o);var _e=s(o,2);{var pe=v=>{var u=_a(),m=r(u),H=s(r(m),2);A(H),C(2),l(m);var T=s(m,2),S=s(r(T),2);A(S),C(2),l(T),l(u),k(H,()=>e(P),B=>i(P,B)),k(S,()=>e(U),B=>i(U,B)),n(v,u)};w(_e,v=>{e(G)&&v(pe)})}h(()=>f.disabled=e(I)),Q(f,()=>e(G),v=>i(G,v)),n(a,t)};w(De,a=>{e(ee)&&a(je)})}var Ee=s(De,2),Te=s(r(Ee),2);ea(Te),l(Ee),l(se);var Be=s(se,2),fe=r(Be);fe.__click=function(...a){c.onCancel?.apply(this,a)};var me=s(fe,2),ze=r(me);{var Je=a=>{var t=ba();C(),n(a,t)},Ke=a=>{var t=be();h(()=>x(t,e(F)?"Save Changes":"Create Batch")),n(a,t)};w(ze,a=>{e(N)?a(Je):a(Ke,!1)})}l(me),l(Be),l(z),h(()=>{x(Le,e(F)?"Edit Batch":"New Batch"),x(Re,e(F)?"Update batch details and measurements":"Create a new fermentation batch"),fe.disabled=e(N),me.disabled=e(N)}),Ve("submit",z,Ie),k(Se,()=>e(M),a=>i(M,a)),Q(oe,()=>e(W),a=>i(W,a)),Q(ne,()=>e(V),a=>i(V,a)),k(Fe,()=>e(L),a=>i(L,a)),k(He,()=>e(R),a=>i(R,a)),k(Te,()=>e(X),a=>i(X,a)),n(Ne,z),$e()}Qe(["click"]);export{Ta as B};
