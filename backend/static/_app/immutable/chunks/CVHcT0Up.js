import{d as ga,f as v,a as r,c as le,s as p,e as Aa,t as fe}from"./BPY3LF1i.js";import{a as ya,s as d,p as w,o as xa,g as wa,e as l,d as i,c as o,h as e,u as U,r as s,f as G,t as h,az as Se,n as Fe,i as Ba}from"./WzhiZOZ9.js";import{e as Ie,i as Le}from"./DnC7am1E.js";import{i as _}from"./DTo_ih-i.js";import{r as _e,s as ke}from"./D5Ox4mlS.js";import{b as se}from"./Cw-VE3R0.js";import{b as Me}from"./BX-VZZUc.js";import{T as Sa,U as Oa,V as Ua}from"./BKVJalqB.js";import{c as ee,e as Ga,f as Pa,g as za}from"./Dhf-mfqW.js";import{f as Qa}from"./gKtBTYkw.js";import{Y as ja}from"./CuwYG8CA.js";var qa=v('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),Ja=v('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),Ka=v('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),Wa=v('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),Xa=v('<p class="recipe-gravity svelte-1m8neh9"> </p>'),Za=v('<p class="recipe-yeast svelte-1m8neh9"> </p>'),Va=v('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),$a=v('<span class="recipe-item-og svelte-1m8neh9"> </span>'),et=v('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),at=v('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),tt=v('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function rt(Ye,c){ya(c,!0);let Y=d(w([])),j=d(!0),me=d(null),q=d(""),Te=U(()=>e(Y).filter(m=>!e(q)||m.name.toLowerCase().includes(e(q).toLowerCase())||m.author?.toLowerCase().includes(e(q).toLowerCase()))),T=U(()=>c.selectedRecipeId?e(Y).find(m=>m.id===c.selectedRecipeId):null);xa(async()=>{try{o(Y,await Sa(),!0)}catch(m){o(me,m instanceof Error?m.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",m)}finally{o(j,!1)}});function ie(m){c.onSelect(m)}function pe(){c.onSelect(null)}var oe=tt(),ae=i(oe),he=l(i(ae),2);{var Ae=m=>{var A=qa();A.__click=pe,r(m,A)};_(he,m=>{e(T)&&m(Ae)})}s(ae);var Be=l(ae,2);{var Oe=m=>{var A=Ja();r(m,A)},Ue=m=>{var A=le(),te=G(A);{var be=P=>{var J=Ka(),z=i(J),K=i(z,!0);s(z),s(J),h(()=>p(K,e(me))),r(P,J)},ge=P=>{var J=le(),z=G(J);{var K=C=>{var ne=Wa();r(C,ne)},Ce=C=>{var ne=le(),Ge=G(ne);{var Pe=re=>{var B=Va(),y=i(B),O=i(y),D=i(O,!0);s(O);var W=l(O,2);{var F=I=>{var N=Xa(),Q=i(N);s(N),h((ce,Ee)=>p(Q,`${ce??""} → ${Ee??""}`),[()=>e(T).og.toFixed(3),()=>e(T).fg.toFixed(3)]),r(I,N)};_(W,I=>{e(T).og&&e(T).fg&&I(F)})}var ve=l(W,2);{var De=I=>{var N=Za(),Q=i(N,!0);s(N),h(()=>p(Q,e(T).yeast_name)),r(I,N)};_(ve,I=>{e(T).yeast_name&&I(De)})}s(y),s(B),h(()=>p(D,e(T).name)),r(re,B)},ze=re=>{var B=at(),y=G(B);_e(y);var O=l(y,2);Ie(O,21,()=>e(Te),D=>D.id,(D,W)=>{var F=et();F.__click=()=>ie(e(W));var ve=i(F),De=i(ve,!0);s(ve);var I=l(ve,2);{var N=Q=>{var ce=$a(),Ee=i(ce,!0);s(ce),h(ye=>p(Ee,ye),[()=>e(W).og.toFixed(3)]),r(Q,ce)};_(I,Q=>{e(W).og&&Q(N)})}s(F),h(()=>p(De,e(W).name)),r(D,F)}),s(O),se(y,()=>e(q),D=>o(q,D)),r(re,B)};_(Ge,re=>{e(T)?re(Pe):re(ze,!1)})}r(C,ne)};_(z,C=>{e(Y).length===0?C(K):C(Ce,!1)},!0)}r(P,J)};_(te,P=>{e(me)?P(be):P(ge,!1)},!0)}r(m,A)};_(Be,m=>{e(j)?m(Oe):m(Ue,!1)})}s(oe),r(Ye,oe),wa()}ga(["click"]);var st=v('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),lt=v('<p class="reference-text svelte-8ou9a2"> <!></p>'),it=v('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),ot=v("<option> </option>"),nt=v('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),vt=v('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),ct=v("<option><!> <!></option>"),dt=v('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a device to track live gravity and temperature</span>',1),ut=v('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),ft=v("<option> </option>"),_t=v('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),mt=v('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),pt=v('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),ht=v("<option> </option>"),bt=v('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),gt=v('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),yt=v('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the cooler</span>'),xt=v('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),wt=v('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link heater and/or cooler switches from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="coolerEntity">Cooler Switch</label> <select id="coolerEntity" class="form-select svelte-8ou9a2"><option>No cooler assigned</option><!></select> <!></div> <!>',1),St=v('<span class="spinner svelte-8ou9a2"></span> Saving...',1),Ft=v('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Yt(Ye,c){ya(c,!0);let Y=d(w(c.batch?.name||"")),j=d(w(c.batch?.recipe_id||null)),me=d(w(c.batch?.yeast_strain_id||null)),q=d(w(c.batch?.device_id||null)),Te=d(w(c.batch?.status||"planning")),T=d(w(c.batch?.brew_date?c.batch.brew_date.split("T")[0]:"")),ie=d(w(c.batch?.measured_og?.toString()||"")),pe=d(w(c.batch?.measured_fg?.toString()||"")),oe=d(w(c.batch?.notes||"")),ae=d(w(c.batch?.heater_entity_id||"")),he=d(w(c.batch?.cooler_entity_id||""));function Ae(a){return a==null?"":ee.config.temp_units==="F"?Ga(a).toFixed(1):a.toFixed(1)}function Be(a){return a==null?"":ee.config.temp_units==="F"?(a*9/5).toFixed(1):a.toFixed(1)}function Oe(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return ee.config.temp_units==="F"?Pa(t):t}function Ue(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return ee.config.temp_units==="F"?t*5/9:t}let m=d(w(Ae(c.batch?.temp_target))),A=d(w(Be(c.batch?.temp_hysteresis))),te=d(w([])),be=d(w([])),ge=d(w([])),P=d(w([])),J=d(!0),z=d(!1),K=d(!1),Ce=d(!1),C=d(!1),ne=U(za),Ge=U(()=>ee.config.temp_units==="C"?0:32),Pe=U(()=>ee.config.temp_units==="C"?38:100),ze=U(()=>ee.config.temp_units==="C"?.3:.5),re=U(()=>ee.config.temp_units==="C"?5.5:10),B=d(null),y=d(null),O=d(null),D=U(()=>ee.config.ha_enabled);const W=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let F=U(()=>!!c.batch);async function ve(){o(J,!0);try{o(te,await Sa(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(J,!1)}}async function De(){o(Ce,!0);try{o(P,await Qa(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(Ce,!1)}}async function I(){if(e(D)){o(z,!0);try{o(be,await Oa(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(z,!1)}}}async function N(){if(e(D)){o(K,!0);try{o(ge,await Ua(),!0)}catch(a){console.error("Failed to load cooler entities:",a)}finally{o(K,!1)}}}function Q(a){o(y,a,!0),a?(o(Y,a.name,!0),o(j,a.id,!0),a.og&&o(ie,a.og.toString(),!0)):o(j,null)}function ce(a){o(O,a,!0),o(me,a?.id||null,!0)}async function Ee(a){if(a.preventDefault(),!e(C)){o(C,!0),o(B,null);try{const t={name:e(Y)||void 0,status:e(Te),device_id:e(q)||void 0,yeast_strain_id:e(me)||void 0,brew_date:e(T)?new Date(e(T)).toISOString():void 0,measured_og:e(ie)?parseFloat(e(ie)):void 0,notes:e(oe)||void 0,heater_entity_id:e(ae)||void 0,cooler_entity_id:e(he)||void 0,temp_target:Oe(e(m)),temp_hysteresis:Ue(e(A))};e(F)?t.recipe_id=e(j)||void 0:t.recipe_id=e(j)||void 0,e(F)&&e(pe)&&(t.measured_fg=parseFloat(e(pe))),await c.onSubmit(t)}catch(t){o(B,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(C,!1)}}}Se(()=>{if(!e(F)&&e(j)&&!e(Y)){const a=e(te).find(t=>t.id===e(j));a&&o(Y,a.name,!0)}}),Se(()=>{e(D)&&e(be).length===0&&!e(z)&&I()}),Se(()=>{e(D)&&e(ge).length===0&&!e(K)&&N()}),Se(()=>{if(c.initialRecipeId&&e(te).length>0&&!e(y)){const a=e(te).find(t=>t.id===c.initialRecipeId);a&&Q(a)}}),Se(()=>{if(e(F)&&c.batch?.recipe&&e(te).length>0&&!e(y)){const a=e(te).find(t=>t.id===c.batch.recipe_id);a&&o(y,a,!0)}}),Se(()=>{e(F)&&c.batch?.yeast_strain&&!e(O)&&o(O,c.batch.yeast_strain,!0)}),xa(()=>{ve(),De(),I(),N()});var ye=Ft(),Qe=i(ye),je=i(Qe),Fa=i(je,!0);s(je);var oa=l(je,2),Ta=i(oa,!0);s(oa),s(Qe);var na=l(Qe,2);{var Ca=a=>{var t=st(),x=l(i(t));s(t),h(()=>p(x,` ${e(B)??""}`)),r(a,t)};_(na,a=>{e(B)&&a(Ca)})}var qe=l(na,2),va=i(qe);{let a=U(()=>e(y)?.id);rt(va,{get selectedRecipeId(){return e(a)},onSelect:Q})}var ca=l(va,2);{var Da=a=>{var t=it(),x=l(i(t),2);{var E=L=>{var k=lt(),X=i(k),de=l(X);{var ue=Z=>{var M=fe();h((b,V)=>p(M,`(${b??""}-${V??""}°C)`),[()=>e(y).yeast_temp_min.toFixed(0),()=>e(y).yeast_temp_max.toFixed(0)]),r(Z,M)};_(de,Z=>{e(y).yeast_temp_min&&e(y).yeast_temp_max&&Z(ue)})}s(k),h(()=>p(X,`Yeast: ${e(y).yeast_name??""} `)),r(L,k)};_(x,L=>{e(y).yeast_name&&L(E)})}s(t),r(a,t)};_(ca,a=>{e(y)&&a(Da)})}var da=l(ca,2);{let a=U(()=>e(O)?.id);ja(da,{get selectedYeastId(){return e(a)},onSelect:ce,label:"Override Yeast Strain (Optional)"})}var Je=l(da,2),ua=l(i(Je),2);_e(ua),Fe(2),s(Je);var Ke=l(Je,2),We=l(i(Ke),2);Ie(We,21,()=>W,Le,(a,t)=>{var x=ot(),E=i(x,!0);s(x);var L={};h(()=>{p(E,e(t).label),L!==(L=e(t).value)&&(x.value=(x.__value=e(t).value)??"")}),r(a,x)}),s(We),s(Ke);var Xe=l(Ke,2),Ea=l(i(Xe),2);{var Ha=a=>{var t=nt();r(a,t)},Ra=a=>{var t=le(),x=G(t);{var E=k=>{var X=vt();r(k,X)},L=k=>{var X=dt(),de=G(X),ue=i(de);ue.value=(ue.__value=null)??"";var Z=l(ue);Ie(Z,17,()=>e(P),Le,(M,b)=>{var V=ct(),Ne=i(V);{var ta=n=>{var f=fe();h(()=>p(f,`${e(b).color??""} Tilt`)),r(n,f)},ra=n=>{var f=le(),H=G(f);{var R=S=>{var $=fe();h(()=>p($,`iSpindel ${(e(b).display_name||e(b).name)??""}`)),r(S,$)},g=S=>{var $=le(),ia=G($);{var xe=we=>{var Re=fe();h(()=>p(Re,`GravityMon ${(e(b).display_name||e(b).name)??""}`)),r(we,Re)},He=we=>{var Re=fe();h(()=>p(Re,e(b).display_name||e(b).name)),r(we,Re)};_(ia,we=>{e(b).device_type==="gravitymon"?we(xe):we(He,!1)},!0)}r(S,$)};_(H,S=>{e(b).device_type==="ispindel"?S(R):S(g,!1)},!0)}r(n,f)};_(Ne,n=>{e(b).device_type==="tilt"?n(ta):n(ra,!1)})}var sa=l(Ne,2);{var la=n=>{var f=fe();h(()=>p(f,`- ${e(b).beer_name??""}`)),r(n,f)};_(sa,n=>{e(b).beer_name&&e(b).beer_name!=="Untitled"&&n(la)})}s(V);var u={};h(()=>{u!==(u=e(b).id)&&(V.value=(V.__value=e(b).id)??"")}),r(M,V)}),s(de),Fe(2),Me(de,()=>e(q),M=>o(q,M)),r(k,X)};_(x,k=>{e(P).length===0?k(E):k(L,!1)},!0)}r(a,t)};_(Ea,a=>{e(Ce)?a(Ha):a(Ra,!1)})}s(Xe);var Ze=l(Xe,2),fa=l(i(Ze),2);_e(fa),Fe(2),s(Ze);var Ve=l(Ze,2),$e=i(Ve),_a=l(i($e),2);_e(_a),s($e);var Ia=l($e,2);{var Na=a=>{var t=ut(),x=l(i(t),2);_e(x),s(t),se(x,()=>e(pe),E=>o(pe,E)),r(a,t)};_(Ia,a=>{e(F)&&a(Na)})}s(Ve);var ma=l(Ve,2);{var La=a=>{var t=wt(),x=l(G(t),2),E=l(i(x),2),L=i(E);L.value=L.__value="";var k=l(L);Ie(k,17,()=>e(be),Le,(u,n)=>{var f=ft(),H=i(f);s(f);var R={};h(()=>{p(H,`${e(n).friendly_name??""} (${e(n).state??""})`),R!==(R=e(n).entity_id)&&(f.value=(f.__value=e(n).entity_id)??"")}),r(u,f)}),s(E);var X=l(E,2);{var de=u=>{var n=_t();r(u,n)},ue=u=>{var n=le(),f=G(n);{var H=g=>{var S=mt();r(g,S)},R=g=>{var S=pt();r(g,S)};_(f,g=>{e(be).length===0?g(H):g(R,!1)},!0)}r(u,n)};_(X,u=>{e(z)?u(de):u(ue,!1)})}s(x);var Z=l(x,2),M=l(i(Z),2),b=i(M);b.value=b.__value="";var V=l(b);Ie(V,17,()=>e(ge),Le,(u,n)=>{var f=ht(),H=i(f);s(f);var R={};h(()=>{p(H,`${e(n).friendly_name??""} (${e(n).state??""})`),R!==(R=e(n).entity_id)&&(f.value=(f.__value=e(n).entity_id)??"")}),r(u,f)}),s(M);var Ne=l(M,2);{var ta=u=>{var n=bt();r(u,n)},ra=u=>{var n=le(),f=G(n);{var H=g=>{var S=gt();r(g,S)},R=g=>{var S=yt();r(g,S)};_(f,g=>{e(ge).length===0?g(H):g(R,!1)},!0)}r(u,n)};_(Ne,u=>{e(K)?u(ta):u(ra,!1)})}s(Z);var sa=l(Z,2);{var la=u=>{var n=xt(),f=i(n),H=i(f),R=i(H);s(H);var g=l(H,2);_e(g),Fe(2),s(f);var S=l(f,2),$=i(S),ia=i($);s($);var xe=l($,2);_e(xe),Fe(2),s(S),s(n),h(()=>{p(R,`Target Temperature (${e(ne)??""})`),ke(g,"min",e(Ge)),ke(g,"max",e(Pe)),p(ia,`Hysteresis (${e(ne)??""})`),ke(xe,"min",e(ze)),ke(xe,"max",e(re))}),se(g,()=>e(m),He=>o(m,He)),se(xe,()=>e(A),He=>o(A,He)),r(u,n)};_(sa,u=>{(e(ae)||e(he))&&u(la)})}h(()=>{E.disabled=e(z),M.disabled=e(K)}),Me(E,()=>e(ae),u=>o(ae,u)),Me(M,()=>e(he),u=>o(he,u)),r(a,t)};_(ma,a=>{e(D)&&a(La)})}var pa=l(ma,2),ha=l(i(pa),2);Ba(ha),s(pa),s(qe);var ba=l(qe,2),ea=i(ba);ea.__click=function(...a){c.onCancel?.apply(this,a)};var aa=l(ea,2),ka=i(aa);{var Ma=a=>{var t=St();Fe(),r(a,t)},Ya=a=>{var t=fe();h(()=>p(t,e(F)?"Save Changes":"Create Batch")),r(a,t)};_(ka,a=>{e(C)?a(Ma):a(Ya,!1)})}s(aa),s(ba),s(ye),h(()=>{p(Fa,e(F)?"Edit Batch":"New Batch"),p(Ta,e(F)?"Update batch details and measurements":"Create a new fermentation batch"),ea.disabled=e(C),aa.disabled=e(C)}),Aa("submit",ye,Ee),se(ua,()=>e(Y),a=>o(Y,a)),Me(We,()=>e(Te),a=>o(Te,a)),se(fa,()=>e(T),a=>o(T,a)),se(_a,()=>e(ie),a=>o(ie,a)),se(ha,()=>e(oe),a=>o(oe,a)),r(Ye,ye),wa()}ga(["click"]);export{Yt as B};
