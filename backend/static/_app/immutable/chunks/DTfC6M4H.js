import{d as pa,f as v,a as r,c as oe,s as p,e as Ia,t as fe}from"./CsQfwH0S.js";import{ah as ha,aq as f,p as F,ao as ba,aj as ga,ak as l,al as i,s as o,c as e,ai as P,an as s,at as U,ar as h,ap as He,as as Fe,au as La}from"./fKkNMI8q.js";import{e as Re,i as ke}from"./COk1ZY4R.js";import{i as _}from"./BvBRaQNg.js";import{r as _e,s as Ie}from"./DbN3nGCc.js";import{b as ie}from"./C-0Ur6Zf.js";import{b as Le}from"./C8srtpii.js";import{l as ya,m as Ma,n as Aa}from"./i8VL_lOf.js";import{c as $,a as Ba,f as Oa,g as Ya}from"./CPwbAm-l.js";import{f as Ua}from"./gKtBTYkw.js";var Ga=v('<button type="button" class="clear-btn svelte-1m8neh9">Clear Selection</button>'),Pa=v('<div class="loading svelte-1m8neh9"><div class="spinner svelte-1m8neh9"></div> <p>Loading recipes...</p></div>'),ja=v('<div class="error-box svelte-1m8neh9"><p class="error-text svelte-1m8neh9"> </p></div>'),qa=v('<div class="empty svelte-1m8neh9"><p class="empty-text svelte-1m8neh9">No recipes yet.</p> <a href="/recipes/import" class="import-link svelte-1m8neh9">Import your first recipe</a></div>'),Qa=v('<p class="recipe-gravity svelte-1m8neh9"> </p>'),za=v('<p class="recipe-yeast svelte-1m8neh9"> </p>'),Ja=v('<div class="selected-recipe svelte-1m8neh9"><div class="recipe-info svelte-1m8neh9"><p class="recipe-name svelte-1m8neh9"> </p> <!> <!></div></div>'),Ka=v('<span class="recipe-item-og svelte-1m8neh9"> </span>'),Wa=v('<button type="button" class="recipe-item svelte-1m8neh9"><span class="recipe-item-name svelte-1m8neh9"> </span> <!></button>'),Xa=v('<input id="recipe-search" type="text" placeholder="Search recipes..." class="search-input svelte-1m8neh9"/> <div class="recipe-list svelte-1m8neh9"></div>',1),Za=v('<div class="recipe-selector svelte-1m8neh9"><div class="selector-header svelte-1m8neh9"><label for="recipe-search" class="selector-label svelte-1m8neh9">Select Recipe (Optional)</label> <!></div> <!></div>');function Va(Me,u){ha(u,!0);let B=f(F([])),j=f(!0),ne=f(null),q=f(""),me=P(()=>e(B).filter(m=>!e(q)||m.name.toLowerCase().includes(e(q).toLowerCase())||m.author?.toLowerCase().includes(e(q).toLowerCase()))),C=P(()=>u.selectedRecipeId?e(B).find(m=>m.id===u.selectedRecipeId):null);ba(async()=>{try{o(B,await ya(),!0)}catch(m){o(ne,m instanceof Error?m.message:"Failed to load recipes",!0),console.error("Failed to load recipes:",m)}finally{o(j,!1)}});function pe(m){u.onSelect(m)}function Se(){u.onSelect(null)}var ee=Za(),ae=i(ee),Ae=l(i(ae),2);{var Be=m=>{var T=Ga();T.__click=Se,r(m,T)};_(Ae,m=>{e(C)&&m(Be)})}s(ae);var Oe=l(ae,2);{var Ye=m=>{var T=Pa();r(m,T)},Ce=m=>{var T=oe(),he=U(T);{var be=Q=>{var R=ja(),G=i(R),ve=i(G,!0);s(G),s(R),h(()=>p(ve,e(ne))),r(Q,R)},Te=Q=>{var R=oe(),G=U(R);{var ve=z=>{var ge=qa();r(z,ge)},te=z=>{var ge=oe(),Ue=U(ge);{var Ge=O=>{var y=Ja(),N=i(y),re=i(N),S=i(re,!0);s(re);var J=l(re,2);{var se=k=>{var Y=Qa(),I=i(Y);s(Y),h((K,ce)=>p(I,`${K??""} → ${ce??""}`),[()=>e(C).og.toFixed(3),()=>e(C).fg.toFixed(3)]),r(k,Y)};_(J,k=>{e(C).og&&e(C).fg&&k(se)})}var le=l(J,2);{var ye=k=>{var Y=za(),I=i(Y,!0);s(Y),h(()=>p(I,e(C).yeast_name)),r(k,Y)};_(le,k=>{e(C).yeast_name&&k(ye)})}s(N),s(y),h(()=>p(S,e(C).name)),r(O,y)},Pe=O=>{var y=Xa(),N=U(y);_e(N);var re=l(N,2);Re(re,21,()=>e(me),S=>S.id,(S,J)=>{var se=Wa();se.__click=()=>pe(e(J));var le=i(se),ye=i(le,!0);s(le);var k=l(le,2);{var Y=I=>{var K=Ka(),ce=i(K,!0);s(K),h(je=>p(ce,je),[()=>e(J).og.toFixed(3)]),r(I,K)};_(k,I=>{e(J).og&&I(Y)})}s(se),h(()=>p(ye,e(J).name)),r(S,se)}),s(re),ie(N,()=>e(q),S=>o(q,S)),r(O,y)};_(Ue,O=>{e(C)?O(Ge):O(Pe,!1)})}r(z,ge)};_(G,z=>{e(B).length===0?z(ve):z(te,!1)},!0)}r(Q,R)};_(he,Q=>{e(ne)?Q(be):Q(Te,!1)},!0)}r(m,T)};_(Oe,m=>{e(j)?m(Ye):m(Ce,!1)})}s(ee),r(Me,ee),ga()}pa(["click"]);var $a=v('<div class="error-banner svelte-8ou9a2"><span class="error-icon svelte-8ou9a2">!</span> </div>'),et=v('<p class="reference-text svelte-8ou9a2"> <!></p>'),at=v('<div class="recipe-reference svelte-8ou9a2"><p class="reference-label svelte-8ou9a2">From Recipe:</p> <!></div>'),tt=v("<option> </option>"),rt=v('<span class="form-hint svelte-8ou9a2">Loading devices...</span>'),st=v('<div class="warning-message svelte-8ou9a2"><p class="svelte-8ou9a2">No paired devices available. Please <a href="/devices" class="svelte-8ou9a2">pair a device</a> before creating a batch.</p></div>'),lt=v("<option><!> <!></option>"),it=v('<select id="device" class="form-select svelte-8ou9a2"><option>No device assigned</option><!></select> <span class="form-hint svelte-8ou9a2">Link a device to track live gravity and temperature</span>',1),ot=v('<div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="fg">Measured FG</label> <input type="number" id="fg" class="form-input svelte-8ou9a2" placeholder="1.010" step="0.001" min="0.990" max="1.100"/></div>'),nt=v("<option> </option>"),vt=v('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),ct=v('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),dt=v('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the heater</span>'),ut=v("<option> </option>"),ft=v('<span class="form-hint svelte-8ou9a2">Loading available switches from Home Assistant...</span>'),_t=v('<span class="form-hint svelte-8ou9a2">No switches found in Home Assistant</span>'),mt=v('<span class="form-hint svelte-8ou9a2">Select a switch or input_boolean entity to control the cooler</span>'),pt=v('<div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempTarget"> </label> <input type="number" id="tempTarget" class="form-input svelte-8ou9a2" placeholder="68" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="tempHysteresis"> </label> <input type="number" id="tempHysteresis" class="form-input svelte-8ou9a2" placeholder="1.0" step="0.5"/> <span class="form-hint svelte-8ou9a2">Leave empty to use global setting</span></div></div>'),ht=v('<div class="form-section svelte-8ou9a2"><h3 class="section-title svelte-8ou9a2">Temperature Control</h3> <span class="section-hint svelte-8ou9a2">Link heater and/or cooler switches from Home Assistant to control fermentation temperature</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="heaterEntity">Heater Switch</label> <select id="heaterEntity" class="form-select svelte-8ou9a2"><option>No heater assigned</option><!></select> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="coolerEntity">Cooler Switch</label> <select id="coolerEntity" class="form-select svelte-8ou9a2"><option>No cooler assigned</option><!></select> <!></div> <!>',1),bt=v('<span class="spinner svelte-8ou9a2"></span> Saving...',1),gt=v('<form class="batch-form svelte-8ou9a2"><div class="form-header svelte-8ou9a2"><h2 class="form-title svelte-8ou9a2"> </h2> <p class="form-description svelte-8ou9a2"> </p></div> <!> <div class="form-body svelte-8ou9a2"><!> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="name">Batch Name</label> <input type="text" id="name" class="form-input svelte-8ou9a2" placeholder="e.g., Summer IPA #3" maxlength="200"/> <span class="form-hint svelte-8ou9a2">Optional - defaults to recipe name</span></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="status">Status</label> <select id="status" class="form-select svelte-8ou9a2"></select></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="device">Tracking Device</label> <!></div> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="brewDate">Brew Date</label> <input type="date" id="brewDate" class="form-input date-input svelte-8ou9a2"/> <span class="form-hint svelte-8ou9a2">DD/MM/YYYY</span></div> <div class="form-row svelte-8ou9a2"><div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="og">Measured OG</label> <input type="number" id="og" class="form-input svelte-8ou9a2" placeholder="1.050" step="0.001" min="0.990" max="1.200"/></div> <!></div> <!> <div class="form-group svelte-8ou9a2"><label class="form-label svelte-8ou9a2" for="notes">Notes</label> <textarea id="notes" class="form-textarea svelte-8ou9a2" placeholder="Brewing notes, observations, etc." rows="3"></textarea></div></div> <div class="form-footer svelte-8ou9a2"><button type="button" class="btn-cancel svelte-8ou9a2">Cancel</button> <button type="submit" class="btn-submit svelte-8ou9a2"><!></button></div></form>');function Rt(Me,u){ha(u,!0);let B=f(F(u.batch?.name||"")),j=f(F(u.batch?.recipe_id||null)),ne=f(F(u.batch?.device_id||null)),q=f(F(u.batch?.status||"planning")),me=f(F(u.batch?.brew_date?u.batch.brew_date.split("T")[0]:"")),C=f(F(u.batch?.measured_og?.toString()||"")),pe=f(F(u.batch?.measured_fg?.toString()||"")),Se=f(F(u.batch?.notes||"")),ee=f(F(u.batch?.heater_entity_id||"")),ae=f(F(u.batch?.cooler_entity_id||""));function Ae(a){return a==null?"":$.config.temp_units==="F"?Ba(a).toFixed(1):a.toFixed(1)}function Be(a){return a==null?"":$.config.temp_units==="F"?(a*9/5).toFixed(1):a.toFixed(1)}function Oe(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return $.config.temp_units==="F"?Oa(t):t}function Ye(a){if(!a)return;const t=parseFloat(a);if(!isNaN(t))return $.config.temp_units==="F"?t*5/9:t}let Ce=f(F(Ae(u.batch?.temp_target))),m=f(F(Be(u.batch?.temp_hysteresis))),T=f(F([])),he=f(F([])),be=f(F([])),Te=f(F([])),Q=f(!0),R=f(!1),G=f(!1),ve=f(!1),te=f(!1),z=P(Ya),ge=P(()=>$.config.temp_units==="C"?0:32),Ue=P(()=>$.config.temp_units==="C"?38:100),Ge=P(()=>$.config.temp_units==="C"?.3:.5),Pe=P(()=>$.config.temp_units==="C"?5.5:10),O=f(null),y=f(null),N=P(()=>$.config.ha_enabled);const re=[{value:"planning",label:"Planning"},{value:"fermenting",label:"Fermenting"},{value:"conditioning",label:"Conditioning"},{value:"completed",label:"Completed"},{value:"archived",label:"Archived"}];let S=P(()=>!!u.batch);async function J(){o(Q,!0);try{o(T,await ya(),!0)}catch(a){console.error("Failed to load recipes:",a)}finally{o(Q,!1)}}async function se(){o(ve,!0);try{o(Te,await Ua(!0),!0)}catch(a){console.error("Failed to load devices:",a)}finally{o(ve,!1)}}async function le(){if(e(N)){o(R,!0);try{o(he,await Ma(),!0)}catch(a){console.error("Failed to load heater entities:",a)}finally{o(R,!1)}}}async function ye(){if(e(N)){o(G,!0);try{o(be,await Aa(),!0)}catch(a){console.error("Failed to load cooler entities:",a)}finally{o(G,!1)}}}function k(a){o(y,a,!0),a?(o(B,a.name,!0),o(j,a.id,!0),a.og&&o(C,a.og.toString(),!0)):o(j,null)}async function Y(a){if(a.preventDefault(),!e(te)){o(te,!0),o(O,null);try{const t={name:e(B)||void 0,status:e(q),device_id:e(ne)||void 0,brew_date:e(me)?new Date(e(me)).toISOString():void 0,measured_og:e(C)?parseFloat(e(C)):void 0,notes:e(Se)||void 0,heater_entity_id:e(ee)||void 0,cooler_entity_id:e(ae)||void 0,temp_target:Oe(e(Ce)),temp_hysteresis:Ye(e(m))};e(S)?t.recipe_id=e(j)||void 0:t.recipe_id=e(j)||void 0,e(S)&&e(pe)&&(t.measured_fg=parseFloat(e(pe))),await u.onSubmit(t)}catch(t){o(O,t instanceof Error?t.message:"Failed to save batch",!0)}finally{o(te,!1)}}}He(()=>{if(!e(S)&&e(j)&&!e(B)){const a=e(T).find(t=>t.id===e(j));a&&o(B,a.name,!0)}}),He(()=>{e(N)&&e(he).length===0&&!e(R)&&le()}),He(()=>{e(N)&&e(be).length===0&&!e(G)&&ye()}),He(()=>{if(u.initialRecipeId&&e(T).length>0&&!e(y)){const a=e(T).find(t=>t.id===u.initialRecipeId);a&&k(a)}}),He(()=>{if(e(S)&&u.batch?.recipe&&e(T).length>0&&!e(y)){const a=e(T).find(t=>t.id===u.batch.recipe_id);a&&o(y,a,!0)}}),ba(()=>{J(),se(),le(),ye()});var I=gt(),K=i(I),ce=i(K),je=i(ce,!0);s(ce);var la=l(ce,2),xa=i(la,!0);s(la),s(K);var ia=l(K,2);{var wa=a=>{var t=$a(),x=l(i(t));s(t),h(()=>p(x,` ${e(O)??""}`)),r(a,t)};_(ia,a=>{e(O)&&a(wa)})}var qe=l(ia,2),oa=i(qe);{let a=P(()=>e(y)?.id);Va(oa,{get selectedRecipeId(){return e(a)},onSelect:k})}var na=l(oa,2);{var Fa=a=>{var t=at(),x=l(i(t),2);{var D=L=>{var M=et(),W=i(M),de=l(W);{var ue=X=>{var A=fe();h((b,Z)=>p(A,`(${b??""}-${Z??""}°C)`),[()=>e(y).yeast_temp_min.toFixed(0),()=>e(y).yeast_temp_max.toFixed(0)]),r(X,A)};_(de,X=>{e(y).yeast_temp_min&&e(y).yeast_temp_max&&X(ue)})}s(M),h(()=>p(W,`Yeast: ${e(y).yeast_name??""} `)),r(L,M)};_(x,L=>{e(y).yeast_name&&L(D)})}s(t),r(a,t)};_(na,a=>{e(y)&&a(Fa)})}var Qe=l(na,2),va=l(i(Qe),2);_e(va),Fe(2),s(Qe);var ze=l(Qe,2),Je=l(i(ze),2);Re(Je,21,()=>re,ke,(a,t)=>{var x=tt(),D=i(x,!0);s(x);var L={};h(()=>{p(D,e(t).label),L!==(L=e(t).value)&&(x.value=(x.__value=e(t).value)??"")}),r(a,x)}),s(Je),s(ze);var Ke=l(ze,2),Sa=l(i(Ke),2);{var Ca=a=>{var t=rt();r(a,t)},Ta=a=>{var t=oe(),x=U(t);{var D=M=>{var W=st();r(M,W)},L=M=>{var W=it(),de=U(W),ue=i(de);ue.value=(ue.__value=null)??"";var X=l(ue);Re(X,17,()=>e(Te),ke,(A,b)=>{var Z=lt(),Ne=i(Z);{var ea=n=>{var d=fe();h(()=>p(d,`${e(b).color??""} Tilt`)),r(n,d)},aa=n=>{var d=oe(),E=U(d);{var H=w=>{var V=fe();h(()=>p(V,`iSpindel ${(e(b).display_name||e(b).name)??""}`)),r(w,V)},g=w=>{var V=oe(),sa=U(V);{var xe=we=>{var Ee=fe();h(()=>p(Ee,`GravityMon ${(e(b).display_name||e(b).name)??""}`)),r(we,Ee)},De=we=>{var Ee=fe();h(()=>p(Ee,e(b).display_name||e(b).name)),r(we,Ee)};_(sa,we=>{e(b).device_type==="gravitymon"?we(xe):we(De,!1)},!0)}r(w,V)};_(E,w=>{e(b).device_type==="ispindel"?w(H):w(g,!1)},!0)}r(n,d)};_(Ne,n=>{e(b).device_type==="tilt"?n(ea):n(aa,!1)})}var ta=l(Ne,2);{var ra=n=>{var d=fe();h(()=>p(d,`- ${e(b).beer_name??""}`)),r(n,d)};_(ta,n=>{e(b).beer_name&&e(b).beer_name!=="Untitled"&&n(ra)})}s(Z);var c={};h(()=>{c!==(c=e(b).id)&&(Z.value=(Z.__value=e(b).id)??"")}),r(A,Z)}),s(de),Fe(2),Le(de,()=>e(ne),A=>o(ne,A)),r(M,W)};_(x,M=>{e(Te).length===0?M(D):M(L,!1)},!0)}r(a,t)};_(Sa,a=>{e(ve)?a(Ca):a(Ta,!1)})}s(Ke);var We=l(Ke,2),ca=l(i(We),2);_e(ca),Fe(2),s(We);var Xe=l(We,2),Ze=i(Xe),da=l(i(Ze),2);_e(da),s(Ze);var Da=l(Ze,2);{var Ea=a=>{var t=ot(),x=l(i(t),2);_e(x),s(t),ie(x,()=>e(pe),D=>o(pe,D)),r(a,t)};_(Da,a=>{e(S)&&a(Ea)})}s(Xe);var ua=l(Xe,2);{var Ha=a=>{var t=ht(),x=l(U(t),2),D=l(i(x),2),L=i(D);L.value=L.__value="";var M=l(L);Re(M,17,()=>e(he),ke,(c,n)=>{var d=nt(),E=i(d);s(d);var H={};h(()=>{p(E,`${e(n).friendly_name??""} (${e(n).state??""})`),H!==(H=e(n).entity_id)&&(d.value=(d.__value=e(n).entity_id)??"")}),r(c,d)}),s(D);var W=l(D,2);{var de=c=>{var n=vt();r(c,n)},ue=c=>{var n=oe(),d=U(n);{var E=g=>{var w=ct();r(g,w)},H=g=>{var w=dt();r(g,w)};_(d,g=>{e(he).length===0?g(E):g(H,!1)},!0)}r(c,n)};_(W,c=>{e(R)?c(de):c(ue,!1)})}s(x);var X=l(x,2),A=l(i(X),2),b=i(A);b.value=b.__value="";var Z=l(b);Re(Z,17,()=>e(be),ke,(c,n)=>{var d=ut(),E=i(d);s(d);var H={};h(()=>{p(E,`${e(n).friendly_name??""} (${e(n).state??""})`),H!==(H=e(n).entity_id)&&(d.value=(d.__value=e(n).entity_id)??"")}),r(c,d)}),s(A);var Ne=l(A,2);{var ea=c=>{var n=ft();r(c,n)},aa=c=>{var n=oe(),d=U(n);{var E=g=>{var w=_t();r(g,w)},H=g=>{var w=mt();r(g,w)};_(d,g=>{e(be).length===0?g(E):g(H,!1)},!0)}r(c,n)};_(Ne,c=>{e(G)?c(ea):c(aa,!1)})}s(X);var ta=l(X,2);{var ra=c=>{var n=pt(),d=i(n),E=i(d),H=i(E);s(E);var g=l(E,2);_e(g),Fe(2),s(d);var w=l(d,2),V=i(w),sa=i(V);s(V);var xe=l(V,2);_e(xe),Fe(2),s(w),s(n),h(()=>{p(H,`Target Temperature (${e(z)??""})`),Ie(g,"min",e(ge)),Ie(g,"max",e(Ue)),p(sa,`Hysteresis (${e(z)??""})`),Ie(xe,"min",e(Ge)),Ie(xe,"max",e(Pe))}),ie(g,()=>e(Ce),De=>o(Ce,De)),ie(xe,()=>e(m),De=>o(m,De)),r(c,n)};_(ta,c=>{(e(ee)||e(ae))&&c(ra)})}h(()=>{D.disabled=e(R),A.disabled=e(G)}),Le(D,()=>e(ee),c=>o(ee,c)),Le(A,()=>e(ae),c=>o(ae,c)),r(a,t)};_(ua,a=>{e(N)&&a(Ha)})}var fa=l(ua,2),_a=l(i(fa),2);La(_a),s(fa),s(qe);var ma=l(qe,2),Ve=i(ma);Ve.__click=function(...a){u.onCancel?.apply(this,a)};var $e=l(Ve,2),Ra=i($e);{var Na=a=>{var t=bt();Fe(),r(a,t)},ka=a=>{var t=fe();h(()=>p(t,e(S)?"Save Changes":"Create Batch")),r(a,t)};_(Ra,a=>{e(te)?a(Na):a(ka,!1)})}s($e),s(ma),s(I),h(()=>{p(je,e(S)?"Edit Batch":"New Batch"),p(xa,e(S)?"Update batch details and measurements":"Create a new fermentation batch"),Ve.disabled=e(te),$e.disabled=e(te)}),Ia("submit",I,Y),ie(va,()=>e(B),a=>o(B,a)),Le(Je,()=>e(q),a=>o(q,a)),ie(ca,()=>e(me),a=>o(me,a)),ie(da,()=>e(C),a=>o(C,a)),ie(_a,()=>e(Se),a=>o(Se,a)),r(Me,I),ga()}pa(["click"]);export{Rt as B};
