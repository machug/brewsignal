import{d as Je,f as p,s as h,a as u,e as kt,c as Ee}from"../chunks/BPY3LF1i.js";import{a as Xe,s as j,p as Me,az as wt,h as e,c,d as s,e as n,r,u as d,n as Be,t as x,g as Ze,f as ee,o as yt,A as Bt,ax as Et}from"../chunks/WzhiZOZ9.js";import{e as ce,i as Se}from"../chunks/DnC7am1E.js";import{i as B}from"../chunks/DTo_ih-i.js";import{h as Mt}from"../chunks/BJzfFUzm.js";import{s as $}from"../chunks/BYYdgBsh.js";import{t as $e}from"../chunks/DGrXzhna.js";import{w as re}from"../chunks/BfLysdZa.js";import{k as St}from"../chunks/D811_l9m.js";import{s as se,r as Ct}from"../chunks/D5Ox4mlS.js";import{s as O}from"../chunks/6KfV5OBv.js";import{b as Lt}from"../chunks/Cw-VE3R0.js";import{b as Tt}from"../chunks/l7yICoyS.js";import{p as qe}from"../chunks/AVMQxM7Q.js";import{a as jt,b as Dt,d as Ft,g as Gt}from"../chunks/DHBlVBC1.js";import{P as Pt,Q as Rt,R as At,S as Ut}from"../chunks/BKVJalqB.js";import{F as It}from"../chunks/D00h4oxf.js";var zt=p('<span class="error-message svelte-1k5rb4o"> </span>'),Vt=p('<div class="flex flex-col gap-1"><input type="text" maxlength="100"/> <!></div>'),Nt=p('<button type="button" class="beer-name-btn svelte-1k5rb4o" title="Click to edit batch name"><h3 class="text-lg font-semibold text-[var(--text-primary)] tracking-tight truncate"> </h3> <svg class="edit-icon svelte-1k5rb4o" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg></button>'),Ht=p('<div class="w-1 rounded-sm transition-all"></div>'),Kt=p('<div class="flex flex-col items-end gap-1"><div class="flex items-end gap-0.5"></div> <span class="text-[10px] text-[var(--text-muted)] font-mono"> </span></div>'),Ot=p('<div class="flex flex-col items-end gap-1"><div class="battery-icon svelte-1k5rb4o"><div class="battery-level svelte-1k5rb4o"></div></div> <span class="text-[10px] font-mono"> </span></div>'),Wt=p('<div class="confidence-badge svelte-1k5rb4o"><span class="text-xs"> </span> <span class="text-[10px]"> </span></div>'),Qt=p('<div class="pairing-badge svelte-1k5rb4o" title="Device not paired - readings not being logged"><svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg> Unpaired</div>'),Yt=p("<li> </li>"),qt=p('<div class="anomaly-alert svelte-1k5rb4o"><div class="flex items-start gap-2"><svg class="w-5 h-5 flex-shrink-0 mt-0.5 svelte-1k5rb4o" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg> <div class="flex-1"><p class="font-semibold text-sm mb-1">Anomaly Detected</p> <ul class="text-xs space-y-0.5 svelte-1k5rb4o"></ul></div></div></div>'),Jt=p(' <span class="reading-unit svelte-1k5rb4o"> </span>',1),Xt=p('--<span class="reading-unit svelte-1k5rb4o"> </span>',1),Zt=p('<div class="text-[11px] text-[var(--text-muted)] font-mono mb-3 px-1"><span class="opacity-60">Raw:</span> <span class="ml-1"> </span> <span class="mx-1 opacity-40">¬∑</span> <span> </span></div>'),$t=p("<div><!></div>"),ea=p('<button type="button" class="expand-btn svelte-1k5rb4o"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ta=p('<div><div class="h-0.5"></div> <div class="p-5"><div class="flex justify-between items-start mb-5"><div class="flex-1 min-w-0 mr-3"><!> <div class="flex items-center gap-2 mt-1"><span class="w-2 h-2 rounded-full"></span> <span class="text-sm text-[var(--text-muted)] font-medium"> </span></div></div> <div class="flex flex-col items-end gap-2"><!> <!> <!></div></div> <!> <div class="grid grid-cols-2 gap-3 mb-4"><div class="reading-box svelte-1k5rb4o"><p class="reading-value svelte-1k5rb4o"> <span class="reading-unit svelte-1k5rb4o"> </span></p> <p class="reading-label svelte-1k5rb4o"> </p></div> <div class="reading-box svelte-1k5rb4o"><p class="reading-value svelte-1k5rb4o"><!></p> <p class="reading-label svelte-1k5rb4o">Temp</p></div></div> <!>  <!> <div class="flex justify-between items-center pt-3 border-t border-[var(--bg-hover)]"><span class="text-[11px] text-[var(--text-muted)]"> </span> <div class="flex items-center gap-2"><a class="view-details-link svelte-1k5rb4o" aria-label="View batch details">View Details</a> <!> <div class="live-indicator svelte-1k5rb4o"></div></div></div></div></div>');function aa(ue,m){Xe(m,!0);let P=qe(m,"expanded",3,!1),W=qe(m,"wide",3,!1),f=d(()=>m.batch.device_id?$e.tilts.get(m.batch.device_id)??null:null),Q=d(()=>m.batch.name||m.batch.recipe?.name||`Batch #${m.batch.batch_number}`),z=d(()=>m.progress?.measured?.current_sg??m.batch.measured_og??1),R=d(()=>m.progress?.temperature?.current??null),Y=d(()=>e(f)?.color??"BLACK"),V=d(()=>e(f)?.rssi??null),I=d(()=>e(f)?.battery_percent??null),q=d(()=>e(f)?.device_type??null),pe=d(()=>e(q)==="tilt"||e(q)===null),ge=d(()=>e(f)?.paired??!0),me=d(()=>e(f)?.last_seen??new Date().toISOString()),te=d(()=>e(f)?.sg_raw??e(z)),J=d(()=>e(f)?.temp_raw??e(R)),le=d(()=>e(f)?.confidence??null),he=d(()=>e(f)?.is_anomaly??!1),ie=d(()=>e(f)?.anomaly_reasons??[]),N=d(()=>fe(e(le))),i=j(!1),_=j(Me([])),E=j(!1);wt(()=>{P()&&!e(i)&&(c(i,!0),e(E)||Pt(m.batch.id,168).then(t=>{c(_,t,!0),c(E,!0)}).catch(t=>{console.error("Failed to fetch control events:",t),c(_,[],!0),c(E,!0)}))});let k=j(!1),v=j(""),M=j(null),y=j(!1),L=j(null);function H(){c(v,e(Q),!0),c(k,!0),c(L,null),setTimeout(()=>e(M)?.focus(),0)}async function X(){if(e(y))return;const t=e(v).trim();if(!t||t===e(Q)){c(k,!1),c(L,null);return}c(y,!0),c(L,null);try{await Rt(m.batch.id,{name:t}),c(k,!1),m.onBatchUpdated&&await m.onBatchUpdated()}catch(a){console.error("Failed to update batch name:",a),c(L,a instanceof Error?a.message:"Failed to save batch name",!0)}finally{c(y,!1)}}function F(t){t.key==="Enter"?X():t.key==="Escape"&&c(k,!1)}let w=d(Gt),S=d(jt);const A={RED:"var(--tilt-red)",GREEN:"var(--tilt-green)",BLACK:"var(--tilt-black)",PURPLE:"var(--tilt-purple)",ORANGE:"var(--tilt-orange)",BLUE:"var(--tilt-blue)",YELLOW:"var(--tilt-yellow)",PINK:"var(--tilt-pink)"};function D(t){return Dt(t)}function U(t){return Ft(t)}function Z(t){return t>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:t>=-60?{bars:3,color:"var(--positive)",label:"Good"}:t>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function K(t){return t>=80?{color:"var(--positive)",label:"Good"}:t>=40?{color:"var(--warning)",label:"Medium"}:t>=20?{color:"var(--warning)",label:"Low"}:{color:"var(--negative)",label:"Critical"}}function fe(t){return t==null?null:t>=.8?{emoji:"üü¢",label:"High",color:"var(--positive)"}:t>=.5?{emoji:"üü°",label:"Medium",color:"var(--warning)"}:{emoji:"üî¥",label:"Low",color:"var(--negative)"}}function ne(t){const a=Math.floor((Date.now()-new Date(t).getTime())/1e3);if(a<10)return"just now";if(a<60)return`${a}s ago`;const l=Math.floor(a/60);if(l<60)return`${l}m ago`;const o=Math.floor(l/60);return o<24?`${o}h ago`:`${Math.floor(o/24)}d ago`}let oe=d(()=>A[e(Y)]||"var(--tilt-black)"),ve=d(()=>e(V)!==null?Z(e(V)):{bars:0,color:"var(--text-muted)",label:"No Signal"}),ae=d(()=>e(I)!==null?K(e(I)):null),et=d(()=>ne(e(me)));var de=ta();let Ce;var Le=s(de),Te=n(Le,2),_e=s(Te),be=s(_e),je=s(be);{var tt=t=>{var a=Vt(),l=s(a);Ct(l),l.__keydown=F;let o;Tt(l,b=>c(M,b),()=>e(M));var g=n(l,2);{var C=b=>{var T=zt(),G=s(T,!0);r(T),x(()=>h(G,e(L))),u(b,T)};B(g,b=>{e(L)&&b(C)})}r(a),x(()=>{l.disabled=e(y),o=$(l,1,"beer-name-input svelte-1k5rb4o",null,o,{error:e(L)})}),kt("blur",l,X),Lt(l,()=>e(v),b=>c(v,b)),u(t,a)},at=t=>{var a=Nt();a.__click=H;var l=s(a),o=s(l,!0);r(l),Be(2),r(a),x(()=>h(o,e(Q))),u(t,a)};B(je,t=>{e(k)?t(tt):t(at,!1)})}var De=n(je,2),Fe=s(De),Ge=n(Fe,2),rt=s(Ge,!0);r(Ge),r(De),r(be);var Pe=n(be,2),Re=s(Pe);{var st=t=>{var a=Kt(),l=s(a);ce(l,20,()=>Array(4),Se,(C,b,T)=>{var G=Ht();x(()=>O(G,`
										height: ${8+T*4}px;
										background: ${(T<e(ve).bars?e(ve).color:"var(--bg-hover)")??""};
										opacity: ${T<e(ve).bars?1:.4};
									`)),u(C,G)}),r(l);var o=n(l,2),g=s(o);r(o),r(a),x(()=>{se(a,"title",`${e(ve).label??""} signal (${e(V)??""} dBm)`),h(g,`${e(V)??""} dBm`)}),u(t,a)},lt=t=>{var a=Ee(),l=ee(a);{var o=g=>{var C=Ot(),b=s(C),T=s(b);r(b);var G=n(b,2),xt=s(G);r(G),r(C),x(()=>{se(C,"title",`Battery: ${e(ae).label??""} (${e(I)??""}%)`),O(b,`border-color: ${e(ae).color??""};`),O(T,`width: ${e(I)??""}%; background: ${e(ae).color??""};`),O(G,`color: ${e(ae).color??""};`),h(xt,`${e(I)??""}%`)}),u(g,C)};B(l,g=>{e(ae)&&e(I)!==null&&g(o)},!0)}u(t,a)};B(Re,t=>{e(pe)&&e(V)!==null?t(st):t(lt,!1)})}var Ae=n(Re,2);{var it=t=>{var a=Wt(),l=s(a),o=s(l,!0);r(l);var g=n(l,2),C=s(g,!0);r(g),r(a),x(b=>{se(a,"title",`ML confidence: ${e(N).label??""} (${b??""}%)`),h(o,e(N).emoji),O(g,`color: ${e(N).color??""};`),h(C,e(N).label)},[()=>(e(le)*100).toFixed(0)]),u(t,a)};B(Ae,t=>{e(N)&&t(it)})}var nt=n(Ae,2);{var ot=t=>{var a=Qt();u(t,a)};B(nt,t=>{e(ge)||t(ot)})}r(Pe),r(_e);var Ue=n(_e,2);{var vt=t=>{var a=qt(),l=s(a),o=n(s(l),2),g=n(s(o),2);ce(g,21,()=>e(ie),Se,(C,b)=>{var T=Yt(),G=s(T);r(T),x(()=>h(G,`‚Ä¢ ${e(b)??""}`)),u(C,T)}),r(g),r(o),r(l),r(a),u(t,a)};B(Ue,t=>{e(he)&&e(ie).length>0&&t(vt)})}var xe=n(Ue,2),ke=s(xe),we=s(ke),Ie=s(we,!0),ze=n(Ie),dt=s(ze,!0);r(ze),r(we);var Ve=n(we,2),ct=s(Ve,!0);r(Ve),r(ke);var Ne=n(ke,2),He=s(Ne),ut=s(He);{var pt=t=>{var a=Jt(),l=ee(a,!0),o=n(l),g=s(o,!0);r(o),x(C=>{h(l,C),h(g,e(w))},[()=>U(e(R))]),u(t,a)},gt=t=>{var a=Xt(),l=n(ee(a)),o=s(l,!0);r(l),x(()=>h(o,e(w))),u(t,a)};B(ut,t=>{e(R)!==null?t(pt):t(gt,!1)})}r(He),Be(2),r(Ne),r(xe);var Ke=n(xe,2);{var mt=t=>{var a=Zt(),l=n(s(a),2),o=s(l,!0);r(l);var g=n(l,4),C=s(g);r(g),r(a),x((b,T)=>{h(o,b),h(C,`${T??""}${e(w)??""}`)},[()=>D(e(te)),()=>e(J)!==null?U(e(J)):"--"]),u(t,a)};B(Ke,t=>{(e(z)!==e(te)||e(R)!==e(J))&&e(f)&&t(mt)})}var Oe=n(Ke,2);{var ht=t=>{var a=$t();let l;var o=s(a);St(o,()=>m.batch.id,g=>{It(g,{get batchId(){return m.batch.id},get deviceColor(){return e(Y)},get originalGravity(){return m.batch.measured_og},get controlEvents(){return e(_)}})}),r(a),x(()=>l=$(a,1,"chart-section svelte-1k5rb4o",null,l,{hidden:!P()})),u(t,a)};B(Oe,t=>{e(i)&&t(ht)})}var We=n(Oe,2),ye=s(We),ft=s(ye);r(ye);var Qe=n(ye,2),Ye=s(Qe),_t=n(Ye,2);{var bt=t=>{var a=ea();a.__click=function(...g){m.onToggleExpand?.apply(this,g)};var l=s(a);let o;r(a),x(()=>{se(a,"aria-label",P()?"Collapse chart":"Expand chart"),o=$(l,0,"w-4 h-4 transition-transform",null,o,{"rotate-180":P()})}),u(t,a)};B(_t,t=>{m.onToggleExpand&&t(bt)})}Be(2),r(Qe),r(We),r(Te),r(de),x(t=>{Ce=$(de,1,"card svelte-1k5rb4o",null,Ce,{expanded:P(),wide:W()}),O(Le,`background: ${e(oe)??""};`),O(Fe,`background: ${e(oe)??""};`),h(rt,e(Y)),h(Ie,t),h(dt,e(S)!=="SG"?e(S):""),h(ct,e(S)==="SG"?"Gravity":e(S)==="¬∞P"?"Plato":"Brix"),h(ft,`Updated ${e(et)??""}`),se(Ye,"href",`/batches/${m.batch.id??""}`)},[()=>D(e(z))]),u(ue,de),Ze()}Je(["keydown","click"]);var ra=p('<div><span class="alert-day svelte-1uha8ag"> </span> <span class="alert-message svelte-1uha8ag"> </span></div>'),sa=p('<div class="alerts-list svelte-1uha8ag"></div>'),la=p('<button type="button" class="show-more-btn svelte-1uha8ag"> </button>'),ia=p('<div class="alerts-banner svelte-1uha8ag"><div class="alerts-header svelte-1uha8ag"><div class="alerts-title svelte-1uha8ag"><svg class="w-5 h-5 svelte-1uha8ag" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" class="svelte-1uha8ag"></path></svg> <span class="svelte-1uha8ag">Weather Alerts</span> <span class="alerts-count svelte-1uha8ag"> </span></div> <button type="button" class="dismiss-btn svelte-1uha8ag" aria-label="Dismiss alerts"><svg class="w-4 h-4 svelte-1uha8ag" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" class="svelte-1uha8ag"></path></svg></button></div> <!> <!></div>'),na=p('<div class="empty-state svelte-1uha8ag"><div class="empty-icon svelte-1uha8ag"><span class="text-5xl svelte-1uha8ag">üç∫</span></div> <h2 class="empty-title svelte-1uha8ag">Loading Batches</h2> <p class="empty-description svelte-1uha8ag"><span class="connecting-dots svelte-1uha8ag">Fetching active fermentations</span></p></div>'),oa=p('<div class="empty-state svelte-1uha8ag"><div class="empty-icon svelte-1uha8ag"><span class="text-5xl svelte-1uha8ag">‚ö†Ô∏è</span></div> <h2 class="empty-title svelte-1uha8ag">Error Loading Batches</h2> <p class="empty-description svelte-1uha8ag"> </p></div>'),va=p('<div class="empty-state svelte-1uha8ag"><div class="empty-icon svelte-1uha8ag"><span class="text-5xl svelte-1uha8ag">üç∫</span></div> <h2 class="empty-title svelte-1uha8ag">No Active Fermentations</h2> <p class="empty-description svelte-1uha8ag">Start a batch and set status to "Fermenting" or "Conditioning" to track it here</p> <div class="empty-hint svelte-1uha8ag"><svg class="w-4 h-4 svelte-1uha8ag" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" class="svelte-1uha8ag"></path></svg> <span class="svelte-1uha8ag">Go to Batches ‚Üí Create a new batch or update an existing batch status</span></div></div>'),da=p("<div></div>"),ca=p("<!> <!>",1);function La(ue,m){Xe(m,!0);let P=j(!1),W=j(!1),f=j(Me([])),Q=j(Me(new Map)),z=j(!0),R=j(null);yt(async()=>{const i=localStorage.getItem("brewsignal_alerts_dismissed"),_=localStorage.getItem("brewsignal_alerts_dismissed_time");i==="true"&&_&&Date.now()-parseInt(_,10)<360*60*1e3&&c(P,!0),await Y()});async function Y(){c(z,!0),c(R,null);try{const i=await At();c(f,i.filter(v=>v.status==="fermenting"||v.status==="conditioning"),!0);const _=e(f).map(async v=>{try{const M=await Ut(v.id);return[v.id,M]}catch{return null}}),E=await Promise.all(_),k=new Map;for(const v of E)v&&k.set(v[0],v[1]);c(Q,k,!0)}catch(i){c(R,i instanceof Error?i.message:"Failed to load batches",!0)}finally{c(z,!1)}}let V=d(()=>new Map(e(f).filter(i=>i.device_id&&(i.status==="fermenting"||i.status==="conditioning")).map(i=>[i.device_id,i.id]))),I=d(()=>{const i=new Map(e(Q));for(const[_,E]of e(V)){const k=$e.tilts.get(_);if(k){const v=i.get(E)||{batch_id:E,status:"fermenting",measured:{},temperature:{status:"unknown"},progress:{},targets:{}},M=k.sg,y=k.temp;i.set(E,{...v,measured:{...v.measured,current_sg:M},temperature:{...v.temperature,current:y,status:v.temperature.yeast_min!==void 0&&v.temperature.yeast_max!==void 0?y<v.temperature.yeast_min?"too_cold":y>v.temperature.yeast_max?"too_hot":"in_range":v.temperature.status}})}}return i}),q=j(null);function pe(i){c(q,e(q)===i?null:i,!0)}function ge(){c(P,!0),localStorage.setItem("brewsignal_alerts_dismissed","true"),localStorage.setItem("brewsignal_alerts_dismissed_time",Date.now().toString())}function me(){c(W,!e(W))}var te=ca();Mt("1uha8ag",i=>{Bt(()=>{Et.title="Dashboard | BrewSignal"})});var J=ee(te);{var le=i=>{var _=ia(),E=s(_),k=s(E),v=n(s(k),4),M=s(v,!0);r(v),r(k);var y=n(k,2);y.__click=ge,r(E);var L=n(E,2);{var H=w=>{var S=sa();ce(S,21,()=>re.alerts,Se,(A,D)=>{var U=ra();let Z;var K=s(U),fe=s(K);r(K);var ne=n(K,2),oe=s(ne,!0);r(ne),r(U),x(()=>{Z=$(U,1,"alert-item svelte-1uha8ag",null,Z,{warning:e(D).level==="warning",critical:e(D).level==="critical"}),h(fe,`${e(D).day??""}:`),h(oe,e(D).message)}),u(A,U)}),r(S),u(w,S)};B(L,w=>{e(W)||w(H)})}var X=n(L,2);{var F=w=>{var S=la();S.__click=me;var A=s(S,!0);r(S),x(()=>h(A,e(W)?`Show ${re.alerts.length} alerts`:"Show less")),u(w,S)};B(X,w=>{re.alerts.length>3&&w(F)})}r(_),x(()=>h(M,re.alerts.length)),u(i,_)};B(J,i=>{re.alerts.length>0&&!e(P)&&i(le)})}var he=n(J,2);{var ie=i=>{var _=na();u(i,_)},N=i=>{var _=Ee(),E=ee(_);{var k=M=>{var y=oa(),L=n(s(y),4),H=s(L,!0);r(L),r(y),x(()=>h(H,e(R))),u(M,y)},v=M=>{var y=Ee(),L=ee(y);{var H=F=>{var w=va();u(F,w)},X=F=>{var w=da();let S;ce(w,21,()=>e(f),A=>A.id,(A,D)=>{{let U=d(()=>e(I).get(e(D).id)),Z=d(()=>e(q)===e(D).id),K=d(()=>e(f).length===1);aa(A,{get batch(){return e(D)},get progress(){return e(U)},get expanded(){return e(Z)},get wide(){return e(K)},onToggleExpand:()=>pe(e(D).id),onBatchUpdated:Y})}}),r(w),x(()=>S=$(w,1,"tilt-grid svelte-1uha8ag",null,S,{"single-tilt":e(f).length===1})),u(F,w)};B(L,F=>{e(f).length===0?F(H):F(X,!1)},!0)}u(M,y)};B(E,M=>{e(R)?M(k):M(v,!1)},!0)}u(i,_)};B(he,i=>{e(z)?i(ie):i(N,!1)})}u(ue,te),Ze()}Je(["click"]);export{La as component};
