import{g as Le,h as at,d as rt,f as C,a as g,s as L,b as oe,t as nt}from"../chunks/mIejMQ-v.js";import{ar as R,x as Re,M as Oe,h as lt,aF as it,T as Ne,U as ot,a6 as dt,aG as ct,aH as vt,J as ut,K as ne,p as gt,c as l,ai as ee,ah as mt,aq as Z,ao as bt,ak as o,s as P,al as n,aj as pt,e as ht,am as _t,as as le,an as r,au as ft}from"../chunks/TUuJpABw.js";import{e as Ce,i as zt}from"../chunks/BMkmvfmB.js";import{i as x}from"../chunks/BpxQuLsu.js";import{h as St}from"../chunks/BXtSjz4L.js";import{b as De,r as Be}from"../chunks/CAmZuRmC.js";import{s as ie}from"../chunks/Cts_lnij.js";import{b as Ct}from"../chunks/CyJrDIBB.js";import{b as It}from"../chunks/DcEBuxxh.js";function $e(e,a,h=!1,z=!1,v=!1){var i=e,c="";R(()=>{var _=lt;if(c===(c=a()??"")){Re&&Oe();return}if(_.nodes_start!==null&&(it(_.nodes_start,_.nodes_end),_.nodes_start=_.nodes_end=null),c!==""){if(Re){Ne.data;for(var d=Oe(),y=d;d!==null&&(d.nodeType!==ot||d.data!=="");)y=d,d=dt(d);if(d===null)throw ct(),vt;Le(Ne,y),i=ut(d);return}var u=c+"";h?u=`<svg>${u}</svg>`:z&&(u=`<math>${u}</math>`);var s=at(u);if((h||z)&&(s=ne(s)),Le(ne(s),s.lastChild),h||z)for(;ne(s);)i.before(ne(s));else i.before(s)}})}function Pe(e){if(!e.startsWith("data: "))return null;const a=e.slice(6).trim();if(a==="[DONE]")return null;try{return JSON.parse(a)}catch{return console.warn("Failed to parse SSE event:",a),null}}function wt(){return`${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function yt(){const e=gt({status:"disconnected",error:null,threadId:null,runId:null,messages:[],streamingMessageId:null,streamingContent:"",toolCallsList:[],agentState:{},currentStep:null});function a(s){return e.toolCallsList.find(m=>m.id===s)}function h(s,m){const f=e.toolCallsList.findIndex(b=>b.id===s);f>=0&&(e.toolCallsList[f]={...e.toolCallsList[f],...m})}const z=ee(()=>e.streamingMessageId!==null),v=ee(()=>e.status==="connected"),i=ee(()=>e.status==="connecting"||l(z)),c=ee(()=>()=>{const s=[...e.messages];if(e.streamingMessageId&&e.streamingContent){const m=s.findIndex(f=>f.id===e.streamingMessageId);m>=0?s[m]={...s[m],content:e.streamingContent}:s.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}return s});function _(s){switch(s.type){case"RUN_STARTED":e.status="connected",e.threadId=s.threadId,e.runId=s.runId,e.error=null;break;case"RUN_FINISHED":if(e.status="connected",e.streamingMessageId&&e.streamingContent){const f=e.messages.findIndex(b=>b.id===e.streamingMessageId);f>=0?e.messages[f].content=e.streamingContent:e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}e.streamingMessageId=null,e.streamingContent="",e.currentStep=null;break;case"RUN_ERROR":e.status="error",e.error=s.message,e.streamingMessageId=null,e.streamingContent="";break;case"STEP_STARTED":e.currentStep=s.stepName;break;case"STEP_FINISHED":e.currentStep=null;break;case"TEXT_MESSAGE_START":e.streamingMessageId=s.messageId,e.streamingContent="";break;case"TEXT_MESSAGE_CONTENT":s.messageId===e.streamingMessageId&&(e.streamingContent+=s.delta);break;case"TEXT_MESSAGE_END":s.messageId===e.streamingMessageId&&(e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent}),e.streamingMessageId=null,e.streamingContent="");break;case"TEXT_MESSAGE_CHUNK":e.streamingMessageId||(e.streamingMessageId=s.messageId,e.streamingContent=""),e.streamingContent+=s.content;break;case"TOOL_CALL_START":e.toolCallsList=[...e.toolCallsList,{id:s.toolCallId,name:s.toolCallName||s.toolName||"unknown",args:"",status:"running"}];break;case"TOOL_CALL_ARGS":const m=a(s.toolCallId);m&&h(s.toolCallId,{args:m.args+s.delta});break;case"TOOL_CALL_END":h(s.toolCallId,{status:"completed"});break;case"TOOL_CALL_RESULT":case"TOOL_RESULT":h(s.toolCallId,{result:s.content||s.result,status:"completed"});break;case"STATE_SNAPSHOT":e.agentState=s.snapshot;break;case"STATE_DELTA":for(const f of s.delta){const b=f.path.split("/").filter(Boolean);if(f.op==="add"||f.op==="replace"){let O=e.agentState;for(let k=0;k<b.length-1;k++)b[k]in O||(O[b[k]]={}),O=O[b[k]];O[b[b.length-1]]=f.value}else if(f.op==="remove"){let O=e.agentState;for(let k=0;k<b.length-1;k++)O=O[b[k]];delete O[b[b.length-1]]}}break;case"MESSAGES_SNAPSHOT":e.messages=s.messages;break;case"CUSTOM":console.log("Custom event:",s.name,s.value);break}}function d(s){const m={id:wt(),role:"user",content:s,createdAt:new Date().toISOString()};return e.messages.push(m),m}function y(){e.messages=[],e.streamingMessageId=null,e.streamingContent="",e.toolCallsList=[],e.agentState={},e.threadId=null,e.runId=null,e.error=null,e.currentStep=null}function u(){e.error=null,e.status==="error"&&(e.status="disconnected")}return{get status(){return e.status},get error(){return e.error},get threadId(){return e.threadId},get runId(){return e.runId},get messages(){return e.messages},get streamingMessageId(){return e.streamingMessageId},get streamingContent(){return e.streamingContent},get toolCalls(){return e.toolCallsList},get agentState(){return e.agentState},get currentStep(){return e.currentStep},get isStreaming(){return l(z)},get isConnected(){return l(v)},get isRunning(){return l(i)},get allMessages(){return l(c)()},handleEvent:_,addUserMessage:d,clear:y,clearError:u,_setStatus(s){e.status=s},_setError(s){e.error=s}}}function Et(e){let a=null;async function h(v,i){z(),a=new AbortController,v._setStatus("connecting"),v._setError(null);try{const c=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream",...e.headers},body:JSON.stringify(i),signal:a.signal});if(!c.ok){const u=await c.text();throw new Error(`HTTP ${c.status}: ${u}`)}if(!c.body)throw new Error("No response body");const _=c.body.getReader(),d=new TextDecoder;let y="";for(;;){const{done:u,value:s}=await _.read();if(u)break;y+=d.decode(s,{stream:!0});const m=y.split(`
`);y=m.pop()||"";for(const f of m){const b=Pe(f);b&&v.handleEvent(b)}}if(y.trim()){const u=Pe(y);u&&v.handleEvent(u)}}catch(c){c instanceof Error&&c.name==="AbortError"?v._setStatus("disconnected"):(v._setStatus("error"),v._setError(c instanceof Error?c.message:"Unknown error"))}finally{a=null}}function z(){a&&(a.abort(),a=null)}return{run:h,abort:z}}function kt(e){const a=yt(),h=Et({url:e.url,headers:e.headers});let z=e.tools||[],v=e.initialState||{};async function i(u){a.addUserMessage(u);const s={threadId:e.threadId||a.threadId||void 0,messages:a.messages,tools:z.length>0?z:void 0,state:Object.keys(v).length>0?v:void 0};await h.run(a,s),a.error?e.onError?.(a.error):e.onComplete?.()}function c(){h.abort()}function _(){h.abort(),a.clear()}function d(u){v={...v,...u}}function y(u){z=u}return{get status(){return a.status},get error(){return a.error},get messages(){return a.allMessages},get isStreaming(){return a.isStreaming},get isRunning(){return a.isRunning},get threadId(){return a.threadId},get currentStep(){return a.currentStep},get toolCalls(){return a.toolCalls},get sharedState(){return v},get streamingContent(){return a.streamingContent},send:i,stop:c,clear:_,setState:d,setTools:y,_agentState:a,_client:h}}function Ue(e){try{const a=JSON.parse(e);return JSON.stringify(a,null,2)}catch{return e}}function je(e){if(!e)return"";let a=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return a=a.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre><code class="language-$1">$2</code></pre>'),a=a.replace(/`([^`]+)`/g,"<code>$1</code>"),a=a.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\*([^*]+)\*/g,"<em>$1</em>"),a=a.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),a=a.replace(/\n/g,"<br>"),a}var Mt=C('<button type="button" class="prompt-chip svelte-12tm3zb"> </button>'),Tt=C('<div class="empty-state svelte-12tm3zb"><div class="empty-icon svelte-12tm3zb"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5" class="svelte-12tm3zb"></path><path d="M2 12l10 5 10-5" class="svelte-12tm3zb"></path></svg></div> <h2 class="svelte-12tm3zb">Start a conversation</h2> <p class="svelte-12tm3zb">Ask me about beer recipes, brewing techniques, or ingredient substitutions.</p> <div class="example-prompts svelte-12tm3zb"></div></div>'),xt=oe('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" class="svelte-12tm3zb"></path></svg>'),At=oe('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg>'),Lt=C('<div class="message-text streaming svelte-12tm3zb"><!> <span class="cursor svelte-12tm3zb"></span></div>'),Rt=C('<div class="message-text svelte-12tm3zb"><!></div>'),Ot=C('<div><div class="message-avatar svelte-12tm3zb"><!></div> <div class="message-content svelte-12tm3zb"><!></div></div>'),Nt=C('<div class="message assistant svelte-12tm3zb"><div class="message-avatar svelte-12tm3zb"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg></div> <div class="message-content svelte-12tm3zb"><div class="typing-indicator svelte-12tm3zb"><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span></div></div></div>'),Dt=C('<div class="messages svelte-12tm3zb"><!> <!></div>'),Bt=C('<div class="error-banner svelte-12tm3zb"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" class="svelte-12tm3zb"></path></svg> <span class="svelte-12tm3zb"> </span> <button type="button" class="svelte-12tm3zb">Dismiss</button></div>'),$t=C('<div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Thread</div> <div class="debug-value mono svelte-12tm3zb"> </div></div>'),Pt=C('<details class="tool-details svelte-12tm3zb"><summary class="svelte-12tm3zb">Arguments</summary> <pre class="tool-json svelte-12tm3zb"> </pre></details>'),Ut=C('<details class="tool-details svelte-12tm3zb"><summary class="svelte-12tm3zb">Result</summary> <pre class="tool-json svelte-12tm3zb"> </pre></details>'),jt=C('<div><div class="tool-call-header svelte-12tm3zb"><span class="tool-name svelte-12tm3zb"> </span> <span class="tool-status svelte-12tm3zb"> </span></div> <!> <!></div>'),Ht=C('<div class="debug-section tool-calls-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb"> </div> <div class="tool-calls-list svelte-12tm3zb"></div></div>'),Gt=C('<div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Shared State</div> <details class="tool-details svelte-12tm3zb"><summary class="svelte-12tm3zb"> </summary> <pre class="tool-json svelte-12tm3zb"> </pre></details></div>'),Jt=C('<div class="debug-panel svelte-12tm3zb"><div class="debug-header svelte-12tm3zb"><h3 class="svelte-12tm3zb">Agent Debug</h3> <button type="button" class="debug-close svelte-12tm3zb">Ã—</button></div> <div class="debug-content svelte-12tm3zb"><div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Status</div> <div class="debug-value svelte-12tm3zb"><span> <!></span></div></div> <!> <div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Messages</div> <div class="debug-value svelte-12tm3zb"> </div></div> <!> <!></div></div>'),Ft=oe('<svg class="spinner svelte-12tm3zb" width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10" class="svelte-12tm3zb"></circle></svg>'),Kt=oe('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12tm3zb"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" class="svelte-12tm3zb"></path></svg>'),Xt=C('<div class="assistant-page svelte-12tm3zb"><header class="page-header svelte-12tm3zb"><div class="header-content svelte-12tm3zb"><h1 class="svelte-12tm3zb">Brewing Assistant</h1> <p class="subtitle svelte-12tm3zb">AI-powered recipe creation and brewing advice</p></div> <div class="settings svelte-12tm3zb"><label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Batch Size</span> <input type="number" min="1" max="100" class="svelte-12tm3zb"/> L</label> <label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Efficiency</span> <input type="number" min="50" max="100" class="svelte-12tm3zb"/> %</label> <button type="button" title="Toggle agent debug panel"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12tm3zb"><path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" class="svelte-12tm3zb"></path></svg></button></div></header> <main class="chat-container svelte-12tm3zb"><!> <!> <!></main> <footer class="input-area svelte-12tm3zb"><div class="input-wrapper svelte-12tm3zb"><textarea placeholder="Ask about brewing..." rows="1" class="svelte-12tm3zb"></textarea> <button type="button" class="send-button svelte-12tm3zb"><!></button></div> <div class="input-hint svelte-12tm3zb">Press Enter to send, Shift+Enter for new line</div></footer></div>');function as(e,a){mt(a,!0);let h=Z(19),z=Z(72),v=Z(!1);const i=kt({url:"/api/ag-ui/run",initialState:{batchSize:l(h),efficiency:l(z)},onStateChange:t=>{t.recipe&&console.log("Recipe extracted:",t.recipe)},onError:t=>{console.error("Agent error:",t)}});let c=ee(()=>i.toolCalls),_=Z(""),d=Z(null);function y(t){P(h,t,!0),i.setState({batchSize:t})}function u(t){P(z,t,!0),i.setState({efficiency:t})}function s(t){t.style.height="auto",t.style.height=Math.min(t.scrollHeight,200)+"px"}async function m(){const t=l(_).trim();!t||i.isRunning||(P(_,""),l(d)&&(l(d).style.height="auto"),await i.send(t))}function f(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),m())}const b=["Help me create an American IPA recipe","What temperature should I ferment a Belgian Tripel?","Create a simple wheat beer recipe for summer","Explain the difference between ale and lager yeast"];function O(t){P(_,t,!0),l(d)&&(l(d).focus(),s(l(d)))}bt(()=>{l(d)?.focus()});var k=Xt();St("12tm3zb",t=>{ht(()=>{_t.title="AI Assistant | BrewSignal"})});var de=n(k),Ie=o(n(de),2),ce=n(Ie),ve=o(n(ce),2);Be(ve),ve.__change=t=>y(Number(t.currentTarget.value)),le(),r(ce);var ue=o(ce,2),ge=o(n(ue),2);Be(ge),ge.__change=t=>u(Number(t.currentTarget.value)),le(),r(ue);var we=o(ue,2);let ye;we.__click=()=>P(v,!l(v)),r(Ie),r(de);var me=o(de,2),Ee=n(me);{var He=t=>{var p=Tt(),M=o(n(p),6);Ce(M,21,()=>b,zt,(j,D)=>{var S=Mt();S.__click=()=>O(l(D));var A=n(S,!0);r(S),R(()=>L(A,l(D))),g(j,S)}),r(M),r(p),g(t,p)},Ge=t=>{var p=Dt(),M=n(p);Ce(M,17,()=>i.messages,S=>S.id,(S,A)=>{var $=Ot(),F=n($),se=n(F);{var be=I=>{var E=xt();g(I,E)},pe=I=>{var E=At();g(I,E)};x(se,I=>{l(A).role==="user"?I(be):I(pe,!1)})}r(F);var W=o(F,2),he=n(W);{var V=I=>{var E=Lt(),Y=n(E);$e(Y,()=>je(i.streamingContent||"")),le(2),r(E),g(I,E)},ae=I=>{var E=Rt(),Y=n(E);$e(Y,()=>je(l(A).content)),r(E),g(I,E)};x(he,I=>{l(A).role==="assistant"&&i.isStreaming&&l(A).id===i._agentState.streamingMessageId?I(V):I(ae,!1)})}r(W),r($),R(()=>ie($,1,`message ${l(A).role??""}`,"svelte-12tm3zb")),g(S,$)});var j=o(M,2);{var D=S=>{var A=Nt();g(S,A)};x(j,S=>{i.isRunning&&!i.isStreaming&&S(D)})}r(p),g(t,p)};x(Ee,t=>{i.messages.length===0?t(He):t(Ge,!1)})}var ke=o(Ee,2);{var Je=t=>{var p=Bt(),M=o(n(p),2),j=n(M,!0);r(M);var D=o(M,2);D.__click=()=>i._agentState.clearError(),r(p),R(()=>L(j,i.error)),g(t,p)};x(ke,t=>{i.error&&t(Je)})}var Fe=o(ke,2);{var Ke=t=>{var p=Jt(),M=n(p),j=o(n(M),2);j.__click=()=>P(v,!1),r(M);var D=o(M,2),S=n(D),A=o(n(S),2),$=n(A);let F;var se=n($),be=o(se);{var pe=w=>{var T=nt("(streaming)");g(w,T)};x(be,w=>{i.isStreaming&&w(pe)})}r($),r(A),r(S);var W=o(S,2);{var he=w=>{var T=$t(),B=o(n(T),2),H=n(B);r(B),r(T),R(K=>L(H,`${K??""}...`),[()=>i.threadId.slice(0,8)]),g(w,T)};x(W,w=>{i.threadId&&w(he)})}var V=o(W,2),ae=o(n(V),2),I=n(ae,!0);r(ae),r(V);var E=o(V,2);{var Y=w=>{var T=Ht(),B=n(T),H=n(B);r(B);var K=o(B,2);Ce(K,21,()=>l(c),X=>X.id,(X,N)=>{var q=jt();let re;var _e=n(q),fe=n(_e),Qe=n(fe,!0);r(fe);var xe=o(fe,2),Ze=n(xe,!0);r(xe),r(_e);var Ae=o(_e,2);{var et=G=>{var J=Pt(),Q=o(n(J),2),ze=n(Q,!0);r(Q),r(J),R(Se=>L(ze,Se),[()=>Ue(l(N).args)]),g(G,J)};x(Ae,G=>{l(N).args&&G(et)})}var tt=o(Ae,2);{var st=G=>{var J=Ut(),Q=o(n(J),2),ze=n(Q,!0);r(Q),r(J),R(Se=>L(ze,Se),[()=>Ue(l(N).result)]),g(G,J)};x(tt,G=>{l(N).result&&G(st)})}r(q),R(()=>{re=ie(q,1,"tool-call svelte-12tm3zb",null,re,{running:l(N).status==="running",completed:l(N).status==="completed"}),L(Qe,l(N).name),L(Ze,l(N).status)}),g(X,q)}),r(K),r(T),R(()=>L(H,`Tool Calls (${l(c).length??""})`)),g(w,T)};x(E,w=>{l(c).length>0&&w(Y)})}var Ve=o(E,2);{var Ye=w=>{var T=Gt(),B=o(n(T),2),H=n(B),K=n(H);r(H);var X=o(H,2),N=n(X,!0);r(X),r(B),r(T),R((q,re)=>{L(K,`${q??""} keys`),L(N,re)},[()=>Object.keys(i.sharedState).length,()=>JSON.stringify(i.sharedState,null,2)]),g(w,T)};x(Ve,w=>{Object.keys(i.sharedState).length>0&&w(Ye)})}r(D),r(p),R(()=>{F=ie($,1,"status-badge svelte-12tm3zb",null,F,{running:i.isRunning,streaming:i.isStreaming}),L(se,`${i.status??""} `),L(I,i.messages.length)}),g(t,p)};x(Fe,t=>{l(v)&&t(Ke)})}r(me);var Me=o(me,2),Te=n(Me),U=n(Te);ft(U),U.__input=t=>s(t.currentTarget),U.__keydown=f,It(U,t=>P(d,t),()=>l(d));var te=o(U,2);te.__click=m;var Xe=n(te);{var qe=t=>{var p=Ft();g(t,p)},We=t=>{var p=Kt();g(t,p)};x(Xe,t=>{i.isRunning?t(qe):t(We,!1)})}r(te),r(Te),le(2),r(Me),r(k),R(t=>{De(ve,l(h)),De(ge,l(z)),ye=ie(we,1,"debug-toggle svelte-12tm3zb",null,ye,{active:l(v)}),U.disabled=i.isRunning,te.disabled=t},[()=>!l(_).trim()||i.isRunning]),Ct(U,()=>l(_),t=>P(_,t)),g(e,k),pt()}rt(["change","click","input","keydown"]);export{as as component};
