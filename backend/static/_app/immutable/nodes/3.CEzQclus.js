import{g as Re,h as at,d as rt,f as S,a as g,s as A,b as oe,t as nt}from"../chunks/mIejMQ-v.js";import{ar as R,x as Oe,M as Ne,h as lt,aF as it,T as Le,U as ot,a6 as dt,aG as ct,aH as vt,J as ut,K as re,p as gt,c as i,ai as ne,ah as mt,aq as Z,ao as bt,ak as o,s as U,al as n,aj as pt,e as ht,am as _t,as as le,an as r,au as ft}from"../chunks/TUuJpABw.js";import{e as Ce,i as zt}from"../chunks/BMkmvfmB.js";import{i as k}from"../chunks/BpxQuLsu.js";import{h as St}from"../chunks/BXtSjz4L.js";import{b as De,r as Be}from"../chunks/CAmZuRmC.js";import{s as ie}from"../chunks/Cts_lnij.js";import{b as Ct}from"../chunks/CyJrDIBB.js";import{b as It}from"../chunks/DcEBuxxh.js";function $e(e,s,_=!1,f=!1,u=!1){var l=e,v="";R(()=>{var p=lt;if(v===(v=s()??"")){Oe&&Ne();return}if(p.nodes_start!==null&&(it(p.nodes_start,p.nodes_end),p.nodes_start=p.nodes_end=null),v!==""){if(Oe){Le.data;for(var c=Ne(),a=c;c!==null&&(c.nodeType!==ot||c.data!=="");)a=c,c=dt(c);if(c===null)throw ct(),vt;Re(Le,a),l=ut(c);return}var d=v+"";_?d=`<svg>${d}</svg>`:f&&(d=`<math>${d}</math>`);var m=at(d);if((_||f)&&(m=re(m)),Re(re(m),m.lastChild),_||f)for(;re(m);)l.before(re(m));else l.before(m)}})}function Pe(e){if(!e.startsWith("data: "))return null;const s=e.slice(6).trim();if(s==="[DONE]")return null;try{return JSON.parse(s)}catch{return console.warn("Failed to parse SSE event:",s),null}}function wt(){return`${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function yt(){const e=gt({status:"disconnected",error:null,threadId:null,runId:null,messages:[],streamingMessageId:null,streamingContent:"",toolCalls:new Map,agentState:{},currentStep:null}),s=ne(()=>e.streamingMessageId!==null),_=ne(()=>e.status==="connected"),f=ne(()=>e.status==="connecting"||i(s)),u=ne(()=>()=>{const a=[...e.messages];if(e.streamingMessageId&&e.streamingContent){const d=a.findIndex(m=>m.id===e.streamingMessageId);d>=0?a[d]={...a[d],content:e.streamingContent}:a.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}return a});function l(a){switch(a.type){case"RUN_STARTED":e.status="connected",e.threadId=a.threadId,e.runId=a.runId,e.error=null;break;case"RUN_FINISHED":if(e.status="connected",e.streamingMessageId&&e.streamingContent){const T=e.messages.findIndex(h=>h.id===e.streamingMessageId);T>=0?e.messages[T].content=e.streamingContent:e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}e.streamingMessageId=null,e.streamingContent="",e.currentStep=null;break;case"RUN_ERROR":e.status="error",e.error=a.message,e.streamingMessageId=null,e.streamingContent="";break;case"STEP_STARTED":e.currentStep=a.stepName;break;case"STEP_FINISHED":e.currentStep=null;break;case"TEXT_MESSAGE_START":e.streamingMessageId=a.messageId,e.streamingContent="";break;case"TEXT_MESSAGE_CONTENT":a.messageId===e.streamingMessageId&&(e.streamingContent+=a.delta);break;case"TEXT_MESSAGE_END":a.messageId===e.streamingMessageId&&(e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent}),e.streamingMessageId=null,e.streamingContent="");break;case"TEXT_MESSAGE_CHUNK":e.streamingMessageId||(e.streamingMessageId=a.messageId,e.streamingContent=""),e.streamingContent+=a.content;break;case"TOOL_CALL_START":e.toolCalls.set(a.toolCallId,{id:a.toolCallId,name:a.toolCallName||a.toolName||"unknown",args:"",status:"running"});break;case"TOOL_CALL_ARGS":const d=e.toolCalls.get(a.toolCallId);d&&(d.args+=a.delta);break;case"TOOL_CALL_END":const m=e.toolCalls.get(a.toolCallId);m&&(m.status="completed");break;case"TOOL_CALL_RESULT":case"TOOL_RESULT":const L=e.toolCalls.get(a.toolCallId);L&&(L.result=a.content||a.result,L.status="completed");break;case"STATE_SNAPSHOT":e.agentState=a.snapshot;break;case"STATE_DELTA":for(const T of a.delta){const h=T.path.split("/").filter(Boolean);if(T.op==="add"||T.op==="replace"){let O=e.agentState;for(let y=0;y<h.length-1;y++)h[y]in O||(O[h[y]]={}),O=O[h[y]];O[h[h.length-1]]=T.value}else if(T.op==="remove"){let O=e.agentState;for(let y=0;y<h.length-1;y++)O=O[h[y]];delete O[h[h.length-1]]}}break;case"MESSAGES_SNAPSHOT":e.messages=a.messages;break;case"CUSTOM":console.log("Custom event:",a.name,a.value);break}}function v(a){const d={id:wt(),role:"user",content:a,createdAt:new Date().toISOString()};return e.messages.push(d),d}function p(){e.messages=[],e.streamingMessageId=null,e.streamingContent="",e.toolCalls.clear(),e.agentState={},e.threadId=null,e.runId=null,e.error=null,e.currentStep=null}function c(){e.error=null,e.status==="error"&&(e.status="disconnected")}return{get status(){return e.status},get error(){return e.error},get threadId(){return e.threadId},get runId(){return e.runId},get messages(){return e.messages},get streamingMessageId(){return e.streamingMessageId},get streamingContent(){return e.streamingContent},get toolCalls(){return e.toolCalls},get agentState(){return e.agentState},get currentStep(){return e.currentStep},get isStreaming(){return i(s)},get isConnected(){return i(_)},get isRunning(){return i(f)},get allMessages(){return i(u)()},handleEvent:l,addUserMessage:v,clear:p,clearError:c,_setStatus(a){e.status=a},_setError(a){e.error=a}}}function Et(e){let s=null;async function _(u,l){f(),s=new AbortController,u._setStatus("connecting"),u._setError(null);try{const v=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream",...e.headers},body:JSON.stringify(l),signal:s.signal});if(!v.ok){const d=await v.text();throw new Error(`HTTP ${v.status}: ${d}`)}if(!v.body)throw new Error("No response body");const p=v.body.getReader(),c=new TextDecoder;let a="";for(;;){const{done:d,value:m}=await p.read();if(d)break;a+=c.decode(m,{stream:!0});const L=a.split(`
`);a=L.pop()||"";for(const T of L){const h=Pe(T);h&&u.handleEvent(h)}}if(a.trim()){const d=Pe(a);d&&u.handleEvent(d)}}catch(v){v instanceof Error&&v.name==="AbortError"?u._setStatus("disconnected"):(u._setStatus("error"),u._setError(v instanceof Error?v.message:"Unknown error"))}finally{s=null}}function f(){s&&(s.abort(),s=null)}return{run:_,abort:f}}function Mt(e){const s=yt(),_=Et({url:e.url,headers:e.headers});let f=e.tools||[],u=e.initialState||{};async function l(d){s.addUserMessage(d);const m={threadId:e.threadId||s.threadId||void 0,messages:s.messages,tools:f.length>0?f:void 0,state:Object.keys(u).length>0?u:void 0};await _.run(s,m),s.error?e.onError?.(s.error):e.onComplete?.()}function v(){_.abort()}function p(){_.abort(),s.clear()}function c(d){u={...u,...d}}function a(d){f=d}return{get status(){return s.status},get error(){return s.error},get messages(){return s.allMessages},get isStreaming(){return s.isStreaming},get isRunning(){return s.isRunning},get threadId(){return s.threadId},get currentStep(){return s.currentStep},get toolCalls(){return s.toolCalls},get sharedState(){return u},get streamingContent(){return s.streamingContent},send:l,stop:v,clear:p,setState:c,setTools:a,_agentState:s,_client:_}}function Ue(e){try{const s=JSON.parse(e);return JSON.stringify(s,null,2)}catch{return e}}function je(e){if(!e)return"";let s=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return s=s.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre><code class="language-$1">$2</code></pre>'),s=s.replace(/`([^`]+)`/g,"<code>$1</code>"),s=s.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),s=s.replace(/\*([^*]+)\*/g,"<em>$1</em>"),s=s.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),s=s.replace(/\n/g,"<br>"),s}var kt=S('<button type="button" class="prompt-chip svelte-12tm3zb"> </button>'),Tt=S('<div class="empty-state svelte-12tm3zb"><div class="empty-icon svelte-12tm3zb"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5" class="svelte-12tm3zb"></path><path d="M2 12l10 5 10-5" class="svelte-12tm3zb"></path></svg></div> <h2 class="svelte-12tm3zb">Start a conversation</h2> <p class="svelte-12tm3zb">Ask me about beer recipes, brewing techniques, or ingredient substitutions.</p> <div class="example-prompts svelte-12tm3zb"></div></div>'),xt=oe('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" class="svelte-12tm3zb"></path></svg>'),At=oe('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg>'),Rt=S('<div class="message-text streaming svelte-12tm3zb"><!> <span class="cursor svelte-12tm3zb"></span></div>'),Ot=S('<div class="message-text svelte-12tm3zb"><!></div>'),Nt=S('<div><div class="message-avatar svelte-12tm3zb"><!></div> <div class="message-content svelte-12tm3zb"><!></div></div>'),Lt=S('<div class="message assistant svelte-12tm3zb"><div class="message-avatar svelte-12tm3zb"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg></div> <div class="message-content svelte-12tm3zb"><div class="typing-indicator svelte-12tm3zb"><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span></div></div></div>'),Dt=S('<div class="messages svelte-12tm3zb"><!> <!></div>'),Bt=S('<div class="error-banner svelte-12tm3zb"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" class="svelte-12tm3zb"></path></svg> <span class="svelte-12tm3zb"> </span> <button type="button" class="svelte-12tm3zb">Dismiss</button></div>'),$t=S('<div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Thread</div> <div class="debug-value mono svelte-12tm3zb"> </div></div>'),Pt=S('<details class="tool-details svelte-12tm3zb"><summary class="svelte-12tm3zb">Arguments</summary> <pre class="tool-json svelte-12tm3zb"> </pre></details>'),Ut=S('<details class="tool-details svelte-12tm3zb"><summary class="svelte-12tm3zb">Result</summary> <pre class="tool-json svelte-12tm3zb"> </pre></details>'),jt=S('<div><div class="tool-call-header svelte-12tm3zb"><span class="tool-name svelte-12tm3zb"> </span> <span class="tool-status svelte-12tm3zb"> </span></div> <!> <!></div>'),Ht=S('<div class="debug-section tool-calls-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb"> </div> <div class="tool-calls-list svelte-12tm3zb"></div></div>'),Gt=S('<div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Shared State</div> <details class="tool-details svelte-12tm3zb"><summary class="svelte-12tm3zb"> </summary> <pre class="tool-json svelte-12tm3zb"> </pre></details></div>'),Jt=S('<div class="debug-panel svelte-12tm3zb"><div class="debug-header svelte-12tm3zb"><h3 class="svelte-12tm3zb">Agent Debug</h3> <button type="button" class="debug-close svelte-12tm3zb">Ã—</button></div> <div class="debug-content svelte-12tm3zb"><div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Status</div> <div class="debug-value svelte-12tm3zb"><span> <!></span></div></div> <!> <div class="debug-section svelte-12tm3zb"><div class="debug-label svelte-12tm3zb">Messages</div> <div class="debug-value svelte-12tm3zb"> </div></div> <!> <!></div></div>'),Ft=oe('<svg class="spinner svelte-12tm3zb" width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10" class="svelte-12tm3zb"></circle></svg>'),Kt=oe('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12tm3zb"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" class="svelte-12tm3zb"></path></svg>'),Xt=S('<div class="assistant-page svelte-12tm3zb"><header class="page-header svelte-12tm3zb"><div class="header-content svelte-12tm3zb"><h1 class="svelte-12tm3zb">Brewing Assistant</h1> <p class="subtitle svelte-12tm3zb">AI-powered recipe creation and brewing advice</p></div> <div class="settings svelte-12tm3zb"><label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Batch Size</span> <input type="number" min="1" max="100" class="svelte-12tm3zb"/> L</label> <label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Efficiency</span> <input type="number" min="50" max="100" class="svelte-12tm3zb"/> %</label> <button type="button" title="Toggle agent debug panel"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12tm3zb"><path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" class="svelte-12tm3zb"></path></svg></button></div></header> <main class="chat-container svelte-12tm3zb"><!> <!> <!></main> <footer class="input-area svelte-12tm3zb"><div class="input-wrapper svelte-12tm3zb"><textarea placeholder="Ask about brewing..." rows="1" class="svelte-12tm3zb"></textarea> <button type="button" class="send-button svelte-12tm3zb"><!></button></div> <div class="input-hint svelte-12tm3zb">Press Enter to send, Shift+Enter for new line</div></footer></div>');function as(e,s){mt(s,!0);let _=Z(19),f=Z(72),u=Z(!1);const l=Mt({url:"/api/ag-ui/run",initialState:{batchSize:i(_),efficiency:i(f)},onStateChange:t=>{t.recipe&&console.log("Recipe extracted:",t.recipe)},onError:t=>{console.error("Agent error:",t)}});function v(){return Array.from(l.toolCalls.values())}let p=Z(""),c=Z(null);function a(t){U(_,t,!0),l.setState({batchSize:t})}function d(t){U(f,t,!0),l.setState({efficiency:t})}function m(t){t.style.height="auto",t.style.height=Math.min(t.scrollHeight,200)+"px"}async function L(){const t=i(p).trim();!t||l.isRunning||(U(p,""),i(c)&&(i(c).style.height="auto"),await l.send(t))}function T(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),L())}const h=["Help me create an American IPA recipe","What temperature should I ferment a Belgian Tripel?","Create a simple wheat beer recipe for summer","Explain the difference between ale and lager yeast"];function O(t){U(p,t,!0),i(c)&&(i(c).focus(),m(i(c)))}bt(()=>{i(c)?.focus()});var y=Xt();St("12tm3zb",t=>{ht(()=>{_t.title="AI Assistant | BrewSignal"})});var de=n(y),Ie=o(n(de),2),ce=n(Ie),ve=o(n(ce),2);Be(ve),ve.__change=t=>a(Number(t.currentTarget.value)),le(),r(ce);var ue=o(ce,2),ge=o(n(ue),2);Be(ge),ge.__change=t=>d(Number(t.currentTarget.value)),le(),r(ue);var we=o(ue,2);let ye;we.__click=()=>U(u,!i(u)),r(Ie),r(de);var me=o(de,2),Ee=n(me);{var He=t=>{var b=Tt(),E=o(n(b),6);Ce(E,21,()=>h,zt,(H,D)=>{var z=kt();z.__click=()=>O(i(D));var x=n(z,!0);r(z),R(()=>A(x,i(D))),g(H,z)}),r(E),r(b),g(t,b)},Ge=t=>{var b=Dt(),E=n(b);Ce(E,17,()=>l.messages,z=>z.id,(z,x)=>{var $=Nt(),K=n($),te=n(K);{var be=C=>{var w=xt();g(C,w)},pe=C=>{var w=At();g(C,w)};k(te,C=>{i(x).role==="user"?C(be):C(pe,!1)})}r(K);var W=o(K,2),he=n(W);{var V=C=>{var w=Rt(),Y=n(w);$e(Y,()=>je(l.streamingContent||"")),le(2),r(w),g(C,w)},se=C=>{var w=Ot(),Y=n(w);$e(Y,()=>je(i(x).content)),r(w),g(C,w)};k(he,C=>{i(x).role==="assistant"&&l.isStreaming&&i(x).id===l._agentState.streamingMessageId?C(V):C(se,!1)})}r(W),r($),R(()=>ie($,1,`message ${i(x).role??""}`,"svelte-12tm3zb")),g(z,$)});var H=o(E,2);{var D=z=>{var x=Lt();g(z,x)};k(H,z=>{l.isRunning&&!l.isStreaming&&z(D)})}r(b),g(t,b)};k(Ee,t=>{l.messages.length===0?t(He):t(Ge,!1)})}var Me=o(Ee,2);{var Je=t=>{var b=Bt(),E=o(n(b),2),H=n(E,!0);r(E);var D=o(E,2);D.__click=()=>l._agentState.clearError(),r(b),R(()=>A(H,l.error)),g(t,b)};k(Me,t=>{l.error&&t(Je)})}var Fe=o(Me,2);{var Ke=t=>{var b=Jt(),E=n(b),H=o(n(E),2);H.__click=()=>U(u,!1),r(E);var D=o(E,2),z=n(D),x=o(n(z),2),$=n(x);let K;var te=n($),be=o(te);{var pe=I=>{var M=nt("(streaming)");g(I,M)};k(be,I=>{l.isStreaming&&I(pe)})}r($),r(x),r(z);var W=o(z,2);{var he=I=>{var M=$t(),B=o(n(M),2),G=n(B);r(B),r(M),R(X=>A(G,`${X??""}...`),[()=>l.threadId.slice(0,8)]),g(I,M)};k(W,I=>{l.threadId&&I(he)})}var V=o(W,2),se=o(n(V),2),C=n(se,!0);r(se),r(V);var w=o(V,2);{var Y=I=>{var M=Ht(),B=n(M),G=n(B);r(B);var X=o(B,2);Ce(X,21,v,P=>P.id,(P,N)=>{var q=jt();let ae;var _e=n(q),fe=n(_e),Qe=n(fe,!0);r(fe);var xe=o(fe,2),Ze=n(xe,!0);r(xe),r(_e);var Ae=o(_e,2);{var et=J=>{var F=Pt(),Q=o(n(F),2),ze=n(Q,!0);r(Q),r(F),R(Se=>A(ze,Se),[()=>Ue(i(N).args)]),g(J,F)};k(Ae,J=>{i(N).args&&J(et)})}var tt=o(Ae,2);{var st=J=>{var F=Ut(),Q=o(n(F),2),ze=n(Q,!0);r(Q),r(F),R(Se=>A(ze,Se),[()=>Ue(i(N).result)]),g(J,F)};k(tt,J=>{i(N).result&&J(st)})}r(q),R(()=>{ae=ie(q,1,"tool-call svelte-12tm3zb",null,ae,{running:i(N).status==="running",completed:i(N).status==="completed"}),A(Qe,i(N).name),A(Ze,i(N).status)}),g(P,q)}),r(X),r(M),R(P=>A(G,`Tool Calls (${P??""})`),[()=>v().length]),g(I,M)};k(w,I=>{v().length>0&&I(Y)})}var Ve=o(w,2);{var Ye=I=>{var M=Gt(),B=o(n(M),2),G=n(B),X=n(G);r(G);var P=o(G,2),N=n(P,!0);r(P),r(B),r(M),R((q,ae)=>{A(X,`${q??""} keys`),A(N,ae)},[()=>Object.keys(l.sharedState).length,()=>JSON.stringify(l.sharedState,null,2)]),g(I,M)};k(Ve,I=>{Object.keys(l.sharedState).length>0&&I(Ye)})}r(D),r(b),R(()=>{K=ie($,1,"status-badge svelte-12tm3zb",null,K,{running:l.isRunning,streaming:l.isStreaming}),A(te,`${l.status??""} `),A(C,l.messages.length)}),g(t,b)};k(Fe,t=>{i(u)&&t(Ke)})}r(me);var ke=o(me,2),Te=n(ke),j=n(Te);ft(j),j.__input=t=>m(t.currentTarget),j.__keydown=T,It(j,t=>U(c,t),()=>i(c));var ee=o(j,2);ee.__click=L;var Xe=n(ee);{var qe=t=>{var b=Ft();g(t,b)},We=t=>{var b=Kt();g(t,b)};k(Xe,t=>{l.isRunning?t(qe):t(We,!1)})}r(ee),r(Te),le(2),r(ke),r(y),R(t=>{De(ve,i(_)),De(ge,i(f)),ye=ie(we,1,"debug-toggle svelte-12tm3zb",null,ye,{active:i(u)}),j.disabled=l.isRunning,ee.disabled=t},[()=>!i(p).trim()||l.isRunning]),Ct(j,()=>i(p),t=>U(p,t)),g(e,y),pt()}rt(["change","click","input","keydown"]);export{as as component};
