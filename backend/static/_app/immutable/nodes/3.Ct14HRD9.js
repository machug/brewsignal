import{g as ee,h as we,d as Ee,f as k,a as S,s as te,b as G}from"../chunks/mIejMQ-v.js";import{ar as L,x as se,M as ae,h as Me,aF as Te,T as re,U as ke,a6 as ye,aG as Ae,aH as xe,J as Re,K as H,p as Ne,c as o,ai as P,ah as Oe,aq as U,ao as Le,ak as z,al as d,aj as De,s as R,e as Be,am as He,as as $,an as i,au as Pe}from"../chunks/TUuJpABw.js";import{e as ne,i as Ue}from"../chunks/BMkmvfmB.js";import{i as N}from"../chunks/BpxQuLsu.js";import{h as $e}from"../chunks/BXtSjz4L.js";import{b as le,r as oe}from"../chunks/CAmZuRmC.js";import{s as Ge}from"../chunks/Cts_lnij.js";import{b as je}from"../chunks/CyJrDIBB.js";import{b as Fe}from"../chunks/DcEBuxxh.js";function ie(e,a,m=!1,v=!1,r=!1){var p=e,l="";L(()=>{var f=Me;if(l===(l=a()??"")){se&&ae();return}if(f.nodes_start!==null&&(Te(f.nodes_start,f.nodes_end),f.nodes_start=f.nodes_end=null),l!==""){if(se){re.data;for(var u=ae(),s=u;u!==null&&(u.nodeType!==ke||u.data!=="");)s=u,u=ye(u);if(u===null)throw Ae(),xe;ee(re,s),p=Re(u);return}var n=l+"";m?n=`<svg>${n}</svg>`:v&&(n=`<math>${n}</math>`);var g=we(n);if((m||v)&&(g=H(g)),ee(H(g),g.lastChild),m||v)for(;H(g);)p.before(H(g));else p.before(g)}})}function ce(e){if(!e.startsWith("data: "))return null;const a=e.slice(6).trim();if(a==="[DONE]")return null;try{return JSON.parse(a)}catch{return console.warn("Failed to parse SSE event:",a),null}}function Ke(){return`${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function Xe(){const e=Ne({status:"disconnected",error:null,threadId:null,runId:null,messages:[],streamingMessageId:null,streamingContent:"",toolCalls:new Map,agentState:{},currentStep:null}),a=P(()=>e.streamingMessageId!==null),m=P(()=>e.status==="connected"),v=P(()=>e.status==="connecting"||o(a)),r=P(()=>()=>{const s=[...e.messages];if(e.streamingMessageId&&e.streamingContent){const n=s.findIndex(g=>g.id===e.streamingMessageId);n>=0?s[n]={...s[n],content:e.streamingContent}:s.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}return s});function p(s){switch(s.type){case"RUN_STARTED":e.status="connected",e.threadId=s.threadId,e.runId=s.runId,e.error=null;break;case"RUN_FINISHED":if(e.status="connected",e.streamingMessageId&&e.streamingContent){const C=e.messages.findIndex(c=>c.id===e.streamingMessageId);C>=0?e.messages[C].content=e.streamingContent:e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}e.streamingMessageId=null,e.streamingContent="",e.currentStep=null;break;case"RUN_ERROR":e.status="error",e.error=s.message,e.streamingMessageId=null,e.streamingContent="";break;case"STEP_STARTED":e.currentStep=s.stepName;break;case"STEP_FINISHED":e.currentStep=null;break;case"TEXT_MESSAGE_START":e.streamingMessageId=s.messageId,e.streamingContent="";break;case"TEXT_MESSAGE_CONTENT":s.messageId===e.streamingMessageId&&(e.streamingContent+=s.delta);break;case"TEXT_MESSAGE_END":s.messageId===e.streamingMessageId&&(e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent}),e.streamingMessageId=null,e.streamingContent="");break;case"TEXT_MESSAGE_CHUNK":e.streamingMessageId||(e.streamingMessageId=s.messageId,e.streamingContent=""),e.streamingContent+=s.content;break;case"TOOL_CALL_START":e.toolCalls.set(s.toolCallId,{id:s.toolCallId,name:s.toolCallName,args:"",status:"running"});break;case"TOOL_CALL_ARGS":const n=e.toolCalls.get(s.toolCallId);n&&(n.args+=s.delta);break;case"TOOL_CALL_END":const g=e.toolCalls.get(s.toolCallId);g&&(g.status="completed");break;case"TOOL_CALL_RESULT":const y=e.toolCalls.get(s.toolCallId);y&&(y.result=s.content,y.status="completed");break;case"STATE_SNAPSHOT":e.agentState=s.snapshot;break;case"STATE_DELTA":for(const C of s.delta){const c=C.path.split("/").filter(Boolean);if(C.op==="add"||C.op==="replace"){let b=e.agentState;for(let I=0;I<c.length-1;I++)c[I]in b||(b[c[I]]={}),b=b[c[I]];b[c[c.length-1]]=C.value}else if(C.op==="remove"){let b=e.agentState;for(let I=0;I<c.length-1;I++)b=b[c[I]];delete b[c[c.length-1]]}}break;case"MESSAGES_SNAPSHOT":e.messages=s.messages;break;case"CUSTOM":console.log("Custom event:",s.name,s.value);break}}function l(s){const n={id:Ke(),role:"user",content:s,createdAt:new Date().toISOString()};return e.messages.push(n),n}function f(){e.messages=[],e.streamingMessageId=null,e.streamingContent="",e.toolCalls.clear(),e.agentState={},e.threadId=null,e.runId=null,e.error=null,e.currentStep=null}function u(){e.error=null,e.status==="error"&&(e.status="disconnected")}return{get status(){return e.status},get error(){return e.error},get threadId(){return e.threadId},get runId(){return e.runId},get messages(){return e.messages},get streamingMessageId(){return e.streamingMessageId},get streamingContent(){return e.streamingContent},get toolCalls(){return e.toolCalls},get agentState(){return e.agentState},get currentStep(){return e.currentStep},get isStreaming(){return o(a)},get isConnected(){return o(m)},get isRunning(){return o(v)},get allMessages(){return o(r)()},handleEvent:p,addUserMessage:l,clear:f,clearError:u,_setStatus(s){e.status=s},_setError(s){e.error=s}}}function Je(e){let a=null;async function m(r,p){v(),a=new AbortController,r._setStatus("connecting"),r._setError(null);try{const l=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream",...e.headers},body:JSON.stringify(p),signal:a.signal});if(!l.ok){const n=await l.text();throw new Error(`HTTP ${l.status}: ${n}`)}if(!l.body)throw new Error("No response body");const f=l.body.getReader(),u=new TextDecoder;let s="";for(;;){const{done:n,value:g}=await f.read();if(n)break;s+=u.decode(g,{stream:!0});const y=s.split(`
`);s=y.pop()||"";for(const C of y){const c=ce(C);c&&r.handleEvent(c)}}if(s.trim()){const n=ce(s);n&&r.handleEvent(n)}}catch(l){l instanceof Error&&l.name==="AbortError"?r._setStatus("disconnected"):(r._setStatus("error"),r._setError(l instanceof Error?l.message:"Unknown error"))}finally{a=null}}function v(){a&&(a.abort(),a=null)}return{run:m,abort:v}}function qe(e){const a=Xe(),m=Je({url:e.url,headers:e.headers});let v=e.tools||[],r=e.initialState||{};async function p(n){a.addUserMessage(n);const g={threadId:e.threadId||a.threadId||void 0,messages:a.messages,tools:v.length>0?v:void 0,state:Object.keys(r).length>0?r:void 0};await m.run(a,g),a.error?e.onError?.(a.error):e.onComplete?.()}function l(){m.abort()}function f(){m.abort(),a.clear()}function u(n){r={...r,...n}}function s(n){v=n}return{get status(){return a.status},get error(){return a.error},get messages(){return a.allMessages},get isStreaming(){return a.isStreaming},get isRunning(){return a.isRunning},get threadId(){return a.threadId},get currentStep(){return a.currentStep},get toolCalls(){return a.toolCalls},get sharedState(){return r},get streamingContent(){return a.streamingContent},send:p,stop:l,clear:f,setState:u,setTools:s,_agentState:a,_client:m}}function de(e){if(!e)return"";let a=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return a=a.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre><code class="language-$1">$2</code></pre>'),a=a.replace(/`([^`]+)`/g,"<code>$1</code>"),a=a.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\*([^*]+)\*/g,"<em>$1</em>"),a=a.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),a=a.replace(/\n/g,"<br>"),a}var We=k('<button type="button" class="prompt-chip svelte-12tm3zb"> </button>'),Ve=k('<div class="empty-state svelte-12tm3zb"><div class="empty-icon svelte-12tm3zb"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5" class="svelte-12tm3zb"></path><path d="M2 12l10 5 10-5" class="svelte-12tm3zb"></path></svg></div> <h2 class="svelte-12tm3zb">Start a conversation</h2> <p class="svelte-12tm3zb">Ask me about beer recipes, brewing techniques, or ingredient substitutions.</p> <div class="example-prompts svelte-12tm3zb"></div></div>'),Ye=G('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" class="svelte-12tm3zb"></path></svg>'),Qe=G('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg>'),Ze=k('<div class="message-text streaming svelte-12tm3zb"><!> <span class="cursor svelte-12tm3zb"></span></div>'),et=k('<div class="message-text svelte-12tm3zb"><!></div>'),tt=k('<div><div class="message-avatar svelte-12tm3zb"><!></div> <div class="message-content svelte-12tm3zb"><!></div></div>'),st=k('<div class="message assistant svelte-12tm3zb"><div class="message-avatar svelte-12tm3zb"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg></div> <div class="message-content svelte-12tm3zb"><div class="typing-indicator svelte-12tm3zb"><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span></div></div></div>'),at=k('<div class="messages svelte-12tm3zb"><!> <!></div>'),rt=k('<div class="error-banner svelte-12tm3zb"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" class="svelte-12tm3zb"></path></svg> <span class="svelte-12tm3zb"> </span> <button type="button" class="svelte-12tm3zb">Dismiss</button></div>'),nt=G('<svg class="spinner svelte-12tm3zb" width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10" class="svelte-12tm3zb"></circle></svg>'),lt=G('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12tm3zb"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" class="svelte-12tm3zb"></path></svg>'),ot=k('<div class="assistant-page svelte-12tm3zb"><header class="page-header svelte-12tm3zb"><div class="header-content svelte-12tm3zb"><h1 class="svelte-12tm3zb">Brewing Assistant</h1> <p class="subtitle svelte-12tm3zb">AI-powered recipe creation and brewing advice</p></div> <div class="settings svelte-12tm3zb"><label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Batch Size</span> <input type="number" min="1" max="100" class="svelte-12tm3zb"/> L</label> <label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Efficiency</span> <input type="number" min="50" max="100" class="svelte-12tm3zb"/> %</label></div></header> <main class="chat-container svelte-12tm3zb"><!> <!></main> <footer class="input-area svelte-12tm3zb"><div class="input-wrapper svelte-12tm3zb"><textarea placeholder="Ask about brewing..." rows="1" class="svelte-12tm3zb"></textarea> <button type="button" class="send-button svelte-12tm3zb"><!></button></div> <div class="input-hint svelte-12tm3zb">Press Enter to send, Shift+Enter for new line</div></footer></div>');function ft(e,a){Oe(a,!0);let m=U(19),v=U(72);const r=qe({url:"/api/ag-ui/run",initialState:{batchSize:o(m),efficiency:o(v)},onStateChange:t=>{t.recipe&&console.log("Recipe extracted:",t.recipe)},onError:t=>{console.error("Agent error:",t)}});let p=U(""),l=U(null);function f(t){R(m,t,!0),r.setState({batchSize:t})}function u(t){R(v,t,!0),r.setState({efficiency:t})}function s(t){t.style.height="auto",t.style.height=Math.min(t.scrollHeight,200)+"px"}async function n(){const t=o(p).trim();!t||r.isRunning||(R(p,""),o(l)&&(o(l).style.height="auto"),await r.send(t))}function g(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),n())}const y=["Help me create an American IPA recipe","What temperature should I ferment a Belgian Tripel?","Create a simple wheat beer recipe for summer","Explain the difference between ale and lager yeast"];function C(t){R(p,t,!0),o(l)&&(o(l).focus(),s(o(l)))}Le(()=>{o(l)?.focus()});var c=ot();$e("12tm3zb",t=>{Be(()=>{He.title="AI Assistant | BrewSignal"})});var b=d(c),I=z(d(b),2),j=d(I),F=z(d(j),2);oe(F),F.__change=t=>f(Number(t.currentTarget.value)),$(),i(j);var W=z(j,2),K=z(d(W),2);oe(K),K.__change=t=>u(Number(t.currentTarget.value)),$(),i(W),i(I),i(b);var X=z(b,2),V=d(X);{var ge=t=>{var h=Ve(),M=z(d(h),6);ne(M,21,()=>y,Ue,(O,x)=>{var w=We();w.__click=()=>C(o(x));var T=d(w,!0);i(w),L(()=>te(T,o(x))),S(O,w)}),i(M),i(h),S(t,h)},ue=t=>{var h=at(),M=d(h);ne(M,17,()=>r.messages,w=>w.id,(w,T)=>{var B=tt(),J=d(B),be=d(J);{var _e=_=>{var E=Ye();S(_,E)},Se=_=>{var E=Qe();S(_,E)};N(be,_=>{o(T).role==="user"?_(_e):_(Se,!1)})}i(J);var Z=z(J,2),ze=d(Z);{var Ce=_=>{var E=Ze(),q=d(E);ie(q,()=>de(r.streamingContent||"")),$(2),i(E),S(_,E)},Ie=_=>{var E=et(),q=d(E);ie(q,()=>de(o(T).content)),i(E),S(_,E)};N(ze,_=>{o(T).role==="assistant"&&r.isStreaming&&o(T).id===r._agentState.streamingMessageId?_(Ce):_(Ie,!1)})}i(Z),i(B),L(()=>Ge(B,1,`message ${o(T).role??""}`,"svelte-12tm3zb")),S(w,B)});var O=z(M,2);{var x=w=>{var T=st();S(w,T)};N(O,w=>{r.isRunning&&!r.isStreaming&&w(x)})}i(h),S(t,h)};N(V,t=>{r.messages.length===0?t(ge):t(ue,!1)})}var me=z(V,2);{var ve=t=>{var h=rt(),M=z(d(h),2),O=d(M,!0);i(M);var x=z(M,2);x.__click=()=>r._agentState.clearError(),i(h),L(()=>te(O,r.error)),S(t,h)};N(me,t=>{r.error&&t(ve)})}i(X);var Y=z(X,2),Q=d(Y),A=d(Q);Pe(A),A.__input=t=>s(t.currentTarget),A.__keydown=g,Fe(A,t=>R(l,t),()=>o(l));var D=z(A,2);D.__click=n;var pe=d(D);{var he=t=>{var h=nt();S(t,h)},fe=t=>{var h=lt();S(t,h)};N(pe,t=>{r.isRunning?t(he):t(fe,!1)})}i(D),i(Q),$(2),i(Y),i(c),L(t=>{le(F,o(m)),le(K,o(v)),A.disabled=r.isRunning,D.disabled=t},[()=>!o(p).trim()||r.isRunning]),je(A,()=>o(p),t=>R(p,t)),S(e,c),De()}Ee(["change","click","input","keydown"]);export{ft as component};
