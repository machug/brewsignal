import{g as te,h as we,d as Ee,f as A,a as z,s as se,b as j}from"../chunks/mIejMQ-v.js";import{ar as D,x as ae,M as re,h as Me,aF as ke,T as ne,U as Te,a6 as ye,aG as Ae,aH as xe,J as Re,K as U,p as q,c as n,ai as $,aq as N,ap as B,s as y,ah as Oe,ao as Ne,al as c,ak as C,aj as Le,e as De,am as Be,as as G,an as i,au as He}from"../chunks/TUuJpABw.js";import{e as le,i as Pe}from"../chunks/BMkmvfmB.js";import{i as O}from"../chunks/BpxQuLsu.js";import{h as Ue}from"../chunks/BXtSjz4L.js";import{r as oe}from"../chunks/DZF_q5Xf.js";import{s as $e}from"../chunks/Cts_lnij.js";import{b as J}from"../chunks/CyJrDIBB.js";import{b as Ge}from"../chunks/DcEBuxxh.js";function ie(e,t,m=!1,v=!1,r=!1){var p=e,o="";D(()=>{var f=Me;if(o===(o=t()??"")){ae&&re();return}if(f.nodes_start!==null&&(ke(f.nodes_start,f.nodes_end),f.nodes_start=f.nodes_end=null),o!==""){if(ae){ne.data;for(var d=re(),s=d;d!==null&&(d.nodeType!==Te||d.data!=="");)s=d,d=ye(d);if(d===null)throw Ae(),xe;te(ne,s),p=Re(d);return}var l=o+"";m?l=`<svg>${l}</svg>`:v&&(l=`<math>${l}</math>`);var g=we(l);if((m||v)&&(g=U(g)),te(U(g),g.lastChild),m||v)for(;U(g);)p.before(U(g));else p.before(g)}})}function ce(e){if(!e.startsWith("data: "))return null;const t=e.slice(6).trim();if(t==="[DONE]")return null;try{return JSON.parse(t)}catch{return console.warn("Failed to parse SSE event:",t),null}}function je(){return`${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function Fe(){const e=q({status:"disconnected",error:null,threadId:null,runId:null,messages:[],streamingMessageId:null,streamingContent:"",toolCalls:new Map,agentState:{},currentStep:null}),t=$(()=>e.streamingMessageId!==null),m=$(()=>e.status==="connected"),v=$(()=>e.status==="connecting"||n(t)),r=$(()=>()=>{const s=[...e.messages];if(e.streamingMessageId&&e.streamingContent){const l=s.findIndex(g=>g.id===e.streamingMessageId);l>=0?s[l]={...s[l],content:e.streamingContent}:s.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}return s});function p(s){switch(s.type){case"RUN_STARTED":e.status="connected",e.threadId=s.threadId,e.runId=s.runId,e.error=null;break;case"RUN_FINISHED":if(e.status="connected",e.streamingMessageId&&e.streamingContent){const b=e.messages.findIndex(u=>u.id===e.streamingMessageId);b>=0?e.messages[b].content=e.streamingContent:e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent})}e.streamingMessageId=null,e.streamingContent="",e.currentStep=null;break;case"RUN_ERROR":e.status="error",e.error=s.message,e.streamingMessageId=null,e.streamingContent="";break;case"STEP_STARTED":e.currentStep=s.stepName;break;case"STEP_FINISHED":e.currentStep=null;break;case"TEXT_MESSAGE_START":e.streamingMessageId=s.messageId,e.streamingContent="";break;case"TEXT_MESSAGE_CONTENT":s.messageId===e.streamingMessageId&&(e.streamingContent+=s.delta);break;case"TEXT_MESSAGE_END":s.messageId===e.streamingMessageId&&(e.messages.push({id:e.streamingMessageId,role:"assistant",content:e.streamingContent}),e.streamingMessageId=null,e.streamingContent="");break;case"TEXT_MESSAGE_CHUNK":e.streamingMessageId||(e.streamingMessageId=s.messageId,e.streamingContent=""),e.streamingContent+=s.content;break;case"TOOL_CALL_START":e.toolCalls.set(s.toolCallId,{id:s.toolCallId,name:s.toolCallName,args:"",status:"running"});break;case"TOOL_CALL_ARGS":const l=e.toolCalls.get(s.toolCallId);l&&(l.args+=s.delta);break;case"TOOL_CALL_END":const g=e.toolCalls.get(s.toolCallId);g&&(g.status="completed");break;case"TOOL_CALL_RESULT":const M=e.toolCalls.get(s.toolCallId);M&&(M.result=s.content,M.status="completed");break;case"STATE_SNAPSHOT":e.agentState=s.snapshot;break;case"STATE_DELTA":for(const b of s.delta){const u=b.path.split("/").filter(Boolean);if(b.op==="add"||b.op==="replace"){let _=e.agentState;for(let I=0;I<u.length-1;I++)u[I]in _||(_[u[I]]={}),_=_[u[I]];_[u[u.length-1]]=b.value}else if(b.op==="remove"){let _=e.agentState;for(let I=0;I<u.length-1;I++)_=_[u[I]];delete _[u[u.length-1]]}}break;case"MESSAGES_SNAPSHOT":e.messages=s.messages;break;case"CUSTOM":console.log("Custom event:",s.name,s.value);break}}function o(s){const l={id:je(),role:"user",content:s,createdAt:new Date().toISOString()};return e.messages.push(l),l}function f(){e.messages=[],e.streamingMessageId=null,e.streamingContent="",e.toolCalls.clear(),e.agentState={},e.threadId=null,e.runId=null,e.error=null,e.currentStep=null}function d(){e.error=null,e.status==="error"&&(e.status="disconnected")}return{get status(){return e.status},get error(){return e.error},get threadId(){return e.threadId},get runId(){return e.runId},get messages(){return e.messages},get streamingMessageId(){return e.streamingMessageId},get streamingContent(){return e.streamingContent},get toolCalls(){return e.toolCalls},get agentState(){return e.agentState},get currentStep(){return e.currentStep},get isStreaming(){return n(t)},get isConnected(){return n(m)},get isRunning(){return n(v)},get allMessages(){return n(r)()},handleEvent:p,addUserMessage:o,clear:f,clearError:d,_setStatus(s){e.status=s},_setError(s){e.error=s}}}function Ke(e){let t=null;async function m(r,p){v(),t=new AbortController,r._setStatus("connecting"),r._setError(null);try{const o=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream",...e.headers},body:JSON.stringify(p),signal:t.signal});if(!o.ok){const l=await o.text();throw new Error(`HTTP ${o.status}: ${l}`)}if(!o.body)throw new Error("No response body");const f=o.body.getReader(),d=new TextDecoder;let s="";for(;;){const{done:l,value:g}=await f.read();if(l)break;s+=d.decode(g,{stream:!0});const M=s.split(`
`);s=M.pop()||"";for(const b of M){const u=ce(b);u&&r.handleEvent(u)}}if(s.trim()){const l=ce(s);l&&r.handleEvent(l)}}catch(o){o instanceof Error&&o.name==="AbortError"?r._setStatus("disconnected"):(r._setStatus("error"),r._setError(o instanceof Error?o.message:"Unknown error"))}finally{t=null}}function v(){t&&(t.abort(),t=null)}return{run:m,abort:v}}function Xe(e){const t=Fe(),m=Ke({url:e.url,headers:e.headers});let v=N(q(e.tools||[])),r=N(q(e.initialState||{}));B(()=>{Object.keys(t.agentState).length>0&&(y(r,{...n(r),...t.agentState},!0),e.onStateChange?.(n(r)))}),B(()=>{for(const[,l]of t.toolCalls)l.status==="running"&&e.onToolCall?.(l.name,l.args)}),B(()=>{t.status==="connected"&&!t.isStreaming&&t.runId&&e.onComplete?.()}),B(()=>{t.error&&e.onError?.(t.error)});async function p(l){t.addUserMessage(l);const g={threadId:e.threadId||t.threadId||void 0,messages:t.messages,tools:n(v).length>0?n(v):void 0,state:Object.keys(n(r)).length>0?n(r):void 0};await m.run(t,g)}function o(){m.abort()}function f(){m.abort(),t.clear()}function d(l){y(r,{...n(r),...l},!0)}function s(l){y(v,l,!0)}return{get status(){return t.status},get error(){return t.error},get messages(){return t.allMessages},get isStreaming(){return t.isStreaming},get isRunning(){return t.isRunning},get threadId(){return t.threadId},get currentStep(){return t.currentStep},get toolCalls(){return t.toolCalls},get sharedState(){return n(r)},get streamingContent(){return t.streamingContent},send:p,stop:o,clear:f,setState:d,setTools:s,_agentState:t,_client:m}}function de(e){if(!e)return"";let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return t=t.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre><code class="language-$1">$2</code></pre>'),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*([^*]+)\*/g,"<em>$1</em>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>'),t=t.replace(/\n/g,"<br>"),t}var Je=A('<button type="button" class="prompt-chip svelte-12tm3zb"> </button>'),qe=A('<div class="empty-state svelte-12tm3zb"><div class="empty-icon svelte-12tm3zb"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5" class="svelte-12tm3zb"></path><path d="M2 12l10 5 10-5" class="svelte-12tm3zb"></path></svg></div> <h2 class="svelte-12tm3zb">Start a conversation</h2> <p class="svelte-12tm3zb">Ask me about beer recipes, brewing techniques, or ingredient substitutions.</p> <div class="example-prompts svelte-12tm3zb"></div></div>'),We=j('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" class="svelte-12tm3zb"></path></svg>'),Ve=j('<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg>'),Ye=A('<div class="message-text streaming svelte-12tm3zb"><!> <span class="cursor svelte-12tm3zb"></span></div>'),Qe=A('<div class="message-text svelte-12tm3zb"><!></div>'),Ze=A('<div><div class="message-avatar svelte-12tm3zb"><!></div> <div class="message-content svelte-12tm3zb"><!></div></div>'),et=A('<div class="message assistant svelte-12tm3zb"><div class="message-avatar svelte-12tm3zb"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2L2 7l10 5 10-5-10-5z" class="svelte-12tm3zb"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" fill="none" class="svelte-12tm3zb"></path></svg></div> <div class="message-content svelte-12tm3zb"><div class="typing-indicator svelte-12tm3zb"><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span><span class="svelte-12tm3zb"></span></div></div></div>'),tt=A('<div class="messages svelte-12tm3zb"><!> <!></div>'),st=A('<div class="error-banner svelte-12tm3zb"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-12tm3zb"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" class="svelte-12tm3zb"></path></svg> <span class="svelte-12tm3zb"> </span> <button type="button" class="svelte-12tm3zb">Dismiss</button></div>'),at=j('<svg class="spinner svelte-12tm3zb" width="20" height="20" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10" class="svelte-12tm3zb"></circle></svg>'),rt=j('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-12tm3zb"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" class="svelte-12tm3zb"></path></svg>'),nt=A('<div class="assistant-page svelte-12tm3zb"><header class="page-header svelte-12tm3zb"><div class="header-content svelte-12tm3zb"><h1 class="svelte-12tm3zb">Brewing Assistant</h1> <p class="subtitle svelte-12tm3zb">AI-powered recipe creation and brewing advice</p></div> <div class="settings svelte-12tm3zb"><label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Batch Size</span> <input type="number" min="1" max="100" class="svelte-12tm3zb"/> L</label> <label class="setting svelte-12tm3zb"><span class="svelte-12tm3zb">Efficiency</span> <input type="number" min="50" max="100" class="svelte-12tm3zb"/> %</label></div></header> <main class="chat-container svelte-12tm3zb"><!> <!></main> <footer class="input-area svelte-12tm3zb"><div class="input-wrapper svelte-12tm3zb"><textarea placeholder="Ask about brewing..." rows="1" class="svelte-12tm3zb"></textarea> <button type="button" class="send-button svelte-12tm3zb"><!></button></div> <div class="input-hint svelte-12tm3zb">Press Enter to send, Shift+Enter for new line</div></footer></div>');function pt(e,t){Oe(t,!0);let m=N(19),v=N(72);const r=Xe({url:"/api/ag-ui/run",initialState:{batchSize:n(m),efficiency:n(v)},onStateChange:a=>{a.recipe&&console.log("Recipe extracted:",a.recipe)},onError:a=>{console.error("Agent error:",a)}});let p=N(""),o=N(null);B(()=>{r.setState({batchSize:n(m),efficiency:n(v)})});function f(a){a.style.height="auto",a.style.height=Math.min(a.scrollHeight,200)+"px"}async function d(){const a=n(p).trim();!a||r.isRunning||(y(p,""),n(o)&&(n(o).style.height="auto"),await r.send(a))}function s(a){a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),d())}const l=["Help me create an American IPA recipe","What temperature should I ferment a Belgian Tripel?","Create a simple wheat beer recipe for summer","Explain the difference between ale and lager yeast"];function g(a){y(p,a,!0),n(o)&&(n(o).focus(),f(n(o)))}Ne(()=>{n(o)?.focus()});var M=nt();Ue("12tm3zb",a=>{De(()=>{Be.title="AI Assistant | BrewSignal"})});var b=c(M),u=C(c(b),2),_=c(u),I=C(c(_),2);oe(I),G(),i(_);var W=C(_,2),V=C(c(W),2);oe(V),G(),i(W),i(u),i(b);var F=C(b,2),Y=c(F);{var ge=a=>{var h=qe(),k=C(c(h),6);le(k,21,()=>l,Pe,(L,R)=>{var w=Je();w.__click=()=>g(n(R));var T=c(w,!0);i(w),D(()=>se(T,n(R))),z(L,w)}),i(k),i(h),z(a,h)},ue=a=>{var h=tt(),k=c(h);le(k,17,()=>r.messages,w=>w.id,(w,T)=>{var P=Ze(),K=c(P),be=c(K);{var _e=S=>{var E=We();z(S,E)},Se=S=>{var E=Ve();z(S,E)};O(be,S=>{n(T).role==="user"?S(_e):S(Se,!1)})}i(K);var ee=C(K,2),ze=c(ee);{var Ce=S=>{var E=Ye(),X=c(E);ie(X,()=>de(r.streamingContent||"")),G(2),i(E),z(S,E)},Ie=S=>{var E=Qe(),X=c(E);ie(X,()=>de(n(T).content)),i(E),z(S,E)};O(ze,S=>{n(T).role==="assistant"&&r.isStreaming&&n(T).id===r._agentState.streamingMessageId?S(Ce):S(Ie,!1)})}i(ee),i(P),D(()=>$e(P,1,`message ${n(T).role??""}`,"svelte-12tm3zb")),z(w,P)});var L=C(k,2);{var R=w=>{var T=et();z(w,T)};O(L,w=>{r.isRunning&&!r.isStreaming&&w(R)})}i(h),z(a,h)};O(Y,a=>{r.messages.length===0?a(ge):a(ue,!1)})}var me=C(Y,2);{var ve=a=>{var h=st(),k=C(c(h),2),L=c(k,!0);i(k);var R=C(k,2);R.__click=()=>r._agentState.clearError(),i(h),D(()=>se(L,r.error)),z(a,h)};O(me,a=>{r.error&&a(ve)})}i(F);var Q=C(F,2),Z=c(Q),x=c(Z);He(x),x.__input=a=>f(a.currentTarget),x.__keydown=s,Ge(x,a=>y(o,a),()=>n(o));var H=C(x,2);H.__click=d;var pe=c(H);{var he=a=>{var h=at();z(a,h)},fe=a=>{var h=rt();z(a,h)};O(pe,a=>{r.isRunning?a(he):a(fe,!1)})}i(H),i(Z),G(2),i(Q),i(M),D(a=>{x.disabled=r.isRunning,H.disabled=a},[()=>!n(p).trim()||r.isRunning]),J(I,()=>n(m),a=>y(m,a)),J(V,()=>n(v),a=>y(v,a)),J(x,()=>n(p),a=>y(p,a)),z(e,M),Le()}Ee(["click","input","keydown"]);export{pt as component};
