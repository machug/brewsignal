import{d as zt,f as i,s as d,a as n,c as me,t as It}from"../chunks/CsQfwH0S.js";import{al as a,ak as s,an as t,ar as u,ah as jt,at as G,c as e,ai as F,as as qe,aj as yt,aq as ze,p as Kt,ao as Qt,s as _,aL as ma,ay as ha,am as ba}from"../chunks/fKkNMI8q.js";import{e as Xt,i as Zt}from"../chunks/COk1ZY4R.js";import{i as o}from"../chunks/BvBRaQNg.js";import{h as xa}from"../chunks/DLseniaC.js";import{s as ft}from"../chunks/DbN3nGCc.js";import{s as Ae}from"../chunks/BDI2zAFW.js";import{s as Ze}from"../chunks/CcRNvR1k.js";import{i as ja,s as ya}from"../chunks/C8srtpii.js";import{s as wa,a as ka}from"../chunks/C51ud8ec.js";import{p as za}from"../chunks/BK9PIFpn.js";import{g as qa}from"../chunks/DY9I2oDS.js";import{z as Fa,A as Ra,q as Ca,j as Wt,B as wt,k as Ba,x as Jt,C as Ct}from"../chunks/i8VL_lOf.js";import{d as xt,e as $t,g as ea,c as kt}from"../chunks/CPwbAm-l.js";import{t as Yt}from"../chunks/C8NDSE1R.js";import{B as Ma}from"../chunks/DTfC6M4H.js";import{s as Ta}from"../chunks/Bdaed-dN.js";import{p as ut}from"../chunks/CllCHKBI.js";const Sa=!1,zr=Object.freeze(Object.defineProperty({__proto__:null,prerender:Sa},Symbol.toStringTag,{value:"Module"}));function Da(le){return le>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:le>=-60?{bars:3,color:"var(--positive)",label:"Good"}:le>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function ta(le){const l=Math.floor((Date.now()-new Date(le).getTime())/1e3);if(l<10)return"just now";if(l<60)return`${l}s ago`;const D=Math.floor(l/60);if(D<60)return`${D}m ago`;const V=Math.floor(D/60);return V<24?`${V}h ago`:`${Math.floor(V/24)}d ago`}var Pa=i('<div class="accent-bar svelte-1oyrwd9"></div>'),Oa=i('<span class="card-icon svelte-1oyrwd9"> </span>'),Aa=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),Ea=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function qt(le,l){let D=ut(l,"highlight",3,!1),V=ut(l,"compact",3,!1),O=ut(l,"collapsible",3,!1),f=ut(l,"expanded",3,!1);var A=Ea();let r;var T=a(A);{var g=h=>{var v=Pa();n(h,v)};o(T,h=>{D()&&h(g)})}var L=s(T,2),ee=a(L),oe=a(ee);{var z=h=>{var v=Oa(),j=a(v,!0);t(v),u(()=>d(j,l.icon)),n(h,v)};o(oe,h=>{l.icon&&h(z)})}var C=s(oe,2),U=a(C,!0);t(C),t(ee);var J=s(ee,2);{var Y=h=>{var v=Aa();v.__click=function(...H){l.onToggle?.apply(this,H)};var j=a(v);let R;t(v),u(()=>{ft(v,"aria-label",f()?"Collapse":"Expand"),R=Ae(j,0,"expand-icon svelte-1oyrwd9",null,R,{"rotate-180":f()})}),n(h,v)};o(J,h=>{O()&&l.onToggle&&h(Y)})}t(L);var ne=s(L,2);let N;var K=a(ne);Ta(K,()=>l.children),t(ne),t(A),u(()=>{r=Ae(A,1,"batch-card svelte-1oyrwd9",null,r,{highlight:D(),compact:V()}),d(U,l.title),N=Ae(ne,1,"card-content svelte-1oyrwd9",null,N,{collapsed:O()&&!f()})}),n(le,A)}zt(["click"]);var Ga=i('<span class="updated-text svelte-t80j9z"> </span>'),La=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),Ua=i('<div class="remaining-text svelte-t80j9z"> </div>'),Na=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),Va=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),Ha=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),Ia=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),Wa=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function Ja(le,l){jt(l,!0);let D=F(()=>l.currentSg??l.progress?.measured?.current_sg),V=F(()=>l.liveReading?.temp??l.progress?.temperature?.current),O=F(()=>l.liveReading?.last_seen),f=F(()=>e(O)?ta(e(O)):null),A=F(ea),r=F(()=>{if(!l.batch.measured_og||!e(D))return null;const z=Math.max(0,(l.batch.measured_og-e(D))*131.25),C=l.batch.measured_og-1,U=C!==0?Math.max(0,Math.min(100,(l.batch.measured_og-e(D))/C*100)):0;return{abv:z,attenuation:U}}),T=F(()=>{const z=l.batch.measured_og,C=l.batch.recipe?.fg;if(!z||!C||!e(D))return null;const U=z-C,J=z-e(D);return U<=0?null:Math.max(0,Math.min(100,J/U*100))}),g=F(()=>l.batch.status==="fermenting"||l.batch.status==="conditioning");function L(z){return z==null?"--":xt(z)}function ee(z){return z==null?"--":`${z.toFixed(1)}%`}function oe(z){return z==null?"--":$t(z)}qt(le,{title:"Fermentation",children:(z,C)=>{var U=me(),J=G(U);{var Y=N=>{var K=Ha(),h=G(K),v=s(a(h),2);{var j=B=>{var M=Ga(),y=a(M);t(M),u(()=>d(y,`Updated ${e(f)??""}`)),n(B,M)};o(v,B=>{e(f)&&B(j)})}t(h);var R=s(h,2),H=a(R),he=a(H),E=a(he,!0);t(he),qe(2),t(H);var be=s(H,2);{var Fe=B=>{var M=La(),y=s(G(M),2),I=a(y),Q=a(I,!0),$=s(Q),te=a($,!0);t($),t(I),qe(2),t(y),u(ce=>{d(Q,ce),d(te,e(A))},[()=>oe(e(V))]),n(B,M)};o(be,B=>{e(V)!=null&&B(Fe)})}t(R);var ie=s(R,2);{var xe=B=>{var M=Na(),y=a(M),I=a(y),Q=a(I),$=a(Q,!0);t(Q),qe(2),t(I);var te=s(I,2),ce=a(te),Ee=a(ce);t(ce),t(te);var je=s(te,2),Ge=a(je),Me=a(Ge,!0);t(Ge),qe(2),t(je),t(y);var c=s(y,2),x=a(c),W=s(x,2);let w;var pe=s(a(W),2),ye=a(pe,!0);t(pe),t(W),t(c);var Re=s(c,2);{var Ce=m=>{var p=Ua(),q=a(p);t(p),u(X=>d(q,`${X??""} points to go`),[()=>l.progress.progress.sg_remaining.toFixed(3)]),n(m,p)};o(Re,m=>{l.progress?.progress?.sg_remaining!=null&&l.progress.progress.sg_remaining>0&&m(Ce)})}t(M),u((m,p,q,X)=>{d($,m),d(Ee,`${p??""}%`),d(Me,q),Ze(x,`width: ${e(T)??""}%`),w=Ae(W,1,"progress-marker svelte-t80j9z",null,w,{"at-start":e(T)<3}),Ze(W,`left: ${e(T)??""}%`),d(ye,X)},[()=>L(l.batch.measured_og),()=>e(T).toFixed(0),()=>L(l.batch.recipe.fg),()=>L(e(D))]),n(B,M)};o(ie,B=>{e(T)!==null&&l.batch.measured_og&&l.batch.recipe?.fg&&B(xe)})}var Z=s(ie,2);{var de=B=>{var M=Va(),y=a(M),I=a(y),Q=a(I,!0);t(I),qe(2),t(y);var $=s(y,2),te=a($),ce=a(te,!0);t(te),qe(2),t($),t(M),u((Ee,je)=>{d(Q,Ee),d(ce,je)},[()=>ee(e(r).abv),()=>ee(e(r).attenuation)]),n(B,M)};o(Z,B=>{e(r)&&B(de)})}u(B=>d(E,B),[()=>L(e(D))]),n(N,K)},ne=N=>{var K=me(),h=G(K);{var v=R=>{var H=Ia(),he=a(H),E=a(he),be=a(E,!0);t(E),qe(2),t(he);var Fe=s(he,2),ie=a(Fe),xe=a(ie,!0);t(ie),qe(2),t(Fe);var Z=s(Fe,2),de=a(Z),B=a(de,!0);t(de),qe(2),t(Z);var M=s(Z,2),y=a(M),I=a(y,!0);t(y),qe(2),t(M),t(H),u((Q,$,te,ce)=>{d(be,Q),d(xe,$),d(B,te),d(I,ce)},[()=>L(l.batch.measured_og),()=>L(l.batch.measured_fg),()=>l.batch.measured_abv!=null?ee(l.batch.measured_abv):"--",()=>l.batch.measured_attenuation!=null?ee(l.batch.measured_attenuation):"--"]),n(R,H)},j=R=>{var H=Wa();n(R,H)};o(h,R=>{l.batch.measured_og?R(v):R(j,!1)},!0)}n(N,K)};o(J,N=>{e(D)&&e(g)?N(Y):N(ne,!1)})}n(z,U)},$$slots:{default:!0}}),yt()}var Ya=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),Ka=i('<div class="signal-bar svelte-1kdxwtz"></div>'),Qa=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),Xa=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),Za=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),$a=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),es=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),ts=i('<div class="device-info svelte-1kdxwtz"><!></div>'),as=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),ss=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function rs(le,l){jt(l,!0);let D=F(()=>l.liveReading?.device_type==="tilt"),V=F(()=>e(D)&&l.liveReading?.rssi?Da(l.liveReading.rssi):null),O=F(()=>l.liveReading?.last_seen?ta(l.liveReading.last_seen):null),f=F(()=>l.liveReading?.battery_percent!=null||l.liveReading?.battery_voltage!=null),A=F(()=>l.liveReading?.battery_percent),r=F(()=>l.liveReading?.battery_voltage),T=F(()=>e(A)?e(A)>50?"var(--positive)":e(A)>20?"#f59e0b":"var(--negative)":"var(--text-muted)"),g=F(()=>{if(!l.liveReading)return l.batch.device_id||"Unknown";const L=l.liveReading.device_type;return L==="tilt"?`${l.liveReading.color} Tilt`:L==="gravitymon"?`GravityMon (${l.liveReading.id})`:L==="ispindel"?`iSpindel (${l.liveReading.id})`:L==="floaty"?`Floaty (${l.liveReading.id})`:l.liveReading.color||l.liveReading.id});qt(le,{title:"Tracking Device",compact:!0,children:(L,ee)=>{var oe=me(),z=G(oe);{var C=J=>{var Y=ts(),ne=a(Y);{var N=h=>{var v=$a(),j=G(v),R=a(j),H=s(a(R));t(R);var he=s(R,2);{var E=ie=>{var xe=Ya(),Z=a(xe,!0);t(xe),u(()=>d(Z,e(O))),n(ie,xe)};o(he,ie=>{e(O)&&ie(E)})}t(j);var be=s(j,2);{var Fe=ie=>{var xe=Za(),Z=a(xe);{var de=y=>{var I=Qa(),Q=a(I);Xt(Q,20,()=>Array(4),Zt,(ce,Ee,je)=>{var Ge=Ka();u(()=>Ze(Ge,`height: ${4+je*2}px; background: ${(je<e(V).bars?e(V).color:"var(--bg-hover)")??""}; opacity: ${je<e(V).bars?1:.4};`)),n(ce,Ge)}),t(Q);var $=s(Q,2),te=a($);t($),t(I),u(()=>{Ze($,`color: ${e(V).color??""}`),d(te,`${l.liveReading.rssi??""}dBm`)}),n(y,I)};o(Z,y=>{e(V)&&y(de)})}var B=s(Z,2);{var M=y=>{var I=Xa(),Q=a(I),$=s(a(Q)),te=s($);t(Q);var ce=s(Q,2),Ee=a(ce);{var je=Me=>{var c=It();u(x=>d(c,`${x??""}%`),[()=>e(A).toFixed(0)]),n(Me,c)},Ge=Me=>{var c=me(),x=G(c);{var W=w=>{var pe=It();u(ye=>d(pe,`${ye??""}V`),[()=>e(r).toFixed(2)]),n(w,pe)};o(x,w=>{e(r)!=null&&w(W)},!0)}n(Me,c)};o(Ee,Me=>{e(A)!=null?Me(je):Me(Ge,!1)})}t(ce),t(I),u(()=>{ft(Q,"stroke",e(T)),ft($,"width",(e(A)??50)*.14),ft($,"fill",e(T)),ft(te,"fill",e(T)),Ze(ce,`color: ${e(T)??""}`)}),n(y,I)};o(B,y=>{e(f)&&y(M)})}t(xe),n(ie,xe)};o(be,ie=>{(e(V)||e(f))&&ie(Fe)})}u(()=>d(H,` ${e(g)??""}`)),n(h,v)},K=h=>{var v=es(),j=a(v),R=s(a(j));t(j),qe(2),t(v),u(()=>d(R,` ${l.batch.device_id??""}`)),n(h,v)};o(ne,h=>{l.liveReading?h(N):h(K,!1)})}t(Y),n(J,Y)},U=J=>{var Y=ss(),ne=s(a(Y),2);{var N=K=>{var h=as();h.__click=function(...v){l.onEdit?.apply(this,v)},n(K,h)};o(ne,K=>{l.onEdit&&K(N)})}t(Y),n(J,Y)};o(z,J=>{l.batch.device_id?J(C):J(U,!1)})}n(L,oe)},$$slots:{default:!0}}),yt()}zt(["click"]);const ls=131.25;var ns=i('<div class="yeast-row svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span></div>'),is=i('<div class="targets-row svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div></div> <!>',1);function vs(le,l){jt(l,!0);function D(O){return O==null?"--":xt(O)}let V=F(()=>l.recipe.abv!=null?l.recipe.abv:l.recipe.og&&l.recipe.fg?(l.recipe.og-l.recipe.fg)*ls:null);qt(le,{title:"Recipe Targets",compact:!0,children:(O,f)=>{var A=is(),r=G(A),T=a(r),g=s(a(T),2),L=a(g,!0);t(g),t(T);var ee=s(T,2),oe=s(a(ee),2),z=a(oe,!0);t(oe),t(ee);var C=s(ee,2),U=s(a(C),2),J=a(U,!0);t(U),t(C),t(r);var Y=s(r,2);{var ne=N=>{var K=ns(),h=s(a(K),2),v=a(h,!0);t(h),t(K),u(()=>d(v,l.recipe.yeast_name)),n(N,K)};o(Y,N=>{l.recipe.yeast_name&&N(ne)})}u((N,K,h)=>{d(L,N),d(z,K),d(J,h)},[()=>D(l.recipe.og),()=>D(l.recipe.fg),()=>e(V)!=null?`${e(V).toFixed(1)}%`:"--"]),n(O,A)},$$slots:{default:!0}}),yt()}var os=i('<p class="notes-content svelte-hkv31i"> </p>');function ds(le,l){qt(le,{title:"Notes",children:(D,V)=>{var O=os(),f=a(O,!0);t(O),u(()=>d(f,l.notes)),n(D,O)},$$slots:{default:!0}})}var cs=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),us=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),_s=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),gs=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),ps=i('<span class="activity-badge svelte-1xs394q"> </span>'),fs=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),ms=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),hs=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),bs=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),xs=i('<span class="days svelte-1xs394q"> </span>'),js=i(" <!>",1),ys=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),ws=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),ks=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Data points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),zs=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!></div></div></div>'),qs=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q">Predictions require at least 10 readings over 2+ hours</p></div>');function Fs(le,l){jt(l,!0);let D=ut(l,"measuredOg",3,null),V=ut(l,"currentSg",3,null),O=ut(l,"liveReading",3,null),f=ze(Kt({available:!1})),A=ze(!0),r=ze(!1),T=ze(null);async function g(){_(A,!0),_(T,null);try{_(f,await Fa(l.batchId),!0)}catch(v){_(T,v instanceof Error?v.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",v)}finally{_(A,!1)}}async function L(){_(r,!0),_(T,null);try{const v=await Ra(l.batchId);console.log("Reloaded predictions:",v.message),await g()}catch(v){_(T,v instanceof Error?v.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",v)}finally{_(r,!1)}}Qt(g);function ee(v){return v?new Date(v).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function oe(v){if(!v)return null;const j=new Date(v),R=new Date,H=j.getTime()-R.getTime();return Math.ceil(H/(1e3*60*60*24))}let z=F(()=>{const v=D()??e(f).predicted_og,j=e(f).predicted_fg,R=V()??O()?.sg;if(!v||!j||!R||v<=j)return null;const H=v-j,E=(v-R)/H*100;return Math.min(100,Math.max(0,E))}),C=F(()=>{const v=D()??e(f).predicted_og,j=V()??O()?.sg;if(!v||!j||v<=1)return null;const R=(v-j)/(v-1)*100;return Math.min(100,Math.max(0,R))}),U=F(()=>{const v=O()?.sg_rate;if(v==null)return null;const j=Math.abs(v);return j>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:j>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:j>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),J=F(()=>O()?.is_anomaly??!1),Y=F(()=>O()?.anomaly_reasons??[]);var ne=me(),N=G(ne);{var K=v=>{var j=cs();n(v,j)},h=v=>{var j=me(),R=G(j);{var H=E=>{var be=us(),Fe=a(be),ie=a(Fe);t(Fe),t(be),u(()=>d(ie,`‚ö†Ô∏è ${e(T)??""}`)),n(E,be)},he=E=>{var be=me(),Fe=G(be);{var ie=Z=>{var de=zs();let B;var M=a(de),y=s(a(M),2);y.__click=L;var I=a(y,!0);t(y),t(M);var Q=s(M,2);{var $=m=>{var p=gs(),q=s(a(p),2),X=s(a(q),2);{var Te=Le=>{var Ye=_s(),ue=a(Ye,!0);t(Ye),u(Se=>d(ue,Se),[()=>e(Y).join(", ")]),n(Le,Ye)};o(X,Le=>{e(Y).length>0&&Le(Te)})}t(q),t(p),n(m,p)};o(Q,m=>{e(J)&&m($)})}var te=s(Q,2);{var ce=m=>{var p=fs(),q=a(p),X=s(a(q),2);{var Te=Ue=>{var tt=ps(),_t=a(tt);t(tt),u(()=>{Ze(tt,`color: ${e(U).color??""}`),d(_t,`${e(U).emoji??""} ${e(U).label??""}`)}),n(Ue,tt)};o(X,Ue=>{e(U)&&Ue(Te)})}t(q);var Le=s(q,2),Ye=a(Le);t(Le);var ue=s(Le,2),Se=a(ue),$e=a(Se);t(Se);var Ke=s(Se,2),it=a(Ke);t(Ke);var Je=s(Ke,2),et=a(Je);t(Je),t(ue),t(p),u((Ue,tt,_t)=>{Ze(Ye,`width: ${e(z)??""}%`),d($e,`OG: ${Ue??""}`),d(it,`${tt??""}%`),d(et,`FG: ${_t??""}`)},[()=>xt(D()??e(f).predicted_og??0),()=>e(z).toFixed(0),()=>xt(e(f).predicted_fg??0)]),n(m,p)};o(te,m=>{e(z)!==null&&m(ce)})}var Ee=s(te,2),je=a(Ee);{var Ge=m=>{var p=ms(),q=s(a(p),2),X=a(q,!0);t(q),t(p),u(Te=>d(X,Te),[()=>xt(e(f).predicted_fg)]),n(m,p)};o(je,m=>{e(f).predicted_fg&&m(Ge)})}var Me=s(je,2);{var c=m=>{var p=hs(),q=s(a(p),2),X=a(q);t(q),t(p),u(Te=>d(X,`${Te??""}%`),[()=>e(C).toFixed(1)]),n(m,p)};o(Me,m=>{e(C)!==null&&m(c)})}var x=s(Me,2);{var W=m=>{const p=F(()=>oe(e(f).estimated_completion));var q=ys(),X=s(a(q),2),Te=a(X);{var Le=ue=>{var Se=bs();n(ue,Se)},Ye=ue=>{var Se=js(),$e=G(Se),Ke=s($e);{var it=Je=>{var et=xs(),Ue=a(et);t(et),u(()=>d(Ue,`(${e(p)??""} ${e(p)===1?"day":"days"})`)),n(Je,et)};o(Ke,Je=>{e(p)!==null&&Je(it)})}u(Je=>d($e,`${Je??""} `),[()=>ee(e(f).estimated_completion)]),n(ue,Se)};o(Te,ue=>{e(p)!==null&&e(p)<=0?ue(Le):ue(Ye,!1)})}t(X),t(q),n(m,q)};o(x,m=>{e(f).estimated_completion&&m(W)})}var w=s(x,2),pe=a(w);{var ye=m=>{var p=ws(),q=s(a(p),2),X=a(q);t(q),t(p),u(Te=>d(X,`${Te??""}%`),[()=>(e(f).r_squared*100).toFixed(0)]),n(m,p)};o(pe,m=>{e(f).r_squared!==void 0&&m(ye)})}var Re=s(pe,2);{var Ce=m=>{var p=ks(),q=s(a(p),2),X=a(q,!0);t(q),t(p),u(()=>d(X,e(f).num_readings)),n(m,p)};o(Re,m=>{e(f).num_readings&&m(Ce)})}t(w),t(Ee),t(de),u(()=>{B=Ae(de,1,"ml-panel svelte-1xs394q",null,B,{"has-anomaly":e(J)}),y.disabled=e(r)||e(A),d(I,e(r)?"Reloading...":"‚Üª Reload")}),n(Z,de)},xe=Z=>{var de=qs(),B=a(de),M=s(a(B),2);M.__click=L;var y=a(M,!0);t(M),t(B),qe(2),t(de),u(()=>{M.disabled=e(r)||e(A),d(y,e(r)?"Reloading...":"‚Üª Reload")}),n(Z,de)};o(Fe,Z=>{e(f).available?Z(ie):Z(xe,!1)},!0)}n(E,be)};o(R,E=>{e(T)?E(H):E(he,!1)},!0)}n(v,j)};o(N,v=>{e(A)?v(K):v(h,!1)})}n(le,ne),yt()}zt(["click"]);var Rs=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Cs=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Bs=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),Ms=i('<span class="recipe-type svelte-g5au2j"> </span>'),Ts=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),Ss=i('<div class="batch-timing svelte-g5au2j"> </div>'),Ds=i('<div class="batch-timing svelte-g5au2j"> </div>'),Ps=i('<option class="svelte-g5au2j"> </option>'),Os=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),As=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),Es=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),Gs=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),Ls=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),Us=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),Ns=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),Vs=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),Hs=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),Is=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),Ws=i('<span class="status-badge idle svelte-g5au2j"> </span>'),Js=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ys=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ks=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Qs=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),Xs=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),Zs=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),$s=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),er=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),tr=i('<span class="svelte-g5au2j"> </span>'),ar=i('<span class="svelte-g5au2j"> </span>'),sr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),rr=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),lr=i('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),nr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function qr(le,l){jt(l,!0);const D=()=>ka(za,"$page",V),[V,O]=wa();let f=null,A=null,r=ze(null),T=ze(null),g=ze(null);Kt([]);let L=ze(!0),ee=ze(null),oe=ze(!1),z=ze(!1),C=ze(!1),U=ze(!1),J=ze(!1),Y=ze(!1),ne=F(()=>parseInt(D().params.id??"0"));const N={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},K=["planning","fermenting","conditioning","completed","archived"];let h=F(()=>e(r)?N[e(r).status]:N.planning),v=F(ea),j=F(()=>kt.config.ha_enabled&&kt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),R=F(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),H=F(()=>!e(R)||!e(E)?.temp||!e(r)?.temp_target?!1:e(E).temp<=e(r).temp_target),he=F(()=>{if(!e(R)||!e(E)?.temp||!e(r)?.temp_target)return null;const c=e(r).temp_target+30,x=e(E).temp,W=e(r).temp_target;if(x<=W)return 100;if(x>=c)return 0;const w=(c-x)/(c-W)*100;return Math.min(100,Math.max(0,w))}),E=F(()=>{if(!e(r)?.device_id)return null;const c=Yt.tilts.get(e(r).device_id);if(c)return c;const x=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!x?.[1])return null;const W=x[1].toUpperCase();for(const w of Yt.tilts.values())if(w.color&&w.color.toUpperCase()===W)return w;return null});async function be(){_(L,!0),_(ee,null);try{if(_(r,await Ca(e(ne)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{_(T,await Wt(e(ne)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{_(g,await wt(e(ne)),!0)}catch{}}catch(c){_(ee,c instanceof Error?c.message:"Failed to load batch",!0)}finally{_(L,!1)}}async function Fe(c){if(!(!e(r)||e(z))&&!(c==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){_(z,!0);try{_(r,await Jt(e(r).id,{status:c}),!0),(c==="fermenting"||c==="conditioning")&&_(T,await Wt(e(r).id),!0)}catch(x){console.error("Failed to update status:",x)}finally{_(z,!1)}}}async function ie(c){if(e(r)&&(_(r,await Jt(e(r).id,c),!0),_(oe,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{_(g,await wt(e(r).id),!0)}catch{}}async function xe(){if(e(r)){_(J,!0);try{await Ba(e(r).id),qa("/batches")}catch(c){_(ee,c instanceof Error?c.message:"Failed to delete batch",!0),_(J,!1),_(U,!1)}}}async function Z(c,x){if(!(!e(r)||e(C))){_(C,!0);try{await Ct(e(r).id,x,60,c),_(g,await wt(e(r).id),!0)}catch(W){console.error("Failed to set override:",W)}finally{_(C,!1)}}}async function de(){if(!(!e(r)||e(C))){_(C,!0);try{e(r).heater_entity_id&&await Ct(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Ct(e(r).id,null,60,"cooler"),_(g,await wt(e(r).id),!0)}catch(c){console.error("Failed to clear overrides:",c)}finally{_(C,!1)}}}function B(){if(f?.readyState===WebSocket.OPEN)return;const x=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;f=new WebSocket(x),f.onmessage=async W=>{try{const w=JSON.parse(W.data);w.type==="control_event"&&w.batch_id===e(ne)&&e(g)&&(w.action==="heat_on"?_(g,{...e(g),heater_state:"on"},!0):w.action==="heat_off"?_(g,{...e(g),heater_state:"off"},!0):w.action==="cool_on"?_(g,{...e(g),cooler_state:"on"},!0):w.action==="cool_off"&&_(g,{...e(g),cooler_state:"off"},!0))}catch{}},f.onclose=()=>{f=null,A=setTimeout(B,3e3)},f.onerror=()=>{f?.close()}}function M(){A&&(clearTimeout(A),A=null),f?.close(),f=null}function y(c){return c==null?"--":$t(c)}function I(c){return c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function Q(c){if(!c)return"--";const x=new Date(c),w=(new Date().getTime()-x.getTime())/(1e3*60*60);if(w<1)return`${Math.round(w*60)}m`;if(w<24)return`${w.toFixed(1)}h`;const pe=w/24;return pe<7?`${pe.toFixed(1)}d`:`${Math.round(pe)}d`}Qt(()=>{be(),B()}),ma(()=>{M()});var $=nr();xa("g5au2j",c=>{ha(()=>{ba.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var te=G($),ce=s(a(te),2);{var Ee=c=>{var x=Rs();n(c,x)},je=c=>{var x=me(),W=G(x);{var w=ye=>{var Re=Cs(),Ce=s(a(Re),2),m=a(Ce,!0);t(Ce);var p=s(Ce,2);p.__click=be,t(Re),u(()=>d(m,e(ee))),n(ye,Re)},pe=ye=>{var Re=me(),Ce=G(Re);{var m=q=>{var X=Bs();n(q,X)},p=q=>{var X=me(),Te=G(X);{var Le=ue=>{Ma(ue,{get batch(){return e(r)},onSubmit:ie,onCancel:()=>_(oe,!1)})},Ye=ue=>{var Se=rr(),$e=G(Se),Ke=a($e),it=a(Ke),Je=a(it);t(it);var et=s(it,2),Ue=a(et),tt=a(Ue,!0);t(Ue);var _t=s(Ue,2);{var aa=b=>{var P=Ts(),se=a(P),_e=s(se);{var ve=fe=>{var Oe=Ms(),Ne=a(Oe);t(Oe),u(()=>d(Ne,`(${e(r).recipe.type??""})`)),n(fe,Oe)};o(_e,fe=>{e(r).recipe.type&&fe(ve)})}t(P),u(()=>{ft(P,"href",`/recipes/${e(r).recipe.id??""}`),d(se,`${e(r).recipe.name??""} `)}),n(b,P)};o(_t,b=>{e(r).recipe&&b(aa)})}var sa=s(_t,2);{var ra=b=>{var P=Ss(),se=a(P);t(P),u((_e,ve)=>d(se,`Started ${_e??""} ¬∑ ${ve??""} ago`),[()=>I(e(r).start_time),()=>Q(e(r).start_time)]),n(b,P)},la=b=>{var P=me(),se=G(P);{var _e=ve=>{var fe=Ds(),Oe=a(fe);t(fe),u(Ne=>d(Oe,`Brewed ${Ne??""}`),[()=>I(e(r).brew_date)]),n(ve,fe)};o(se,ve=>{e(r).brew_date&&ve(_e)},!0)}n(b,P)};o(sa,b=>{e(r).start_time?b(ra):b(la,!1)})}t(et),t(Ke);var Bt=s(Ke,2),Ft=a(Bt),Qe=a(Ft);Qe.__change=b=>Fe(b.currentTarget.value),Xt(Qe,21,()=>K,Zt,(b,P)=>{var se=Ps(),_e=a(se,!0);t(se);var ve={};u(()=>{d(_e,N[e(P)].label),ve!==(ve=e(P))&&(se.value=(se.__value=e(P))??"")}),n(b,se)}),t(Qe);var Mt;ja(Qe),t(Ft);var Tt=s(Ft,2);Tt.__click=()=>_(oe,!0);var na=s(Tt,2);na.__click=()=>_(U,!0),t(Bt),t($e);var St=s($e,2);{var ia=b=>{var P=Vs();let se;var _e=a(P),ve=a(_e);{var fe=k=>{var S=Os();qe(2),n(k,S)},Oe=k=>{var S=As();qe(2),n(k,S)};o(ve,k=>{e(H)?k(fe):k(Oe,!1)})}t(_e);var Ne=s(_e,2),vt=a(Ne),at=a(vt),gt=s(a(at),2),Ve=a(gt,!0);t(gt),t(at);var ae=s(at,4),Be=s(a(ae),2),ot=a(Be,!0);t(Be),t(ae),t(vt);var dt=s(vt,2);{var mt=k=>{var S=Es(),ge=a(S),we=a(ge);t(ge);var De=s(ge,2),re=a(De);t(De),t(S),u(ke=>{Ze(we,`width: ${e(he)??""}%`),d(re,`${ke??""}% to target`)},[()=>Math.round(e(he))]),n(k,S)};o(dt,k=>{e(he)!=null&&!e(H)&&k(mt)})}var He=s(dt,2),st=a(He);{var ht=k=>{var S=Gs();n(k,S)},bt=k=>{var S=me(),ge=G(S);{var we=re=>{var ke=Ls();n(re,ke)},De=re=>{var ke=me(),rt=G(ke);{var Xe=nt=>{var pt=Us();n(nt,pt)},lt=nt=>{var pt=Ns();n(nt,pt)};o(rt,nt=>{e(H)?nt(Xe):nt(lt,!1)},!0)}n(re,ke)};o(ge,re=>{!kt.config.ha_enabled||!kt.config.temp_control_enabled?re(we):re(De,!1)},!0)}n(k,S)};o(st,k=>{e(r).cooler_entity_id?k(bt,!1):k(ht)})}t(He),t(Ne),t(P),u((k,S)=>{se=Ae(P,1,"chilling-banner svelte-g5au2j",null,se,{ready:e(H)}),d(Ve,k),d(ot,S)},[()=>e(E)?.temp!=null?y(e(E).temp):"--",()=>e(r).temp_target!=null?y(e(r).temp_target):"--"]),n(b,P)};o(St,b=>{e(R)&&b(ia)})}var Dt=s(St,2),Rt=a(Dt),Pt=a(Rt);{let b=F(()=>e(E)?.sg??e(T)?.measured?.current_sg);Ja(Pt,{get batch(){return e(r)},get currentSg(){return e(b)},get progress(){return e(T)},get liveReading(){return e(E)}})}var va=s(Pt,2);{var oa=b=>{vs(b,{get recipe(){return e(r).recipe}})};o(va,b=>{e(r).recipe&&b(oa)})}t(Rt);var Ot=s(Rt,2),At=a(Ot);rs(At,{get batch(){return e(r)},get liveReading(){return e(E)},onEdit:()=>_(oe,!0)});var Et=s(At,2);{let b=F(()=>e(E)?.sg);Fs(Et,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(b)},get liveReading(){return e(E)}})}var Gt=s(Et,2);{var da=b=>{var P=er();let se;var _e=a(P);_e.__click=()=>_(Y,!e(Y));var ve=s(a(_e),2),fe=a(ve);{var Oe=ae=>{var Be=Hs();n(ae,Be)},Ne=ae=>{var Be=me(),ot=G(Be);{var dt=He=>{var st=Is();n(He,st)},mt=He=>{var st=me(),ht=G(st);{var bt=k=>{var S=Ws(),ge=a(S);t(S),u(we=>d(ge,`üéØ ${we??""}${e(v)??""}`),[()=>y(e(g).target_temp)]),n(k,S)};o(ht,k=>{e(Y)&&e(g)&&k(bt)},!0)}n(He,st)};o(ot,He=>{e(g)?.cooler_state==="on"?He(dt):He(mt,!1)},!0)}n(ae,Be)};o(fe,ae=>{e(g)?.heater_state==="on"?ae(Oe):ae(Ne,!1)})}var vt=s(fe,2);let at;t(ve),t(_e);var gt=s(_e,2);{var Ve=ae=>{var Be=$s(),ot=G(Be),dt=a(ot);{var mt=k=>{var S=Js(),ge=a(S);let we;var De=s(ge,2),re=s(a(De),2);let ke;var rt=a(re,!0);t(re);var Xe=s(re,2),lt=a(Xe,!0);t(Xe),t(De),t(S),u(()=>{we=Ae(ge,1,"device-icon-wrap svelte-g5au2j",null,we,{active:e(g)?.heater_state==="on"}),ke=Ae(re,1,"device-state svelte-g5au2j",null,ke,{on:e(g)?.heater_state==="on"}),d(rt,e(g)?.heater_state==="on"?"ON":"OFF"),d(lt,e(r).heater_entity_id)}),n(k,S)};o(dt,k=>{e(r).heater_entity_id&&k(mt)})}var He=s(dt,2);{var st=k=>{var S=Ys(),ge=a(S);let we;var De=s(ge,2),re=s(a(De),2);let ke;var rt=a(re,!0);t(re);var Xe=s(re,2),lt=a(Xe,!0);t(Xe),t(De),t(S),u(()=>{we=Ae(ge,1,"device-icon-wrap svelte-g5au2j",null,we,{active:e(g)?.cooler_state==="on"}),ke=Ae(re,1,"device-state svelte-g5au2j",null,ke,{on:e(g)?.cooler_state==="on"}),d(rt,e(g)?.cooler_state==="on"?"ON":"OFF"),d(lt,e(r).cooler_entity_id)}),n(k,S)};o(He,k=>{e(r).cooler_entity_id&&k(st)})}t(ot);var ht=s(ot,2);{var bt=k=>{var S=Zs(),ge=G(S),we=a(ge),De=s(a(we),2),re=a(De);t(De),t(we);var ke=s(we,2),rt=s(a(ke),2),Xe=a(rt);t(rt),t(ke),t(ge);var lt=s(ge,2);{var nt=Pe=>{var Ie=Ks(),We=s(a(Ie),2),ct=a(We);t(We);var Ht=s(We,2);Ht.__click=()=>de(),t(Ie),u(fa=>{d(ct,`Override active: ${fa??""}`),Ht.disabled=e(C)},[()=>e(g).override_state?.toUpperCase()]),n(Pe,Ie)};o(lt,Pe=>{e(g).override_active&&Pe(nt)})}var pt=s(lt,2),Lt=s(a(pt),2),Ut=a(Lt);{var ga=Pe=>{var Ie=Qs(),We=G(Ie);We.__click=()=>Z("heater","on");var ct=s(We,2);ct.__click=()=>Z("heater","off"),u(()=>{We.disabled=e(C),ct.disabled=e(C)}),n(Pe,Ie)};o(Ut,Pe=>{e(r).heater_entity_id&&Pe(ga)})}var Nt=s(Ut,2);{var pa=Pe=>{var Ie=Xs(),We=G(Ie);We.__click=()=>Z("cooler","on");var ct=s(We,2);ct.__click=()=>Z("cooler","off"),u(()=>{We.disabled=e(C),ct.disabled=e(C)}),n(Pe,Ie)};o(Nt,Pe=>{e(r).cooler_entity_id&&Pe(pa)})}var Vt=s(Nt,2);Vt.__click=()=>de(),t(Lt),t(pt),u((Pe,Ie)=>{d(re,`${Pe??""}${e(v)??""}`),d(Xe,`¬±${Ie??""}${e(v)??""}`),Vt.disabled=e(C)},[()=>y(e(g).target_temp),()=>e(g).hysteresis?.toFixed(1)||"--"]),n(k,S)};o(ht,k=>{e(g)&&k(bt)})}n(ae,Be)};o(gt,ae=>{e(Y)||ae(Ve)})}t(P),u(()=>{se=Ae(P,1,"info-card temp-control-card svelte-g5au2j",null,se,{"heater-on":e(g)?.heater_state==="on","cooler-on":e(g)?.cooler_state==="on",collapsed:e(Y)}),at=Ae(vt,0,"chevron svelte-g5au2j",null,at,{rotated:!e(Y)})}),n(b,P)},ca=b=>{var P=me(),se=G(P);{var _e=ve=>{var fe=sr(),Oe=s(a(fe),2),Ne=a(Oe);{var vt=Ve=>{var ae=tr(),Be=a(ae);t(ae),u(()=>d(Be,`Heater: ${e(r).heater_entity_id??""}`)),n(Ve,ae)};o(Ne,Ve=>{e(r).heater_entity_id&&Ve(vt)})}var at=s(Ne,2);{var gt=Ve=>{var ae=ar(),Be=a(ae);t(ae),u(()=>d(Be,`Cooler: ${e(r).cooler_entity_id??""}`)),n(Ve,ae)};o(at,Ve=>{e(r).cooler_entity_id&&Ve(gt)})}qe(2),t(Oe),t(fe),n(ve,fe)};o(se,ve=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&ve(_e)},!0)}n(b,P)};o(Gt,b=>{e(j)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?b(da):b(ca,!1)})}var ua=s(Gt,2);{var _a=b=>{ds(b,{get notes(){return e(r).notes}})};o(ua,b=>{e(r).notes&&b(_a)})}t(Ot),t(Dt),u(()=>{d(Je,`#${(e(r).batch_number||"?")??""}`),d(tt,e(r).name||e(r).recipe?.name||"Unnamed Batch"),Qe.disabled=e(z),Ze(Qe,`color: ${e(h).color??""}; background: ${e(h).bg??""};`),Mt!==(Mt=e(r).status)&&(Qe.value=(Qe.__value=e(r).status)??"",ya(Qe,e(r).status))}),n(ue,Se)};o(Te,ue=>{e(oe)?ue(Le):ue(Ye,!1)},!0)}n(q,X)};o(Ce,q=>{e(r)?q(p,!1):q(m)},!0)}n(ye,Re)};o(W,ye=>{e(ee)?ye(w):ye(pe,!1)},!0)}n(c,x)};o(ce,c=>{e(L)?c(Ee):c(je,!1)})}t(te);var Ge=s(te,2);{var Me=c=>{var x=lr();x.__click=()=>_(U,!1);var W=a(x);W.__click=p=>p.stopPropagation();var w=s(a(W),2),pe=a(w);t(w);var ye=s(w,2),Re=a(ye);Re.__click=()=>_(U,!1);var Ce=s(Re,2);Ce.__click=xe;var m=a(Ce,!0);t(Ce),t(ye),t(W),t(x),u(()=>{d(pe,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),Re.disabled=e(J),Ce.disabled=e(J),d(m,e(J)?"Deleting...":"Delete Batch")}),n(c,x)};o(Ge,c=>{e(U)&&c(Me)})}n(le,$),yt(),O()}zt(["click","change"]);export{qr as component,zr as universal};
