import{d as zt,f as i,s as d,a as n,c as me,t as It}from"../chunks/CsQfwH0S.js";import{al as a,ak as s,an as t,ar as u,ah as jt,at as L,c as e,ai as F,as as qe,aj as yt,aq as ze,p as Kt,ao as Qt,s as _,aL as ma,ay as ha,am as ba}from"../chunks/fKkNMI8q.js";import{e as Xt,i as Zt}from"../chunks/COk1ZY4R.js";import{i as o}from"../chunks/BvBRaQNg.js";import{h as xa}from"../chunks/DLseniaC.js";import{s as ft}from"../chunks/DbN3nGCc.js";import{s as Ae}from"../chunks/BDI2zAFW.js";import{s as Ze}from"../chunks/CcRNvR1k.js";import{i as ja,s as ya}from"../chunks/C8srtpii.js";import{s as wa,a as ka}from"../chunks/C51ud8ec.js";import{p as za}from"../chunks/B12ZhJ1s.js";import{g as qa}from"../chunks/VmpfXBO3.js";import{z as Fa,A as Ra,q as Ca,j as Wt,B as wt,k as Ba,x as Jt,C as Ct}from"../chunks/i8VL_lOf.js";import{d as xt,e as $t,g as ea,c as kt}from"../chunks/CPwbAm-l.js";import{t as Yt}from"../chunks/C8NDSE1R.js";import{B as Ma}from"../chunks/DTfC6M4H.js";import{s as Ta}from"../chunks/Bdaed-dN.js";import{p as ut}from"../chunks/CllCHKBI.js";const Sa=!1,zr=Object.freeze(Object.defineProperty({__proto__:null,prerender:Sa},Symbol.toStringTag,{value:"Module"}));function Da(ne){return ne>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:ne>=-60?{bars:3,color:"var(--positive)",label:"Good"}:ne>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function ta(ne){const l=Math.floor((Date.now()-new Date(ne).getTime())/1e3);if(l<10)return"just now";if(l<60)return`${l}s ago`;const S=Math.floor(l/60);if(S<60)return`${S}m ago`;const N=Math.floor(S/60);return N<24?`${N}h ago`:`${Math.floor(N/24)}d ago`}var Pa=i('<div class="accent-bar svelte-1oyrwd9"></div>'),Oa=i('<span class="card-icon svelte-1oyrwd9"> </span>'),Aa=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),Ea=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function qt(ne,l){let S=ut(l,"highlight",3,!1),N=ut(l,"compact",3,!1),E=ut(l,"collapsible",3,!1),f=ut(l,"expanded",3,!1);var D=Ea();let r;var P=a(D);{var g=z=>{var v=Pa();n(z,v)};o(P,z=>{S()&&z(g)})}var O=s(P,2),se=a(O),_e=a(se);{var b=z=>{var v=Oa(),j=a(v,!0);t(v),u(()=>d(j,l.icon)),n(z,v)};o(_e,z=>{l.icon&&z(b)})}var C=s(_e,2),V=a(C,!0);t(C),t(se);var J=s(se,2);{var Y=z=>{var v=Aa();v.__click=function(...H){l.onToggle?.apply(this,H)};var j=a(v);let R;t(v),u(()=>{ft(v,"aria-label",f()?"Collapse":"Expand"),R=Ae(j,0,"expand-icon svelte-1oyrwd9",null,R,{"rotate-180":f()})}),n(z,v)};o(J,z=>{E()&&l.onToggle&&z(Y)})}t(O);var K=s(O,2);let U;var Z=a(K);Ta(Z,()=>l.children),t(K),t(D),u(()=>{r=Ae(D,1,"batch-card svelte-1oyrwd9",null,r,{highlight:S(),compact:N()}),d(V,l.title),U=Ae(K,1,"card-content svelte-1oyrwd9",null,U,{collapsed:E()&&!f()})}),n(ne,D)}zt(["click"]);var Ga=i('<span class="updated-text svelte-t80j9z"> </span>'),La=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),Ua=i('<div class="remaining-text svelte-t80j9z"> </div>'),Na=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),Va=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),Ha=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),Ia=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),Wa=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function Ja(ne,l){jt(l,!0);let S=F(()=>l.currentSg??l.progress?.measured?.current_sg),N=F(()=>l.liveReading?.temp??l.progress?.temperature?.current),E=F(()=>l.liveReading?.last_seen),f=F(()=>e(E)?ta(e(E)):null),D=F(ea),r=F(()=>{if(!l.batch.measured_og||!e(S))return null;const b=Math.max(0,(l.batch.measured_og-e(S))*131.25),C=l.batch.measured_og-1,V=C!==0?Math.max(0,Math.min(100,(l.batch.measured_og-e(S))/C*100)):0;return{abv:b,attenuation:V}}),P=F(()=>{const b=l.batch.measured_og,C=l.batch.recipe?.fg;if(!b||!C||!e(S))return null;const V=b-C,J=b-e(S);return V<=0?null:Math.max(0,Math.min(100,J/V*100))}),g=F(()=>l.batch.status==="fermenting"||l.batch.status==="conditioning");function O(b){return b==null?"--":xt(b)}function se(b){return b==null?"--":`${b.toFixed(1)}%`}function _e(b){return b==null?"--":$t(b)}qt(ne,{title:"Fermentation",children:(b,C)=>{var V=me(),J=L(V);{var Y=U=>{var Z=Ha(),z=L(Z),v=s(a(z),2);{var j=B=>{var M=Ga(),y=a(M);t(M),u(()=>d(y,`Updated ${e(f)??""}`)),n(B,M)};o(v,B=>{e(f)&&B(j)})}t(z);var R=s(z,2),H=a(R),he=a(H),G=a(he,!0);t(he),qe(2),t(H);var be=s(H,2);{var Fe=B=>{var M=La(),y=s(L(M),2),I=a(y),Q=a(I,!0),ee=s(Q),te=a(ee,!0);t(ee),t(I),qe(2),t(y),u(de=>{d(Q,de),d(te,e(D))},[()=>_e(e(N))]),n(B,M)};o(be,B=>{e(N)!=null&&B(Fe)})}t(R);var ie=s(R,2);{var xe=B=>{var M=Na(),y=a(M),I=a(y),Q=a(I),ee=a(Q,!0);t(Q),qe(2),t(I);var te=s(I,2),de=a(te),Ee=a(de);t(de),t(te);var je=s(te,2),Ge=a(je),Me=a(Ge,!0);t(Ge),qe(2),t(je),t(y);var c=s(y,2),x=a(c),W=s(x,2);let w;var pe=s(a(W),2),ye=a(pe,!0);t(pe),t(W),t(c);var Re=s(c,2);{var Ce=m=>{var p=Ua(),q=a(p);t(p),u(X=>d(q,`${X??""} points to go`),[()=>l.progress.progress.sg_remaining.toFixed(3)]),n(m,p)};o(Re,m=>{l.progress?.progress?.sg_remaining!=null&&l.progress.progress.sg_remaining>0&&m(Ce)})}t(M),u((m,p,q,X)=>{d(ee,m),d(Ee,`${p??""}%`),d(Me,q),Ze(x,`width: ${e(P)??""}%`),w=Ae(W,1,"progress-marker svelte-t80j9z",null,w,{"at-start":e(P)<3}),Ze(W,`left: ${e(P)??""}%`),d(ye,X)},[()=>O(l.batch.measured_og),()=>e(P).toFixed(0),()=>O(l.batch.recipe.fg),()=>O(e(S))]),n(B,M)};o(ie,B=>{e(P)!==null&&l.batch.measured_og&&l.batch.recipe?.fg&&B(xe)})}var $=s(ie,2);{var oe=B=>{var M=Va(),y=a(M),I=a(y),Q=a(I,!0);t(I),qe(2),t(y);var ee=s(y,2),te=a(ee),de=a(te,!0);t(te),qe(2),t(ee),t(M),u((Ee,je)=>{d(Q,Ee),d(de,je)},[()=>se(e(r).abv),()=>se(e(r).attenuation)]),n(B,M)};o($,B=>{e(r)&&B(oe)})}u(B=>d(G,B),[()=>O(e(S))]),n(U,Z)},K=U=>{var Z=me(),z=L(Z);{var v=R=>{var H=Ia(),he=a(H),G=a(he),be=a(G,!0);t(G),qe(2),t(he);var Fe=s(he,2),ie=a(Fe),xe=a(ie,!0);t(ie),qe(2),t(Fe);var $=s(Fe,2),oe=a($),B=a(oe,!0);t(oe),qe(2),t($);var M=s($,2),y=a(M),I=a(y,!0);t(y),qe(2),t(M),t(H),u((Q,ee,te,de)=>{d(be,Q),d(xe,ee),d(B,te),d(I,de)},[()=>O(l.batch.measured_og),()=>O(l.batch.measured_fg),()=>l.batch.measured_abv!=null?se(l.batch.measured_abv):"--",()=>l.batch.measured_attenuation!=null?se(l.batch.measured_attenuation):"--"]),n(R,H)},j=R=>{var H=Wa();n(R,H)};o(z,R=>{l.batch.measured_og?R(v):R(j,!1)},!0)}n(U,Z)};o(J,U=>{e(S)&&e(g)?U(Y):U(K,!1)})}n(b,V)},$$slots:{default:!0}}),yt()}var Ya=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),Ka=i('<div class="signal-bar svelte-1kdxwtz"></div>'),Qa=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),Xa=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),Za=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),$a=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),es=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),ts=i('<div class="device-info svelte-1kdxwtz"><!></div>'),as=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),ss=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function rs(ne,l){jt(l,!0);let S=F(()=>l.liveReading?.device_type==="tilt"),N=F(()=>e(S)&&l.liveReading?.rssi?Da(l.liveReading.rssi):null),E=F(()=>l.liveReading?.last_seen?ta(l.liveReading.last_seen):null),f=F(()=>l.liveReading?.battery_percent!=null||l.liveReading?.battery_voltage!=null),D=F(()=>l.liveReading?.battery_percent),r=F(()=>l.liveReading?.battery_voltage),P=F(()=>e(D)?e(D)>50?"var(--positive)":e(D)>20?"#f59e0b":"var(--negative)":"var(--text-muted)"),g=F(()=>{if(!l.liveReading)return l.batch.device_id||"Unknown";const O=l.liveReading.device_type;return O==="tilt"?`${l.liveReading.color} Tilt`:O==="gravitymon"?`GravityMon (${l.liveReading.id})`:O==="ispindel"?`iSpindel (${l.liveReading.id})`:O==="floaty"?`Floaty (${l.liveReading.id})`:l.liveReading.color||l.liveReading.id});qt(ne,{title:"Tracking Device",compact:!0,children:(O,se)=>{var _e=me(),b=L(_e);{var C=J=>{var Y=ts(),K=a(Y);{var U=z=>{var v=$a(),j=L(v),R=a(j),H=s(a(R));t(R);var he=s(R,2);{var G=ie=>{var xe=Ya(),$=a(xe,!0);t(xe),u(()=>d($,e(E))),n(ie,xe)};o(he,ie=>{e(E)&&ie(G)})}t(j);var be=s(j,2);{var Fe=ie=>{var xe=Za(),$=a(xe);{var oe=y=>{var I=Qa(),Q=a(I);Xt(Q,20,()=>Array(4),Zt,(de,Ee,je)=>{var Ge=Ka();u(()=>Ze(Ge,`height: ${4+je*2}px; background: ${(je<e(N).bars?e(N).color:"var(--bg-hover)")??""}; opacity: ${je<e(N).bars?1:.4};`)),n(de,Ge)}),t(Q);var ee=s(Q,2),te=a(ee);t(ee),t(I),u(()=>{Ze(ee,`color: ${e(N).color??""}`),d(te,`${l.liveReading.rssi??""}dBm`)}),n(y,I)};o($,y=>{e(N)&&y(oe)})}var B=s($,2);{var M=y=>{var I=Xa(),Q=a(I),ee=s(a(Q)),te=s(ee);t(Q);var de=s(Q,2),Ee=a(de);{var je=Me=>{var c=It();u(x=>d(c,`${x??""}%`),[()=>e(D).toFixed(0)]),n(Me,c)},Ge=Me=>{var c=me(),x=L(c);{var W=w=>{var pe=It();u(ye=>d(pe,`${ye??""}V`),[()=>e(r).toFixed(2)]),n(w,pe)};o(x,w=>{e(r)!=null&&w(W)},!0)}n(Me,c)};o(Ee,Me=>{e(D)!=null?Me(je):Me(Ge,!1)})}t(de),t(I),u(()=>{ft(Q,"stroke",e(P)),ft(ee,"width",(e(D)??50)*.14),ft(ee,"fill",e(P)),ft(te,"fill",e(P)),Ze(de,`color: ${e(P)??""}`)}),n(y,I)};o(B,y=>{e(f)&&y(M)})}t(xe),n(ie,xe)};o(be,ie=>{(e(N)||e(f))&&ie(Fe)})}u(()=>d(H,` ${e(g)??""}`)),n(z,v)},Z=z=>{var v=es(),j=a(v),R=s(a(j));t(j),qe(2),t(v),u(()=>d(R,` ${l.batch.device_id??""}`)),n(z,v)};o(K,z=>{l.liveReading?z(U):z(Z,!1)})}t(Y),n(J,Y)},V=J=>{var Y=ss(),K=s(a(Y),2);{var U=Z=>{var z=as();z.__click=function(...v){l.onEdit?.apply(this,v)},n(Z,z)};o(K,Z=>{l.onEdit&&Z(U)})}t(Y),n(J,Y)};o(b,J=>{l.batch.device_id?J(C):J(V,!1)})}n(O,_e)},$$slots:{default:!0}}),yt()}zt(["click"]);const ls=131.25;var ns=i('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),is=i('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function vs(ne,l){jt(l,!0);function S(E){return E==null?"--":xt(E)}let N=F(()=>l.recipe.abv!=null?l.recipe.abv:l.recipe.og&&l.recipe.fg?(l.recipe.og-l.recipe.fg)*ls:null);qt(ne,{title:"Recipe Targets",children:(E,f)=>{var D=is(),r=a(D),P=s(a(r),2),g=a(P,!0);t(P),t(r);var O=s(r,2),se=s(a(O),2),_e=a(se,!0);t(se),t(O);var b=s(O,2),C=s(a(b),2),V=a(C,!0);t(C),t(b);var J=s(b,2);{var Y=K=>{var U=ns(),Z=s(a(U),2),z=a(Z,!0);t(Z),t(U),u(()=>d(z,l.recipe.yeast_name)),n(K,U)};o(J,K=>{l.recipe.yeast_name&&K(Y)})}t(D),u((K,U,Z)=>{d(g,K),d(_e,U),d(V,Z)},[()=>S(l.recipe.og),()=>S(l.recipe.fg),()=>e(N)!=null?`${e(N).toFixed(1)}%`:"--"]),n(E,D)},$$slots:{default:!0}}),yt()}var os=i('<p class="notes-content svelte-hkv31i"> </p>');function ds(ne,l){qt(ne,{title:"Notes",children:(S,N)=>{var E=os(),f=a(E,!0);t(E),u(()=>d(f,l.notes)),n(S,E)},$$slots:{default:!0}})}var cs=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),us=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),_s=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),gs=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),ps=i('<span class="activity-badge svelte-1xs394q"> </span>'),fs=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),ms=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),hs=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),bs=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),xs=i('<span class="days svelte-1xs394q"> </span>'),js=i(" <!>",1),ys=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),ws=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),ks=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Data points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),zs=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!></div></div></div>'),qs=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q">Predictions require at least 10 readings over 2+ hours</p></div>');function Fs(ne,l){jt(l,!0);let S=ut(l,"measuredOg",3,null),N=ut(l,"currentSg",3,null),E=ut(l,"liveReading",3,null),f=ze(Kt({available:!1})),D=ze(!0),r=ze(!1),P=ze(null);async function g(){_(D,!0),_(P,null);try{_(f,await Fa(l.batchId),!0)}catch(v){_(P,v instanceof Error?v.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",v)}finally{_(D,!1)}}async function O(){_(r,!0),_(P,null);try{const v=await Ra(l.batchId);console.log("Reloaded predictions:",v.message),await g()}catch(v){_(P,v instanceof Error?v.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",v)}finally{_(r,!1)}}Qt(g);function se(v){return v?new Date(v).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function _e(v){if(!v)return null;const j=new Date(v),R=new Date,H=j.getTime()-R.getTime();return Math.ceil(H/(1e3*60*60*24))}let b=F(()=>{const v=S()??e(f).predicted_og,j=e(f).predicted_fg,R=N()??E()?.sg;if(!v||!j||!R||v<=j)return null;const H=v-j,G=(v-R)/H*100;return Math.min(100,Math.max(0,G))}),C=F(()=>{const v=S()??e(f).predicted_og,j=N()??E()?.sg;if(!v||!j||v<=1)return null;const R=(v-j)/(v-1)*100;return Math.min(100,Math.max(0,R))}),V=F(()=>{const v=E()?.sg_rate;if(v==null)return null;const j=Math.abs(v);return j>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:j>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:j>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),J=F(()=>E()?.is_anomaly??!1),Y=F(()=>E()?.anomaly_reasons??[]);var K=me(),U=L(K);{var Z=v=>{var j=cs();n(v,j)},z=v=>{var j=me(),R=L(j);{var H=G=>{var be=us(),Fe=a(be),ie=a(Fe);t(Fe),t(be),u(()=>d(ie,`‚ö†Ô∏è ${e(P)??""}`)),n(G,be)},he=G=>{var be=me(),Fe=L(be);{var ie=$=>{var oe=zs();let B;var M=a(oe),y=s(a(M),2);y.__click=O;var I=a(y,!0);t(y),t(M);var Q=s(M,2);{var ee=m=>{var p=gs(),q=s(a(p),2),X=s(a(q),2);{var Te=Le=>{var Ye=_s(),ce=a(Ye,!0);t(Ye),u(Se=>d(ce,Se),[()=>e(Y).join(", ")]),n(Le,Ye)};o(X,Le=>{e(Y).length>0&&Le(Te)})}t(q),t(p),n(m,p)};o(Q,m=>{e(J)&&m(ee)})}var te=s(Q,2);{var de=m=>{var p=fs(),q=a(p),X=s(a(q),2);{var Te=Ue=>{var tt=ps(),_t=a(tt);t(tt),u(()=>{Ze(tt,`color: ${e(V).color??""}`),d(_t,`${e(V).emoji??""} ${e(V).label??""}`)}),n(Ue,tt)};o(X,Ue=>{e(V)&&Ue(Te)})}t(q);var Le=s(q,2),Ye=a(Le);t(Le);var ce=s(Le,2),Se=a(ce),$e=a(Se);t(Se);var Ke=s(Se,2),it=a(Ke);t(Ke);var Je=s(Ke,2),et=a(Je);t(Je),t(ce),t(p),u((Ue,tt,_t)=>{Ze(Ye,`width: ${e(b)??""}%`),d($e,`OG: ${Ue??""}`),d(it,`${tt??""}%`),d(et,`FG: ${_t??""}`)},[()=>xt(S()??e(f).predicted_og??0),()=>e(b).toFixed(0),()=>xt(e(f).predicted_fg??0)]),n(m,p)};o(te,m=>{e(b)!==null&&m(de)})}var Ee=s(te,2),je=a(Ee);{var Ge=m=>{var p=ms(),q=s(a(p),2),X=a(q,!0);t(q),t(p),u(Te=>d(X,Te),[()=>xt(e(f).predicted_fg)]),n(m,p)};o(je,m=>{e(f).predicted_fg&&m(Ge)})}var Me=s(je,2);{var c=m=>{var p=hs(),q=s(a(p),2),X=a(q);t(q),t(p),u(Te=>d(X,`${Te??""}%`),[()=>e(C).toFixed(1)]),n(m,p)};o(Me,m=>{e(C)!==null&&m(c)})}var x=s(Me,2);{var W=m=>{const p=F(()=>_e(e(f).estimated_completion));var q=ys(),X=s(a(q),2),Te=a(X);{var Le=ce=>{var Se=bs();n(ce,Se)},Ye=ce=>{var Se=js(),$e=L(Se),Ke=s($e);{var it=Je=>{var et=xs(),Ue=a(et);t(et),u(()=>d(Ue,`(${e(p)??""} ${e(p)===1?"day":"days"})`)),n(Je,et)};o(Ke,Je=>{e(p)!==null&&Je(it)})}u(Je=>d($e,`${Je??""} `),[()=>se(e(f).estimated_completion)]),n(ce,Se)};o(Te,ce=>{e(p)!==null&&e(p)<=0?ce(Le):ce(Ye,!1)})}t(X),t(q),n(m,q)};o(x,m=>{e(f).estimated_completion&&m(W)})}var w=s(x,2),pe=a(w);{var ye=m=>{var p=ws(),q=s(a(p),2),X=a(q);t(q),t(p),u(Te=>d(X,`${Te??""}%`),[()=>(e(f).r_squared*100).toFixed(0)]),n(m,p)};o(pe,m=>{e(f).r_squared!==void 0&&m(ye)})}var Re=s(pe,2);{var Ce=m=>{var p=ks(),q=s(a(p),2),X=a(q,!0);t(q),t(p),u(()=>d(X,e(f).num_readings)),n(m,p)};o(Re,m=>{e(f).num_readings&&m(Ce)})}t(w),t(Ee),t(oe),u(()=>{B=Ae(oe,1,"ml-panel svelte-1xs394q",null,B,{"has-anomaly":e(J)}),y.disabled=e(r)||e(D),d(I,e(r)?"Reloading...":"‚Üª Reload")}),n($,oe)},xe=$=>{var oe=qs(),B=a(oe),M=s(a(B),2);M.__click=O;var y=a(M,!0);t(M),t(B),qe(2),t(oe),u(()=>{M.disabled=e(r)||e(D),d(y,e(r)?"Reloading...":"‚Üª Reload")}),n($,oe)};o(Fe,$=>{e(f).available?$(ie):$(xe,!1)},!0)}n(G,be)};o(R,G=>{e(P)?G(H):G(he,!1)},!0)}n(v,j)};o(U,v=>{e(D)?v(Z):v(z,!1)})}n(ne,K),yt()}zt(["click"]);var Rs=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Cs=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Bs=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),Ms=i('<span class="recipe-type svelte-g5au2j"> </span>'),Ts=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),Ss=i('<div class="batch-timing svelte-g5au2j"> </div>'),Ds=i('<div class="batch-timing svelte-g5au2j"> </div>'),Ps=i('<option class="svelte-g5au2j"> </option>'),Os=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),As=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),Es=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),Gs=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),Ls=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),Us=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),Ns=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),Vs=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),Hs=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),Is=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),Ws=i('<span class="status-badge idle svelte-g5au2j"> </span>'),Js=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ys=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ks=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Qs=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),Xs=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),Zs=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),$s=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),er=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),tr=i('<span class="svelte-g5au2j"> </span>'),ar=i('<span class="svelte-g5au2j"> </span>'),sr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),rr=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),lr=i('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),nr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function qr(ne,l){jt(l,!0);const S=()=>ka(za,"$page",N),[N,E]=wa();let f=null,D=null,r=ze(null),P=ze(null),g=ze(null);Kt([]);let O=ze(!0),se=ze(null),_e=ze(!1),b=ze(!1),C=ze(!1),V=ze(!1),J=ze(!1),Y=ze(!1),K=F(()=>parseInt(S().params.id??"0"));const U={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},Z=["planning","fermenting","conditioning","completed","archived"];let z=F(()=>e(r)?U[e(r).status]:U.planning),v=F(ea),j=F(()=>kt.config.ha_enabled&&kt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),R=F(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),H=F(()=>!e(R)||!e(G)?.temp||!e(r)?.temp_target?!1:e(G).temp<=e(r).temp_target),he=F(()=>{if(!e(R)||!e(G)?.temp||!e(r)?.temp_target)return null;const c=e(r).temp_target+30,x=e(G).temp,W=e(r).temp_target;if(x<=W)return 100;if(x>=c)return 0;const w=(c-x)/(c-W)*100;return Math.min(100,Math.max(0,w))}),G=F(()=>{if(!e(r)?.device_id)return null;const c=Yt.tilts.get(e(r).device_id);if(c)return c;const x=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!x?.[1])return null;const W=x[1].toUpperCase();for(const w of Yt.tilts.values())if(w.color&&w.color.toUpperCase()===W)return w;return null});async function be(){_(O,!0),_(se,null);try{if(_(r,await Ca(e(K)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{_(P,await Wt(e(K)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{_(g,await wt(e(K)),!0)}catch{}}catch(c){_(se,c instanceof Error?c.message:"Failed to load batch",!0)}finally{_(O,!1)}}async function Fe(c){if(!(!e(r)||e(b))&&!(c==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){_(b,!0);try{_(r,await Jt(e(r).id,{status:c}),!0),(c==="fermenting"||c==="conditioning")&&_(P,await Wt(e(r).id),!0)}catch(x){console.error("Failed to update status:",x)}finally{_(b,!1)}}}async function ie(c){if(e(r)&&(_(r,await Jt(e(r).id,c),!0),_(_e,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{_(g,await wt(e(r).id),!0)}catch{}}async function xe(){if(e(r)){_(J,!0);try{await Ba(e(r).id),qa("/batches")}catch(c){_(se,c instanceof Error?c.message:"Failed to delete batch",!0),_(J,!1),_(V,!1)}}}async function $(c,x){if(!(!e(r)||e(C))){_(C,!0);try{await Ct(e(r).id,x,60,c),_(g,await wt(e(r).id),!0)}catch(W){console.error("Failed to set override:",W)}finally{_(C,!1)}}}async function oe(){if(!(!e(r)||e(C))){_(C,!0);try{e(r).heater_entity_id&&await Ct(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Ct(e(r).id,null,60,"cooler"),_(g,await wt(e(r).id),!0)}catch(c){console.error("Failed to clear overrides:",c)}finally{_(C,!1)}}}function B(){if(f?.readyState===WebSocket.OPEN)return;const x=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;f=new WebSocket(x),f.onmessage=async W=>{try{const w=JSON.parse(W.data);w.type==="control_event"&&w.batch_id===e(K)&&e(g)&&(w.action==="heat_on"?_(g,{...e(g),heater_state:"on"},!0):w.action==="heat_off"?_(g,{...e(g),heater_state:"off"},!0):w.action==="cool_on"?_(g,{...e(g),cooler_state:"on"},!0):w.action==="cool_off"&&_(g,{...e(g),cooler_state:"off"},!0))}catch{}},f.onclose=()=>{f=null,D=setTimeout(B,3e3)},f.onerror=()=>{f?.close()}}function M(){D&&(clearTimeout(D),D=null),f?.close(),f=null}function y(c){return c==null?"--":$t(c)}function I(c){return c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function Q(c){if(!c)return"--";const x=new Date(c),w=(new Date().getTime()-x.getTime())/(1e3*60*60);if(w<1)return`${Math.round(w*60)}m`;if(w<24)return`${w.toFixed(1)}h`;const pe=w/24;return pe<7?`${pe.toFixed(1)}d`:`${Math.round(pe)}d`}Qt(()=>{be(),B()}),ma(()=>{M()});var ee=nr();xa("g5au2j",c=>{ha(()=>{ba.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var te=L(ee),de=s(a(te),2);{var Ee=c=>{var x=Rs();n(c,x)},je=c=>{var x=me(),W=L(x);{var w=ye=>{var Re=Cs(),Ce=s(a(Re),2),m=a(Ce,!0);t(Ce);var p=s(Ce,2);p.__click=be,t(Re),u(()=>d(m,e(se))),n(ye,Re)},pe=ye=>{var Re=me(),Ce=L(Re);{var m=q=>{var X=Bs();n(q,X)},p=q=>{var X=me(),Te=L(X);{var Le=ce=>{Ma(ce,{get batch(){return e(r)},onSubmit:ie,onCancel:()=>_(_e,!1)})},Ye=ce=>{var Se=rr(),$e=L(Se),Ke=a($e),it=a(Ke),Je=a(it);t(it);var et=s(it,2),Ue=a(et),tt=a(Ue,!0);t(Ue);var _t=s(Ue,2);{var aa=h=>{var A=Ts(),re=a(A),ue=s(re);{var ve=fe=>{var Oe=Ms(),Ne=a(Oe);t(Oe),u(()=>d(Ne,`(${e(r).recipe.type??""})`)),n(fe,Oe)};o(ue,fe=>{e(r).recipe.type&&fe(ve)})}t(A),u(()=>{ft(A,"href",`/recipes/${e(r).recipe.id??""}`),d(re,`${e(r).recipe.name??""} `)}),n(h,A)};o(_t,h=>{e(r).recipe&&h(aa)})}var sa=s(_t,2);{var ra=h=>{var A=Ss(),re=a(A);t(A),u((ue,ve)=>d(re,`Started ${ue??""} ¬∑ ${ve??""} ago`),[()=>I(e(r).start_time),()=>Q(e(r).start_time)]),n(h,A)},la=h=>{var A=me(),re=L(A);{var ue=ve=>{var fe=Ds(),Oe=a(fe);t(fe),u(Ne=>d(Oe,`Brewed ${Ne??""}`),[()=>I(e(r).brew_date)]),n(ve,fe)};o(re,ve=>{e(r).brew_date&&ve(ue)},!0)}n(h,A)};o(sa,h=>{e(r).start_time?h(ra):h(la,!1)})}t(et),t(Ke);var Bt=s(Ke,2),Ft=a(Bt),Qe=a(Ft);Qe.__change=h=>Fe(h.currentTarget.value),Xt(Qe,21,()=>Z,Zt,(h,A)=>{var re=Ps(),ue=a(re,!0);t(re);var ve={};u(()=>{d(ue,U[e(A)].label),ve!==(ve=e(A))&&(re.value=(re.__value=e(A))??"")}),n(h,re)}),t(Qe);var Mt;ja(Qe),t(Ft);var Tt=s(Ft,2);Tt.__click=()=>_(_e,!0);var na=s(Tt,2);na.__click=()=>_(V,!0),t(Bt),t($e);var St=s($e,2);{var ia=h=>{var A=Vs();let re;var ue=a(A),ve=a(ue);{var fe=k=>{var T=Os();qe(2),n(k,T)},Oe=k=>{var T=As();qe(2),n(k,T)};o(ve,k=>{e(H)?k(fe):k(Oe,!1)})}t(ue);var Ne=s(ue,2),vt=a(Ne),at=a(vt),gt=s(a(at),2),Ve=a(gt,!0);t(gt),t(at);var ae=s(at,4),Be=s(a(ae),2),ot=a(Be,!0);t(Be),t(ae),t(vt);var dt=s(vt,2);{var mt=k=>{var T=Es(),ge=a(T),we=a(ge);t(ge);var De=s(ge,2),le=a(De);t(De),t(T),u(ke=>{Ze(we,`width: ${e(he)??""}%`),d(le,`${ke??""}% to target`)},[()=>Math.round(e(he))]),n(k,T)};o(dt,k=>{e(he)!=null&&!e(H)&&k(mt)})}var He=s(dt,2),st=a(He);{var ht=k=>{var T=Gs();n(k,T)},bt=k=>{var T=me(),ge=L(T);{var we=le=>{var ke=Ls();n(le,ke)},De=le=>{var ke=me(),rt=L(ke);{var Xe=nt=>{var pt=Us();n(nt,pt)},lt=nt=>{var pt=Ns();n(nt,pt)};o(rt,nt=>{e(H)?nt(Xe):nt(lt,!1)},!0)}n(le,ke)};o(ge,le=>{!kt.config.ha_enabled||!kt.config.temp_control_enabled?le(we):le(De,!1)},!0)}n(k,T)};o(st,k=>{e(r).cooler_entity_id?k(bt,!1):k(ht)})}t(He),t(Ne),t(A),u((k,T)=>{re=Ae(A,1,"chilling-banner svelte-g5au2j",null,re,{ready:e(H)}),d(Ve,k),d(ot,T)},[()=>e(G)?.temp!=null?y(e(G).temp):"--",()=>e(r).temp_target!=null?y(e(r).temp_target):"--"]),n(h,A)};o(St,h=>{e(R)&&h(ia)})}var Dt=s(St,2),Rt=a(Dt),Pt=a(Rt);{let h=F(()=>e(G)?.sg??e(P)?.measured?.current_sg);Ja(Pt,{get batch(){return e(r)},get currentSg(){return e(h)},get progress(){return e(P)},get liveReading(){return e(G)}})}var va=s(Pt,2);{var oa=h=>{vs(h,{get recipe(){return e(r).recipe}})};o(va,h=>{e(r).recipe&&h(oa)})}t(Rt);var Ot=s(Rt,2),At=a(Ot);rs(At,{get batch(){return e(r)},get liveReading(){return e(G)},onEdit:()=>_(_e,!0)});var Et=s(At,2);{let h=F(()=>e(G)?.sg);Fs(Et,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(h)},get liveReading(){return e(G)}})}var Gt=s(Et,2);{var da=h=>{var A=er();let re;var ue=a(A);ue.__click=()=>_(Y,!e(Y));var ve=s(a(ue),2),fe=a(ve);{var Oe=ae=>{var Be=Hs();n(ae,Be)},Ne=ae=>{var Be=me(),ot=L(Be);{var dt=He=>{var st=Is();n(He,st)},mt=He=>{var st=me(),ht=L(st);{var bt=k=>{var T=Ws(),ge=a(T);t(T),u(we=>d(ge,`üéØ ${we??""}${e(v)??""}`),[()=>y(e(g).target_temp)]),n(k,T)};o(ht,k=>{e(Y)&&e(g)&&k(bt)},!0)}n(He,st)};o(ot,He=>{e(g)?.cooler_state==="on"?He(dt):He(mt,!1)},!0)}n(ae,Be)};o(fe,ae=>{e(g)?.heater_state==="on"?ae(Oe):ae(Ne,!1)})}var vt=s(fe,2);let at;t(ve),t(ue);var gt=s(ue,2);{var Ve=ae=>{var Be=$s(),ot=L(Be),dt=a(ot);{var mt=k=>{var T=Js(),ge=a(T);let we;var De=s(ge,2),le=s(a(De),2);let ke;var rt=a(le,!0);t(le);var Xe=s(le,2),lt=a(Xe,!0);t(Xe),t(De),t(T),u(()=>{we=Ae(ge,1,"device-icon-wrap svelte-g5au2j",null,we,{active:e(g)?.heater_state==="on"}),ke=Ae(le,1,"device-state svelte-g5au2j",null,ke,{on:e(g)?.heater_state==="on"}),d(rt,e(g)?.heater_state==="on"?"ON":"OFF"),d(lt,e(r).heater_entity_id)}),n(k,T)};o(dt,k=>{e(r).heater_entity_id&&k(mt)})}var He=s(dt,2);{var st=k=>{var T=Ys(),ge=a(T);let we;var De=s(ge,2),le=s(a(De),2);let ke;var rt=a(le,!0);t(le);var Xe=s(le,2),lt=a(Xe,!0);t(Xe),t(De),t(T),u(()=>{we=Ae(ge,1,"device-icon-wrap svelte-g5au2j",null,we,{active:e(g)?.cooler_state==="on"}),ke=Ae(le,1,"device-state svelte-g5au2j",null,ke,{on:e(g)?.cooler_state==="on"}),d(rt,e(g)?.cooler_state==="on"?"ON":"OFF"),d(lt,e(r).cooler_entity_id)}),n(k,T)};o(He,k=>{e(r).cooler_entity_id&&k(st)})}t(ot);var ht=s(ot,2);{var bt=k=>{var T=Zs(),ge=L(T),we=a(ge),De=s(a(we),2),le=a(De);t(De),t(we);var ke=s(we,2),rt=s(a(ke),2),Xe=a(rt);t(rt),t(ke),t(ge);var lt=s(ge,2);{var nt=Pe=>{var Ie=Ks(),We=s(a(Ie),2),ct=a(We);t(We);var Ht=s(We,2);Ht.__click=()=>oe(),t(Ie),u(fa=>{d(ct,`Override active: ${fa??""}`),Ht.disabled=e(C)},[()=>e(g).override_state?.toUpperCase()]),n(Pe,Ie)};o(lt,Pe=>{e(g).override_active&&Pe(nt)})}var pt=s(lt,2),Lt=s(a(pt),2),Ut=a(Lt);{var ga=Pe=>{var Ie=Qs(),We=L(Ie);We.__click=()=>$("heater","on");var ct=s(We,2);ct.__click=()=>$("heater","off"),u(()=>{We.disabled=e(C),ct.disabled=e(C)}),n(Pe,Ie)};o(Ut,Pe=>{e(r).heater_entity_id&&Pe(ga)})}var Nt=s(Ut,2);{var pa=Pe=>{var Ie=Xs(),We=L(Ie);We.__click=()=>$("cooler","on");var ct=s(We,2);ct.__click=()=>$("cooler","off"),u(()=>{We.disabled=e(C),ct.disabled=e(C)}),n(Pe,Ie)};o(Nt,Pe=>{e(r).cooler_entity_id&&Pe(pa)})}var Vt=s(Nt,2);Vt.__click=()=>oe(),t(Lt),t(pt),u((Pe,Ie)=>{d(le,`${Pe??""}${e(v)??""}`),d(Xe,`¬±${Ie??""}${e(v)??""}`),Vt.disabled=e(C)},[()=>y(e(g).target_temp),()=>e(g).hysteresis?.toFixed(1)||"--"]),n(k,T)};o(ht,k=>{e(g)&&k(bt)})}n(ae,Be)};o(gt,ae=>{e(Y)||ae(Ve)})}t(A),u(()=>{re=Ae(A,1,"info-card temp-control-card svelte-g5au2j",null,re,{"heater-on":e(g)?.heater_state==="on","cooler-on":e(g)?.cooler_state==="on",collapsed:e(Y)}),at=Ae(vt,0,"chevron svelte-g5au2j",null,at,{rotated:!e(Y)})}),n(h,A)},ca=h=>{var A=me(),re=L(A);{var ue=ve=>{var fe=sr(),Oe=s(a(fe),2),Ne=a(Oe);{var vt=Ve=>{var ae=tr(),Be=a(ae);t(ae),u(()=>d(Be,`Heater: ${e(r).heater_entity_id??""}`)),n(Ve,ae)};o(Ne,Ve=>{e(r).heater_entity_id&&Ve(vt)})}var at=s(Ne,2);{var gt=Ve=>{var ae=ar(),Be=a(ae);t(ae),u(()=>d(Be,`Cooler: ${e(r).cooler_entity_id??""}`)),n(Ve,ae)};o(at,Ve=>{e(r).cooler_entity_id&&Ve(gt)})}qe(2),t(Oe),t(fe),n(ve,fe)};o(re,ve=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&ve(ue)},!0)}n(h,A)};o(Gt,h=>{e(j)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?h(da):h(ca,!1)})}var ua=s(Gt,2);{var _a=h=>{ds(h,{get notes(){return e(r).notes}})};o(ua,h=>{e(r).notes&&h(_a)})}t(Ot),t(Dt),u(()=>{d(Je,`#${(e(r).batch_number||"?")??""}`),d(tt,e(r).name||e(r).recipe?.name||"Unnamed Batch"),Qe.disabled=e(b),Ze(Qe,`color: ${e(z).color??""}; background: ${e(z).bg??""};`),Mt!==(Mt=e(r).status)&&(Qe.value=(Qe.__value=e(r).status)??"",ya(Qe,e(r).status))}),n(ce,Se)};o(Te,ce=>{e(_e)?ce(Le):ce(Ye,!1)},!0)}n(q,X)};o(Ce,q=>{e(r)?q(p,!1):q(m)},!0)}n(ye,Re)};o(W,ye=>{e(se)?ye(w):ye(pe,!1)},!0)}n(c,x)};o(de,c=>{e(O)?c(Ee):c(je,!1)})}t(te);var Ge=s(te,2);{var Me=c=>{var x=lr();x.__click=()=>_(V,!1);var W=a(x);W.__click=p=>p.stopPropagation();var w=s(a(W),2),pe=a(w);t(w);var ye=s(w,2),Re=a(ye);Re.__click=()=>_(V,!1);var Ce=s(Re,2);Ce.__click=xe;var m=a(Ce,!0);t(Ce),t(ye),t(W),t(x),u(()=>{d(pe,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),Re.disabled=e(J),Ce.disabled=e(J),d(m,e(J)?"Deleting...":"Delete Batch")}),n(c,x)};o(Ge,c=>{e(V)&&c(Me)})}n(ne,ee),yt(),E()}zt(["click","change"]);export{qr as component,zr as universal};
