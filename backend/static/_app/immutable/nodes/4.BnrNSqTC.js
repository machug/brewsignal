import{d as Ie,f as d,s as n,a as l,c as me}from"../chunks/CsQfwH0S.js";import{al as a,ak as s,an as t,ar as f,ah as Me,at as K,c as e,ai as A,as as qe,aj as De,aq as ve,p as wt,ao as zt,s as g,aL as Xt,ay as Zt,am as $t}from"../chunks/fKkNMI8q.js";import{e as Ft,i as Rt}from"../chunks/COk1ZY4R.js";import{i as u}from"../chunks/BvBRaQNg.js";import{h as ea}from"../chunks/DLseniaC.js";import{s as Ct}from"../chunks/DbN3nGCc.js";import{s as Re}from"../chunks/BDI2zAFW.js";import{s as Ee}from"../chunks/CcRNvR1k.js";import{i as ta,s as aa}from"../chunks/C8srtpii.js";import{s as sa,a as ra}from"../chunks/C51ud8ec.js";import{p as ia}from"../chunks/U_qLtK4Q.js";import{g as la}from"../chunks/HEJTfQlf.js";import{z as va,A as na,q as oa,j as jt,B as Ne,k as da,x as yt,C as $e}from"../chunks/i8VL_lOf.js";import{b as ca,g as Bt,d as Ve,e as Tt,c as xt}from"../chunks/CPwbAm-l.js";import{t as kt}from"../chunks/CKZ2knDC.js";import{B as ua}from"../chunks/DTfC6M4H.js";import{s as _a}from"../chunks/Bdaed-dN.js";import{p as et}from"../chunks/CllCHKBI.js";const ga=!1,Ns=Object.freeze(Object.defineProperty({__proto__:null,prerender:ga},Symbol.toStringTag,{value:"Module"}));function fa(U){return U>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:U>=-60?{bars:3,color:"var(--positive)",label:"Good"}:U>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function St(U){const r=Math.floor((Date.now()-new Date(U).getTime())/1e3);if(r<10)return"just now";if(r<60)return`${r}s ago`;const _=Math.floor(r/60);if(_<60)return`${_}m ago`;const C=Math.floor(_/60);return C<24?`${C}h ago`:`${Math.floor(C/24)}d ago`}var ma=d('<div class="accent-bar svelte-1oyrwd9"></div>'),pa=d('<span class="card-icon svelte-1oyrwd9"> </span>'),ba=d('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ha=d('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function Ae(U,r){let _=et(r,"highlight",3,!1),C=et(r,"collapsible",3,!1),m=et(r,"expanded",3,!1);var b=ha();let y;var i=a(b);{var S=p=>{var R=ma();l(p,R)};u(i,p=>{_()&&p(S)})}var c=s(i,2),G=a(c),q=a(G);{var P=p=>{var R=pa(),V=a(R,!0);t(R),f(()=>n(V,r.icon)),l(p,R)};u(q,p=>{r.icon&&p(P)})}var h=s(q,2),o=a(h,!0);t(h),t(G);var z=s(G,2);{var k=p=>{var R=ba();R.__click=function(...M){r.onToggle?.apply(this,M)};var V=a(R);let J;t(R),f(()=>{Ct(R,"aria-label",m()?"Collapse":"Expand"),J=Re(V,0,"expand-icon svelte-1oyrwd9",null,J,{"rotate-180":m()})}),l(p,R)};u(z,p=>{C()&&r.onToggle&&p(k)})}t(c);var F=s(c,2);let j;var w=a(F);_a(w,()=>r.children),t(F),t(b),f(()=>{y=Re(b,1,"batch-card svelte-1oyrwd9",null,y,{highlight:_()}),n(o,r.title),j=Re(F,1,"card-content svelte-1oyrwd9",null,j,{collapsed:C()&&!m()})}),l(U,b)}Ie(["click"]);var ja=d('<span class="unit svelte-lzskfi"> </span>'),ya=d('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),xa=d('<div class="last-seen svelte-lzskfi"> </div>'),ka=d('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function wa(U,r){Me(r,!0);let _=A(()=>r.liveReading?.sg??r.currentSg),C=A(()=>r.liveReading?.temp??r.currentTemp),m=A(()=>r.liveReading?.sg_raw),b=A(()=>r.liveReading?.temp_raw),y=A(()=>r.liveReading?.last_seen),i=A(()=>r.liveReading&&(r.liveReading.sg!==r.liveReading.sg_raw||r.liveReading.temp!==r.liveReading.temp_raw)),S=A(ca),c=A(Bt);function G(h){return h==null?"--":Ve(h)}function q(h){return h==null?"--":Tt(h)}let P=A(()=>e(y)?St(e(y)):null);Ae(U,{title:"Live Readings",highlight:!0,children:(h,o)=>{var z=ka(),k=s(K(z),2),F=a(k),j=a(F),w=a(j),p=s(w);{var R=I=>{var O=ja(),se=a(O,!0);t(O),f(()=>n(se,e(S))),l(I,O)};u(p,I=>{e(S)!=="SG"&&I(R)})}t(j);var V=s(j,2),J=a(V,!0);t(V),t(F);var M=s(F,2),N=a(M),H=a(N),W=s(H),ee=a(W,!0);t(W),t(N),qe(2),t(M),t(k);var te=s(k,2);{var ie=I=>{var O=ya(),se=s(a(O),2),Ce=a(se,!0);t(se);var xe=s(se,4),B=a(xe);t(xe),t(O),f((T,v)=>{n(Ce,T),n(B,`${v??""}${e(c)??""}`)},[()=>G(e(m)),()=>q(e(b))]),l(I,O)};u(te,I=>{e(i)&&I(ie)})}var ne=s(te,2);{var le=I=>{var O=xa(),se=a(O);t(O),f(()=>n(se,`Updated ${e(P)??""}`)),l(I,O)};u(ne,I=>{e(P)&&I(le)})}f((I,O)=>{n(w,`${I??""} `),n(J,e(S)==="SG"?"Gravity":e(S)==="¬∞P"?"Plato":"Brix"),n(H,`${O??""} `),n(ee,e(c))},[()=>G(e(_)),()=>q(e(C))]),l(h,z)},$$slots:{default:!0}}),De()}var za=d('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),Fa=d('<div class="progress-remaining svelte-t80j9z"> </div>'),Ra=d('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),Ca=d('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),Ba=d('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),Ta=d('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Sa(U,r){Me(r,!0);let _=A(()=>{if(!r.batch.measured_og)return null;const y=r.currentSg??r.progress?.measured?.current_sg;if(!y)return null;const i=(r.batch.measured_og-y)*131.25,S=r.batch.measured_og-1,c=S!==0?(r.batch.measured_og-y)/S*100:0;return{currentSg:y,abv:Math.max(0,i),attenuation:Math.max(0,Math.min(100,c)),isFermenting:r.batch.status==="fermenting"||r.batch.status==="conditioning"}}),C=A(()=>e(_)?.isFermenting??!1);function m(y){return y==null?"--":Ve(y)}function b(y){return y==null?"--":`${y.toFixed(1)}%`}{let y=A(()=>e(C)?"Fermentation Progress":"Fermentation Measurements");Ae(U,{get title(){return e(y)},children:(i,S)=>{var c=me(),G=K(c);{var q=h=>{var o=Ca(),z=K(o),k=s(a(z),2),F=a(k);qe(),t(k),t(z);var j=s(z,2),w=s(a(j),2),p=s(a(w),4),R=a(p,!0);t(p),t(w);var V=s(w,2);{var J=B=>{var T=za(),v=s(a(T),4),x=a(v,!0);t(v),t(T),f(E=>n(x,E),[()=>m(r.batch.recipe.fg)]),l(B,T)};u(V,B=>{r.batch.recipe?.fg&&B(J)})}var M=s(V,2),N=s(a(M),4),H=a(N,!0);t(N),t(M),t(j);var W=s(j,2),ee=a(W),te=s(a(ee),2),ie=s(a(te),2),ne=a(ie);qe(),t(ie),t(te),t(ee);var le=s(ee,2),I=s(a(le),2),O=s(a(I),2),se=a(O);qe(),t(O),t(I),t(le),t(W);var Ce=s(W,2);{var xe=B=>{var T=Ra(),v=a(T),x=s(a(v),2),E=a(x);t(x),t(v);var L=s(v,2),pe=s(a(L),2);qe(2),t(L);var Y=s(L,2);{var ae=Q=>{var be=Fa(),Be=a(be);t(be),f(ke=>n(Be,`${ke??""} gravity points remaining`),[()=>r.progress.progress.sg_remaining.toFixed(3)]),l(Q,be)};u(Y,Q=>{r.progress.progress.sg_remaining!=null&&Q(ae)})}t(T),f(Q=>{n(E,`${Q??""}%`),Ee(pe,`width: ${r.progress.progress.percent_complete??""}%`)},[()=>r.progress.progress.percent_complete.toFixed(0)]),l(B,T)};u(Ce,B=>{r.progress?.progress?.percent_complete!=null&&B(xe)})}f((B,T,v,x,E)=>{n(F,`${B??""} `),n(R,T),n(H,v),n(ne,`${x??""} `),n(se,`${E??""} `)},[()=>m(e(_).currentSg),()=>m(r.batch.measured_og),()=>m(e(_).currentSg),()=>b(e(_).abv),()=>b(e(_).attenuation)]),l(h,o)},P=h=>{var o=me(),z=K(o);{var k=j=>{var w=Ba(),p=a(w),R=s(a(p),2),V=a(R,!0);t(R),t(p);var J=s(p,2),M=s(a(J),2),N=a(M,!0);t(M),t(J);var H=s(J,2),W=s(a(H),2),ee=a(W,!0);t(W),t(H);var te=s(H,2),ie=s(a(te),2),ne=a(ie,!0);t(ie),t(te),t(w),f((le,I,O,se)=>{n(V,le),n(N,I),n(ee,O),n(ne,se)},[()=>m(r.batch.measured_og),()=>m(r.batch.measured_fg),()=>r.batch.measured_abv!=null?b(r.batch.measured_abv):"--",()=>r.batch.measured_attenuation!=null?b(r.batch.measured_attenuation):"--"]),l(j,w)},F=j=>{var w=Ta();l(j,w)};u(z,j=>{r.batch.measured_og?j(k):j(F,!1)},!0)}l(h,o)};u(G,h=>{e(_)&&e(C)?h(q):h(P,!1)})}l(i,c)},$$slots:{default:!0}})}De()}var qa=d('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Ma(U,r){Me(r,!0);function _(m){return m?new Date(m).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function C(m){return m?new Date(m).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}Ae(U,{title:"Timeline",children:(m,b)=>{var y=qa(),i=a(y),S=s(a(i),2),c=a(S,!0);t(S),t(i);var G=s(i,2),q=s(a(G),2),P=a(q,!0);t(q),t(G);var h=s(G,2),o=s(a(h),2),z=a(o,!0);t(o),t(h);var k=s(h,2),F=s(a(k),2),j=a(F,!0);t(F),t(k),t(y),f((w,p,R,V)=>{n(c,w),n(P,p),n(z,R),n(j,V)},[()=>_(r.batch.brew_date),()=>C(r.batch.start_time),()=>C(r.batch.end_time),()=>C(r.batch.created_at)]),l(m,y)},$$slots:{default:!0}}),De()}var Da=d('<div class="signal-bar svelte-1kdxwtz"></div>'),Pa=d('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),La=d('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Ga=d('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Oa=d('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Aa=d('<div class="device-info svelte-1kdxwtz"><!></div>'),Ea=d('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Ua=d('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Na(U,r){Me(r,!0);let _=A(()=>r.liveReading?.rssi?fa(r.liveReading.rssi):null),C=A(()=>r.liveReading?.last_seen?St(r.liveReading.last_seen):null),m=A(()=>{if(!r.liveReading)return r.batch.device_id||"Unknown";const b=r.liveReading.device_type;return b==="tilt"?`${r.liveReading.color} Tilt`:b==="gravitymon"?`GravityMon (${r.liveReading.id})`:b==="ispindel"?`iSpindel (${r.liveReading.id})`:b==="floaty"?`Floaty (${r.liveReading.id})`:r.liveReading.color||r.liveReading.id});Ae(U,{title:"Tracking Device",children:(b,y)=>{var i=me(),S=K(i);{var c=q=>{var P=Aa(),h=a(P);{var o=k=>{var F=Ga(),j=K(F),w=s(a(j));t(j);var p=s(j,2);{var R=M=>{var N=Pa(),H=a(N);Ft(H,20,()=>Array(4),Rt,(te,ie,ne)=>{var le=Da();f(()=>Ee(le,`
										height: ${6+ne*3}px;
										background: ${(ne<e(_).bars?e(_).color:"var(--bg-hover)")??""};
										opacity: ${ne<e(_).bars?1:.4};
									`)),l(te,le)}),t(H);var W=s(H,2),ee=a(W);t(W),t(N),f(()=>{Ee(W,`color: ${e(_).color??""}`),n(ee,`${e(_).label??""} (${r.liveReading.rssi??""} dBm)`)}),l(M,N)};u(p,M=>{e(_)&&M(R)})}var V=s(p,2);{var J=M=>{var N=La(),H=a(N);t(N),f(()=>n(H,`Updated ${e(C)??""}`)),l(M,N)};u(V,M=>{e(C)&&M(J)})}f(()=>n(w,` ${e(m)??""} - Connected`)),l(k,F)},z=k=>{var F=Oa(),j=K(F),w=s(a(j));t(j),qe(2),f(()=>n(w,` Device: ${r.batch.device_id??""}`)),l(k,F)};u(h,k=>{r.liveReading?k(o):k(z,!1)})}t(P),l(q,P)},G=q=>{var P=Ua(),h=s(a(P),2);{var o=z=>{var k=Ea();k.__click=function(...F){r.onEdit?.apply(this,F)},l(z,k)};u(h,z=>{r.onEdit&&z(o)})}t(P),l(q,P)};u(S,q=>{r.batch.device_id?q(c):q(G,!1)})}l(b,i)},$$slots:{default:!0}}),De()}Ie(["click"]);const Ia=131.25;var Va=d('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Ha=d('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Wa(U,r){Me(r,!0);function _(m){return m==null?"--":Ve(m)}let C=A(()=>r.recipe.abv!=null?r.recipe.abv*100:r.recipe.og&&r.recipe.fg?(r.recipe.og-r.recipe.fg)*Ia:null);Ae(U,{title:"Recipe Targets",children:(m,b)=>{var y=Ha(),i=a(y),S=s(a(i),2),c=a(S,!0);t(S),t(i);var G=s(i,2),q=s(a(G),2),P=a(q,!0);t(q),t(G);var h=s(G,2),o=s(a(h),2),z=a(o,!0);t(o),t(h);var k=s(h,2);{var F=j=>{var w=Va(),p=s(a(w),2),R=a(p,!0);t(p),t(w),f(()=>n(R,r.recipe.yeast_name)),l(j,w)};u(k,j=>{r.recipe.yeast_name&&j(F)})}t(y),f((j,w,p)=>{n(c,j),n(P,w),n(z,p)},[()=>_(r.recipe.og),()=>_(r.recipe.fg),()=>e(C)!=null?`${e(C).toFixed(1)}%`:"--"]),l(m,y)},$$slots:{default:!0}}),De()}var Ja=d('<p class="notes-content svelte-hkv31i"> </p>');function Ya(U,r){Ae(U,{title:"Notes",children:(_,C)=>{var m=Ja(),b=a(m,!0);t(m),f(()=>n(b,r.notes)),l(_,m)},$$slots:{default:!0}})}var Ka=d('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),Qa=d('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Xa=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Za=d('<span class="days svelte-1xs394q"> </span>'),$a=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"> <!></span></div>'),es=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Model Fit (R¬≤):</span> <div class="progress-wrapper svelte-1xs394q"><div class="progress-bar svelte-1xs394q"><div class="fill svelte-1xs394q"></div></div> <span class="percentage svelte-1xs394q"> </span></div></div>'),ts=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Readings:</span> <span class="value svelte-1xs394q"> </span></div>'),as=d('<div class="ml-panel svelte-1xs394q"><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">ML Predictions</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <div class="metrics svelte-1xs394q"><!> <!> <!> <!></div></div>'),ss=d('<div class="ml-panel disabled svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable (insufficient data)</p></div>');function rs(U,r){Me(r,!0);let _=ve(wt({available:!1})),C=ve(!0),m=ve(!1),b=ve(null);async function y(){g(C,!0),g(b,null);try{g(_,await va(r.batchId),!0)}catch(o){g(b,o instanceof Error?o.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",o)}finally{g(C,!1)}}async function i(){g(m,!0),g(b,null);try{const o=await na(r.batchId);console.log("Reloaded predictions:",o.message),await y()}catch(o){g(b,o instanceof Error?o.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",o)}finally{g(m,!1)}}zt(y);function S(o){return o?new Date(o).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function c(o){if(!o)return null;const z=new Date(o),k=new Date,F=z.getTime()-k.getTime();return Math.ceil(F/(1e3*60*60*24))}var G=me(),q=K(G);{var P=o=>{var z=Ka();l(o,z)},h=o=>{var z=me(),k=K(z);{var F=w=>{var p=Qa(),R=a(p),V=a(R);t(R),t(p),f(()=>n(V,`‚ö†Ô∏è ${e(b)??""}`)),l(w,p)},j=w=>{var p=me(),R=K(p);{var V=M=>{var N=as(),H=a(N),W=s(a(H),2);W.__click=i;var ee=a(W,!0);t(W),t(H);var te=s(H,2),ie=a(te);{var ne=B=>{var T=Xa(),v=s(a(T),2),x=a(v,!0);t(v),t(T),f(E=>n(x,E),[()=>Ve(e(_).predicted_fg)]),l(B,T)};u(ie,B=>{e(_).predicted_fg&&B(ne)})}var le=s(ie,2);{var I=B=>{const T=A(()=>c(e(_).estimated_completion));var v=$a(),x=s(a(v),2),E=a(x),L=s(E);{var pe=Y=>{var ae=Za(),Q=a(ae);t(ae),f(()=>n(Q,`(${e(T)??""} ${e(T)===1?"day":"days"})`)),l(Y,ae)};u(L,Y=>{e(T)!==null&&Y(pe)})}t(x),t(v),f(Y=>n(E,`${Y??""} `),[()=>S(e(_).estimated_completion)]),l(B,v)};u(le,B=>{e(_).estimated_completion&&B(I)})}var O=s(le,2);{var se=B=>{var T=es(),v=s(a(T),2),x=a(v),E=a(x);t(x);var L=s(x,2),pe=a(L);t(L),t(v),t(T),f(Y=>{Ee(E,`width: ${e(_).r_squared*100}%`),n(pe,`${Y??""}%`)},[()=>(e(_).r_squared*100).toFixed(0)]),l(B,T)};u(O,B=>{e(_).r_squared!==void 0&&B(se)})}var Ce=s(O,2);{var xe=B=>{var T=ts(),v=s(a(T),2),x=a(v);t(v),t(T),f(()=>n(x,`${e(_).num_readings??""} points`)),l(B,T)};u(Ce,B=>{e(_).num_readings&&B(xe)})}t(te),t(N),f(()=>{W.disabled=e(m)||e(C),n(ee,e(m)?"Reloading...":"‚Üª Reload")}),l(M,N)},J=M=>{var N=ss();l(M,N)};u(R,M=>{e(_).available?M(V):M(J,!1)},!0)}l(w,p)};u(k,w=>{e(b)?w(F):w(j,!1)},!0)}l(o,z)};u(q,o=>{e(C)?o(P):o(h,!1)})}l(U,G),De()}Ie(["click"]);var is=d('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),ls=d('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),vs=d('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),ns=d('<span class="recipe-type svelte-g5au2j"> </span>'),os=d('<a class="recipe-link svelte-g5au2j"> <!></a>'),ds=d('<option class="svelte-g5au2j"> </option>'),cs=d('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),us=d('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),_s=d('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),gs=d('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),fs=d('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),ms=d('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),ps=d('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),bs=d('<span class="svelte-g5au2j"> </span>'),hs=d('<span class="svelte-g5au2j"> </span>'),js=d('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),ys=d('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div>',1),xs=d('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),ks=d('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Is(U,r){Me(r,!0);const _=()=>ra(ia,"$page",C),[C,m]=sa();let b=null,y=null,i=ve(null),S=ve(null),c=ve(null);wt([]);let G=ve(!0),q=ve(null),P=ve(!1),h=ve(!1),o=ve(!1),z=ve(!1),k=ve(!1),F=A(()=>parseInt(_().params.id??"0"));const j={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},w=["planning","fermenting","conditioning","completed","archived"];let p=A(()=>e(i)?j[e(i).status]:j.planning),R=A(Bt),V=A(()=>xt.config.ha_enabled&&xt.config.temp_control_enabled&&(e(i)?.heater_entity_id||e(i)?.cooler_entity_id)),J=A(()=>{if(!e(i)?.device_id)return null;const v=kt.tilts.get(e(i).device_id);if(v)return v;const x=e(i).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!x?.[1])return null;const E=x[1].toUpperCase();for(const L of kt.tilts.values())if(L.color&&L.color.toUpperCase()===E)return L;return null});async function M(){g(G,!0),g(q,null);try{if(g(i,await oa(e(F)),!0),e(i).status==="fermenting"||e(i).status==="conditioning")try{g(S,await jt(e(F)),!0)}catch{}if(e(i).heater_entity_id||e(i).cooler_entity_id)try{g(c,await Ne(e(F)),!0)}catch{}}catch(v){g(q,v instanceof Error?v.message:"Failed to load batch",!0)}finally{g(G,!1)}}async function N(v){if(!(!e(i)||e(h))&&!(v==="conditioning"&&e(i).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){g(h,!0);try{g(i,await yt(e(i).id,{status:v}),!0),(v==="fermenting"||v==="conditioning")&&g(S,await jt(e(i).id),!0)}catch(x){console.error("Failed to update status:",x)}finally{g(h,!1)}}}async function H(v){if(e(i)&&(g(i,await yt(e(i).id,v),!0),g(P,!1),e(i).heater_entity_id||e(i).cooler_entity_id))try{g(c,await Ne(e(i).id),!0)}catch{}}async function W(){if(e(i)){g(k,!0);try{await da(e(i).id),la("/batches")}catch(v){g(q,v instanceof Error?v.message:"Failed to delete batch",!0),g(k,!1),g(z,!1)}}}async function ee(v,x){if(!(!e(i)||e(o))){g(o,!0);try{await $e(e(i).id,x,60,v),g(c,await Ne(e(i).id),!0)}catch(E){console.error("Failed to set override:",E)}finally{g(o,!1)}}}async function te(){if(!(!e(i)||e(o))){g(o,!0);try{e(i).heater_entity_id&&await $e(e(i).id,null,60,"heater"),e(i).cooler_entity_id&&await $e(e(i).id,null,60,"cooler"),g(c,await Ne(e(i).id),!0)}catch(v){console.error("Failed to clear overrides:",v)}finally{g(o,!1)}}}function ie(){if(b?.readyState===WebSocket.OPEN)return;const x=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;b=new WebSocket(x),b.onmessage=async E=>{try{const L=JSON.parse(E.data);L.type==="control_event"&&L.batch_id===e(F)&&e(c)&&(L.action==="heat_on"?g(c,{...e(c),heater_state:"on"},!0):L.action==="heat_off"?g(c,{...e(c),heater_state:"off"},!0):L.action==="cool_on"?g(c,{...e(c),cooler_state:"on"},!0):L.action==="cool_off"&&g(c,{...e(c),cooler_state:"off"},!0))}catch{}},b.onclose=()=>{b=null,y=setTimeout(ie,3e3)},b.onerror=()=>{b?.close()}}function ne(){y&&(clearTimeout(y),y=null),b?.close(),b=null}function le(v){return v==null?"--":Tt(v)}zt(()=>{M(),ie()}),Xt(()=>{ne()});var I=ks();ea("g5au2j",v=>{Zt(()=>{$t.title=`${(e(i)?.name||"Batch")??""} | BrewSignal`})});var O=K(I),se=s(a(O),2);{var Ce=v=>{var x=is();l(v,x)},xe=v=>{var x=me(),E=K(x);{var L=Y=>{var ae=ls(),Q=s(a(ae),2),be=a(Q,!0);t(Q);var Be=s(Q,2);Be.__click=M,t(ae),f(()=>n(be,e(q))),l(Y,ae)},pe=Y=>{var ae=me(),Q=K(ae);{var be=ke=>{var Ue=vs();l(ke,Ue)},Be=ke=>{var Ue=me(),qt=K(Ue);{var Mt=Pe=>{ua(Pe,{get batch(){return e(i)},onSubmit:H,onCancel:()=>g(P,!1)})},Dt=Pe=>{var tt=ys(),He=K(tt),We=a(He),Je=a(We),Pt=a(Je);t(Je);var at=s(Je,2),Ye=a(at),Lt=a(Ye,!0);t(Ye);var Gt=s(Ye,2);{var Ot=D=>{var X=os(),re=a(X),je=s(re);{var ue=ye=>{var we=ns(),Le=a(we);t(we),f(()=>n(Le,`(${e(i).recipe.type??""})`)),l(ye,we)};u(je,ye=>{e(i).recipe.type&&ye(ue)})}t(X),f(()=>{Ct(X,"href",`/recipes/${e(i).recipe.id??""}`),n(re,`${e(i).recipe.name??""} `)}),l(D,X)};u(Gt,D=>{e(i).recipe&&D(Ot)})}t(at),t(We);var st=s(We,2),Ke=a(st),he=a(Ke);he.__change=D=>N(D.currentTarget.value),Ft(he,21,()=>w,Rt,(D,X)=>{var re=ds(),je=a(re,!0);t(re);var ue={};f(()=>{n(je,j[e(X)].label),ue!==(ue=e(X))&&(re.value=(re.__value=e(X))??"")}),l(D,re)}),t(he);var rt;ta(he),t(Ke);var it=s(Ke,2);it.__click=()=>g(P,!0);var At=s(it,2);At.__click=()=>g(z,!0),t(st),t(He);var lt=s(He,2),Qe=a(lt),vt=a(Qe);{var Et=D=>{{let X=A(()=>e(S)?.measured?.current_sg),re=A(()=>e(S)?.temperature?.current);wa(D,{get liveReading(){return e(J)},get currentSg(){return e(X)},get currentTemp(){return e(re)}})}};u(vt,D=>{(e(J)||e(S)?.measured?.current_sg!=null)&&D(Et)})}var nt=s(vt,2);{let D=A(()=>e(J)?.sg??e(S)?.measured?.current_sg);Sa(nt,{get batch(){return e(i)},get currentSg(){return e(D)},get progress(){return e(S)}})}var Ut=s(nt,2);{var Nt=D=>{Wa(D,{get recipe(){return e(i).recipe}})};u(Ut,D=>{e(i).recipe&&D(Nt)})}t(Qe);var ot=s(Qe,2),dt=a(ot);Ma(dt,{get batch(){return e(i)}});var ct=s(dt,2);Na(ct,{get batch(){return e(i)},get liveReading(){return e(J)},onEdit:()=>g(P,!0)});var ut=s(ct,2);rs(ut,{get batchId(){return e(i).id}});var _t=s(ut,2);{var It=D=>{var X=ps();let re;var je=s(a(X),2),ue=a(je);{var ye=oe=>{var Z=cs(),$=a(Z);let de;var ze=s($,2),_e=s(a(ze),2);let Fe;var Ge=a(_e,!0);t(_e);var Te=s(_e,2),Oe=a(Te,!0);t(Te),t(ze),t(Z),f(()=>{de=Re($,1,"device-icon-wrap svelte-g5au2j",null,de,{active:e(c)?.heater_state==="on"}),Fe=Re(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(c)?.heater_state==="on"}),n(Ge,e(c)?.heater_state==="on"?"ON":"OFF"),n(Oe,e(i).heater_entity_id)}),l(oe,Z)};u(ue,oe=>{e(i).heater_entity_id&&oe(ye)})}var we=s(ue,2);{var Le=oe=>{var Z=us(),$=a(Z);let de;var ze=s($,2),_e=s(a(ze),2);let Fe;var Ge=a(_e,!0);t(_e);var Te=s(_e,2),Oe=a(Te,!0);t(Te),t(ze),t(Z),f(()=>{de=Re($,1,"device-icon-wrap svelte-g5au2j",null,de,{active:e(c)?.cooler_state==="on"}),Fe=Re(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(c)?.cooler_state==="on"}),n(Ge,e(c)?.cooler_state==="on"?"ON":"OFF"),n(Oe,e(i).cooler_entity_id)}),l(oe,Z)};u(we,oe=>{e(i).cooler_entity_id&&oe(Le)})}t(je);var Xe=s(je,2);{var Ze=oe=>{var Z=ms(),$=K(Z),de=a($),ze=s(a(de),2),_e=a(ze);t(ze),t(de);var Fe=s(de,2),Ge=s(a(Fe),2),Te=a(Ge);t(Ge),t(Fe),t($);var Oe=s($,2);{var Jt=ce=>{var ge=_s(),fe=s(a(ge),2),Se=a(fe);t(fe);var ht=s(fe,2);ht.__click=()=>te(),t(ge),f(Qt=>{n(Se,`Override active: ${Qt??""}`),ht.disabled=e(o)},[()=>e(c).override_state?.toUpperCase()]),l(ce,ge)};u(Oe,ce=>{e(c).override_active&&ce(Jt)})}var gt=s(Oe,2),ft=s(a(gt),2),mt=a(ft);{var Yt=ce=>{var ge=gs(),fe=K(ge);fe.__click=()=>ee("heater","on");var Se=s(fe,2);Se.__click=()=>ee("heater","off"),f(()=>{fe.disabled=e(o),Se.disabled=e(o)}),l(ce,ge)};u(mt,ce=>{e(i).heater_entity_id&&ce(Yt)})}var pt=s(mt,2);{var Kt=ce=>{var ge=fs(),fe=K(ge);fe.__click=()=>ee("cooler","on");var Se=s(fe,2);Se.__click=()=>ee("cooler","off"),f(()=>{fe.disabled=e(o),Se.disabled=e(o)}),l(ce,ge)};u(pt,ce=>{e(i).cooler_entity_id&&ce(Kt)})}var bt=s(pt,2);bt.__click=()=>te(),t(ft),t(gt),f((ce,ge)=>{n(_e,`${ce??""}${e(R)??""}`),n(Te,`¬±${ge??""}${e(R)??""}`),bt.disabled=e(o)},[()=>le(e(c).target_temp),()=>e(c).hysteresis?.toFixed(1)||"--"]),l(oe,Z)};u(Xe,oe=>{e(c)&&oe(Ze)})}t(X),f(()=>re=Re(X,1,"info-card temp-control-card svelte-g5au2j",null,re,{"heater-on":e(c)?.heater_state==="on","cooler-on":e(c)?.cooler_state==="on"})),l(D,X)},Vt=D=>{var X=me(),re=K(X);{var je=ue=>{var ye=js(),we=s(a(ye),2),Le=a(we);{var Xe=Z=>{var $=bs(),de=a($);t($),f(()=>n(de,`Heater: ${e(i).heater_entity_id??""}`)),l(Z,$)};u(Le,Z=>{e(i).heater_entity_id&&Z(Xe)})}var Ze=s(Le,2);{var oe=Z=>{var $=hs(),de=a($);t($),f(()=>n(de,`Cooler: ${e(i).cooler_entity_id??""}`)),l(Z,$)};u(Ze,Z=>{e(i).cooler_entity_id&&Z(oe)})}qe(2),t(we),t(ye),l(ue,ye)};u(re,ue=>{(e(i).heater_entity_id||e(i).cooler_entity_id)&&e(i).status!=="fermenting"&&ue(je)},!0)}l(D,X)};u(_t,D=>{e(V)&&(e(i).status==="fermenting"||e(i).status==="conditioning")?D(It):D(Vt,!1)})}var Ht=s(_t,2);{var Wt=D=>{Ya(D,{get notes(){return e(i).notes}})};u(Ht,D=>{e(i).notes&&D(Wt)})}t(ot),t(lt),f(()=>{n(Pt,`#${(e(i).batch_number||"?")??""}`),n(Lt,e(i).name||e(i).recipe?.name||"Unnamed Batch"),he.disabled=e(h),Ee(he,`color: ${e(p).color??""}; background: ${e(p).bg??""};`),rt!==(rt=e(i).status)&&(he.value=(he.__value=e(i).status)??"",aa(he,e(i).status))}),l(Pe,tt)};u(qt,Pe=>{e(P)?Pe(Mt):Pe(Dt,!1)},!0)}l(ke,Ue)};u(Q,ke=>{e(i)?ke(Be,!1):ke(be)},!0)}l(Y,ae)};u(E,Y=>{e(q)?Y(L):Y(pe,!1)},!0)}l(v,x)};u(se,v=>{e(G)?v(Ce):v(xe,!1)})}t(O);var B=s(O,2);{var T=v=>{var x=xs();x.__click=()=>g(z,!1);var E=a(x);E.__click=Be=>Be.stopPropagation();var L=s(a(E),2),pe=a(L);t(L);var Y=s(L,2),ae=a(Y);ae.__click=()=>g(z,!1);var Q=s(ae,2);Q.__click=W;var be=a(Q,!0);t(Q),t(Y),t(E),t(x),f(()=>{n(pe,`Are you sure you want to delete "${(e(i)?.name||"this batch")??""}"? This cannot be undone.`),ae.disabled=e(k),Q.disabled=e(k),n(be,e(k)?"Deleting...":"Delete Batch")}),l(v,x)};u(B,v=>{e(z)&&v(T)})}l(U,I),De(),m()}Ie(["click","change"]);export{Is as component,Ns as universal};
