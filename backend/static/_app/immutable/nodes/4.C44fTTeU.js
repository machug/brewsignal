import{d as Ne,f as d,s as n,a as l,c as me}from"../chunks/CsQfwH0S.js";import{al as a,ak as s,an as t,ar as f,ah as Me,at as J,c as e,ai as E,as as qe,aj as Pe,aq as le,p as wt,ao as zt,s as g,aL as Xt,ay as Zt,am as $t}from"../chunks/fKkNMI8q.js";import{e as Ft,i as Ct}from"../chunks/COk1ZY4R.js";import{i as u}from"../chunks/BvBRaQNg.js";import{h as ea}from"../chunks/DLseniaC.js";import{s as Bt}from"../chunks/DbN3nGCc.js";import{s as Ce}from"../chunks/BDI2zAFW.js";import{s as Ee}from"../chunks/CcRNvR1k.js";import{i as ta,s as aa}from"../chunks/C8srtpii.js";import{s as sa,a as ra}from"../chunks/C51ud8ec.js";import{p as ia}from"../chunks/DMjRosww.js";import{g as la}from"../chunks/B1O5L4LG.js";import{z as va,A as na,q as oa,j as jt,B as Ie,k as da,x as yt,C as $e}from"../chunks/i8VL_lOf.js";import{b as ca,g as Rt,d as Ve,e as Tt,c as xt}from"../chunks/CPwbAm-l.js";import{t as kt}from"../chunks/CKZ2knDC.js";import{B as ua}from"../chunks/DTfC6M4H.js";import{s as _a}from"../chunks/Bdaed-dN.js";import{p as et}from"../chunks/CllCHKBI.js";const ga=!1,Is=Object.freeze(Object.defineProperty({__proto__:null,prerender:ga},Symbol.toStringTag,{value:"Module"}));function fa(U){return U>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:U>=-60?{bars:3,color:"var(--positive)",label:"Good"}:U>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function St(U){const i=Math.floor((Date.now()-new Date(U).getTime())/1e3);if(i<10)return"just now";if(i<60)return`${i}s ago`;const _=Math.floor(i/60);if(_<60)return`${_}m ago`;const R=Math.floor(_/60);return R<24?`${R}h ago`:`${Math.floor(R/24)}d ago`}var ma=d('<div class="accent-bar svelte-1oyrwd9"></div>'),pa=d('<span class="card-icon svelte-1oyrwd9"> </span>'),ba=d('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ha=d('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function Ae(U,i){let _=et(i,"highlight",3,!1),R=et(i,"collapsible",3,!1),m=et(i,"expanded",3,!1);var w=ha();let p;var r=a(w);{var M=b=>{var C=ma();l(b,C)};u(r,b=>{_()&&b(M)})}var c=s(r,2),B=a(c),T=a(B);{var N=b=>{var C=pa(),V=a(C,!0);t(C),f(()=>n(V,i.icon)),l(b,C)};u(T,b=>{i.icon&&b(N)})}var h=s(T,2),o=a(h,!0);t(h),t(B);var j=s(B,2);{var z=b=>{var C=ba();C.__click=function(...P){i.onToggle?.apply(this,P)};var V=a(C);let O;t(C),f(()=>{Bt(C,"aria-label",m()?"Collapse":"Expand"),O=Ce(V,0,"expand-icon svelte-1oyrwd9",null,O,{"rotate-180":m()})}),l(b,C)};u(j,b=>{R()&&i.onToggle&&b(z)})}t(c);var F=s(c,2);let x;var k=a(F);_a(k,()=>i.children),t(F),t(w),f(()=>{p=Ce(w,1,"batch-card svelte-1oyrwd9",null,p,{highlight:_()}),n(o,i.title),x=Ce(F,1,"card-content svelte-1oyrwd9",null,x,{collapsed:R()&&!m()})}),l(U,w)}Ne(["click"]);var ja=d('<span class="unit svelte-lzskfi"> </span>'),ya=d('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),xa=d('<div class="last-seen svelte-lzskfi"> </div>'),ka=d('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function wa(U,i){Me(i,!0);let _=E(()=>i.liveReading?.sg??i.currentSg),R=E(()=>i.liveReading?.temp??i.currentTemp),m=E(()=>i.liveReading?.sg_raw),w=E(()=>i.liveReading?.temp_raw),p=E(()=>i.liveReading?.last_seen),r=E(()=>i.liveReading&&(i.liveReading.sg!==i.liveReading.sg_raw||i.liveReading.temp!==i.liveReading.temp_raw)),M=E(ca),c=E(Rt);function B(h){return h==null?"--":Ve(h)}function T(h){return h==null?"--":Tt(h)}let N=E(()=>e(p)?St(e(p)):null);Ae(U,{title:"Live Readings",highlight:!0,children:(h,o)=>{var j=ka(),z=s(J(j),2),F=a(z),x=a(F),k=a(x),b=s(k);{var C=I=>{var G=ja(),re=a(G,!0);t(G),f(()=>n(re,e(M))),l(I,G)};u(b,I=>{e(M)!=="SG"&&I(C)})}t(x);var V=s(x,2),O=a(V,!0);t(V),t(F);var P=s(F,2),H=a(P),Y=a(H),K=s(Y),te=a(K,!0);t(K),t(H),qe(2),t(P),t(z);var se=s(z,2);{var $=I=>{var G=ya(),re=s(a(G),2),Be=a(re,!0);t(re);var xe=s(re,4),S=a(xe);t(xe),t(G),f((q,v)=>{n(Be,q),n(S,`${v??""}${e(c)??""}`)},[()=>B(e(m)),()=>T(e(w))]),l(I,G)};u(se,I=>{e(r)&&I($)})}var de=s(se,2);{var ce=I=>{var G=xa(),re=a(G);t(G),f(()=>n(re,`Updated ${e(N)??""}`)),l(I,G)};u(de,I=>{e(N)&&I(ce)})}f((I,G)=>{n(k,`${I??""} `),n(O,e(M)==="SG"?"Gravity":e(M)==="¬∞P"?"Plato":"Brix"),n(Y,`${G??""} `),n(te,e(c))},[()=>B(e(_)),()=>T(e(R))]),l(h,j)},$$slots:{default:!0}}),Pe()}var za=d('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),Fa=d('<div class="progress-remaining svelte-t80j9z"> </div>'),Ca=d('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),Ba=d('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),Ra=d('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),Ta=d('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Sa(U,i){Me(i,!0);let _=E(()=>{if(!i.batch.measured_og)return null;const p=i.currentSg??i.progress?.measured?.current_sg;if(!p)return null;const r=(i.batch.measured_og-p)*131.25,M=i.batch.measured_og-1,c=M!==0?(i.batch.measured_og-p)/M*100:0;return{currentSg:p,abv:Math.max(0,r),attenuation:Math.max(0,Math.min(100,c)),isFermenting:i.batch.status==="fermenting"||i.batch.status==="conditioning"}}),R=E(()=>e(_)?.isFermenting??!1);function m(p){return p==null?"--":Ve(p)}function w(p){return p==null?"--":`${p.toFixed(1)}%`}{let p=E(()=>e(R)?"Fermentation Progress":"Fermentation Measurements");Ae(U,{get title(){return e(p)},children:(r,M)=>{var c=me(),B=J(c);{var T=h=>{var o=Ba(),j=J(o),z=s(a(j),2),F=a(z);qe(),t(z),t(j);var x=s(j,2),k=s(a(x),2),b=s(a(k),4),C=a(b,!0);t(b),t(k);var V=s(k,2);{var O=S=>{var q=za(),v=s(a(q),4),y=a(v,!0);t(v),t(q),f(A=>n(y,A),[()=>m(i.batch.recipe.fg)]),l(S,q)};u(V,S=>{i.batch.recipe?.fg&&S(O)})}var P=s(V,2),H=s(a(P),4),Y=a(H,!0);t(H),t(P),t(x);var K=s(x,2),te=a(K),se=s(a(te),2),$=s(a(se),2),de=a($);qe(),t($),t(se),t(te);var ce=s(te,2),I=s(a(ce),2),G=s(a(I),2),re=a(G);qe(),t(G),t(I),t(ce),t(K);var Be=s(K,2);{var xe=S=>{var q=Ca(),v=a(q),y=s(a(v),2),A=a(y);t(y),t(v);var L=s(v,2),pe=s(a(L),2);qe(2),t(L);var W=s(L,2);{var ae=Q=>{var be=Fa(),Re=a(be);t(be),f(ke=>n(Re,`${ke??""} gravity points remaining`),[()=>i.progress.progress.sg_remaining.toFixed(3)]),l(Q,be)};u(W,Q=>{i.progress.progress.sg_remaining!=null&&Q(ae)})}t(q),f(Q=>{n(A,`${Q??""}%`),Ee(pe,`width: ${i.progress.progress.percent_complete??""}%`)},[()=>i.progress.progress.percent_complete.toFixed(0)]),l(S,q)};u(Be,S=>{i.progress?.progress?.percent_complete!=null&&S(xe)})}f((S,q,v,y,A)=>{n(F,`${S??""} `),n(C,q),n(Y,v),n(de,`${y??""} `),n(re,`${A??""} `)},[()=>m(e(_).currentSg),()=>m(i.batch.measured_og),()=>m(e(_).currentSg),()=>w(e(_).abv),()=>w(e(_).attenuation)]),l(h,o)},N=h=>{var o=me(),j=J(o);{var z=x=>{var k=Ra(),b=a(k),C=s(a(b),2),V=a(C,!0);t(C),t(b);var O=s(b,2),P=s(a(O),2),H=a(P,!0);t(P),t(O);var Y=s(O,2),K=s(a(Y),2),te=a(K,!0);t(K),t(Y);var se=s(Y,2),$=s(a(se),2),de=a($,!0);t($),t(se),t(k),f((ce,I,G,re)=>{n(V,ce),n(H,I),n(te,G),n(de,re)},[()=>m(i.batch.measured_og),()=>m(i.batch.measured_fg),()=>i.batch.measured_abv!=null?w(i.batch.measured_abv):"--",()=>i.batch.measured_attenuation!=null?w(i.batch.measured_attenuation):"--"]),l(x,k)},F=x=>{var k=Ta();l(x,k)};u(j,x=>{i.batch.measured_og?x(z):x(F,!1)},!0)}l(h,o)};u(B,h=>{e(_)&&e(R)?h(T):h(N,!1)})}l(r,c)},$$slots:{default:!0}})}Pe()}var qa=d('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Ma(U,i){Me(i,!0);function _(m){return m?new Date(m).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function R(m){return m?new Date(m).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}Ae(U,{title:"Timeline",children:(m,w)=>{var p=qa(),r=a(p),M=s(a(r),2),c=a(M,!0);t(M),t(r);var B=s(r,2),T=s(a(B),2),N=a(T,!0);t(T),t(B);var h=s(B,2),o=s(a(h),2),j=a(o,!0);t(o),t(h);var z=s(h,2),F=s(a(z),2),x=a(F,!0);t(F),t(z),t(p),f((k,b,C,V)=>{n(c,k),n(N,b),n(j,C),n(x,V)},[()=>_(i.batch.brew_date),()=>R(i.batch.start_time),()=>R(i.batch.end_time),()=>R(i.batch.created_at)]),l(m,p)},$$slots:{default:!0}}),Pe()}var Pa=d('<div class="signal-bar svelte-1kdxwtz"></div>'),Da=d('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),La=d('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Oa=d('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ga=d('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Aa=d('<div class="device-info svelte-1kdxwtz"><!></div>'),Ea=d('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Ua=d('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Ia(U,i){Me(i,!0);let _=E(()=>i.liveReading?.rssi?fa(i.liveReading.rssi):null),R=E(()=>i.liveReading?.last_seen?St(i.liveReading.last_seen):null);Ae(U,{title:"Tracking Device",children:(m,w)=>{var p=me(),r=J(p);{var M=B=>{var T=Aa(),N=a(T);{var h=j=>{var z=Oa(),F=J(z),x=s(a(F));t(F);var k=s(F,2);{var b=O=>{var P=Da(),H=a(P);Ft(H,20,()=>Array(4),Ct,(te,se,$)=>{var de=Pa();f(()=>Ee(de,`
										height: ${6+$*3}px;
										background: ${($<e(_).bars?e(_).color:"var(--bg-hover)")??""};
										opacity: ${$<e(_).bars?1:.4};
									`)),l(te,de)}),t(H);var Y=s(H,2),K=a(Y);t(Y),t(P),f(()=>{Ee(Y,`color: ${e(_).color??""}`),n(K,`${e(_).label??""} (${i.liveReading.rssi??""} dBm)`)}),l(O,P)};u(k,O=>{e(_)&&O(b)})}var C=s(k,2);{var V=O=>{var P=La(),H=a(P);t(P),f(()=>n(H,`Updated ${e(R)??""}`)),l(O,P)};u(C,O=>{e(R)&&O(V)})}f(()=>n(x,` ${i.liveReading.color??""} Tilt - Connected`)),l(j,z)},o=j=>{var z=Ga(),F=J(z),x=s(a(F));t(F),qe(2),f(()=>n(x,` Device: ${i.batch.device_id??""}`)),l(j,z)};u(N,j=>{i.liveReading?j(h):j(o,!1)})}t(T),l(B,T)},c=B=>{var T=Ua(),N=s(a(T),2);{var h=o=>{var j=Ea();j.__click=function(...z){i.onEdit?.apply(this,z)},l(o,j)};u(N,o=>{i.onEdit&&o(h)})}t(T),l(B,T)};u(r,B=>{i.batch.device_id?B(M):B(c,!1)})}l(m,p)},$$slots:{default:!0}}),Pe()}Ne(["click"]);const Na=131.25;var Va=d('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Ha=d('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Wa(U,i){Me(i,!0);function _(m){return m==null?"--":Ve(m)}let R=E(()=>i.recipe.abv!=null?i.recipe.abv*100:i.recipe.og&&i.recipe.fg?(i.recipe.og-i.recipe.fg)*Na:null);Ae(U,{title:"Recipe Targets",children:(m,w)=>{var p=Ha(),r=a(p),M=s(a(r),2),c=a(M,!0);t(M),t(r);var B=s(r,2),T=s(a(B),2),N=a(T,!0);t(T),t(B);var h=s(B,2),o=s(a(h),2),j=a(o,!0);t(o),t(h);var z=s(h,2);{var F=x=>{var k=Va(),b=s(a(k),2),C=a(b,!0);t(b),t(k),f(()=>n(C,i.recipe.yeast_name)),l(x,k)};u(z,x=>{i.recipe.yeast_name&&x(F)})}t(p),f((x,k,b)=>{n(c,x),n(N,k),n(j,b)},[()=>_(i.recipe.og),()=>_(i.recipe.fg),()=>e(R)!=null?`${e(R).toFixed(1)}%`:"--"]),l(m,p)},$$slots:{default:!0}}),Pe()}var Ja=d('<p class="notes-content svelte-hkv31i"> </p>');function Ya(U,i){Ae(U,{title:"Notes",children:(_,R)=>{var m=Ja(),w=a(m,!0);t(m),f(()=>n(w,i.notes)),l(_,m)},$$slots:{default:!0}})}var Ka=d('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),Qa=d('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Xa=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Za=d('<span class="days svelte-1xs394q"> </span>'),$a=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"> <!></span></div>'),es=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Model Fit (R¬≤):</span> <div class="progress-wrapper svelte-1xs394q"><div class="progress-bar svelte-1xs394q"><div class="fill svelte-1xs394q"></div></div> <span class="percentage svelte-1xs394q"> </span></div></div>'),ts=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Readings:</span> <span class="value svelte-1xs394q"> </span></div>'),as=d('<div class="ml-panel svelte-1xs394q"><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">ML Predictions</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <div class="metrics svelte-1xs394q"><!> <!> <!> <!></div></div>'),ss=d('<div class="ml-panel disabled svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable (insufficient data)</p></div>');function rs(U,i){Me(i,!0);let _=le(wt({available:!1})),R=le(!0),m=le(!1),w=le(null);async function p(){g(R,!0),g(w,null);try{g(_,await va(i.batchId),!0)}catch(o){g(w,o instanceof Error?o.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",o)}finally{g(R,!1)}}async function r(){g(m,!0),g(w,null);try{const o=await na(i.batchId);console.log("Reloaded predictions:",o.message),await p()}catch(o){g(w,o instanceof Error?o.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",o)}finally{g(m,!1)}}zt(p);function M(o){return o?new Date(o).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function c(o){if(!o)return null;const j=new Date(o),z=new Date,F=j.getTime()-z.getTime();return Math.ceil(F/(1e3*60*60*24))}var B=me(),T=J(B);{var N=o=>{var j=Ka();l(o,j)},h=o=>{var j=me(),z=J(j);{var F=k=>{var b=Qa(),C=a(b),V=a(C);t(C),t(b),f(()=>n(V,`‚ö†Ô∏è ${e(w)??""}`)),l(k,b)},x=k=>{var b=me(),C=J(b);{var V=P=>{var H=as(),Y=a(H),K=s(a(Y),2);K.__click=r;var te=a(K,!0);t(K),t(Y);var se=s(Y,2),$=a(se);{var de=S=>{var q=Xa(),v=s(a(q),2),y=a(v,!0);t(v),t(q),f(A=>n(y,A),[()=>Ve(e(_).predicted_fg)]),l(S,q)};u($,S=>{e(_).predicted_fg&&S(de)})}var ce=s($,2);{var I=S=>{const q=E(()=>c(e(_).estimated_completion));var v=$a(),y=s(a(v),2),A=a(y),L=s(A);{var pe=W=>{var ae=Za(),Q=a(ae);t(ae),f(()=>n(Q,`(${e(q)??""} ${e(q)===1?"day":"days"})`)),l(W,ae)};u(L,W=>{e(q)!==null&&W(pe)})}t(y),t(v),f(W=>n(A,`${W??""} `),[()=>M(e(_).estimated_completion)]),l(S,v)};u(ce,S=>{e(_).estimated_completion&&S(I)})}var G=s(ce,2);{var re=S=>{var q=es(),v=s(a(q),2),y=a(v),A=a(y);t(y);var L=s(y,2),pe=a(L);t(L),t(v),t(q),f(W=>{Ee(A,`width: ${e(_).r_squared*100}%`),n(pe,`${W??""}%`)},[()=>(e(_).r_squared*100).toFixed(0)]),l(S,q)};u(G,S=>{e(_).r_squared!==void 0&&S(re)})}var Be=s(G,2);{var xe=S=>{var q=ts(),v=s(a(q),2),y=a(v);t(v),t(q),f(()=>n(y,`${e(_).num_readings??""} points`)),l(S,q)};u(Be,S=>{e(_).num_readings&&S(xe)})}t(se),t(H),f(()=>{K.disabled=e(m)||e(R),n(te,e(m)?"Reloading...":"‚Üª Reload")}),l(P,H)},O=P=>{var H=ss();l(P,H)};u(C,P=>{e(_).available?P(V):P(O,!1)},!0)}l(k,b)};u(z,k=>{e(w)?k(F):k(x,!1)},!0)}l(o,j)};u(T,o=>{e(R)?o(N):o(h,!1)})}l(U,B),Pe()}Ne(["click"]);var is=d('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),ls=d('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),vs=d('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),ns=d('<span class="recipe-type svelte-g5au2j"> </span>'),os=d('<a class="recipe-link svelte-g5au2j"> <!></a>'),ds=d('<option class="svelte-g5au2j"> </option>'),cs=d('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),us=d('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),_s=d('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),gs=d('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),fs=d('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),ms=d('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),ps=d('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),bs=d('<span class="svelte-g5au2j"> </span>'),hs=d('<span class="svelte-g5au2j"> </span>'),js=d('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),ys=d('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div>',1),xs=d('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),ks=d('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Ns(U,i){Me(i,!0);const _=()=>ra(ia,"$page",R),[R,m]=sa();let w=null,p=null,r=le(null),M=le(null),c=le(null);wt([]);let B=le(!0),T=le(null),N=le(!1),h=le(!1),o=le(!1),j=le(!1),z=le(!1),F=E(()=>parseInt(_().params.id??"0"));const x={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},k=["planning","fermenting","conditioning","completed","archived"];let b=E(()=>e(r)?x[e(r).status]:x.planning),C=E(Rt),V=E(()=>xt.config.ha_enabled&&xt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),O=E(()=>{if(!e(r)?.device_id)return null;const v=kt.tilts.get(e(r).device_id);if(v)return v;const y=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!y?.[1])return null;const A=y[1].toUpperCase();for(const L of kt.tilts.values())if(L.color&&L.color.toUpperCase()===A)return L;return null});async function P(){g(B,!0),g(T,null);try{if(g(r,await oa(e(F)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{g(M,await jt(e(F)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{g(c,await Ie(e(F)),!0)}catch{}}catch(v){g(T,v instanceof Error?v.message:"Failed to load batch",!0)}finally{g(B,!1)}}async function H(v){if(!(!e(r)||e(h))&&!(v==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){g(h,!0);try{g(r,await yt(e(r).id,{status:v}),!0),(v==="fermenting"||v==="conditioning")&&g(M,await jt(e(r).id),!0)}catch(y){console.error("Failed to update status:",y)}finally{g(h,!1)}}}async function Y(v){if(e(r)&&(g(r,await yt(e(r).id,v),!0),g(N,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{g(c,await Ie(e(r).id),!0)}catch{}}async function K(){if(e(r)){g(z,!0);try{await da(e(r).id),la("/batches")}catch(v){g(T,v instanceof Error?v.message:"Failed to delete batch",!0),g(z,!1),g(j,!1)}}}async function te(v,y){if(!(!e(r)||e(o))){g(o,!0);try{await $e(e(r).id,y,60,v),g(c,await Ie(e(r).id),!0)}catch(A){console.error("Failed to set override:",A)}finally{g(o,!1)}}}async function se(){if(!(!e(r)||e(o))){g(o,!0);try{e(r).heater_entity_id&&await $e(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await $e(e(r).id,null,60,"cooler"),g(c,await Ie(e(r).id),!0)}catch(v){console.error("Failed to clear overrides:",v)}finally{g(o,!1)}}}function $(){if(w?.readyState===WebSocket.OPEN)return;const y=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;w=new WebSocket(y),w.onmessage=async A=>{try{const L=JSON.parse(A.data);L.type==="control_event"&&L.batch_id===e(F)&&e(c)&&(L.action==="heat_on"?g(c,{...e(c),heater_state:"on"},!0):L.action==="heat_off"?g(c,{...e(c),heater_state:"off"},!0):L.action==="cool_on"?g(c,{...e(c),cooler_state:"on"},!0):L.action==="cool_off"&&g(c,{...e(c),cooler_state:"off"},!0))}catch{}},w.onclose=()=>{w=null,p=setTimeout($,3e3)},w.onerror=()=>{w?.close()}}function de(){p&&(clearTimeout(p),p=null),w?.close(),w=null}function ce(v){return v==null?"--":Tt(v)}zt(()=>{P(),$()}),Xt(()=>{de()});var I=ks();ea("g5au2j",v=>{Zt(()=>{$t.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var G=J(I),re=s(a(G),2);{var Be=v=>{var y=is();l(v,y)},xe=v=>{var y=me(),A=J(y);{var L=W=>{var ae=ls(),Q=s(a(ae),2),be=a(Q,!0);t(Q);var Re=s(Q,2);Re.__click=P,t(ae),f(()=>n(be,e(T))),l(W,ae)},pe=W=>{var ae=me(),Q=J(ae);{var be=ke=>{var Ue=vs();l(ke,Ue)},Re=ke=>{var Ue=me(),qt=J(Ue);{var Mt=De=>{ua(De,{get batch(){return e(r)},onSubmit:Y,onCancel:()=>g(N,!1)})},Pt=De=>{var tt=ys(),He=J(tt),We=a(He),Je=a(We),Dt=a(Je);t(Je);var at=s(Je,2),Ye=a(at),Lt=a(Ye,!0);t(Ye);var Ot=s(Ye,2);{var Gt=D=>{var X=os(),ie=a(X),je=s(ie);{var ue=ye=>{var we=ns(),Le=a(we);t(we),f(()=>n(Le,`(${e(r).recipe.type??""})`)),l(ye,we)};u(je,ye=>{e(r).recipe.type&&ye(ue)})}t(X),f(()=>{Bt(X,"href",`/recipes/${e(r).recipe.id??""}`),n(ie,`${e(r).recipe.name??""} `)}),l(D,X)};u(Ot,D=>{e(r).recipe&&D(Gt)})}t(at),t(We);var st=s(We,2),Ke=a(st),he=a(Ke);he.__change=D=>H(D.currentTarget.value),Ft(he,21,()=>k,Ct,(D,X)=>{var ie=ds(),je=a(ie,!0);t(ie);var ue={};f(()=>{n(je,x[e(X)].label),ue!==(ue=e(X))&&(ie.value=(ie.__value=e(X))??"")}),l(D,ie)}),t(he);var rt;ta(he),t(Ke);var it=s(Ke,2);it.__click=()=>g(N,!0);var At=s(it,2);At.__click=()=>g(j,!0),t(st),t(He);var lt=s(He,2),Qe=a(lt),vt=a(Qe);{var Et=D=>{{let X=E(()=>e(M)?.measured?.current_sg),ie=E(()=>e(M)?.temperature?.current);wa(D,{get liveReading(){return e(O)},get currentSg(){return e(X)},get currentTemp(){return e(ie)}})}};u(vt,D=>{(e(O)||e(M)?.measured?.current_sg!=null)&&D(Et)})}var nt=s(vt,2);{let D=E(()=>e(O)?.sg??e(M)?.measured?.current_sg);Sa(nt,{get batch(){return e(r)},get currentSg(){return e(D)},get progress(){return e(M)}})}var Ut=s(nt,2);{var It=D=>{Wa(D,{get recipe(){return e(r).recipe}})};u(Ut,D=>{e(r).recipe&&D(It)})}t(Qe);var ot=s(Qe,2),dt=a(ot);Ma(dt,{get batch(){return e(r)}});var ct=s(dt,2);Ia(ct,{get batch(){return e(r)},get liveReading(){return e(O)},onEdit:()=>g(N,!0)});var ut=s(ct,2);rs(ut,{get batchId(){return e(r).id}});var _t=s(ut,2);{var Nt=D=>{var X=ps();let ie;var je=s(a(X),2),ue=a(je);{var ye=ve=>{var Z=cs(),ee=a(Z);let ne;var ze=s(ee,2),_e=s(a(ze),2);let Fe;var Oe=a(_e,!0);t(_e);var Te=s(_e,2),Ge=a(Te,!0);t(Te),t(ze),t(Z),f(()=>{ne=Ce(ee,1,"device-icon-wrap svelte-g5au2j",null,ne,{active:e(c)?.heater_state==="on"}),Fe=Ce(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(c)?.heater_state==="on"}),n(Oe,e(c)?.heater_state==="on"?"ON":"OFF"),n(Ge,e(r).heater_entity_id)}),l(ve,Z)};u(ue,ve=>{e(r).heater_entity_id&&ve(ye)})}var we=s(ue,2);{var Le=ve=>{var Z=us(),ee=a(Z);let ne;var ze=s(ee,2),_e=s(a(ze),2);let Fe;var Oe=a(_e,!0);t(_e);var Te=s(_e,2),Ge=a(Te,!0);t(Te),t(ze),t(Z),f(()=>{ne=Ce(ee,1,"device-icon-wrap svelte-g5au2j",null,ne,{active:e(c)?.cooler_state==="on"}),Fe=Ce(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(c)?.cooler_state==="on"}),n(Oe,e(c)?.cooler_state==="on"?"ON":"OFF"),n(Ge,e(r).cooler_entity_id)}),l(ve,Z)};u(we,ve=>{e(r).cooler_entity_id&&ve(Le)})}t(je);var Xe=s(je,2);{var Ze=ve=>{var Z=ms(),ee=J(Z),ne=a(ee),ze=s(a(ne),2),_e=a(ze);t(ze),t(ne);var Fe=s(ne,2),Oe=s(a(Fe),2),Te=a(Oe);t(Oe),t(Fe),t(ee);var Ge=s(ee,2);{var Jt=oe=>{var ge=_s(),fe=s(a(ge),2),Se=a(fe);t(fe);var ht=s(fe,2);ht.__click=()=>se(),t(ge),f(Qt=>{n(Se,`Override active: ${Qt??""}`),ht.disabled=e(o)},[()=>e(c).override_state?.toUpperCase()]),l(oe,ge)};u(Ge,oe=>{e(c).override_active&&oe(Jt)})}var gt=s(Ge,2),ft=s(a(gt),2),mt=a(ft);{var Yt=oe=>{var ge=gs(),fe=J(ge);fe.__click=()=>te("heater","on");var Se=s(fe,2);Se.__click=()=>te("heater","off"),f(()=>{fe.disabled=e(o),Se.disabled=e(o)}),l(oe,ge)};u(mt,oe=>{e(r).heater_entity_id&&oe(Yt)})}var pt=s(mt,2);{var Kt=oe=>{var ge=fs(),fe=J(ge);fe.__click=()=>te("cooler","on");var Se=s(fe,2);Se.__click=()=>te("cooler","off"),f(()=>{fe.disabled=e(o),Se.disabled=e(o)}),l(oe,ge)};u(pt,oe=>{e(r).cooler_entity_id&&oe(Kt)})}var bt=s(pt,2);bt.__click=()=>se(),t(ft),t(gt),f((oe,ge)=>{n(_e,`${oe??""}${e(C)??""}`),n(Te,`¬±${ge??""}${e(C)??""}`),bt.disabled=e(o)},[()=>ce(e(c).target_temp),()=>e(c).hysteresis?.toFixed(1)||"--"]),l(ve,Z)};u(Xe,ve=>{e(c)&&ve(Ze)})}t(X),f(()=>ie=Ce(X,1,"info-card temp-control-card svelte-g5au2j",null,ie,{"heater-on":e(c)?.heater_state==="on","cooler-on":e(c)?.cooler_state==="on"})),l(D,X)},Vt=D=>{var X=me(),ie=J(X);{var je=ue=>{var ye=js(),we=s(a(ye),2),Le=a(we);{var Xe=Z=>{var ee=bs(),ne=a(ee);t(ee),f(()=>n(ne,`Heater: ${e(r).heater_entity_id??""}`)),l(Z,ee)};u(Le,Z=>{e(r).heater_entity_id&&Z(Xe)})}var Ze=s(Le,2);{var ve=Z=>{var ee=hs(),ne=a(ee);t(ee),f(()=>n(ne,`Cooler: ${e(r).cooler_entity_id??""}`)),l(Z,ee)};u(Ze,Z=>{e(r).cooler_entity_id&&Z(ve)})}qe(2),t(we),t(ye),l(ue,ye)};u(ie,ue=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&ue(je)},!0)}l(D,X)};u(_t,D=>{e(V)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?D(Nt):D(Vt,!1)})}var Ht=s(_t,2);{var Wt=D=>{Ya(D,{get notes(){return e(r).notes}})};u(Ht,D=>{e(r).notes&&D(Wt)})}t(ot),t(lt),f(()=>{n(Dt,`#${(e(r).batch_number||"?")??""}`),n(Lt,e(r).name||e(r).recipe?.name||"Unnamed Batch"),he.disabled=e(h),Ee(he,`color: ${e(b).color??""}; background: ${e(b).bg??""};`),rt!==(rt=e(r).status)&&(he.value=(he.__value=e(r).status)??"",aa(he,e(r).status))}),l(De,tt)};u(qt,De=>{e(N)?De(Mt):De(Pt,!1)},!0)}l(ke,Ue)};u(Q,ke=>{e(r)?ke(Re,!1):ke(be)},!0)}l(W,ae)};u(A,W=>{e(T)?W(L):W(pe,!1)},!0)}l(v,y)};u(re,v=>{e(B)?v(Be):v(xe,!1)})}t(G);var S=s(G,2);{var q=v=>{var y=xs();y.__click=()=>g(j,!1);var A=a(y);A.__click=Re=>Re.stopPropagation();var L=s(a(A),2),pe=a(L);t(L);var W=s(L,2),ae=a(W);ae.__click=()=>g(j,!1);var Q=s(ae,2);Q.__click=K;var be=a(Q,!0);t(Q),t(W),t(A),t(y),f(()=>{n(pe,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),ae.disabled=e(z),Q.disabled=e(z),n(be,e(z)?"Deleting...":"Delete Batch")}),l(v,y)};u(S,v=>{e(j)&&v(q)})}l(U,I),Pe(),m()}Ne(["click","change"]);export{Ns as component,Is as universal};
