import{d as Qe,f as v,s as g,a as c,c as Ge,t as He}from"../chunks/Bkky6kvZ.js";import{a as qe,d as s,e as l,r as a,h as e,u as C,t as k,g as Oe,n as pe,f as fe,s as X,p as Ee,o as Ke,az as We,c as y,A as Xe,ax as Ze}from"../chunks/813s5maz.js";import{e as $e}from"../chunks/j9QCVC2i.js";import{i as m}from"../chunks/Bf7HnLem.js";import{h as et}from"../chunks/BgIwEmqo.js";import{s as tt,r as at}from"../chunks/UKAZQVVw.js";import{s as ce}from"../chunks/LBYG0Yba.js";import{b as st}from"../chunks/Bjks-vZK.js";import{g as Ne}from"../chunks/Bwf2T4I3.js";import{Q as rt,R as nt,S as it,P as lt,T as ct,U as ot}from"../chunks/D3bWYmks.js";import{s as me}from"../chunks/C7upzuIa.js";import{p as Ie}from"../chunks/B-xGjlKy.js";import{b as vt,d as dt,e as ut,g as gt}from"../chunks/CbPjToI1.js";import{t as ze}from"../chunks/DVuldl-p.js";var _t=v('<span class="recipe-name svelte-6cd32a"> </span>'),mt=v('<span class="activity-badge svelte-6cd32a"> </span>'),pt=v('<span class="status-dot svelte-6cd32a"></span>'),ft=v('<div class="metric svelte-6cd32a"><div class="metric-value temp svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span> <span class="temp-indicator svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a">Temp</div></div>'),ht=v('<div class="metric svelte-6cd32a"><div class="metric-value progress-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a">%</span></div> <div class="metric-label svelte-6cd32a">Progress</div></div>'),bt=v('<div class="progress-bar-container svelte-6cd32a"><div class="progress-bar svelte-6cd32a"></div> <div class="progress-markers svelte-6cd32a"><span class="svelte-6cd32a">0%</span> <span class="svelte-6cd32a">50%</span> <span class="svelte-6cd32a">100%</span></div></div>'),yt=v('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">ABV</span> <span class="stat-value svelte-6cd32a"> </span></div> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Atten</span> <span class="stat-value svelte-6cd32a"> </span></div>',1),wt=v('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Target FG</span> <span class="stat-value svelte-6cd32a"> </span></div>'),kt=v('<button type="button" class="action-btn svelte-6cd32a">View <svg class="action-icon svelte-6cd32a" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" class="svelte-6cd32a"></path></svg></button>'),xt=v('<button type="button" class="expand-btn svelte-6cd32a"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" class="svelte-6cd32a"></path></svg></button>'),Bt=v('<div><div class="accent-stripe svelte-6cd32a"></div> <div class="card-content svelte-6cd32a"><div class="header svelte-6cd32a"><div class="header-left svelte-6cd32a"><div class="batch-number svelte-6cd32a"> </div> <div class="title-group svelte-6cd32a"><h3 class="batch-name svelte-6cd32a"> </h3> <!></div></div> <div class="header-right svelte-6cd32a"><!> <button type="button" class="status-pill svelte-6cd32a"><!> </button></div></div> <div class="metrics-row svelte-6cd32a"><div class="metric svelte-6cd32a"><div class="metric-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a"> </div></div> <!> <!></div> <!> <div class="stats-row svelte-6cd32a"><!> <!> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Brewed</span> <span class="stat-value svelte-6cd32a"> </span></div></div> <div class="footer svelte-6cd32a"><span class="brew-date svelte-6cd32a"> </span> <div class="footer-actions svelte-6cd32a"><!> <!></div></div></div></div>');function Ct(Se,r){qe(r,!0);let A=Ie(r,"liveReading",3,null),Z=Ie(r,"expanded",3,!1);const $={planning:{label:"Planning",color:"var(--status-planning)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"var(--status-fermenting)",bg:"var(--recipe-accent-muted)"},conditioning:{label:"Conditioning",color:"var(--status-conditioning)",bg:"rgba(167, 139, 250, 0.15)"},completed:{label:"Completed",color:"var(--status-completed)",bg:"var(--positive-muted)"},archived:{label:"Archived",color:"var(--status-archived)",bg:"var(--bg-elevated)"}},z={in_range:{icon:"‚úì",color:"var(--positive)"},too_cold:{icon:"‚Üì",color:"var(--accent)"},too_hot:{icon:"‚Üë",color:"var(--negative)"},unknown:{icon:"?",color:"var(--text-muted)"}};let f=C(()=>$[r.batch.status]||$.planning),F=C(()=>r.progress?.temperature?.status?z[r.progress.temperature.status]:z.unknown),R=C(vt),Te=C(gt),ee=C(()=>{if(r.batch.status!=="fermenting"&&r.batch.status!=="conditioning")return null;const t=A()?.sg_rate;if(t==null)return null;const n=Math.abs(t);return n>.002?{label:"Very Active",color:"var(--activity-very-active)",emoji:"üî•"}:n>5e-4?{label:"Active",color:"var(--activity-active)",emoji:"‚ú®"}:n>1e-4?{label:"Slowing",color:"var(--activity-slowing)",emoji:"üê¢"}:{label:"Complete",color:"var(--activity-complete)",emoji:"‚úì"}}),oe=C(()=>A()?.is_anomaly??!1);function P(t){return t==null?"--":dt(t)}function je(t){return t==null?"--":ut(t)}function Ae(){if(!r.batch.brew_date)return"--";const t=new Date(r.batch.brew_date),o=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));return o===0?"Today":o===1?"1 day":`${o} days`}function Re(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}let te=C(Ae),ve=C(()=>r.batch.name||r.batch.recipe?.name||"Unnamed Batch");var Q=Bt();let he;var ae=s(Q),be=l(ae,2),q=s(be),O=s(q),Y=s(O),ye=s(Y);a(Y);var se=l(Y,2),re=s(se),we=s(re,!0);a(re);var ke=l(re,2);{var xe=t=>{var n=_t(),o=s(n,!0);a(n),k(()=>g(o,r.batch.recipe.name)),c(t,n)};m(ke,t=>{r.batch.recipe?.name&&r.batch.name&&r.batch.name!==r.batch.recipe.name&&t(xe)})}a(se),a(O);var de=l(O,2),Be=s(de);{var Le=t=>{var n=mt(),o=s(n);a(n),k(()=>{me(n,`color: ${e(ee).color??""};`),g(o,`${e(ee).emoji??""} ${e(ee).label??""}`)}),c(t,n)};m(Be,t=>{e(ee)&&t(Le)})}var ne=l(Be,2);ne.__click=()=>r.onStatusChange?.(r.batch.status);var i=s(ne);{var d=t=>{var n=pt();c(t,n)};m(i,t=>{r.batch.status==="fermenting"&&t(d)})}var b=l(i);a(ne),a(de),a(q);var p=l(q,2),_=s(p),u=s(_),S=s(u),G=l(S),ue=s(G,!0);a(G),a(u);var ie=l(u,2),H=s(ie,!0);a(ie),a(_);var L=l(_,2);{var J=t=>{var n=ft(),o=s(n),M=s(o),j=l(M),Me=s(j,!0);a(j);var _e=l(j,2),Fe=s(_e,!0);a(_e),a(o),pe(2),a(n),k(Pe=>{me(o,`color: ${e(F).color??""};`),g(M,`${Pe??""} `),g(Me,e(Te)),g(Fe,e(F).icon)},[()=>je(r.progress.temperature.current)]),c(t,n)};m(L,t=>{r.progress?.temperature?.current!=null&&t(J)})}var h=l(L,2);{var K=t=>{var n=ht(),o=s(n),M=s(o);pe(),a(o),pe(2),a(n),k(j=>g(M,`${j??""} `),[()=>r.progress.progress.percent_complete.toFixed(0)]),c(t,n)};m(h,t=>{r.progress?.progress?.percent_complete!==void 0&&r.progress.progress.percent_complete!==null&&t(K)})}a(p);var D=l(p,2);{var N=t=>{var n=bt(),o=s(n);pe(2),a(n),k(()=>me(o,`width: ${r.progress?.progress?.percent_complete??0??""}%;`)),c(t,n)};m(D,t=>{(r.batch.status==="fermenting"||r.batch.status==="conditioning")&&t(N)})}var U=l(D,2),le=s(U);{var W=t=>{var n=yt(),o=fe(n),M=l(s(o),2),j=s(M);a(M),a(o);var Me=l(o,2),_e=l(s(Me),2),Fe=s(_e);a(_e),a(Me),k((Pe,Je)=>{g(j,`${Pe??""}%`),g(Fe,`${Je??""}%`)},[()=>r.progress.measured.abv?.toFixed(1)??"--",()=>r.progress.measured.attenuation?.toFixed(0)??"--"]),c(t,n)};m(le,t=>{r.batch.measured_og&&r.progress?.measured?.current_sg&&t(W)})}var w=l(le,2);{var x=t=>{var n=wt(),o=l(s(n),2),M=s(o,!0);a(o),a(n),k(j=>g(M,j),[()=>P(r.progress.targets.fg)]),c(t,n)};m(w,t=>{r.progress?.targets?.fg&&t(x)})}var V=l(w,2),E=l(s(V),2),Ue=s(E,!0);a(E),a(V),a(U);var B=l(U,2),T=s(B),Ve=s(T,!0);a(T);var Ce=l(T,2),De=s(Ce);{var I=t=>{var n=kt();n.__click=function(...o){r.onViewDetails?.apply(this,o)},c(t,n)};m(De,t=>{r.onViewDetails&&t(I)})}var ge=l(De,2);{var Ye=t=>{var n=xt();n.__click=function(...j){r.onToggleExpand?.apply(this,j)};var o=s(n);let M;a(n),k(()=>{tt(n,"aria-label",Z()?"Collapse":"Expand"),M=ce(o,0,"expand-icon svelte-6cd32a",null,M,{"rotate-180":Z()})}),c(t,n)};m(ge,t=>{r.onToggleExpand&&t(Ye)})}a(Ce),a(B),a(be),a(Q),k((t,n)=>{he=ce(Q,1,"batch-card svelte-6cd32a",null,he,{expanded:Z(),fermenting:r.batch.status==="fermenting","has-anomaly":e(oe)}),me(ae,`background: ${(e(oe)?"var(--recipe-accent)":e(f).color)??""};`),g(ye,`#${(r.batch.batch_number||"?")??""}`),g(we,e(ve)),me(ne,`color: ${e(f).color??""}; background: ${e(f).bg??""};`),g(b,` ${e(f).label??""}`),g(S,`${t??""} `),g(ue,e(R)!=="SG"?e(R):""),g(H,r.progress?.measured?.current_sg?"Current":"OG"),g(Ue,e(te)),g(Ve,n)},[()=>P(r.progress?.measured?.current_sg??r.batch.measured_og),()=>Re(r.batch.brew_date)]),c(Se,Q),Oe()}Qe(["click"]);var Dt=v('<div><span> </span> <button type="button" class="notification-close svelte-40gn7n">√ó</button></div>'),Mt=v('<div class="loading-state svelte-40gn7n"><div class="spinner svelte-40gn7n"></div> <span>Loading batches...</span></div>'),St=v('<div class="error-state svelte-40gn7n"><span class="error-icon svelte-40gn7n">!</span> <p> </p> <button type="button" class="retry-btn svelte-40gn7n">Retry</button></div>'),Tt=v('<button type="button" class="create-btn svelte-40gn7n">Create Batch</button>'),jt=v('<div class="empty-icon svelte-40gn7n">üç∫</div> <h3 class="svelte-40gn7n"> </h3> <p class="svelte-40gn7n"><!></p> <!>',1),At=v('<div class="empty-icon svelte-40gn7n">üîç</div> <h3 class="svelte-40gn7n">No matches</h3> <p class="svelte-40gn7n">Try adjusting your search query</p>',1),Rt=v('<div class="empty-state svelte-40gn7n"><!></div>'),Lt=v('<div class="deleted-badge svelte-40gn7n"><svg class="badge-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg> </div>'),Ut=v('<div class="batch-actions svelte-40gn7n"><button type="button" class="action-restore svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Restore</button> <button type="button" class="action-delete svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg> Permanent Delete</button></div>'),Vt=v('<div class="batch-wrapper svelte-40gn7n"><!> <!> <!></div>'),Ft=v('<div class="batches-grid svelte-40gn7n"></div>'),Pt=v('<div class="page-container svelte-40gn7n"><!> <div class="page-header svelte-40gn7n"><div class="header-content svelte-40gn7n"><h1 class="page-title svelte-40gn7n">Batches</h1> <p class="page-description svelte-40gn7n">Track your fermentation batches</p></div> <button type="button" class="create-btn svelte-40gn7n"><svg class="btn-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> New Batch</button></div> <div class="tabs-container svelte-40gn7n"><div class="tabs svelte-40gn7n"><button type="button">Active</button> <button type="button">Completed</button> <button type="button">Deleted</button></div> <div class="search-box svelte-40gn7n"><svg class="search-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search batches..." class="search-input svelte-40gn7n"/></div></div> <!></div>');function Zt(Se,r){qe(r,!0);let A=X(Ee([])),Z=X(Ee(new Map)),$=X(!0),z=X(null),f=X("active"),F=X(""),R=X(null),Te=C(()=>new Map(e(A).filter(i=>i.device_id&&(i.status==="fermenting"||i.status==="conditioning")).map(i=>[i.device_id,i.id]))),ee=C(()=>{const i=new Map(e(Z));for(const[d,b]of e(Te)){const p=ze.tilts.get(d);if(p){const _=i.get(b)||{batch_id:b,status:"fermenting",measured:{},temperature:{status:"unknown"},progress:{},targets:{}};i.set(b,{..._,measured:{..._.measured,current_sg:p.sg},temperature:{..._.temperature,current:p.temp,status:_.temperature.yeast_min!==void 0&&_.temperature.yeast_max!==void 0?p.temp<_.temperature.yeast_min?"too_cold":p.temp>_.temperature.yeast_max?"too_hot":"in_range":_.temperature.status}})}}return i}),oe=C(()=>e(A).filter(i=>!e(F)||(i.name?.toLowerCase().includes(e(F).toLowerCase())??!1)||(i.recipe?.name?.toLowerCase().includes(e(F).toLowerCase())??!1)));async function P(){y($,!0),y(z,null);try{switch(e(f)){case"active":y(A,await it(),!0);break;case"completed":y(A,await nt(),!0);break;case"deleted":y(A,await rt(),!0);break}const i=["fermenting","conditioning"],b=e(A).filter(u=>i.includes(u.status)).map(async u=>{try{const S=await lt(u.id);return[u.id,S]}catch{return null}}),p=await Promise.all(b),_=new Map;for(const u of p)u&&_.set(u[0],u[1]);y(Z,_,!0)}catch(i){y(z,i instanceof Error?i.message:"Failed to load batches",!0)}finally{y($,!1)}}function je(i){Ne(`/batches/${i}`)}async function Ae(i,d){const b=e(f)==="deleted",p=b?"This will permanently delete this batch. This cannot be undone. Are you sure?":`Soft delete "${d}"? You can restore it later from the Deleted tab.`;if(confirm(p))try{await ot(i,b),te("Batch deleted successfully","success"),await P()}catch{te("Failed to delete batch","error")}}async function Re(i,d){try{await ct(i),te(`"${d}" restored successfully`,"success"),await P()}catch{te("Failed to restore batch","error")}}function te(i,d){y(R,{message:i,type:d},!0),setTimeout(()=>{y(R,null)},3e3)}Ke(()=>{P()}),We(()=>{e(f)!==void 0&&P()});var ve=Pt();et("40gn7n",i=>{Xe(()=>{Ze.title="Batches | BrewSignal"})});var Q=s(ve);{var he=i=>{var d=Dt();let b;var p=s(d),_=s(p,!0);a(p);var u=l(p,2);u.__click=()=>y(R,null),a(d),k(()=>{b=ce(d,1,"notification svelte-40gn7n",null,b,{success:e(R).type==="success",error:e(R).type==="error"}),g(_,e(R).message)}),c(i,d)};m(Q,i=>{e(R)&&i(he)})}var ae=l(Q,2),be=l(s(ae),2);be.__click=()=>Ne("/batches/new"),a(ae);var q=l(ae,2),O=s(q),Y=s(O);let ye;Y.__click=()=>y(f,"active");var se=l(Y,2);let re;se.__click=()=>y(f,"completed");var we=l(se,2);let ke;we.__click=()=>y(f,"deleted"),a(O);var xe=l(O,2),de=l(s(xe),2);at(de),a(xe),a(q);var Be=l(q,2);{var Le=i=>{var d=Mt();c(i,d)},ne=i=>{var d=Ge(),b=fe(d);{var p=u=>{var S=St(),G=l(s(S),2),ue=s(G,!0);a(G);var ie=l(G,2);ie.__click=P,a(S),k(()=>g(ue,e(z))),c(u,S)},_=u=>{var S=Ge(),G=fe(S);{var ue=H=>{var L=Rt(),J=s(L);{var h=D=>{var N=jt(),U=l(fe(N),2),le=s(U);a(U);var W=l(U,2),w=s(W);{var x=B=>{var T=He("Create your first batch to start tracking fermentation");c(B,T)},V=B=>{var T=Ge(),Ve=fe(T);{var Ce=I=>{var ge=He("Complete a batch to see it here");c(I,ge)},De=I=>{var ge=He("Deleted batches will appear here");c(I,ge)};m(Ve,I=>{e(f)==="completed"?I(Ce):I(De,!1)},!0)}c(B,T)};m(w,B=>{e(f)==="active"?B(x):B(V,!1)})}a(W);var E=l(W,2);{var Ue=B=>{var T=Tt();T.__click=()=>Ne("/batches/new"),c(B,T)};m(E,B=>{e(f)==="active"&&B(Ue)})}k(()=>g(le,`No ${e(f)??""} batches yet`)),c(D,N)},K=D=>{var N=At();pe(4),c(D,N)};m(J,D=>{e(A).length===0?D(h):D(K,!1)})}a(L),c(H,L)},ie=H=>{var L=Ft();$e(L,21,()=>e(oe),J=>J.id,(J,h)=>{var K=Vt(),D=s(K);{var N=w=>{var x=Lt(),V=l(s(x));a(x),k(E=>g(V,` Deleted ${E??""}`),[()=>new Date(e(h).deleted_at).toLocaleDateString()]),c(w,x)};m(D,w=>{e(h).deleted_at&&w(N)})}var U=l(D,2);{let w=C(()=>e(ee).get(e(h).id)),x=C(()=>e(h).device_id?ze.tilts.get(e(h).device_id):null);Ct(U,{get batch(){return e(h)},get progress(){return e(w)},get liveReading(){return e(x)},onViewDetails:()=>je(e(h).id)})}var le=l(U,2);{var W=w=>{var x=Ut(),V=s(x);V.__click=()=>Re(e(h).id,e(h).name||e(h).recipe?.name||"Unnamed Batch");var E=l(V,2);E.__click=()=>Ae(e(h).id,e(h).name||e(h).recipe?.name||"Unnamed Batch"),a(x),c(w,x)};m(le,w=>{e(h).deleted_at&&w(W)})}a(K),c(J,K)}),a(L),c(H,L)};m(G,H=>{e(oe).length===0?H(ue):H(ie,!1)},!0)}c(u,S)};m(b,u=>{e(z)?u(p):u(_,!1)},!0)}c(i,d)};m(Be,i=>{e($)?i(Le):i(ne,!1)})}a(ve),k(()=>{ye=ce(Y,1,"tab svelte-40gn7n",null,ye,{active:e(f)==="active"}),re=ce(se,1,"tab svelte-40gn7n",null,re,{active:e(f)==="completed"}),ke=ce(we,1,"tab svelte-40gn7n",null,ke,{active:e(f)==="deleted"})}),st(de,()=>e(F),i=>y(F,i)),c(Se,ve),Oe()}Qe(["click"]);export{Zt as component};
