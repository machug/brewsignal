import{c as fe,a as v,f as o,s as _,d as Oe,t as Ge}from"../chunks/BPY3LF1i.js";import{a as He,f as ve,g as Ne,d as r,e as i,r as s,t as y,h as e,u as j,n as Be,s as ge,p as Ee,o as Ye,az as Je,c as C,A as Ke,ax as We}from"../chunks/WzhiZOZ9.js";import{e as Xe}from"../chunks/DnC7am1E.js";import{i as d}from"../chunks/DTo_ih-i.js";import{h as Ze}from"../chunks/BJzfFUzm.js";import{s as $e,r as et}from"../chunks/D5Ox4mlS.js";import{s as O}from"../chunks/BYYdgBsh.js";import{b as tt}from"../chunks/Cw-VE3R0.js";import{g as Pe}from"../chunks/C_xudilQ.js";import{$ as at,a0 as st,a1 as rt,S as nt,a2 as it,a3 as lt}from"../chunks/BKVJalqB.js";import{s as oe}from"../chunks/6KfV5OBv.js";import{p as Ce}from"../chunks/AVMQxM7Q.js";import{b as vt,d as ot,e as ct,g as dt}from"../chunks/Bg9PSRz2.js";import{s as je}from"../chunks/BuoPMR_v.js";import{t as Ie}from"../chunks/DGrXzhna.js";var ut=o('<span class="status-dot svelte-12nqn7t"></span>'),_t=o("<span><!> </span>"),gt=o('<span class="status-dot svelte-12nqn7t"></span>'),mt=o("<span><!> </span>"),ft=o("<span></span>"),pt=o('<span class="status-dot svelte-12nqn7t"></span>'),ht=o("<span><!> </span>");function bt(pe,a){He(a,!0);let D=Ce(a,"variant",3,"badge"),Q=Ce(a,"size",3,"md"),H=Ce(a,"showDot",3,!1),B=j(()=>je[a.status]||je.planning);var g=fe(),N=ve(g);{var F=z=>{var M=_t(),V=r(M);{var ce=S=>{var w=ut();v(S,w)};d(V,S=>{(H()||a.status==="fermenting")&&S(ce)})}var de=i(V);s(M),y(()=>{O(M,1,`status-badge status-${a.status??""} size-${Q()??""}`,"svelte-12nqn7t"),oe(M,`--status-color: ${e(B).color??""}; --status-bg: ${e(B).bg??""};`),_(de,` ${e(B).label??""}`)}),v(z,M)},ae=z=>{var M=fe(),V=ve(M);{var ce=S=>{var w=mt(),A=r(w);{var Y=x=>{var k=gt();v(x,k)};d(A,x=>{(H()||a.status==="fermenting")&&x(Y)})}var se=i(A);s(w),y(()=>{O(w,1,`status-pill status-${a.status??""} size-${Q()??""}`,"svelte-12nqn7t"),oe(w,`--status-color: ${e(B).color??""};`),_(se,` ${e(B).label??""}`)}),v(S,w)},de=S=>{var w=fe(),A=ve(w);{var Y=x=>{var k=ft();y(()=>{O(k,1,`status-dot-only status-${a.status??""}`,"svelte-12nqn7t"),oe(k,`--status-color: ${e(B).color??""};`)}),v(x,k)},se=x=>{var k=ht(),E=r(k);{var J=K=>{var W=pt();v(K,W)};d(E,K=>{(H()||a.status==="fermenting")&&K(J)})}var ue=i(E);s(k),y(()=>{O(k,1,`status-text status-${a.status??""}`,"svelte-12nqn7t"),oe(k,`--status-color: ${e(B).color??""};`),_(ue,` ${e(B).label??""}`)}),v(x,k)};d(A,x=>{D()==="dot"?x(Y):x(se,!1)},!0)}v(S,w)};d(V,S=>{D()==="pill"?S(ce):S(de,!1)},!0)}v(z,M)};d(N,z=>{D()==="badge"?z(F):z(ae,!1)})}v(pe,g),Ne()}var yt=o('<span class="recipe-name svelte-6cd32a"> </span>'),wt=o('<span class="activity-badge svelte-6cd32a"> </span>'),xt=o('<div class="metric svelte-6cd32a"><div class="metric-value temp svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span> <span class="temp-indicator svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a">Temp</div></div>'),kt=o('<div class="metric svelte-6cd32a"><div class="metric-value progress-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a">%</span></div> <div class="metric-label svelte-6cd32a">Progress</div></div>'),Bt=o('<div class="progress-bar-container svelte-6cd32a"><div class="progress-bar svelte-6cd32a"></div> <div class="progress-markers svelte-6cd32a"><span>0%</span> <span>50%</span> <span>100%</span></div></div>'),Ct=o('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">ABV</span> <span class="stat-value svelte-6cd32a"> </span></div> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Atten</span> <span class="stat-value svelte-6cd32a"> </span></div>',1),Dt=o('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Target FG</span> <span class="stat-value svelte-6cd32a"> </span></div>'),Mt=o('<button type="button" class="action-btn svelte-6cd32a">View <svg class="action-icon svelte-6cd32a" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button>'),St=o('<button type="button" class="expand-btn svelte-6cd32a"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),Tt=o('<div><div class="accent-stripe svelte-6cd32a"></div> <div class="card-content svelte-6cd32a"><div class="header svelte-6cd32a"><div class="header-left svelte-6cd32a"><div class="batch-number svelte-6cd32a"> </div> <div class="title-group svelte-6cd32a"><h3 class="batch-name svelte-6cd32a"> </h3> <!></div></div> <div class="header-right svelte-6cd32a"><!> <button type="button" class="status-btn svelte-6cd32a"><!></button></div></div> <div class="metrics-row svelte-6cd32a"><div class="metric svelte-6cd32a"><div class="metric-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a"> </div></div> <!> <!></div> <!> <div class="stats-row svelte-6cd32a"><!> <!> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Brewed</span> <span class="stat-value svelte-6cd32a"> </span></div></div> <div class="footer svelte-6cd32a"><span class="brew-date svelte-6cd32a"> </span> <div class="footer-actions svelte-6cd32a"><!> <!></div></div></div></div>');function jt(pe,a){He(a,!0);let D=Ce(a,"liveReading",3,null),Q=Ce(a,"expanded",3,!1);const H={in_range:{icon:"‚úì",color:"var(--positive)"},too_cold:{icon:"‚Üì",color:"var(--accent)"},too_hot:{icon:"‚Üë",color:"var(--negative)"},unknown:{icon:"?",color:"var(--text-muted)"}};let B=j(()=>je[a.batch.status]||je.planning),g=j(()=>a.progress?.temperature?.status?H[a.progress.temperature.status]:H.unknown),N=j(vt),F=j(dt),ae=j(()=>{if(a.batch.status!=="fermenting"&&a.batch.status!=="conditioning")return null;const t=D()?.sg_rate;if(t==null)return null;const n=Math.abs(t);return n>.002?{label:"Very Active",color:"var(--activity-very-active)",emoji:"üî•"}:n>5e-4?{label:"Active",color:"var(--activity-active)",emoji:"‚ú®"}:n>1e-4?{label:"Slowing",color:"var(--activity-slowing)",emoji:"üê¢"}:{label:"Complete",color:"var(--activity-complete)",emoji:"‚úì"}}),z=j(()=>D()?.is_anomaly??!1);function M(t){return t==null?"--":ot(t)}function V(t){return t==null?"--":ct(t)}function ce(){if(!a.batch.brew_date)return"--";const t=new Date(a.batch.brew_date),c=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));return c===0?"Today":c===1?"1 day":`${c} days`}function de(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}let S=j(ce),w=j(()=>a.batch.name||a.batch.recipe?.name||"Unnamed Batch");var A=Tt();let Y;var se=r(A),x=i(se,2),k=r(x),E=r(k),J=r(E),ue=r(J);s(J);var K=i(J,2),W=r(K),De=r(W,!0);s(W);var Me=i(W,2);{var Se=t=>{var n=yt(),c=r(n,!0);s(n),y(()=>_(c,a.batch.recipe.name)),v(t,n)};d(Me,t=>{a.batch.recipe?.name&&a.batch.name&&a.batch.name!==a.batch.recipe.name&&t(Se)})}s(K),s(E);var he=i(E,2),be=r(he);{var Ae=t=>{var n=wt(),c=r(n);s(n),y(()=>{oe(n,`color: ${e(ae).color??""};`),_(c,`${e(ae).emoji??""} ${e(ae).label??""}`)}),v(t,n)};d(be,t=>{e(ae)&&t(Ae)})}var ye=i(be,2);ye.__click=()=>a.onStatusChange?.(a.batch.status);var Le=r(ye);bt(Le,{get status(){return a.batch.status},variant:"badge"}),s(ye),s(he),s(k);var l=i(k,2),u=r(l),p=r(u),h=r(p),m=i(h),f=r(m,!0);s(m),s(p);var G=i(p,2),_e=r(G,!0);s(G),s(u);var me=i(u,2);{var we=t=>{var n=xt(),c=r(n),U=r(c),P=i(U),Te=r(P,!0);s(P);var ke=i(P,2),Fe=r(ke,!0);s(ke),s(c),Be(2),s(n),y(ze=>{oe(c,`color: ${e(g).color??""};`),_(U,`${ze??""} `),_(Te,e(F)),_(Fe,e(g).icon)},[()=>V(a.progress.temperature.current)]),v(t,n)};d(me,t=>{a.progress?.temperature?.current!=null&&t(we)})}var re=i(me,2);{var X=t=>{var n=kt(),c=r(n),U=r(c);Be(),s(c),Be(2),s(n),y(P=>_(U,`${P??""} `),[()=>a.progress.progress.percent_complete.toFixed(0)]),v(t,n)};d(re,t=>{a.progress?.progress?.percent_complete!==void 0&&a.progress.progress.percent_complete!==null&&t(X)})}s(l);var ne=i(l,2);{var b=t=>{var n=Bt(),c=r(n);Be(2),s(n),y(()=>oe(c,`width: ${a.progress?.progress?.percent_complete??0??""}%;`)),v(t,n)};d(ne,t=>{(a.batch.status==="fermenting"||a.batch.status==="conditioning")&&t(b)})}var Z=i(ne,2),q=r(Z);{var ie=t=>{var n=Ct(),c=ve(n),U=i(r(c),2),P=r(U);s(U),s(c);var Te=i(c,2),ke=i(r(Te),2),Fe=r(ke);s(ke),s(Te),y((ze,Qe)=>{_(P,`${ze??""}%`),_(Fe,`${Qe??""}%`)},[()=>a.progress.measured.abv?.toFixed(1)??"--",()=>a.progress.measured.attenuation?.toFixed(0)??"--"]),v(t,n)};d(q,t=>{a.batch.measured_og&&a.progress?.measured?.current_sg&&t(ie)})}var $=i(q,2);{var xe=t=>{var n=Dt(),c=i(r(n),2),U=r(c,!0);s(c),s(n),y(P=>_(U,P),[()=>M(a.progress.targets.fg)]),v(t,n)};d($,t=>{a.progress?.targets?.fg&&t(xe)})}var le=i($,2),T=i(r(le),2),L=r(T,!0);s(T),s(le),s(Z);var ee=i(Z,2),te=r(ee),Re=r(te,!0);s(te);var R=i(te,2),I=r(R);{var Ve=t=>{var n=Mt();n.__click=function(...c){a.onViewDetails?.apply(this,c)},v(t,n)};d(I,t=>{a.onViewDetails&&t(Ve)})}var qe=i(I,2);{var Ue=t=>{var n=St();n.__click=function(...P){a.onToggleExpand?.apply(this,P)};var c=r(n);let U;s(n),y(()=>{$e(n,"aria-label",Q()?"Collapse":"Expand"),U=O(c,0,"expand-icon svelte-6cd32a",null,U,{"rotate-180":Q()})}),v(t,n)};d(qe,t=>{a.onToggleExpand&&t(Ue)})}s(R),s(ee),s(x),s(A),y((t,n)=>{Y=O(A,1,"batch-card svelte-6cd32a",null,Y,{expanded:Q(),fermenting:a.batch.status==="fermenting","has-anomaly":e(z)}),oe(se,`background: ${(e(z)?"var(--recipe-accent)":e(B).color)??""};`),_(ue,`#${(a.batch.batch_number||"?")??""}`),_(De,e(w)),_(h,`${t??""} `),_(f,e(N)!=="SG"?e(N):""),_(_e,a.progress?.measured?.current_sg?"Current":"OG"),_(L,e(S)),_(Re,n)},[()=>M(a.progress?.measured?.current_sg??a.batch.measured_og),()=>de(a.batch.brew_date)]),v(pe,A),Ne()}Oe(["click"]);var At=o('<div><span> </span> <button type="button" class="notification-close svelte-40gn7n">√ó</button></div>'),Lt=o('<div class="loading-state svelte-40gn7n"><div class="spinner svelte-40gn7n"></div> <span>Loading batches...</span></div>'),Rt=o('<div class="error-state svelte-40gn7n"><span class="error-icon svelte-40gn7n">!</span> <p> </p> <button type="button" class="retry-btn svelte-40gn7n">Retry</button></div>'),Vt=o('<button type="button" class="create-btn svelte-40gn7n">Create Batch</button>'),qt=o('<div class="empty-icon svelte-40gn7n">üç∫</div> <h3 class="svelte-40gn7n"> </h3> <p class="svelte-40gn7n"><!></p> <!>',1),Ut=o('<div class="empty-icon svelte-40gn7n">üîç</div> <h3 class="svelte-40gn7n">No matches</h3> <p class="svelte-40gn7n">Try adjusting your search query</p>',1),Ft=o('<div class="empty-state svelte-40gn7n"><!></div>'),zt=o('<div class="deleted-badge svelte-40gn7n"><svg class="badge-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg> </div>'),Gt=o('<div class="batch-actions svelte-40gn7n"><button type="button" class="action-restore svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Restore</button> <button type="button" class="action-delete svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg> Permanent Delete</button></div>'),Pt=o('<div class="batch-wrapper svelte-40gn7n"><!> <!> <!></div>'),Ht=o('<div class="batches-grid svelte-40gn7n"></div>'),Nt=o('<div class="page-container svelte-40gn7n"><!> <div class="page-header svelte-40gn7n"><div class="header-content svelte-40gn7n"><h1 class="page-title svelte-40gn7n">Batches</h1> <p class="page-description svelte-40gn7n">Track your fermentation batches</p></div> <button type="button" class="create-btn svelte-40gn7n"><svg class="btn-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> New Batch</button></div> <div class="tabs-container svelte-40gn7n"><div class="tabs svelte-40gn7n"><button type="button">Active</button> <button type="button">Completed</button> <button type="button">Deleted</button></div> <div class="search-box svelte-40gn7n"><svg class="search-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search batches..." class="search-input svelte-40gn7n"/></div></div> <!></div>');function ra(pe,a){He(a,!0);let D=ge(Ee([])),Q=ge(Ee(new Map)),H=ge(!0),B=ge(null),g=ge("active"),N=ge(""),F=ge(null),ae=j(()=>new Map(e(D).filter(l=>l.device_id&&(l.status==="fermenting"||l.status==="conditioning")).map(l=>[l.device_id,l.id]))),z=j(()=>{const l=new Map(e(Q));for(const[u,p]of e(ae)){const h=Ie.tilts.get(u);if(h){const m=l.get(p)||{batch_id:p,status:"fermenting",measured:{},temperature:{status:"unknown"},progress:{},targets:{}};l.set(p,{...m,measured:{...m.measured,current_sg:h.sg},temperature:{...m.temperature,current:h.temp,status:m.temperature.yeast_min!==void 0&&m.temperature.yeast_max!==void 0?h.temp<m.temperature.yeast_min?"too_cold":h.temp>m.temperature.yeast_max?"too_hot":"in_range":m.temperature.status}})}}return l}),M=j(()=>e(D).filter(l=>!e(N)||(l.name?.toLowerCase().includes(e(N).toLowerCase())??!1)||(l.recipe?.name?.toLowerCase().includes(e(N).toLowerCase())??!1)));async function V(){C(H,!0),C(B,null);try{switch(e(g)){case"active":C(D,await rt(),!0);break;case"completed":C(D,await st(),!0);break;case"deleted":C(D,await at(),!0);break}const l=["fermenting","conditioning"],p=e(D).filter(f=>l.includes(f.status)).map(async f=>{try{const G=await nt(f.id);return[f.id,G]}catch{return null}}),h=await Promise.all(p),m=new Map;for(const f of h)f&&m.set(f[0],f[1]);C(Q,m,!0)}catch(l){C(B,l instanceof Error?l.message:"Failed to load batches",!0)}finally{C(H,!1)}}function ce(l){Pe(`/batches/${l}`)}async function de(l,u){const p=e(g)==="deleted",h=p?"This will permanently delete this batch. This cannot be undone. Are you sure?":`Soft delete "${u}"? You can restore it later from the Deleted tab.`;if(confirm(h))try{await lt(l,p),w("Batch deleted successfully","success"),await V()}catch{w("Failed to delete batch","error")}}async function S(l,u){try{await it(l),w(`"${u}" restored successfully`,"success"),await V()}catch{w("Failed to restore batch","error")}}function w(l,u){C(F,{message:l,type:u},!0),setTimeout(()=>{C(F,null)},3e3)}Ye(()=>{V()}),Je(()=>{e(g)!==void 0&&V()});var A=Nt();Ze("40gn7n",l=>{Ke(()=>{We.title="Batches | BrewSignal"})});var Y=r(A);{var se=l=>{var u=At();let p;var h=r(u),m=r(h,!0);s(h);var f=i(h,2);f.__click=()=>C(F,null),s(u),y(()=>{p=O(u,1,"notification svelte-40gn7n",null,p,{success:e(F).type==="success",error:e(F).type==="error"}),_(m,e(F).message)}),v(l,u)};d(Y,l=>{e(F)&&l(se)})}var x=i(Y,2),k=i(r(x),2);k.__click=()=>Pe("/batches/new"),s(x);var E=i(x,2),J=r(E),ue=r(J);let K;ue.__click=()=>C(g,"active");var W=i(ue,2);let De;W.__click=()=>C(g,"completed");var Me=i(W,2);let Se;Me.__click=()=>C(g,"deleted"),s(J);var he=i(J,2),be=i(r(he),2);et(be),s(he),s(E);var Ae=i(E,2);{var ye=l=>{var u=Lt();v(l,u)},Le=l=>{var u=fe(),p=ve(u);{var h=f=>{var G=Rt(),_e=i(r(G),2),me=r(_e,!0);s(_e);var we=i(_e,2);we.__click=V,s(G),y(()=>_(me,e(B))),v(f,G)},m=f=>{var G=fe(),_e=ve(G);{var me=re=>{var X=Ft(),ne=r(X);{var b=q=>{var ie=qt(),$=i(ve(ie),2),xe=r($);s($);var le=i($,2),T=r(le);{var L=R=>{var I=Ge("Create your first batch to start tracking fermentation");v(R,I)},ee=R=>{var I=fe(),Ve=ve(I);{var qe=t=>{var n=Ge("Complete a batch to see it here");v(t,n)},Ue=t=>{var n=Ge("Deleted batches will appear here");v(t,n)};d(Ve,t=>{e(g)==="completed"?t(qe):t(Ue,!1)},!0)}v(R,I)};d(T,R=>{e(g)==="active"?R(L):R(ee,!1)})}s(le);var te=i(le,2);{var Re=R=>{var I=Vt();I.__click=()=>Pe("/batches/new"),v(R,I)};d(te,R=>{e(g)==="active"&&R(Re)})}y(()=>_(xe,`No ${e(g)??""} batches yet`)),v(q,ie)},Z=q=>{var ie=Ut();Be(4),v(q,ie)};d(ne,q=>{e(D).length===0?q(b):q(Z,!1)})}s(X),v(re,X)},we=re=>{var X=Ht();Xe(X,21,()=>e(M),ne=>ne.id,(ne,b)=>{var Z=Pt(),q=r(Z);{var ie=T=>{var L=zt(),ee=i(r(L));s(L),y(te=>_(ee,` Deleted ${te??""}`),[()=>new Date(e(b).deleted_at).toLocaleDateString()]),v(T,L)};d(q,T=>{e(b).deleted_at&&T(ie)})}var $=i(q,2);{let T=j(()=>e(z).get(e(b).id)),L=j(()=>e(b).device_id?Ie.tilts.get(e(b).device_id):null);jt($,{get batch(){return e(b)},get progress(){return e(T)},get liveReading(){return e(L)},onViewDetails:()=>ce(e(b).id)})}var xe=i($,2);{var le=T=>{var L=Gt(),ee=r(L);ee.__click=()=>S(e(b).id,e(b).name||e(b).recipe?.name||"Unnamed Batch");var te=i(ee,2);te.__click=()=>de(e(b).id,e(b).name||e(b).recipe?.name||"Unnamed Batch"),s(L),v(T,L)};d(xe,T=>{e(b).deleted_at&&T(le)})}s(Z),v(ne,Z)}),s(X),v(re,X)};d(_e,re=>{e(M).length===0?re(me):re(we,!1)},!0)}v(f,G)};d(p,f=>{e(B)?f(h):f(m,!1)},!0)}v(l,u)};d(Ae,l=>{e(H)?l(ye):l(Le,!1)})}s(A),y(()=>{K=O(ue,1,"tab svelte-40gn7n",null,K,{active:e(g)==="active"}),De=O(W,1,"tab svelte-40gn7n",null,De,{active:e(g)==="completed"}),Se=O(Me,1,"tab svelte-40gn7n",null,Se,{active:e(g)==="deleted"})}),tt(be,()=>e(N),l=>C(N,l)),v(pe,A),Ne()}Oe(["click"]);export{ra as component};
