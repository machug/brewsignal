import{d as et,f as n,s as v,a as l,c as be}from"../chunks/BQ88CgEU.js";import{al as a,ak as s,an as t,as as g,ah as qe,ar as V,c as e,ai as E,at as Re,aj as Me,ao as ne,p as kt,ap as zt,s as y,aL as Qt,aF as Xt,am as Zt}from"../chunks/CGXqq0_G.js";import{e as wt,i as Ft}from"../chunks/payu-7ZH.js";import{i as c}from"../chunks/ziKwUJ4R.js";import{h as $t}from"../chunks/BP8qDDK3.js";import{s as Ct}from"../chunks/D2zVhfuI.js";import{s as Ce}from"../chunks/DqcjHxzZ.js";import{s as Ee}from"../chunks/BSw_pJTS.js";import{i as ea,s as ta}from"../chunks/C5J5lxM1.js";import{s as aa,a as sa}from"../chunks/C-ohbqfQ.js";import{p as ra}from"../chunks/BCOQjbog.js";import{g as ia}from"../chunks/Ujy8sZJO.js";import{x as la,o as va,g as jt,y as Ne,h as na,v as yt,z as Ze}from"../chunks/CIWF638Y.js";import{b as oa,g as Bt,d as Ie,e as Tt,c as xt}from"../chunks/Dq6yox8V.js";import{t as da}from"../chunks/DThvY6M2.js";import{B as ca}from"../chunks/BqrUd5ku.js";import{s as ua}from"../chunks/CUQuFe4_.js";import{p as $e}from"../chunks/B3wItnqC.js";const _a=!1,Us=Object.freeze(Object.defineProperty({__proto__:null,prerender:_a},Symbol.toStringTag,{value:"Module"}));function ga(U){return U>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:U>=-60?{bars:3,color:"var(--positive)",label:"Good"}:U>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function St(U){const i=Math.floor((Date.now()-new Date(U).getTime())/1e3);if(i<10)return"just now";if(i<60)return`${i}s ago`;const u=Math.floor(i/60);if(u<60)return`${u}m ago`;const D=Math.floor(u/60);return D<24?`${D}h ago`:`${Math.floor(D/24)}d ago`}var fa=n('<div class="accent-bar svelte-1oyrwd9"></div>'),ma=n('<span class="card-icon svelte-1oyrwd9"> </span>'),pa=n('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ba=n('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function Ge(U,i){let u=$e(i,"highlight",3,!1),D=$e(i,"collapsible",3,!1),m=$e(i,"expanded",3,!1);var S=ba();let p;var r=a(S);{var R=w=>{var F=fa();l(w,F)};c(r,w=>{u()&&w(R)})}var d=s(r,2),T=a(d),_=a(T);{var q=w=>{var F=ma(),N=a(F,!0);t(F),g(()=>v(N,i.icon)),l(w,F)};c(_,w=>{i.icon&&w(q)})}var f=s(_,2),h=a(f,!0);t(f),t(T);var C=s(T,2);{var x=w=>{var F=pa();F.__click=function(...P){i.onToggle?.apply(this,P)};var N=a(F);let O;t(F),g(()=>{Ct(F,"aria-label",m()?"Collapse":"Expand"),O=Ce(N,0,"expand-icon svelte-1oyrwd9",null,O,{"rotate-180":m()})}),l(w,F)};c(C,w=>{D()&&i.onToggle&&w(x)})}t(d);var k=s(d,2);let b;var B=a(k);ua(B,()=>i.children),t(k),t(S),g(()=>{p=Ce(S,1,"batch-card svelte-1oyrwd9",null,p,{highlight:u()}),v(h,i.title),b=Ce(k,1,"card-content svelte-1oyrwd9",null,b,{collapsed:D()&&!m()})}),l(U,S)}et(["click"]);var ha=n('<span class="unit svelte-lzskfi"> </span>'),ja=n('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),ya=n('<div class="last-seen svelte-lzskfi"> </div>'),xa=n('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function ka(U,i){qe(i,!0);let u=E(()=>i.liveReading?.sg??i.currentSg),D=E(()=>i.liveReading?.temp??i.currentTemp),m=E(()=>i.liveReading?.sg_raw),S=E(()=>i.liveReading?.temp_raw),p=E(()=>i.liveReading?.last_seen),r=E(()=>i.liveReading&&(i.liveReading.sg!==i.liveReading.sg_raw||i.liveReading.temp!==i.liveReading.temp_raw)),R=E(oa),d=E(Bt);function T(f){return f==null?"--":Ie(f)}function _(f){return f==null?"--":Tt(f)}let q=E(()=>e(p)?St(e(p)):null);Ge(U,{title:"Live Readings",highlight:!0,children:(f,h)=>{var C=xa(),x=s(V(C),2),k=a(x),b=a(k),B=a(b),w=s(B);{var F=j=>{var z=ha(),A=a(z,!0);t(z),g(()=>v(A,e(R))),l(j,z)};c(w,j=>{e(R)!=="SG"&&j(F)})}t(b);var N=s(b,2),O=a(N,!0);t(N),t(k);var P=s(k,2),Y=a(P),K=a(Y),ae=s(K),Q=a(ae,!0);t(ae),t(Y),Re(2),t(P),t(x);var re=s(x,2);{var ee=j=>{var z=ja(),A=s(a(z),2),de=a(A,!0);t(A);var ue=s(A,4),X=a(ue);t(ue),t(z),g((I,o)=>{v(de,I),v(X,`${o??""}${e(d)??""}`)},[()=>T(e(m)),()=>_(e(S))]),l(j,z)};c(re,j=>{e(r)&&j(ee)})}var oe=s(re,2);{var G=j=>{var z=ya(),A=a(z);t(z),g(()=>v(A,`Updated ${e(q)??""}`)),l(j,z)};c(oe,j=>{e(q)&&j(G)})}g((j,z)=>{v(B,`${j??""} `),v(O,e(R)==="SG"?"Gravity":e(R)==="¬∞P"?"Plato":"Brix"),v(K,`${z??""} `),v(Q,e(d))},[()=>T(e(u)),()=>_(e(D))]),l(f,C)},$$slots:{default:!0}}),Me()}var za=n('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),wa=n('<div class="progress-remaining svelte-t80j9z"> </div>'),Fa=n('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),Ca=n('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),Ba=n('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),Ta=n('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Sa(U,i){qe(i,!0);let u=E(()=>{if(!i.batch.measured_og)return null;const p=i.currentSg??i.progress?.measured?.current_sg;if(!p)return null;const r=(i.batch.measured_og-p)*131.25,R=i.batch.measured_og-1,d=R!==0?(i.batch.measured_og-p)/R*100:0;return{currentSg:p,abv:Math.max(0,r),attenuation:Math.max(0,Math.min(100,d)),isFermenting:i.batch.status==="fermenting"||i.batch.status==="conditioning"}}),D=E(()=>e(u)?.isFermenting??!1);function m(p){return p==null?"--":Ie(p)}function S(p){return p==null?"--":`${p.toFixed(1)}%`}{let p=E(()=>e(D)?"Fermentation Progress":"Fermentation Measurements");Ge(U,{get title(){return e(p)},children:(r,R)=>{var d=be(),T=V(d);{var _=f=>{var h=Ca(),C=V(h),x=s(a(C),2),k=a(x);Re(),t(x),t(C);var b=s(C,2),B=s(a(b),2),w=s(a(B),4),F=a(w,!0);t(w),t(B);var N=s(B,2);{var O=X=>{var I=za(),o=s(a(I),4),L=a(o,!0);t(o),t(I),g(H=>v(L,H),[()=>m(i.batch.recipe.fg_target)]),l(X,I)};c(N,X=>{i.batch.recipe?.fg_target&&X(O)})}var P=s(N,2),Y=s(a(P),4),K=a(Y,!0);t(Y),t(P),t(b);var ae=s(b,2),Q=a(ae),re=s(a(Q),2),ee=s(a(re),2),oe=a(ee);Re(),t(ee),t(re),t(Q);var G=s(Q,2),j=s(a(G),2),z=s(a(j),2),A=a(z);Re(),t(z),t(j),t(G),t(ae);var de=s(ae,2);{var ue=X=>{var I=Fa(),o=a(I),L=s(a(o),2),H=a(L);t(L),t(o);var Z=s(o,2),Ae=s(a(Z),2);Re(2),t(Z);var _e=s(Z,2);{var ce=te=>{var he=wa(),Be=a(he);t(he),g(ke=>v(Be,`${ke??""} gravity points remaining`),[()=>i.progress.progress.sg_remaining.toFixed(3)]),l(te,he)};c(_e,te=>{i.progress.progress.sg_remaining!=null&&te(ce)})}t(I),g(te=>{v(H,`${te??""}%`),Ee(Ae,`width: ${i.progress.progress.percent_complete??""}%`)},[()=>i.progress.progress.percent_complete.toFixed(0)]),l(X,I)};c(de,X=>{i.progress?.progress?.percent_complete!=null&&X(ue)})}g((X,I,o,L,H)=>{v(k,`${X??""} `),v(F,I),v(K,o),v(oe,`${L??""} `),v(A,`${H??""} `)},[()=>m(e(u).currentSg),()=>m(i.batch.measured_og),()=>m(e(u).currentSg),()=>S(e(u).abv),()=>S(e(u).attenuation)]),l(f,h)},q=f=>{var h=be(),C=V(h);{var x=b=>{var B=Ba(),w=a(B),F=s(a(w),2),N=a(F,!0);t(F),t(w);var O=s(w,2),P=s(a(O),2),Y=a(P,!0);t(P),t(O);var K=s(O,2),ae=s(a(K),2),Q=a(ae,!0);t(ae),t(K);var re=s(K,2),ee=s(a(re),2),oe=a(ee,!0);t(ee),t(re),t(B),g((G,j,z,A)=>{v(N,G),v(Y,j),v(Q,z),v(oe,A)},[()=>m(i.batch.measured_og),()=>m(i.batch.measured_fg),()=>i.batch.measured_abv!=null?S(i.batch.measured_abv):"--",()=>i.batch.measured_attenuation!=null?S(i.batch.measured_attenuation):"--"]),l(b,B)},k=b=>{var B=Ta();l(b,B)};c(C,b=>{i.batch.measured_og?b(x):b(k,!1)},!0)}l(f,h)};c(T,f=>{e(u)&&e(D)?f(_):f(q,!1)})}l(r,d)},$$slots:{default:!0}})}Me()}var Ra=n('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function qa(U,i){qe(i,!0);function u(m){return m?new Date(m).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function D(m){return m?new Date(m).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}Ge(U,{title:"Timeline",children:(m,S)=>{var p=Ra(),r=a(p),R=s(a(r),2),d=a(R,!0);t(R),t(r);var T=s(r,2),_=s(a(T),2),q=a(_,!0);t(_),t(T);var f=s(T,2),h=s(a(f),2),C=a(h,!0);t(h),t(f);var x=s(f,2),k=s(a(x),2),b=a(k,!0);t(k),t(x),t(p),g((B,w,F,N)=>{v(d,B),v(q,w),v(C,F),v(b,N)},[()=>u(i.batch.brew_date),()=>D(i.batch.start_time),()=>D(i.batch.end_time),()=>D(i.batch.created_at)]),l(m,p)},$$slots:{default:!0}}),Me()}var Ma=n('<div class="signal-bar svelte-1kdxwtz"></div>'),Da=n('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),La=n('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Oa=n('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Pa=n('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Ga=n('<div class="device-info svelte-1kdxwtz"><!></div>'),Aa=n('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Ea=n('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Ua(U,i){qe(i,!0);let u=E(()=>i.liveReading?.rssi?ga(i.liveReading.rssi):null),D=E(()=>i.liveReading?.last_seen?St(i.liveReading.last_seen):null);Ge(U,{title:"Tracking Device",children:(m,S)=>{var p=be(),r=V(p);{var R=T=>{var _=Ga(),q=a(_);{var f=C=>{var x=Oa(),k=V(x),b=s(a(k));t(k);var B=s(k,2);{var w=O=>{var P=Da(),Y=a(P);wt(Y,20,()=>Array(4),Ft,(Q,re,ee)=>{var oe=Ma();g(()=>Ee(oe,`
										height: ${6+ee*3}px;
										background: ${(ee<e(u).bars?e(u).color:"var(--bg-hover)")??""};
										opacity: ${ee<e(u).bars?1:.4};
									`)),l(Q,oe)}),t(Y);var K=s(Y,2),ae=a(K);t(K),t(P),g(()=>{Ee(K,`color: ${e(u).color??""}`),v(ae,`${e(u).label??""} (${i.liveReading.rssi??""} dBm)`)}),l(O,P)};c(B,O=>{e(u)&&O(w)})}var F=s(B,2);{var N=O=>{var P=La(),Y=a(P);t(P),g(()=>v(Y,`Updated ${e(D)??""}`)),l(O,P)};c(F,O=>{e(D)&&O(N)})}g(()=>v(b,` ${i.liveReading.color??""} Tilt - Connected`)),l(C,x)},h=C=>{var x=Pa(),k=V(x),b=s(a(k));t(k),Re(2),g(()=>v(b,` Device: ${i.batch.device_id??""}`)),l(C,x)};c(q,C=>{i.liveReading?C(f):C(h,!1)})}t(_),l(T,_)},d=T=>{var _=Ea(),q=s(a(_),2);{var f=h=>{var C=Aa();C.__click=function(...x){i.onEdit?.apply(this,x)},l(h,C)};c(q,h=>{i.onEdit&&h(f)})}t(_),l(T,_)};c(r,T=>{i.batch.device_id?T(R):T(d,!1)})}l(m,p)},$$slots:{default:!0}}),Me()}et(["click"]);const Na=131.25;var Ia=n('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Va=n('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Ha(U,i){qe(i,!0);function u(m){return m==null?"--":Ie(m)}let D=E(()=>i.recipe.abv_target!=null?i.recipe.abv_target:i.recipe.og_target&&i.recipe.fg_target?(i.recipe.og_target-i.recipe.fg_target)*Na:null);Ge(U,{title:"Recipe Targets",children:(m,S)=>{var p=Va(),r=a(p),R=s(a(r),2),d=a(R,!0);t(R),t(r);var T=s(r,2),_=s(a(T),2),q=a(_,!0);t(_),t(T);var f=s(T,2),h=s(a(f),2),C=a(h,!0);t(h),t(f);var x=s(f,2);{var k=b=>{var B=Ia(),w=s(a(B),2),F=a(w,!0);t(w),t(B),g(()=>v(F,i.recipe.yeast_name)),l(b,B)};c(x,b=>{i.recipe.yeast_name&&b(k)})}t(p),g((b,B,w)=>{v(d,b),v(q,B),v(C,w)},[()=>u(i.recipe.og_target),()=>u(i.recipe.fg_target),()=>e(D)!=null?`${e(D).toFixed(1)}%`:"--"]),l(m,p)},$$slots:{default:!0}}),Me()}var Wa=n('<p class="notes-content svelte-hkv31i"> </p>');function Ja(U,i){Ge(U,{title:"Notes",children:(u,D)=>{var m=Wa(),S=a(m,!0);t(m),g(()=>v(S,i.notes)),l(u,m)},$$slots:{default:!0}})}var Ya=n('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),Ka=n('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Qa=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Xa=n('<span class="days svelte-1xs394q"> </span>'),Za=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"> <!></span></div>'),$a=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Model Fit (R¬≤):</span> <div class="progress-wrapper svelte-1xs394q"><div class="progress-bar svelte-1xs394q"><div class="fill svelte-1xs394q"></div></div> <span class="percentage svelte-1xs394q"> </span></div></div>'),es=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Readings:</span> <span class="value svelte-1xs394q"> </span></div>'),ts=n('<div class="ml-panel svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">ML Predictions</h3> <div class="metrics svelte-1xs394q"><!> <!> <!> <!></div></div>'),as=n('<div class="ml-panel disabled svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable (insufficient data)</p></div>');function ss(U,i){qe(i,!0);let u=ne(kt({available:!1})),D=ne(!0),m=ne(null);zt(async()=>{try{y(u,await la(i.batchId),!0)}catch(_){y(m,_ instanceof Error?_.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",_)}finally{y(D,!1)}});function S(_){return _?new Date(_).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function p(_){if(!_)return null;const q=new Date(_),f=new Date,h=q.getTime()-f.getTime();return Math.ceil(h/(1e3*60*60*24))}var r=be(),R=V(r);{var d=_=>{var q=Ya();l(_,q)},T=_=>{var q=be(),f=V(q);{var h=x=>{var k=Ka(),b=a(k),B=a(b);t(b),t(k),g(()=>v(B,`‚ö†Ô∏è ${e(m)??""}`)),l(x,k)},C=x=>{var k=be(),b=V(k);{var B=F=>{var N=ts(),O=s(a(N),2),P=a(O);{var Y=G=>{var j=Qa(),z=s(a(j),2),A=a(z,!0);t(z),t(j),g(de=>v(A,de),[()=>Ie(e(u).predicted_fg)]),l(G,j)};c(P,G=>{e(u).predicted_fg&&G(Y)})}var K=s(P,2);{var ae=G=>{const j=E(()=>p(e(u).estimated_completion));var z=Za(),A=s(a(z),2),de=a(A),ue=s(de);{var X=I=>{var o=Xa(),L=a(o);t(o),g(()=>v(L,`(${e(j)??""} ${e(j)===1?"day":"days"})`)),l(I,o)};c(ue,I=>{e(j)!==null&&I(X)})}t(A),t(z),g(I=>v(de,`${I??""} `),[()=>S(e(u).estimated_completion)]),l(G,z)};c(K,G=>{e(u).estimated_completion&&G(ae)})}var Q=s(K,2);{var re=G=>{var j=$a(),z=s(a(j),2),A=a(z),de=a(A);t(A);var ue=s(A,2),X=a(ue);t(ue),t(z),t(j),g(I=>{Ee(de,`width: ${e(u).r_squared*100}%`),v(X,`${I??""}%`)},[()=>(e(u).r_squared*100).toFixed(0)]),l(G,j)};c(Q,G=>{e(u).r_squared!==void 0&&G(re)})}var ee=s(Q,2);{var oe=G=>{var j=es(),z=s(a(j),2),A=a(z);t(z),t(j),g(()=>v(A,`${e(u).num_readings??""} points`)),l(G,j)};c(ee,G=>{e(u).num_readings&&G(oe)})}t(O),t(N),l(F,N)},w=F=>{var N=as();l(F,N)};c(b,F=>{e(u).available?F(B):F(w,!1)},!0)}l(x,k)};c(f,x=>{e(m)?x(h):x(C,!1)},!0)}l(_,q)};c(R,_=>{e(D)?_(d):_(T,!1)})}l(U,r),Me()}var rs=n('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),is=n('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),ls=n('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),vs=n('<span class="recipe-type svelte-g5au2j"> </span>'),ns=n('<a class="recipe-link svelte-g5au2j"> <!></a>'),os=n('<option class="svelte-g5au2j"> </option>'),ds=n('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),cs=n('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),us=n('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),_s=n('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),gs=n('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),fs=n('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),ms=n('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),ps=n('<span class="svelte-g5au2j"> </span>'),bs=n('<span class="svelte-g5au2j"> </span>'),hs=n('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),js=n('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div>',1),ys=n('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),xs=n('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Ns(U,i){qe(i,!0);const u=()=>sa(ra,"$page",D),[D,m]=aa();let S=null,p=null,r=ne(null),R=ne(null),d=ne(null);kt([]);let T=ne(!0),_=ne(null),q=ne(!1),f=ne(!1),h=ne(!1),C=ne(!1),x=ne(!1),k=E(()=>parseInt(u().params.id??"0"));const b={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},B=["planning","fermenting","conditioning","completed","archived"];let w=E(()=>e(r)?b[e(r).status]:b.planning),F=E(Bt),N=E(()=>xt.config.ha_enabled&&xt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),O=E(()=>{if(!e(r)?.device_id)return null;const o=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!o?.[1])return null;const L=o[1].toUpperCase();for(const H of da.tilts.values())if(H.color.toUpperCase()===L)return H;return null});async function P(){y(T,!0),y(_,null);try{if(y(r,await va(e(k)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{y(R,await jt(e(k)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{y(d,await Ne(e(k)),!0)}catch{}}catch(o){y(_,o instanceof Error?o.message:"Failed to load batch",!0)}finally{y(T,!1)}}async function Y(o){if(!(!e(r)||e(f))&&!(o==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){y(f,!0);try{y(r,await yt(e(r).id,{status:o}),!0),(o==="fermenting"||o==="conditioning")&&y(R,await jt(e(r).id),!0)}catch(L){console.error("Failed to update status:",L)}finally{y(f,!1)}}}async function K(o){if(e(r)&&(y(r,await yt(e(r).id,o),!0),y(q,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{y(d,await Ne(e(r).id),!0)}catch{}}async function ae(){if(e(r)){y(x,!0);try{await na(e(r).id),ia("/batches")}catch(o){y(_,o instanceof Error?o.message:"Failed to delete batch",!0),y(x,!1),y(C,!1)}}}async function Q(o,L){if(!(!e(r)||e(h))){y(h,!0);try{await Ze(e(r).id,L,60,o),y(d,await Ne(e(r).id),!0)}catch(H){console.error("Failed to set override:",H)}finally{y(h,!1)}}}async function re(){if(!(!e(r)||e(h))){y(h,!0);try{e(r).heater_entity_id&&await Ze(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Ze(e(r).id,null,60,"cooler"),y(d,await Ne(e(r).id),!0)}catch(o){console.error("Failed to clear overrides:",o)}finally{y(h,!1)}}}function ee(){if(S?.readyState===WebSocket.OPEN)return;const L=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;S=new WebSocket(L),S.onmessage=async H=>{try{const Z=JSON.parse(H.data);Z.type==="control_event"&&Z.batch_id===e(k)&&e(d)&&(Z.action==="heat_on"?y(d,{...e(d),heater_state:"on"},!0):Z.action==="heat_off"?y(d,{...e(d),heater_state:"off"},!0):Z.action==="cool_on"?y(d,{...e(d),cooler_state:"on"},!0):Z.action==="cool_off"&&y(d,{...e(d),cooler_state:"off"},!0))}catch{}},S.onclose=()=>{S=null,p=setTimeout(ee,3e3)},S.onerror=()=>{S?.close()}}function oe(){p&&(clearTimeout(p),p=null),S?.close(),S=null}function G(o){return o==null?"--":Tt(o)}zt(()=>{P(),ee()}),Qt(()=>{oe()});var j=xs();$t("g5au2j",o=>{Xt(()=>{Zt.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var z=V(j),A=s(a(z),2);{var de=o=>{var L=rs();l(o,L)},ue=o=>{var L=be(),H=V(L);{var Z=_e=>{var ce=is(),te=s(a(ce),2),he=a(te,!0);t(te);var Be=s(te,2);Be.__click=P,t(ce),g(()=>v(he,e(_))),l(_e,ce)},Ae=_e=>{var ce=be(),te=V(ce);{var he=ke=>{var Ue=ls();l(ke,Ue)},Be=ke=>{var Ue=be(),Rt=V(Ue);{var qt=De=>{ca(De,{get batch(){return e(r)},onSubmit:K,onCancel:()=>y(q,!1)})},Mt=De=>{var tt=js(),Ve=V(tt),He=a(Ve),We=a(He),Dt=a(We);t(We);var at=s(We,2),Je=a(at),Lt=a(Je,!0);t(Je);var Ot=s(Je,2);{var Pt=M=>{var W=ns(),se=a(W),ye=s(se);{var ge=xe=>{var ze=vs(),Le=a(ze);t(ze),g(()=>v(Le,`(${e(r).recipe.type??""})`)),l(xe,ze)};c(ye,xe=>{e(r).recipe.type&&xe(ge)})}t(W),g(()=>{Ct(W,"href",`/recipes/${e(r).recipe.id??""}`),v(se,`${e(r).recipe.name??""} `)}),l(M,W)};c(Ot,M=>{e(r).recipe&&M(Pt)})}t(at),t(He);var st=s(He,2),Ye=a(st),je=a(Ye);je.__change=M=>Y(M.currentTarget.value),wt(je,21,()=>B,Ft,(M,W)=>{var se=os(),ye=a(se,!0);t(se);var ge={};g(()=>{v(ye,b[e(W)].label),ge!==(ge=e(W))&&(se.value=(se.__value=e(W))??"")}),l(M,se)}),t(je);var rt;ea(je),t(Ye);var it=s(Ye,2);it.__click=()=>y(q,!0);var Gt=s(it,2);Gt.__click=()=>y(C,!0),t(st),t(Ve);var lt=s(Ve,2),Ke=a(lt),vt=a(Ke);{var At=M=>{{let W=E(()=>e(R)?.measured?.current_sg),se=E(()=>e(R)?.temperature?.current);ka(M,{get liveReading(){return e(O)},get currentSg(){return e(W)},get currentTemp(){return e(se)}})}};c(vt,M=>{(e(O)||e(R)?.measured?.current_sg!=null)&&M(At)})}var nt=s(vt,2);{let M=E(()=>e(O)?.sg??e(R)?.measured?.current_sg);Sa(nt,{get batch(){return e(r)},get currentSg(){return e(M)},get progress(){return e(R)}})}var Et=s(nt,2);{var Ut=M=>{Ha(M,{get recipe(){return e(r).recipe}})};c(Et,M=>{e(r).recipe&&M(Ut)})}t(Ke);var ot=s(Ke,2),dt=a(ot);qa(dt,{get batch(){return e(r)}});var ct=s(dt,2);Ua(ct,{get batch(){return e(r)},get liveReading(){return e(O)},onEdit:()=>y(q,!0)});var ut=s(ct,2);ss(ut,{get batchId(){return e(r).id}});var _t=s(ut,2);{var Nt=M=>{var W=ms();let se;var ye=s(a(W),2),ge=a(ye);{var xe=ie=>{var J=ds(),$=a(J);let le;var we=s($,2),fe=s(a(we),2);let Fe;var Oe=a(fe,!0);t(fe);var Te=s(fe,2),Pe=a(Te,!0);t(Te),t(we),t(J),g(()=>{le=Ce($,1,"device-icon-wrap svelte-g5au2j",null,le,{active:e(d)?.heater_state==="on"}),Fe=Ce(fe,1,"device-state svelte-g5au2j",null,Fe,{on:e(d)?.heater_state==="on"}),v(Oe,e(d)?.heater_state==="on"?"ON":"OFF"),v(Pe,e(r).heater_entity_id)}),l(ie,J)};c(ge,ie=>{e(r).heater_entity_id&&ie(xe)})}var ze=s(ge,2);{var Le=ie=>{var J=cs(),$=a(J);let le;var we=s($,2),fe=s(a(we),2);let Fe;var Oe=a(fe,!0);t(fe);var Te=s(fe,2),Pe=a(Te,!0);t(Te),t(we),t(J),g(()=>{le=Ce($,1,"device-icon-wrap svelte-g5au2j",null,le,{active:e(d)?.cooler_state==="on"}),Fe=Ce(fe,1,"device-state svelte-g5au2j",null,Fe,{on:e(d)?.cooler_state==="on"}),v(Oe,e(d)?.cooler_state==="on"?"ON":"OFF"),v(Pe,e(r).cooler_entity_id)}),l(ie,J)};c(ze,ie=>{e(r).cooler_entity_id&&ie(Le)})}t(ye);var Qe=s(ye,2);{var Xe=ie=>{var J=fs(),$=V(J),le=a($),we=s(a(le),2),fe=a(we);t(we),t(le);var Fe=s(le,2),Oe=s(a(Fe),2),Te=a(Oe);t(Oe),t(Fe),t($);var Pe=s($,2);{var Wt=ve=>{var me=us(),pe=s(a(me),2),Se=a(pe);t(pe);var ht=s(pe,2);ht.__click=()=>re(),t(me),g(Kt=>{v(Se,`Override active: ${Kt??""}`),ht.disabled=e(h)},[()=>e(d).override_state?.toUpperCase()]),l(ve,me)};c(Pe,ve=>{e(d).override_active&&ve(Wt)})}var gt=s(Pe,2),ft=s(a(gt),2),mt=a(ft);{var Jt=ve=>{var me=_s(),pe=V(me);pe.__click=()=>Q("heater","on");var Se=s(pe,2);Se.__click=()=>Q("heater","off"),g(()=>{pe.disabled=e(h),Se.disabled=e(h)}),l(ve,me)};c(mt,ve=>{e(r).heater_entity_id&&ve(Jt)})}var pt=s(mt,2);{var Yt=ve=>{var me=gs(),pe=V(me);pe.__click=()=>Q("cooler","on");var Se=s(pe,2);Se.__click=()=>Q("cooler","off"),g(()=>{pe.disabled=e(h),Se.disabled=e(h)}),l(ve,me)};c(pt,ve=>{e(r).cooler_entity_id&&ve(Yt)})}var bt=s(pt,2);bt.__click=()=>re(),t(ft),t(gt),g((ve,me)=>{v(fe,`${ve??""}${e(F)??""}`),v(Te,`¬±${me??""}${e(F)??""}`),bt.disabled=e(h)},[()=>G(e(d).target_temp),()=>e(d).hysteresis?.toFixed(1)||"--"]),l(ie,J)};c(Qe,ie=>{e(d)&&ie(Xe)})}t(W),g(()=>se=Ce(W,1,"info-card temp-control-card svelte-g5au2j",null,se,{"heater-on":e(d)?.heater_state==="on","cooler-on":e(d)?.cooler_state==="on"})),l(M,W)},It=M=>{var W=be(),se=V(W);{var ye=ge=>{var xe=hs(),ze=s(a(xe),2),Le=a(ze);{var Qe=J=>{var $=ps(),le=a($);t($),g(()=>v(le,`Heater: ${e(r).heater_entity_id??""}`)),l(J,$)};c(Le,J=>{e(r).heater_entity_id&&J(Qe)})}var Xe=s(Le,2);{var ie=J=>{var $=bs(),le=a($);t($),g(()=>v(le,`Cooler: ${e(r).cooler_entity_id??""}`)),l(J,$)};c(Xe,J=>{e(r).cooler_entity_id&&J(ie)})}Re(2),t(ze),t(xe),l(ge,xe)};c(se,ge=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&ge(ye)},!0)}l(M,W)};c(_t,M=>{e(N)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?M(Nt):M(It,!1)})}var Vt=s(_t,2);{var Ht=M=>{Ja(M,{get notes(){return e(r).notes}})};c(Vt,M=>{e(r).notes&&M(Ht)})}t(ot),t(lt),g(()=>{v(Dt,`#${(e(r).batch_number||"?")??""}`),v(Lt,e(r).name||e(r).recipe?.name||"Unnamed Batch"),je.disabled=e(f),Ee(je,`color: ${e(w).color??""}; background: ${e(w).bg??""};`),rt!==(rt=e(r).status)&&(je.value=(je.__value=e(r).status)??"",ta(je,e(r).status))}),l(De,tt)};c(Rt,De=>{e(q)?De(qt):De(Mt,!1)},!0)}l(ke,Ue)};c(te,ke=>{e(r)?ke(Be,!1):ke(he)},!0)}l(_e,ce)};c(H,_e=>{e(_)?_e(Z):_e(Ae,!1)},!0)}l(o,L)};c(A,o=>{e(T)?o(de):o(ue,!1)})}t(z);var X=s(z,2);{var I=o=>{var L=ys();L.__click=()=>y(C,!1);var H=a(L);H.__click=Be=>Be.stopPropagation();var Z=s(a(H),2),Ae=a(Z);t(Z);var _e=s(Z,2),ce=a(_e);ce.__click=()=>y(C,!1);var te=s(ce,2);te.__click=ae;var he=a(te,!0);t(te),t(_e),t(H),t(L),g(()=>{v(Ae,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),ce.disabled=e(x),te.disabled=e(x),v(he,e(x)?"Deleting...":"Delete Batch")}),l(o,L)};c(X,o=>{e(C)&&o(I)})}l(U,j),Me(),m()}et(["click","change"]);export{Ns as component,Us as universal};
