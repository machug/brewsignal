import{d as jt,f as n,s as v,a as l,c as Se}from"../chunks/CsQfwH0S.js";import{al as a,ak as s,an as t,ar as c,ah as ut,at as Q,c as e,ai as x,as as Qe,aj as _t,aq as we,p as Gt,ao as Lt,s as b,aL as aa,ay as sa,am as ra}from"../chunks/fKkNMI8q.js";import{e as Et,i as Ut}from"../chunks/COk1ZY4R.js";import{i as o}from"../chunks/BvBRaQNg.js";import{h as ia}from"../chunks/DLseniaC.js";import{s as Nt}from"../chunks/DbN3nGCc.js";import{s as Ne}from"../chunks/BDI2zAFW.js";import{s as ct}from"../chunks/CcRNvR1k.js";import{i as la,s as na}from"../chunks/C8srtpii.js";import{s as va,a as oa}from"../chunks/C51ud8ec.js";import{p as da}from"../chunks/z1y1qqo2.js";import{g as ca}from"../chunks/DImV--Lg.js";import{z as ua,A as _a,q as ga,j as Dt,B as bt,k as pa,x as Ot,C as kt}from"../chunks/i8VL_lOf.js";import{b as fa,g as It,d as dt,e as Vt,c as ht}from"../chunks/CPwbAm-l.js";import{t as At}from"../chunks/C8NDSE1R.js";import{B as ma}from"../chunks/DTfC6M4H.js";import{s as ba}from"../chunks/Bdaed-dN.js";import{p as pt}from"../chunks/CllCHKBI.js";const ha=!1,or=Object.freeze(Object.defineProperty({__proto__:null,prerender:ha},Symbol.toStringTag,{value:"Module"}));function ja(V){return V>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:V>=-60?{bars:3,color:"var(--positive)",label:"Good"}:V>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function Ht(V){const i=Math.floor((Date.now()-new Date(V).getTime())/1e3);if(i<10)return"just now";if(i<60)return`${i}s ago`;const M=Math.floor(i/60);if(M<60)return`${M}m ago`;const q=Math.floor(M/60);return q<24?`${q}h ago`:`${Math.floor(q/24)}d ago`}var ya=n('<div class="accent-bar svelte-1oyrwd9"></div>'),xa=n('<span class="card-icon svelte-1oyrwd9"> </span>'),ka=n('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),wa=n('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function ft(V,i){let M=pt(i,"highlight",3,!1),q=pt(i,"collapsible",3,!1),p=pt(i,"expanded",3,!1);var f=wa();let g;var r=a(f);{var k=j=>{var D=ya();l(j,D)};o(r,j=>{M()&&j(k)})}var u=s(r,2),N=a(u),H=a(N);{var E=j=>{var D=xa(),d=a(D,!0);t(D),c(()=>v(d,i.icon)),l(j,D)};o(H,j=>{i.icon&&j(E)})}var m=s(H,2),w=a(m,!0);t(m),t(N);var O=s(N,2);{var P=j=>{var D=ka();D.__click=function(...L){i.onToggle?.apply(this,L)};var d=a(D);let y;t(D),c(()=>{Nt(D,"aria-label",p()?"Collapse":"Expand"),y=Ne(d,0,"expand-icon svelte-1oyrwd9",null,y,{"rotate-180":p()})}),l(j,D)};o(O,j=>{q()&&i.onToggle&&j(P)})}t(u);var z=s(u,2);let h;var F=a(z);ba(F,()=>i.children),t(z),t(f),c(()=>{g=Ne(f,1,"batch-card svelte-1oyrwd9",null,g,{highlight:M()}),v(w,i.title),h=Ne(z,1,"card-content svelte-1oyrwd9",null,h,{collapsed:q()&&!p()})}),l(V,f)}jt(["click"]);var za=n('<span class="unit svelte-lzskfi"> </span>'),Ra=n('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),qa=n('<div class="last-seen svelte-lzskfi"> </div>'),Fa=n('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function Ca(V,i){ut(i,!0);let M=x(()=>i.liveReading?.sg??i.currentSg),q=x(()=>i.liveReading?.temp??i.currentTemp),p=x(()=>i.liveReading?.sg_raw),f=x(()=>i.liveReading?.temp_raw),g=x(()=>i.liveReading?.last_seen),r=x(()=>i.liveReading&&(i.liveReading.sg!==i.liveReading.sg_raw||i.liveReading.temp!==i.liveReading.temp_raw)),k=x(fa),u=x(It);function N(m){return m==null?"--":dt(m)}function H(m){return m==null?"--":Vt(m)}let E=x(()=>e(g)?Ht(e(g)):null);ft(V,{title:"Live Readings",highlight:!0,children:(m,w)=>{var O=Fa(),P=s(Q(O),2),z=a(P),h=a(z),F=a(h),j=s(F);{var D=S=>{var W=za(),te=a(W,!0);t(W),c(()=>v(te,e(k))),l(S,W)};o(j,S=>{e(k)!=="SG"&&S(D)})}t(h);var d=s(h,2),y=a(d,!0);t(d),t(z);var L=s(z,2),U=a(L),C=a(U),A=s(C),X=a(A,!0);t(A),t(U),Qe(2),t(L),t(P);var le=s(P,2);{var ge=S=>{var W=Ra(),te=s(a(W),2),Be=a(te,!0);t(te);var Pe=s(te,4),de=a(Pe);t(Pe),t(W),c((pe,fe)=>{v(Be,pe),v(de,`${fe??""}${e(u)??""}`)},[()=>N(e(p)),()=>H(e(f))]),l(S,W)};o(le,S=>{e(r)&&S(ge)})}var ze=s(le,2);{var Z=S=>{var W=qa(),te=a(W);t(W),c(()=>v(te,`Updated ${e(E)??""}`)),l(S,W)};o(ze,S=>{e(E)&&S(Z)})}c((S,W)=>{v(F,`${S??""} `),v(y,e(k)==="SG"?"Gravity":e(k)==="¬∞P"?"Plato":"Brix"),v(C,`${W??""} `),v(X,e(u))},[()=>N(e(M)),()=>H(e(q))]),l(m,O)},$$slots:{default:!0}}),_t()}var Ta=n('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),Sa=n('<div class="progress-remaining svelte-t80j9z"> </div>'),Ba=n('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),Ma=n('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),Pa=n('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),Da=n('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Oa(V,i){ut(i,!0);let M=x(()=>{if(!i.batch.measured_og)return null;const g=i.currentSg??i.progress?.measured?.current_sg;if(!g)return null;const r=(i.batch.measured_og-g)*131.25,k=i.batch.measured_og-1,u=k!==0?(i.batch.measured_og-g)/k*100:0;return{currentSg:g,abv:Math.max(0,r),attenuation:Math.max(0,Math.min(100,u)),isFermenting:i.batch.status==="fermenting"||i.batch.status==="conditioning"}}),q=x(()=>e(M)?.isFermenting??!1);function p(g){return g==null?"--":dt(g)}function f(g){return g==null?"--":`${g.toFixed(1)}%`}{let g=x(()=>e(q)?"Fermentation Progress":"Fermentation Measurements");ft(V,{get title(){return e(g)},children:(r,k)=>{var u=Se(),N=Q(u);{var H=m=>{var w=Ma(),O=Q(w),P=s(a(O),2),z=a(P);Qe(),t(P),t(O);var h=s(O,2),F=s(a(h),2),j=s(a(F),4),D=a(j,!0);t(j),t(F);var d=s(F,2);{var y=de=>{var pe=Ta(),fe=s(a(pe),4),De=a(fe,!0);t(fe),t(pe),c(Oe=>v(De,Oe),[()=>p(i.batch.recipe.fg)]),l(de,pe)};o(d,de=>{i.batch.recipe?.fg&&de(y)})}var L=s(d,2),U=s(a(L),4),C=a(U,!0);t(U),t(L),t(h);var A=s(h,2),X=a(A),le=s(a(X),2),ge=s(a(le),2),ze=a(ge);Qe(),t(ge),t(le),t(X);var Z=s(X,2),S=s(a(Z),2),W=s(a(S),2),te=a(W);Qe(),t(W),t(S),t(Z),t(A);var Be=s(A,2);{var Pe=de=>{var pe=Ba(),fe=a(pe),De=s(a(fe),2),Oe=a(De);t(De),t(fe);var _=s(fe,2),G=s(a(_),2);Qe(2),t(_);var ae=s(_,2);{var J=Te=>{var me=Sa(),be=a(me);t(me),c(he=>v(be,`${he??""} gravity points remaining`),[()=>i.progress.progress.sg_remaining.toFixed(3)]),l(Te,me)};o(ae,Te=>{i.progress.progress.sg_remaining!=null&&Te(J)})}t(pe),c(Te=>{v(Oe,`${Te??""}%`),ct(G,`width: ${i.progress.progress.percent_complete??""}%`)},[()=>i.progress.progress.percent_complete.toFixed(0)]),l(de,pe)};o(Be,de=>{i.progress?.progress?.percent_complete!=null&&de(Pe)})}c((de,pe,fe,De,Oe)=>{v(z,`${de??""} `),v(D,pe),v(C,fe),v(ze,`${De??""} `),v(te,`${Oe??""} `)},[()=>p(e(M).currentSg),()=>p(i.batch.measured_og),()=>p(e(M).currentSg),()=>f(e(M).abv),()=>f(e(M).attenuation)]),l(m,w)},E=m=>{var w=Se(),O=Q(w);{var P=h=>{var F=Pa(),j=a(F),D=s(a(j),2),d=a(D,!0);t(D),t(j);var y=s(j,2),L=s(a(y),2),U=a(L,!0);t(L),t(y);var C=s(y,2),A=s(a(C),2),X=a(A,!0);t(A),t(C);var le=s(C,2),ge=s(a(le),2),ze=a(ge,!0);t(ge),t(le),t(F),c((Z,S,W,te)=>{v(d,Z),v(U,S),v(X,W),v(ze,te)},[()=>p(i.batch.measured_og),()=>p(i.batch.measured_fg),()=>i.batch.measured_abv!=null?f(i.batch.measured_abv):"--",()=>i.batch.measured_attenuation!=null?f(i.batch.measured_attenuation):"--"]),l(h,F)},z=h=>{var F=Da();l(h,F)};o(O,h=>{i.batch.measured_og?h(P):h(z,!1)},!0)}l(m,w)};o(N,m=>{e(M)&&e(q)?m(H):m(E,!1)})}l(r,u)},$$slots:{default:!0}})}_t()}var Aa=n('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Ga(V,i){ut(i,!0);function M(p){return p?new Date(p).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function q(p){return p?new Date(p).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}ft(V,{title:"Timeline",children:(p,f)=>{var g=Aa(),r=a(g),k=s(a(r),2),u=a(k,!0);t(k),t(r);var N=s(r,2),H=s(a(N),2),E=a(H,!0);t(H),t(N);var m=s(N,2),w=s(a(m),2),O=a(w,!0);t(w),t(m);var P=s(m,2),z=s(a(P),2),h=a(z,!0);t(z),t(P),t(g),c((F,j,D,d)=>{v(u,F),v(E,j),v(O,D),v(h,d)},[()=>M(i.batch.brew_date),()=>q(i.batch.start_time),()=>q(i.batch.end_time),()=>q(i.batch.created_at)]),l(p,g)},$$slots:{default:!0}}),_t()}var La=n('<div class="signal-bar svelte-1kdxwtz"></div>'),Ea=n('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),Ua=n('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Na=n('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ia=n('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Va=n('<div class="device-info svelte-1kdxwtz"><!></div>'),Ha=n('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Wa=n('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Ja(V,i){ut(i,!0);let M=x(()=>i.liveReading?.device_type==="tilt"),q=x(()=>e(M)&&i.liveReading?.rssi?ja(i.liveReading.rssi):null),p=x(()=>i.liveReading?.last_seen?Ht(i.liveReading.last_seen):null),f=x(()=>{if(!i.liveReading)return i.batch.device_id||"Unknown";const g=i.liveReading.device_type;return g==="tilt"?`${i.liveReading.color} Tilt`:g==="gravitymon"?`GravityMon (${i.liveReading.id})`:g==="ispindel"?`iSpindel (${i.liveReading.id})`:g==="floaty"?`Floaty (${i.liveReading.id})`:i.liveReading.color||i.liveReading.id});ft(V,{title:"Tracking Device",children:(g,r)=>{var k=Se(),u=Q(k);{var N=E=>{var m=Va(),w=a(m);{var O=z=>{var h=Na(),F=Q(h),j=s(a(F));t(F);var D=s(F,2);{var d=U=>{var C=Ea(),A=a(C);Et(A,20,()=>Array(4),Ut,(ge,ze,Z)=>{var S=La();c(()=>ct(S,`
										height: ${6+Z*3}px;
										background: ${(Z<e(q).bars?e(q).color:"var(--bg-hover)")??""};
										opacity: ${Z<e(q).bars?1:.4};
									`)),l(ge,S)}),t(A);var X=s(A,2),le=a(X);t(X),t(C),c(()=>{ct(X,`color: ${e(q).color??""}`),v(le,`${e(q).label??""} (${i.liveReading.rssi??""} dBm)`)}),l(U,C)};o(D,U=>{e(q)&&U(d)})}var y=s(D,2);{var L=U=>{var C=Ua(),A=a(C);t(C),c(()=>v(A,`Updated ${e(p)??""}`)),l(U,C)};o(y,U=>{e(p)&&U(L)})}c(()=>v(j,` ${e(f)??""} - Connected`)),l(z,h)},P=z=>{var h=Ia(),F=Q(h),j=s(a(F));t(F),Qe(2),c(()=>v(j,` Device: ${i.batch.device_id??""}`)),l(z,h)};o(w,z=>{i.liveReading?z(O):z(P,!1)})}t(m),l(E,m)},H=E=>{var m=Wa(),w=s(a(m),2);{var O=P=>{var z=Ha();z.__click=function(...h){i.onEdit?.apply(this,h)},l(P,z)};o(w,P=>{i.onEdit&&P(O)})}t(m),l(E,m)};o(u,E=>{i.batch.device_id?E(N):E(H,!1)})}l(g,k)},$$slots:{default:!0}}),_t()}jt(["click"]);const Ya=131.25;var Ka=n('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Qa=n('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Xa(V,i){ut(i,!0);function M(p){return p==null?"--":dt(p)}let q=x(()=>i.recipe.abv!=null?i.recipe.abv:i.recipe.og&&i.recipe.fg?(i.recipe.og-i.recipe.fg)*Ya:null);ft(V,{title:"Recipe Targets",children:(p,f)=>{var g=Qa(),r=a(g),k=s(a(r),2),u=a(k,!0);t(k),t(r);var N=s(r,2),H=s(a(N),2),E=a(H,!0);t(H),t(N);var m=s(N,2),w=s(a(m),2),O=a(w,!0);t(w),t(m);var P=s(m,2);{var z=h=>{var F=Ka(),j=s(a(F),2),D=a(j,!0);t(j),t(F),c(()=>v(D,i.recipe.yeast_name)),l(h,F)};o(P,h=>{i.recipe.yeast_name&&h(z)})}t(g),c((h,F,j)=>{v(u,h),v(E,F),v(O,j)},[()=>M(i.recipe.og),()=>M(i.recipe.fg),()=>e(q)!=null?`${e(q).toFixed(1)}%`:"--"]),l(p,g)},$$slots:{default:!0}}),_t()}var Za=n('<p class="notes-content svelte-hkv31i"> </p>');function $a(V,i){ft(V,{title:"Notes",children:(M,q)=>{var p=Za(),f=a(p,!0);t(p),c(()=>v(f,i.notes)),l(M,p)},$$slots:{default:!0}})}var es=n('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),ts=n('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),as=n('<span class="anomaly-reasons svelte-1xs394q"> </span>'),ss=n('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),rs=n('<span class="activity-badge svelte-1xs394q"> </span>'),is=n('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),ls=n('<span class="current-hint svelte-1xs394q"> </span>'),ns=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> <!></span></div>'),vs=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),os=n('<span class="complete-now svelte-1xs394q">Ready now!</span>'),ds=n('<span class="days svelte-1xs394q"> </span>'),cs=n(" <!>",1),us=n('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),_s=n('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),gs=n('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Data points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),ps=n('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!></div></div></div>'),fs=n('<div class="ml-panel disabled svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <p class="unavailable-hint svelte-1xs394q">Predictions require at least 10 readings over 2+ hours</p></div>');function ms(V,i){ut(i,!0);let M=pt(i,"measuredOg",3,null),q=pt(i,"currentSg",3,null),p=pt(i,"liveReading",3,null),f=we(Gt({available:!1})),g=we(!0),r=we(!1),k=we(null);async function u(){b(g,!0),b(k,null);try{b(f,await ua(i.batchId),!0)}catch(d){b(k,d instanceof Error?d.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",d)}finally{b(g,!1)}}async function N(){b(r,!0),b(k,null);try{const d=await _a(i.batchId);console.log("Reloaded predictions:",d.message),await u()}catch(d){b(k,d instanceof Error?d.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",d)}finally{b(r,!1)}}Lt(u);function H(d){return d?new Date(d).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function E(d){if(!d)return null;const y=new Date(d),L=new Date,U=y.getTime()-L.getTime();return Math.ceil(U/(1e3*60*60*24))}let m=x(()=>{const d=M()??e(f).predicted_og,y=e(f).predicted_fg,L=q()??p()?.sg;if(!d||!y||!L||d<=y)return null;const U=d-y,A=(d-L)/U*100;return Math.min(100,Math.max(0,A))}),w=x(()=>{const d=M()??e(f).predicted_og,y=q()??p()?.sg;if(!d||!y||d<=1)return null;const L=(d-y)/(d-1)*100;return Math.min(100,Math.max(0,L))}),O=x(()=>{const d=p()?.sg_rate;if(d==null)return null;const y=Math.abs(d);return y>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:y>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:y>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),P=x(()=>p()?.is_anomaly??!1),z=x(()=>p()?.anomaly_reasons??[]);var h=Se(),F=Q(h);{var j=d=>{var y=es();l(d,y)},D=d=>{var y=Se(),L=Q(y);{var U=A=>{var X=ts(),le=a(X),ge=a(le);t(le),t(X),c(()=>v(ge,`‚ö†Ô∏è ${e(k)??""}`)),l(A,X)},C=A=>{var X=Se(),le=Q(X);{var ge=Z=>{var S=ps();let W;var te=a(S),Be=s(a(te),2);Be.__click=N;var Pe=a(Be,!0);t(Be),t(te);var de=s(te,2);{var pe=T=>{var B=ss(),I=s(a(B),2),ne=s(a(I),2);{var re=ye=>{var ve=as(),se=a(ve,!0);t(ve),c(ce=>v(se,ce),[()=>e(z).join(", ")]),l(ye,ve)};o(ne,ye=>{e(z).length>0&&ye(re)})}t(I),t(B),l(T,B)};o(de,T=>{e(P)&&T(pe)})}var fe=s(de,2);{var De=T=>{var B=is(),I=a(B),ne=s(a(I),2);{var re=Ie=>{var Ve=rs(),lt=a(Ve);t(Ve),c(()=>{ct(Ve,`color: ${e(O).color??""}`),v(lt,`${e(O).emoji??""} ${e(O).label??""}`)}),l(Ie,Ve)};o(ne,Ie=>{e(O)&&Ie(re)})}t(I);var ye=s(I,2),ve=a(ye);t(ye);var se=s(ye,2),ce=a(se),Ze=a(ce);t(ce);var $e=s(ce,2),rt=a($e);t($e);var Ae=s($e,2),it=a(Ae);t(Ae),t(se),t(B),c((Ie,Ve,lt)=>{ct(ve,`width: ${e(m)??""}%`),v(Ze,`OG: ${Ie??""}`),v(rt,`${Ve??""}%`),v(it,`FG: ${lt??""}`)},[()=>dt(M()??e(f).predicted_og??0),()=>e(m).toFixed(0),()=>dt(e(f).predicted_fg??0)]),l(T,B)};o(fe,T=>{e(m)!==null&&T(De)})}var Oe=s(fe,2),_=a(Oe);{var G=T=>{var B=ns(),I=s(a(B),2),ne=a(I),re=s(ne);{var ye=ve=>{var se=ls(),ce=a(se);t(se),c(Ze=>v(ce,`(now: ${Ze??""})`),[()=>dt(q()??p()?.sg??0)]),l(ve,se)};o(re,ve=>{(q()||p()?.sg)&&ve(ye)})}t(I),t(B),c(ve=>v(ne,`${ve??""} `),[()=>dt(e(f).predicted_fg)]),l(T,B)};o(_,T=>{e(f).predicted_fg&&T(G)})}var ae=s(_,2);{var J=T=>{var B=vs(),I=s(a(B),2),ne=a(I);t(I),t(B),c(re=>v(ne,`${re??""}%`),[()=>e(w).toFixed(1)]),l(T,B)};o(ae,T=>{e(w)!==null&&T(J)})}var Te=s(ae,2);{var me=T=>{const B=x(()=>E(e(f).estimated_completion));var I=us(),ne=s(a(I),2),re=a(ne);{var ye=se=>{var ce=os();l(se,ce)},ve=se=>{var ce=cs(),Ze=Q(ce),$e=s(Ze);{var rt=Ae=>{var it=ds(),Ie=a(it);t(it),c(()=>v(Ie,`(${e(B)??""} ${e(B)===1?"day":"days"})`)),l(Ae,it)};o($e,Ae=>{e(B)!==null&&Ae(rt)})}c(Ae=>v(Ze,`${Ae??""} `),[()=>H(e(f).estimated_completion)]),l(se,ce)};o(re,se=>{e(B)!==null&&e(B)<=0?se(ye):se(ve,!1)})}t(ne),t(I),l(T,I)};o(Te,T=>{e(f).estimated_completion&&T(me)})}var be=s(Te,2),he=a(be);{var at=T=>{var B=_s(),I=s(a(B),2),ne=a(I);t(I),t(B),c(re=>v(ne,`${re??""}%`),[()=>(e(f).r_squared*100).toFixed(0)]),l(T,B)};o(he,T=>{e(f).r_squared!==void 0&&T(at)})}var st=s(he,2);{var Xe=T=>{var B=gs(),I=s(a(B),2),ne=a(I,!0);t(I),t(B),c(()=>v(ne,e(f).num_readings)),l(T,B)};o(st,T=>{e(f).num_readings&&T(Xe)})}t(be),t(Oe),t(S),c(()=>{W=Ne(S,1,"ml-panel svelte-1xs394q",null,W,{"has-anomaly":e(P)}),Be.disabled=e(r)||e(g),v(Pe,e(r)?"Reloading...":"‚Üª Reload")}),l(Z,S)},ze=Z=>{var S=fs();l(Z,S)};o(le,Z=>{e(f).available?Z(ge):Z(ze,!1)},!0)}l(A,X)};o(L,A=>{e(k)?A(U):A(C,!1)},!0)}l(d,y)};o(F,d=>{e(g)?d(j):d(D,!1)})}l(V,h),_t()}jt(["click"]);var bs=n('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),hs=n('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),js=n('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),ys=n('<span class="recipe-type svelte-g5au2j"> </span>'),xs=n('<a class="recipe-link svelte-g5au2j"> <!></a>'),ks=n('<option class="svelte-g5au2j"> </option>'),ws=n('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),zs=n('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),Rs=n('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),qs=n('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),Fs=n('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),Cs=n('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),Ts=n('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),Ss=n('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),Bs=n('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ms=n('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Ps=n('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Ds=n('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),Os=n('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),As=n('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),Gs=n('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),Ls=n('<span class="svelte-g5au2j"> </span>'),Es=n('<span class="svelte-g5au2j"> </span>'),Us=n('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Ns=n('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div>',1),Is=n('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),Vs=n('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function dr(V,i){ut(i,!0);const M=()=>oa(da,"$page",q),[q,p]=va();let f=null,g=null,r=we(null),k=we(null),u=we(null);Gt([]);let N=we(!0),H=we(null),E=we(!1),m=we(!1),w=we(!1),O=we(!1),P=we(!1),z=x(()=>parseInt(M().params.id??"0"));const h={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},F=["planning","fermenting","conditioning","completed","archived"];let j=x(()=>e(r)?h[e(r).status]:h.planning),D=x(It),d=x(()=>ht.config.ha_enabled&&ht.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),y=x(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),L=x(()=>!e(y)||!e(C)?.temp||!e(r)?.temp_target?!1:e(C).temp<=e(r).temp_target),U=x(()=>{if(!e(y)||!e(C)?.temp||!e(r)?.temp_target)return null;const _=e(r).temp_target+30,G=e(C).temp,ae=e(r).temp_target;if(G<=ae)return 100;if(G>=_)return 0;const J=(_-G)/(_-ae)*100;return Math.min(100,Math.max(0,J))}),C=x(()=>{if(!e(r)?.device_id)return null;const _=At.tilts.get(e(r).device_id);if(_)return _;const G=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!G?.[1])return null;const ae=G[1].toUpperCase();for(const J of At.tilts.values())if(J.color&&J.color.toUpperCase()===ae)return J;return null});async function A(){b(N,!0),b(H,null);try{if(b(r,await ga(e(z)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{b(k,await Dt(e(z)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{b(u,await bt(e(z)),!0)}catch{}}catch(_){b(H,_ instanceof Error?_.message:"Failed to load batch",!0)}finally{b(N,!1)}}async function X(_){if(!(!e(r)||e(m))&&!(_==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){b(m,!0);try{b(r,await Ot(e(r).id,{status:_}),!0),(_==="fermenting"||_==="conditioning")&&b(k,await Dt(e(r).id),!0)}catch(G){console.error("Failed to update status:",G)}finally{b(m,!1)}}}async function le(_){if(e(r)&&(b(r,await Ot(e(r).id,_),!0),b(E,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{b(u,await bt(e(r).id),!0)}catch{}}async function ge(){if(e(r)){b(P,!0);try{await pa(e(r).id),ca("/batches")}catch(_){b(H,_ instanceof Error?_.message:"Failed to delete batch",!0),b(P,!1),b(O,!1)}}}async function ze(_,G){if(!(!e(r)||e(w))){b(w,!0);try{await kt(e(r).id,G,60,_),b(u,await bt(e(r).id),!0)}catch(ae){console.error("Failed to set override:",ae)}finally{b(w,!1)}}}async function Z(){if(!(!e(r)||e(w))){b(w,!0);try{e(r).heater_entity_id&&await kt(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await kt(e(r).id,null,60,"cooler"),b(u,await bt(e(r).id),!0)}catch(_){console.error("Failed to clear overrides:",_)}finally{b(w,!1)}}}function S(){if(f?.readyState===WebSocket.OPEN)return;const G=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;f=new WebSocket(G),f.onmessage=async ae=>{try{const J=JSON.parse(ae.data);J.type==="control_event"&&J.batch_id===e(z)&&e(u)&&(J.action==="heat_on"?b(u,{...e(u),heater_state:"on"},!0):J.action==="heat_off"?b(u,{...e(u),heater_state:"off"},!0):J.action==="cool_on"?b(u,{...e(u),cooler_state:"on"},!0):J.action==="cool_off"&&b(u,{...e(u),cooler_state:"off"},!0))}catch{}},f.onclose=()=>{f=null,g=setTimeout(S,3e3)},f.onerror=()=>{f?.close()}}function W(){g&&(clearTimeout(g),g=null),f?.close(),f=null}function te(_){return _==null?"--":Vt(_)}Lt(()=>{A(),S()}),aa(()=>{W()});var Be=Vs();ia("g5au2j",_=>{sa(()=>{ra.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var Pe=Q(Be),de=s(a(Pe),2);{var pe=_=>{var G=bs();l(_,G)},fe=_=>{var G=Se(),ae=Q(G);{var J=me=>{var be=hs(),he=s(a(be),2),at=a(he,!0);t(he);var st=s(he,2);st.__click=A,t(be),c(()=>v(at,e(H))),l(me,be)},Te=me=>{var be=Se(),he=Q(be);{var at=Xe=>{var T=js();l(Xe,T)},st=Xe=>{var T=Se(),B=Q(T);{var I=re=>{ma(re,{get batch(){return e(r)},onSubmit:le,onCancel:()=>b(E,!1)})},ne=re=>{var ye=Ns(),ve=Q(ye),se=a(ve),ce=a(se),Ze=a(ce);t(ce);var $e=s(ce,2),rt=a($e),Ae=a(rt,!0);t(rt);var it=s(rt,2);{var Ie=R=>{var Y=xs(),ie=a(Y),Re=s(ie);{var qe=Me=>{var Ge=ys(),We=a(Ge);t(Ge),c(()=>v(We,`(${e(r).recipe.type??""})`)),l(Me,Ge)};o(Re,Me=>{e(r).recipe.type&&Me(qe)})}t(Y),c(()=>{Nt(Y,"href",`/recipes/${e(r).recipe.id??""}`),v(ie,`${e(r).recipe.name??""} `)}),l(R,Y)};o(it,R=>{e(r).recipe&&R(Ie)})}t($e),t(se);var Ve=s(se,2),lt=a(Ve),He=a(lt);He.__change=R=>X(R.currentTarget.value),Et(He,21,()=>F,Ut,(R,Y)=>{var ie=ks(),Re=a(ie,!0);t(ie);var qe={};c(()=>{v(Re,h[e(Y)].label),qe!==(qe=e(Y))&&(ie.value=(ie.__value=e(Y))??"")}),l(R,ie)}),t(He);var wt;la(He),t(lt);var zt=s(lt,2);zt.__click=()=>b(E,!0);var Wt=s(zt,2);Wt.__click=()=>b(O,!0),t(Ve),t(ve);var Rt=s(ve,2);{var Jt=R=>{var Y=Ss();let ie;var Re=a(Y),qe=a(Re);{var Me=K=>{var oe=ws();Qe(2),l(K,oe)},Ge=K=>{var oe=zs();Qe(2),l(K,oe)};o(qe,K=>{e(L)?K(Me):K(Ge,!1)})}t(Re);var We=s(Re,2),nt=a(We),vt=a(nt),ue=s(a(vt),2),$=a(ue,!0);t(ue),t(vt);var ee=s(vt,4),_e=s(a(ee),2),Le=a(_e,!0);t(_e),t(ee),t(nt);var xe=s(nt,2);{var Ee=K=>{var oe=Rs(),tt=a(oe),mt=a(tt);t(tt);var ot=s(tt,2),Ue=a(ot);t(ot),t(oe),c(Ke=>{ct(mt,`width: ${e(U)??""}%`),v(Ue,`${Ke??""}% to target`)},[()=>Math.round(e(U))]),l(K,oe)};o(xe,K=>{e(U)!=null&&!e(L)&&K(Ee)})}var Je=s(xe,2),Ye=a(Je);{var et=K=>{var oe=qs();l(K,oe)},xt=K=>{var oe=Se(),tt=Q(oe);{var mt=Ue=>{var Ke=Fs();l(Ue,Ke)},ot=Ue=>{var Ke=Se(),je=Q(Ke);{var Fe=ke=>{var gt=Cs();l(ke,gt)},Ce=ke=>{var gt=Ts();l(ke,gt)};o(je,ke=>{e(L)?ke(Fe):ke(Ce,!1)},!0)}l(Ue,Ke)};o(tt,Ue=>{!ht.config.ha_enabled||!ht.config.temp_control_enabled?Ue(mt):Ue(ot,!1)},!0)}l(K,oe)};o(Ye,K=>{e(r).cooler_entity_id?K(xt,!1):K(et)})}t(Je),t(We),t(Y),c((K,oe)=>{ie=Ne(Y,1,"chilling-banner svelte-g5au2j",null,ie,{ready:e(L)}),v($,K),v(Le,oe)},[()=>e(C)?.temp!=null?te(e(C).temp):"--",()=>e(r).temp_target!=null?te(e(r).temp_target):"--"]),l(R,Y)};o(Rt,R=>{e(y)&&R(Jt)})}var qt=s(Rt,2),yt=a(qt),Ft=a(yt);{var Yt=R=>{{let Y=x(()=>e(k)?.measured?.current_sg),ie=x(()=>e(k)?.temperature?.current);Ca(R,{get liveReading(){return e(C)},get currentSg(){return e(Y)},get currentTemp(){return e(ie)}})}};o(Ft,R=>{(e(C)||e(k)?.measured?.current_sg!=null)&&R(Yt)})}var Ct=s(Ft,2);{let R=x(()=>e(C)?.sg??e(k)?.measured?.current_sg);Oa(Ct,{get batch(){return e(r)},get currentSg(){return e(R)},get progress(){return e(k)}})}var Kt=s(Ct,2);{var Qt=R=>{Xa(R,{get recipe(){return e(r).recipe}})};o(Kt,R=>{e(r).recipe&&R(Qt)})}t(yt);var Tt=s(yt,2),St=a(Tt);Ga(St,{get batch(){return e(r)}});var Bt=s(St,2);Ja(Bt,{get batch(){return e(r)},get liveReading(){return e(C)},onEdit:()=>b(E,!0)});var Mt=s(Bt,2);{let R=x(()=>e(C)?.sg);ms(Mt,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(R)},get liveReading(){return e(C)}})}var Pt=s(Mt,2);{var Xt=R=>{var Y=Gs();let ie;var Re=s(a(Y),2),qe=a(Re);{var Me=ue=>{var $=Bs(),ee=a($);let _e;var Le=s(ee,2),xe=s(a(Le),2);let Ee;var Je=a(xe,!0);t(xe);var Ye=s(xe,2),et=a(Ye,!0);t(Ye),t(Le),t($),c(()=>{_e=Ne(ee,1,"device-icon-wrap svelte-g5au2j",null,_e,{active:e(u)?.heater_state==="on"}),Ee=Ne(xe,1,"device-state svelte-g5au2j",null,Ee,{on:e(u)?.heater_state==="on"}),v(Je,e(u)?.heater_state==="on"?"ON":"OFF"),v(et,e(r).heater_entity_id)}),l(ue,$)};o(qe,ue=>{e(r).heater_entity_id&&ue(Me)})}var Ge=s(qe,2);{var We=ue=>{var $=Ms(),ee=a($);let _e;var Le=s(ee,2),xe=s(a(Le),2);let Ee;var Je=a(xe,!0);t(xe);var Ye=s(xe,2),et=a(Ye,!0);t(Ye),t(Le),t($),c(()=>{_e=Ne(ee,1,"device-icon-wrap svelte-g5au2j",null,_e,{active:e(u)?.cooler_state==="on"}),Ee=Ne(xe,1,"device-state svelte-g5au2j",null,Ee,{on:e(u)?.cooler_state==="on"}),v(Je,e(u)?.cooler_state==="on"?"ON":"OFF"),v(et,e(r).cooler_entity_id)}),l(ue,$)};o(Ge,ue=>{e(r).cooler_entity_id&&ue(We)})}t(Re);var nt=s(Re,2);{var vt=ue=>{var $=As(),ee=Q($),_e=a(ee),Le=s(a(_e),2),xe=a(Le);t(Le),t(_e);var Ee=s(_e,2),Je=s(a(Ee),2),Ye=a(Je);t(Je),t(Ee),t(ee);var et=s(ee,2);{var xt=je=>{var Fe=Ps(),Ce=s(a(Fe),2),ke=a(Ce);t(Ce);var gt=s(Ce,2);gt.__click=()=>Z(),t(Fe),c(ta=>{v(ke,`Override active: ${ta??""}`),gt.disabled=e(w)},[()=>e(u).override_state?.toUpperCase()]),l(je,Fe)};o(et,je=>{e(u).override_active&&je(xt)})}var K=s(et,2),oe=s(a(K),2),tt=a(oe);{var mt=je=>{var Fe=Ds(),Ce=Q(Fe);Ce.__click=()=>ze("heater","on");var ke=s(Ce,2);ke.__click=()=>ze("heater","off"),c(()=>{Ce.disabled=e(w),ke.disabled=e(w)}),l(je,Fe)};o(tt,je=>{e(r).heater_entity_id&&je(mt)})}var ot=s(tt,2);{var Ue=je=>{var Fe=Os(),Ce=Q(Fe);Ce.__click=()=>ze("cooler","on");var ke=s(Ce,2);ke.__click=()=>ze("cooler","off"),c(()=>{Ce.disabled=e(w),ke.disabled=e(w)}),l(je,Fe)};o(ot,je=>{e(r).cooler_entity_id&&je(Ue)})}var Ke=s(ot,2);Ke.__click=()=>Z(),t(oe),t(K),c((je,Fe)=>{v(xe,`${je??""}${e(D)??""}`),v(Ye,`¬±${Fe??""}${e(D)??""}`),Ke.disabled=e(w)},[()=>te(e(u).target_temp),()=>e(u).hysteresis?.toFixed(1)||"--"]),l(ue,$)};o(nt,ue=>{e(u)&&ue(vt)})}t(Y),c(()=>ie=Ne(Y,1,"info-card temp-control-card svelte-g5au2j",null,ie,{"heater-on":e(u)?.heater_state==="on","cooler-on":e(u)?.cooler_state==="on"})),l(R,Y)},Zt=R=>{var Y=Se(),ie=Q(Y);{var Re=qe=>{var Me=Us(),Ge=s(a(Me),2),We=a(Ge);{var nt=$=>{var ee=Ls(),_e=a(ee);t(ee),c(()=>v(_e,`Heater: ${e(r).heater_entity_id??""}`)),l($,ee)};o(We,$=>{e(r).heater_entity_id&&$(nt)})}var vt=s(We,2);{var ue=$=>{var ee=Es(),_e=a(ee);t(ee),c(()=>v(_e,`Cooler: ${e(r).cooler_entity_id??""}`)),l($,ee)};o(vt,$=>{e(r).cooler_entity_id&&$(ue)})}Qe(2),t(Ge),t(Me),l(qe,Me)};o(ie,qe=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&qe(Re)},!0)}l(R,Y)};o(Pt,R=>{e(d)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?R(Xt):R(Zt,!1)})}var $t=s(Pt,2);{var ea=R=>{$a(R,{get notes(){return e(r).notes}})};o($t,R=>{e(r).notes&&R(ea)})}t(Tt),t(qt),c(()=>{v(Ze,`#${(e(r).batch_number||"?")??""}`),v(Ae,e(r).name||e(r).recipe?.name||"Unnamed Batch"),He.disabled=e(m),ct(He,`color: ${e(j).color??""}; background: ${e(j).bg??""};`),wt!==(wt=e(r).status)&&(He.value=(He.__value=e(r).status)??"",na(He,e(r).status))}),l(re,ye)};o(B,re=>{e(E)?re(I):re(ne,!1)},!0)}l(Xe,T)};o(he,Xe=>{e(r)?Xe(st,!1):Xe(at)},!0)}l(me,be)};o(ae,me=>{e(H)?me(J):me(Te,!1)},!0)}l(_,G)};o(de,_=>{e(N)?_(pe):_(fe,!1)})}t(Pe);var De=s(Pe,2);{var Oe=_=>{var G=Is();G.__click=()=>b(O,!1);var ae=a(G);ae.__click=st=>st.stopPropagation();var J=s(a(ae),2),Te=a(J);t(J);var me=s(J,2),be=a(me);be.__click=()=>b(O,!1);var he=s(be,2);he.__click=ge;var at=a(he,!0);t(he),t(me),t(ae),t(G),c(()=>{v(Te,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),be.disabled=e(P),he.disabled=e(P),v(at,e(P)?"Deleting...":"Delete Batch")}),l(_,G)};o(De,_=>{e(O)&&_(Oe)})}l(V,Be),_t(),p()}jt(["click","change"]);export{dr as component,or as universal};
