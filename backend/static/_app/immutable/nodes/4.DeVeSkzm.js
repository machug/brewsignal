import{d as Ne,f as d,s as n,a as l,c as me}from"../chunks/BQ88CgEU.js";import{al as a,ak as s,an as t,as as f,ah as Me,ar as J,c as e,ai as A,at as qe,aj as Pe,ao as le,p as kt,ap as wt,s as g,aL as Qt,aF as Xt,am as Zt}from"../chunks/CGXqq0_G.js";import{e as zt,i as Ft}from"../chunks/payu-7ZH.js";import{i as u}from"../chunks/ziKwUJ4R.js";import{h as $t}from"../chunks/BP8qDDK3.js";import{s as Ct}from"../chunks/D2zVhfuI.js";import{s as Ce}from"../chunks/DqcjHxzZ.js";import{s as Ee}from"../chunks/BSw_pJTS.js";import{i as ea,s as ta}from"../chunks/C5J5lxM1.js";import{s as aa,a as sa}from"../chunks/C-ohbqfQ.js";import{p as ra}from"../chunks/DAvaRZYN.js";import{g as ia}from"../chunks/WBDnnuwp.js";import{x as la,y as va,o as na,g as jt,z as Ie,h as oa,v as yt,A as $e}from"../chunks/D2Emw0fV.js";import{b as da,g as Bt,d as Ve,e as Rt,c as xt}from"../chunks/Dq6yox8V.js";import{t as ca}from"../chunks/DThvY6M2.js";import{B as ua}from"../chunks/BV_0Sdqd.js";import{s as _a}from"../chunks/CUQuFe4_.js";import{p as et}from"../chunks/B3wItnqC.js";const ga=!1,Is=Object.freeze(Object.defineProperty({__proto__:null,prerender:ga},Symbol.toStringTag,{value:"Module"}));function fa(E){return E>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:E>=-60?{bars:3,color:"var(--positive)",label:"Good"}:E>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function Tt(E){const r=Math.floor((Date.now()-new Date(E).getTime())/1e3);if(r<10)return"just now";if(r<60)return`${r}s ago`;const _=Math.floor(r/60);if(_<60)return`${_}m ago`;const R=Math.floor(_/60);return R<24?`${R}h ago`:`${Math.floor(R/24)}d ago`}var ma=d('<div class="accent-bar svelte-1oyrwd9"></div>'),pa=d('<span class="card-icon svelte-1oyrwd9"> </span>'),ba=d('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ha=d('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function Ae(E,r){let _=et(r,"highlight",3,!1),R=et(r,"collapsible",3,!1),m=et(r,"expanded",3,!1);var w=ha();let p;var i=a(w);{var M=b=>{var C=ma();l(b,C)};u(i,b=>{_()&&b(M)})}var c=s(i,2),B=a(c),T=a(B);{var I=b=>{var C=pa(),V=a(C,!0);t(C),f(()=>n(V,r.icon)),l(b,C)};u(T,b=>{r.icon&&b(I)})}var h=s(T,2),o=a(h,!0);t(h),t(B);var j=s(B,2);{var z=b=>{var C=ba();C.__click=function(...P){r.onToggle?.apply(this,P)};var V=a(C);let L;t(C),f(()=>{Ct(C,"aria-label",m()?"Collapse":"Expand"),L=Ce(V,0,"expand-icon svelte-1oyrwd9",null,L,{"rotate-180":m()})}),l(b,C)};u(j,b=>{R()&&r.onToggle&&b(z)})}t(c);var F=s(c,2);let x;var k=a(F);_a(k,()=>r.children),t(F),t(w),f(()=>{p=Ce(w,1,"batch-card svelte-1oyrwd9",null,p,{highlight:_()}),n(o,r.title),x=Ce(F,1,"card-content svelte-1oyrwd9",null,x,{collapsed:R()&&!m()})}),l(E,w)}Ne(["click"]);var ja=d('<span class="unit svelte-lzskfi"> </span>'),ya=d('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),xa=d('<div class="last-seen svelte-lzskfi"> </div>'),ka=d('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function wa(E,r){Me(r,!0);let _=A(()=>r.liveReading?.sg??r.currentSg),R=A(()=>r.liveReading?.temp??r.currentTemp),m=A(()=>r.liveReading?.sg_raw),w=A(()=>r.liveReading?.temp_raw),p=A(()=>r.liveReading?.last_seen),i=A(()=>r.liveReading&&(r.liveReading.sg!==r.liveReading.sg_raw||r.liveReading.temp!==r.liveReading.temp_raw)),M=A(da),c=A(Bt);function B(h){return h==null?"--":Ve(h)}function T(h){return h==null?"--":Rt(h)}let I=A(()=>e(p)?Tt(e(p)):null);Ae(E,{title:"Live Readings",highlight:!0,children:(h,o)=>{var j=ka(),z=s(J(j),2),F=a(z),x=a(F),k=a(x),b=s(k);{var C=U=>{var O=ja(),re=a(O,!0);t(O),f(()=>n(re,e(M))),l(U,O)};u(b,U=>{e(M)!=="SG"&&U(C)})}t(x);var V=s(x,2),L=a(V,!0);t(V),t(F);var P=s(F,2),H=a(P),Y=a(H),K=s(Y),te=a(K,!0);t(K),t(H),qe(2),t(P),t(z);var se=s(z,2);{var $=U=>{var O=ya(),re=s(a(O),2),Be=a(re,!0);t(re);var xe=s(re,4),S=a(xe);t(xe),t(O),f((q,v)=>{n(Be,q),n(S,`${v??""}${e(c)??""}`)},[()=>B(e(m)),()=>T(e(w))]),l(U,O)};u(se,U=>{e(i)&&U($)})}var de=s(se,2);{var ce=U=>{var O=xa(),re=a(O);t(O),f(()=>n(re,`Updated ${e(I)??""}`)),l(U,O)};u(de,U=>{e(I)&&U(ce)})}f((U,O)=>{n(k,`${U??""} `),n(L,e(M)==="SG"?"Gravity":e(M)==="¬∞P"?"Plato":"Brix"),n(Y,`${O??""} `),n(te,e(c))},[()=>B(e(_)),()=>T(e(R))]),l(h,j)},$$slots:{default:!0}}),Pe()}var za=d('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),Fa=d('<div class="progress-remaining svelte-t80j9z"> </div>'),Ca=d('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),Ba=d('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),Ra=d('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),Ta=d('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Sa(E,r){Me(r,!0);let _=A(()=>{if(!r.batch.measured_og)return null;const p=r.currentSg??r.progress?.measured?.current_sg;if(!p)return null;const i=(r.batch.measured_og-p)*131.25,M=r.batch.measured_og-1,c=M!==0?(r.batch.measured_og-p)/M*100:0;return{currentSg:p,abv:Math.max(0,i),attenuation:Math.max(0,Math.min(100,c)),isFermenting:r.batch.status==="fermenting"||r.batch.status==="conditioning"}}),R=A(()=>e(_)?.isFermenting??!1);function m(p){return p==null?"--":Ve(p)}function w(p){return p==null?"--":`${p.toFixed(1)}%`}{let p=A(()=>e(R)?"Fermentation Progress":"Fermentation Measurements");Ae(E,{get title(){return e(p)},children:(i,M)=>{var c=me(),B=J(c);{var T=h=>{var o=Ba(),j=J(o),z=s(a(j),2),F=a(z);qe(),t(z),t(j);var x=s(j,2),k=s(a(x),2),b=s(a(k),4),C=a(b,!0);t(b),t(k);var V=s(k,2);{var L=S=>{var q=za(),v=s(a(q),4),y=a(v,!0);t(v),t(q),f(G=>n(y,G),[()=>m(r.batch.recipe.fg_target)]),l(S,q)};u(V,S=>{r.batch.recipe?.fg_target&&S(L)})}var P=s(V,2),H=s(a(P),4),Y=a(H,!0);t(H),t(P),t(x);var K=s(x,2),te=a(K),se=s(a(te),2),$=s(a(se),2),de=a($);qe(),t($),t(se),t(te);var ce=s(te,2),U=s(a(ce),2),O=s(a(U),2),re=a(O);qe(),t(O),t(U),t(ce),t(K);var Be=s(K,2);{var xe=S=>{var q=Ca(),v=a(q),y=s(a(v),2),G=a(y);t(y),t(v);var N=s(v,2),pe=s(a(N),2);qe(2),t(N);var W=s(N,2);{var ae=Q=>{var be=Fa(),Re=a(be);t(be),f(ke=>n(Re,`${ke??""} gravity points remaining`),[()=>r.progress.progress.sg_remaining.toFixed(3)]),l(Q,be)};u(W,Q=>{r.progress.progress.sg_remaining!=null&&Q(ae)})}t(q),f(Q=>{n(G,`${Q??""}%`),Ee(pe,`width: ${r.progress.progress.percent_complete??""}%`)},[()=>r.progress.progress.percent_complete.toFixed(0)]),l(S,q)};u(Be,S=>{r.progress?.progress?.percent_complete!=null&&S(xe)})}f((S,q,v,y,G)=>{n(F,`${S??""} `),n(C,q),n(Y,v),n(de,`${y??""} `),n(re,`${G??""} `)},[()=>m(e(_).currentSg),()=>m(r.batch.measured_og),()=>m(e(_).currentSg),()=>w(e(_).abv),()=>w(e(_).attenuation)]),l(h,o)},I=h=>{var o=me(),j=J(o);{var z=x=>{var k=Ra(),b=a(k),C=s(a(b),2),V=a(C,!0);t(C),t(b);var L=s(b,2),P=s(a(L),2),H=a(P,!0);t(P),t(L);var Y=s(L,2),K=s(a(Y),2),te=a(K,!0);t(K),t(Y);var se=s(Y,2),$=s(a(se),2),de=a($,!0);t($),t(se),t(k),f((ce,U,O,re)=>{n(V,ce),n(H,U),n(te,O),n(de,re)},[()=>m(r.batch.measured_og),()=>m(r.batch.measured_fg),()=>r.batch.measured_abv!=null?w(r.batch.measured_abv):"--",()=>r.batch.measured_attenuation!=null?w(r.batch.measured_attenuation):"--"]),l(x,k)},F=x=>{var k=Ta();l(x,k)};u(j,x=>{r.batch.measured_og?x(z):x(F,!1)},!0)}l(h,o)};u(B,h=>{e(_)&&e(R)?h(T):h(I,!1)})}l(i,c)},$$slots:{default:!0}})}Pe()}var qa=d('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function Ma(E,r){Me(r,!0);function _(m){return m?new Date(m).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function R(m){return m?new Date(m).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}Ae(E,{title:"Timeline",children:(m,w)=>{var p=qa(),i=a(p),M=s(a(i),2),c=a(M,!0);t(M),t(i);var B=s(i,2),T=s(a(B),2),I=a(T,!0);t(T),t(B);var h=s(B,2),o=s(a(h),2),j=a(o,!0);t(o),t(h);var z=s(h,2),F=s(a(z),2),x=a(F,!0);t(F),t(z),t(p),f((k,b,C,V)=>{n(c,k),n(I,b),n(j,C),n(x,V)},[()=>_(r.batch.brew_date),()=>R(r.batch.start_time),()=>R(r.batch.end_time),()=>R(r.batch.created_at)]),l(m,p)},$$slots:{default:!0}}),Pe()}var Pa=d('<div class="signal-bar svelte-1kdxwtz"></div>'),Da=d('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),La=d('<div class="device-last-seen svelte-1kdxwtz"> </div>'),Oa=d('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Ga=d('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Aa=d('<div class="device-info svelte-1kdxwtz"><!></div>'),Ea=d('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Ua=d('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Ia(E,r){Me(r,!0);let _=A(()=>r.liveReading?.rssi?fa(r.liveReading.rssi):null),R=A(()=>r.liveReading?.last_seen?Tt(r.liveReading.last_seen):null);Ae(E,{title:"Tracking Device",children:(m,w)=>{var p=me(),i=J(p);{var M=B=>{var T=Aa(),I=a(T);{var h=j=>{var z=Oa(),F=J(z),x=s(a(F));t(F);var k=s(F,2);{var b=L=>{var P=Da(),H=a(P);zt(H,20,()=>Array(4),Ft,(te,se,$)=>{var de=Pa();f(()=>Ee(de,`
										height: ${6+$*3}px;
										background: ${($<e(_).bars?e(_).color:"var(--bg-hover)")??""};
										opacity: ${$<e(_).bars?1:.4};
									`)),l(te,de)}),t(H);var Y=s(H,2),K=a(Y);t(Y),t(P),f(()=>{Ee(Y,`color: ${e(_).color??""}`),n(K,`${e(_).label??""} (${r.liveReading.rssi??""} dBm)`)}),l(L,P)};u(k,L=>{e(_)&&L(b)})}var C=s(k,2);{var V=L=>{var P=La(),H=a(P);t(P),f(()=>n(H,`Updated ${e(R)??""}`)),l(L,P)};u(C,L=>{e(R)&&L(V)})}f(()=>n(x,` ${r.liveReading.color??""} Tilt - Connected`)),l(j,z)},o=j=>{var z=Ga(),F=J(z),x=s(a(F));t(F),qe(2),f(()=>n(x,` Device: ${r.batch.device_id??""}`)),l(j,z)};u(I,j=>{r.liveReading?j(h):j(o,!1)})}t(T),l(B,T)},c=B=>{var T=Ua(),I=s(a(T),2);{var h=o=>{var j=Ea();j.__click=function(...z){r.onEdit?.apply(this,z)},l(o,j)};u(I,o=>{r.onEdit&&o(h)})}t(T),l(B,T)};u(i,B=>{r.batch.device_id?B(M):B(c,!1)})}l(m,p)},$$slots:{default:!0}}),Pe()}Ne(["click"]);const Na=131.25;var Va=d('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Ha=d('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Wa(E,r){Me(r,!0);function _(m){return m==null?"--":Ve(m)}let R=A(()=>r.recipe.abv_target!=null?r.recipe.abv_target:r.recipe.og_target&&r.recipe.fg_target?(r.recipe.og_target-r.recipe.fg_target)*Na:null);Ae(E,{title:"Recipe Targets",children:(m,w)=>{var p=Ha(),i=a(p),M=s(a(i),2),c=a(M,!0);t(M),t(i);var B=s(i,2),T=s(a(B),2),I=a(T,!0);t(T),t(B);var h=s(B,2),o=s(a(h),2),j=a(o,!0);t(o),t(h);var z=s(h,2);{var F=x=>{var k=Va(),b=s(a(k),2),C=a(b,!0);t(b),t(k),f(()=>n(C,r.recipe.yeast_name)),l(x,k)};u(z,x=>{r.recipe.yeast_name&&x(F)})}t(p),f((x,k,b)=>{n(c,x),n(I,k),n(j,b)},[()=>_(r.recipe.og_target),()=>_(r.recipe.fg_target),()=>e(R)!=null?`${e(R).toFixed(1)}%`:"--"]),l(m,p)},$$slots:{default:!0}}),Pe()}var Ja=d('<p class="notes-content svelte-hkv31i"> </p>');function Ya(E,r){Ae(E,{title:"Notes",children:(_,R)=>{var m=Ja(),w=a(m,!0);t(m),f(()=>n(w,r.notes)),l(_,m)},$$slots:{default:!0}})}var Ka=d('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),Qa=d('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Xa=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Za=d('<span class="days svelte-1xs394q"> </span>'),$a=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"> <!></span></div>'),es=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Model Fit (R¬≤):</span> <div class="progress-wrapper svelte-1xs394q"><div class="progress-bar svelte-1xs394q"><div class="fill svelte-1xs394q"></div></div> <span class="percentage svelte-1xs394q"> </span></div></div>'),ts=d('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Readings:</span> <span class="value svelte-1xs394q"> </span></div>'),as=d('<div class="ml-panel svelte-1xs394q"><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">ML Predictions</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <div class="metrics svelte-1xs394q"><!> <!> <!> <!></div></div>'),ss=d('<div class="ml-panel disabled svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable (insufficient data)</p></div>');function rs(E,r){Me(r,!0);let _=le(kt({available:!1})),R=le(!0),m=le(!1),w=le(null);async function p(){g(R,!0),g(w,null);try{g(_,await la(r.batchId),!0)}catch(o){g(w,o instanceof Error?o.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",o)}finally{g(R,!1)}}async function i(){g(m,!0),g(w,null);try{const o=await va(r.batchId);console.log("Reloaded predictions:",o.message),await p()}catch(o){g(w,o instanceof Error?o.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",o)}finally{g(m,!1)}}wt(p);function M(o){return o?new Date(o).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function c(o){if(!o)return null;const j=new Date(o),z=new Date,F=j.getTime()-z.getTime();return Math.ceil(F/(1e3*60*60*24))}var B=me(),T=J(B);{var I=o=>{var j=Ka();l(o,j)},h=o=>{var j=me(),z=J(j);{var F=k=>{var b=Qa(),C=a(b),V=a(C);t(C),t(b),f(()=>n(V,`‚ö†Ô∏è ${e(w)??""}`)),l(k,b)},x=k=>{var b=me(),C=J(b);{var V=P=>{var H=as(),Y=a(H),K=s(a(Y),2);K.__click=i;var te=a(K,!0);t(K),t(Y);var se=s(Y,2),$=a(se);{var de=S=>{var q=Xa(),v=s(a(q),2),y=a(v,!0);t(v),t(q),f(G=>n(y,G),[()=>Ve(e(_).predicted_fg)]),l(S,q)};u($,S=>{e(_).predicted_fg&&S(de)})}var ce=s($,2);{var U=S=>{const q=A(()=>c(e(_).estimated_completion));var v=$a(),y=s(a(v),2),G=a(y),N=s(G);{var pe=W=>{var ae=Za(),Q=a(ae);t(ae),f(()=>n(Q,`(${e(q)??""} ${e(q)===1?"day":"days"})`)),l(W,ae)};u(N,W=>{e(q)!==null&&W(pe)})}t(y),t(v),f(W=>n(G,`${W??""} `),[()=>M(e(_).estimated_completion)]),l(S,v)};u(ce,S=>{e(_).estimated_completion&&S(U)})}var O=s(ce,2);{var re=S=>{var q=es(),v=s(a(q),2),y=a(v),G=a(y);t(y);var N=s(y,2),pe=a(N);t(N),t(v),t(q),f(W=>{Ee(G,`width: ${e(_).r_squared*100}%`),n(pe,`${W??""}%`)},[()=>(e(_).r_squared*100).toFixed(0)]),l(S,q)};u(O,S=>{e(_).r_squared!==void 0&&S(re)})}var Be=s(O,2);{var xe=S=>{var q=ts(),v=s(a(q),2),y=a(v);t(v),t(q),f(()=>n(y,`${e(_).num_readings??""} points`)),l(S,q)};u(Be,S=>{e(_).num_readings&&S(xe)})}t(se),t(H),f(()=>{K.disabled=e(m)||e(R),n(te,e(m)?"Reloading...":"‚Üª Reload")}),l(P,H)},L=P=>{var H=ss();l(P,H)};u(C,P=>{e(_).available?P(V):P(L,!1)},!0)}l(k,b)};u(z,k=>{e(w)?k(F):k(x,!1)},!0)}l(o,j)};u(T,o=>{e(R)?o(I):o(h,!1)})}l(E,B),Pe()}Ne(["click"]);var is=d('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),ls=d('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),vs=d('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),ns=d('<span class="recipe-type svelte-g5au2j"> </span>'),os=d('<a class="recipe-link svelte-g5au2j"> <!></a>'),ds=d('<option class="svelte-g5au2j"> </option>'),cs=d('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),us=d('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),_s=d('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),gs=d('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),fs=d('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),ms=d('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),ps=d('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),bs=d('<span class="svelte-g5au2j"> </span>'),hs=d('<span class="svelte-g5au2j"> </span>'),js=d('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),ys=d('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div>',1),xs=d('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),ks=d('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Ns(E,r){Me(r,!0);const _=()=>sa(ra,"$page",R),[R,m]=aa();let w=null,p=null,i=le(null),M=le(null),c=le(null);kt([]);let B=le(!0),T=le(null),I=le(!1),h=le(!1),o=le(!1),j=le(!1),z=le(!1),F=A(()=>parseInt(_().params.id??"0"));const x={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},k=["planning","fermenting","conditioning","completed","archived"];let b=A(()=>e(i)?x[e(i).status]:x.planning),C=A(Bt),V=A(()=>xt.config.ha_enabled&&xt.config.temp_control_enabled&&(e(i)?.heater_entity_id||e(i)?.cooler_entity_id)),L=A(()=>{if(!e(i)?.device_id)return null;const v=e(i).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!v?.[1])return null;const y=v[1].toUpperCase();for(const G of ca.tilts.values())if(G.color.toUpperCase()===y)return G;return null});async function P(){g(B,!0),g(T,null);try{if(g(i,await na(e(F)),!0),e(i).status==="fermenting"||e(i).status==="conditioning")try{g(M,await jt(e(F)),!0)}catch{}if(e(i).heater_entity_id||e(i).cooler_entity_id)try{g(c,await Ie(e(F)),!0)}catch{}}catch(v){g(T,v instanceof Error?v.message:"Failed to load batch",!0)}finally{g(B,!1)}}async function H(v){if(!(!e(i)||e(h))&&!(v==="conditioning"&&e(i).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){g(h,!0);try{g(i,await yt(e(i).id,{status:v}),!0),(v==="fermenting"||v==="conditioning")&&g(M,await jt(e(i).id),!0)}catch(y){console.error("Failed to update status:",y)}finally{g(h,!1)}}}async function Y(v){if(e(i)&&(g(i,await yt(e(i).id,v),!0),g(I,!1),e(i).heater_entity_id||e(i).cooler_entity_id))try{g(c,await Ie(e(i).id),!0)}catch{}}async function K(){if(e(i)){g(z,!0);try{await oa(e(i).id),ia("/batches")}catch(v){g(T,v instanceof Error?v.message:"Failed to delete batch",!0),g(z,!1),g(j,!1)}}}async function te(v,y){if(!(!e(i)||e(o))){g(o,!0);try{await $e(e(i).id,y,60,v),g(c,await Ie(e(i).id),!0)}catch(G){console.error("Failed to set override:",G)}finally{g(o,!1)}}}async function se(){if(!(!e(i)||e(o))){g(o,!0);try{e(i).heater_entity_id&&await $e(e(i).id,null,60,"heater"),e(i).cooler_entity_id&&await $e(e(i).id,null,60,"cooler"),g(c,await Ie(e(i).id),!0)}catch(v){console.error("Failed to clear overrides:",v)}finally{g(o,!1)}}}function $(){if(w?.readyState===WebSocket.OPEN)return;const y=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;w=new WebSocket(y),w.onmessage=async G=>{try{const N=JSON.parse(G.data);N.type==="control_event"&&N.batch_id===e(F)&&e(c)&&(N.action==="heat_on"?g(c,{...e(c),heater_state:"on"},!0):N.action==="heat_off"?g(c,{...e(c),heater_state:"off"},!0):N.action==="cool_on"?g(c,{...e(c),cooler_state:"on"},!0):N.action==="cool_off"&&g(c,{...e(c),cooler_state:"off"},!0))}catch{}},w.onclose=()=>{w=null,p=setTimeout($,3e3)},w.onerror=()=>{w?.close()}}function de(){p&&(clearTimeout(p),p=null),w?.close(),w=null}function ce(v){return v==null?"--":Rt(v)}wt(()=>{P(),$()}),Qt(()=>{de()});var U=ks();$t("g5au2j",v=>{Xt(()=>{Zt.title=`${(e(i)?.name||"Batch")??""} | BrewSignal`})});var O=J(U),re=s(a(O),2);{var Be=v=>{var y=is();l(v,y)},xe=v=>{var y=me(),G=J(y);{var N=W=>{var ae=ls(),Q=s(a(ae),2),be=a(Q,!0);t(Q);var Re=s(Q,2);Re.__click=P,t(ae),f(()=>n(be,e(T))),l(W,ae)},pe=W=>{var ae=me(),Q=J(ae);{var be=ke=>{var Ue=vs();l(ke,Ue)},Re=ke=>{var Ue=me(),St=J(Ue);{var qt=De=>{ua(De,{get batch(){return e(i)},onSubmit:Y,onCancel:()=>g(I,!1)})},Mt=De=>{var tt=ys(),He=J(tt),We=a(He),Je=a(We),Pt=a(Je);t(Je);var at=s(Je,2),Ye=a(at),Dt=a(Ye,!0);t(Ye);var Lt=s(Ye,2);{var Ot=D=>{var X=os(),ie=a(X),je=s(ie);{var ue=ye=>{var we=ns(),Le=a(we);t(we),f(()=>n(Le,`(${e(i).recipe.type??""})`)),l(ye,we)};u(je,ye=>{e(i).recipe.type&&ye(ue)})}t(X),f(()=>{Ct(X,"href",`/recipes/${e(i).recipe.id??""}`),n(ie,`${e(i).recipe.name??""} `)}),l(D,X)};u(Lt,D=>{e(i).recipe&&D(Ot)})}t(at),t(We);var st=s(We,2),Ke=a(st),he=a(Ke);he.__change=D=>H(D.currentTarget.value),zt(he,21,()=>k,Ft,(D,X)=>{var ie=ds(),je=a(ie,!0);t(ie);var ue={};f(()=>{n(je,x[e(X)].label),ue!==(ue=e(X))&&(ie.value=(ie.__value=e(X))??"")}),l(D,ie)}),t(he);var rt;ea(he),t(Ke);var it=s(Ke,2);it.__click=()=>g(I,!0);var Gt=s(it,2);Gt.__click=()=>g(j,!0),t(st),t(He);var lt=s(He,2),Qe=a(lt),vt=a(Qe);{var At=D=>{{let X=A(()=>e(M)?.measured?.current_sg),ie=A(()=>e(M)?.temperature?.current);wa(D,{get liveReading(){return e(L)},get currentSg(){return e(X)},get currentTemp(){return e(ie)}})}};u(vt,D=>{(e(L)||e(M)?.measured?.current_sg!=null)&&D(At)})}var nt=s(vt,2);{let D=A(()=>e(L)?.sg??e(M)?.measured?.current_sg);Sa(nt,{get batch(){return e(i)},get currentSg(){return e(D)},get progress(){return e(M)}})}var Et=s(nt,2);{var Ut=D=>{Wa(D,{get recipe(){return e(i).recipe}})};u(Et,D=>{e(i).recipe&&D(Ut)})}t(Qe);var ot=s(Qe,2),dt=a(ot);Ma(dt,{get batch(){return e(i)}});var ct=s(dt,2);Ia(ct,{get batch(){return e(i)},get liveReading(){return e(L)},onEdit:()=>g(I,!0)});var ut=s(ct,2);rs(ut,{get batchId(){return e(i).id}});var _t=s(ut,2);{var It=D=>{var X=ps();let ie;var je=s(a(X),2),ue=a(je);{var ye=ve=>{var Z=cs(),ee=a(Z);let ne;var ze=s(ee,2),_e=s(a(ze),2);let Fe;var Oe=a(_e,!0);t(_e);var Te=s(_e,2),Ge=a(Te,!0);t(Te),t(ze),t(Z),f(()=>{ne=Ce(ee,1,"device-icon-wrap svelte-g5au2j",null,ne,{active:e(c)?.heater_state==="on"}),Fe=Ce(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(c)?.heater_state==="on"}),n(Oe,e(c)?.heater_state==="on"?"ON":"OFF"),n(Ge,e(i).heater_entity_id)}),l(ve,Z)};u(ue,ve=>{e(i).heater_entity_id&&ve(ye)})}var we=s(ue,2);{var Le=ve=>{var Z=us(),ee=a(Z);let ne;var ze=s(ee,2),_e=s(a(ze),2);let Fe;var Oe=a(_e,!0);t(_e);var Te=s(_e,2),Ge=a(Te,!0);t(Te),t(ze),t(Z),f(()=>{ne=Ce(ee,1,"device-icon-wrap svelte-g5au2j",null,ne,{active:e(c)?.cooler_state==="on"}),Fe=Ce(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(c)?.cooler_state==="on"}),n(Oe,e(c)?.cooler_state==="on"?"ON":"OFF"),n(Ge,e(i).cooler_entity_id)}),l(ve,Z)};u(we,ve=>{e(i).cooler_entity_id&&ve(Le)})}t(je);var Xe=s(je,2);{var Ze=ve=>{var Z=ms(),ee=J(Z),ne=a(ee),ze=s(a(ne),2),_e=a(ze);t(ze),t(ne);var Fe=s(ne,2),Oe=s(a(Fe),2),Te=a(Oe);t(Oe),t(Fe),t(ee);var Ge=s(ee,2);{var Wt=oe=>{var ge=_s(),fe=s(a(ge),2),Se=a(fe);t(fe);var ht=s(fe,2);ht.__click=()=>se(),t(ge),f(Kt=>{n(Se,`Override active: ${Kt??""}`),ht.disabled=e(o)},[()=>e(c).override_state?.toUpperCase()]),l(oe,ge)};u(Ge,oe=>{e(c).override_active&&oe(Wt)})}var gt=s(Ge,2),ft=s(a(gt),2),mt=a(ft);{var Jt=oe=>{var ge=gs(),fe=J(ge);fe.__click=()=>te("heater","on");var Se=s(fe,2);Se.__click=()=>te("heater","off"),f(()=>{fe.disabled=e(o),Se.disabled=e(o)}),l(oe,ge)};u(mt,oe=>{e(i).heater_entity_id&&oe(Jt)})}var pt=s(mt,2);{var Yt=oe=>{var ge=fs(),fe=J(ge);fe.__click=()=>te("cooler","on");var Se=s(fe,2);Se.__click=()=>te("cooler","off"),f(()=>{fe.disabled=e(o),Se.disabled=e(o)}),l(oe,ge)};u(pt,oe=>{e(i).cooler_entity_id&&oe(Yt)})}var bt=s(pt,2);bt.__click=()=>se(),t(ft),t(gt),f((oe,ge)=>{n(_e,`${oe??""}${e(C)??""}`),n(Te,`¬±${ge??""}${e(C)??""}`),bt.disabled=e(o)},[()=>ce(e(c).target_temp),()=>e(c).hysteresis?.toFixed(1)||"--"]),l(ve,Z)};u(Xe,ve=>{e(c)&&ve(Ze)})}t(X),f(()=>ie=Ce(X,1,"info-card temp-control-card svelte-g5au2j",null,ie,{"heater-on":e(c)?.heater_state==="on","cooler-on":e(c)?.cooler_state==="on"})),l(D,X)},Nt=D=>{var X=me(),ie=J(X);{var je=ue=>{var ye=js(),we=s(a(ye),2),Le=a(we);{var Xe=Z=>{var ee=bs(),ne=a(ee);t(ee),f(()=>n(ne,`Heater: ${e(i).heater_entity_id??""}`)),l(Z,ee)};u(Le,Z=>{e(i).heater_entity_id&&Z(Xe)})}var Ze=s(Le,2);{var ve=Z=>{var ee=hs(),ne=a(ee);t(ee),f(()=>n(ne,`Cooler: ${e(i).cooler_entity_id??""}`)),l(Z,ee)};u(Ze,Z=>{e(i).cooler_entity_id&&Z(ve)})}qe(2),t(we),t(ye),l(ue,ye)};u(ie,ue=>{(e(i).heater_entity_id||e(i).cooler_entity_id)&&e(i).status!=="fermenting"&&ue(je)},!0)}l(D,X)};u(_t,D=>{e(V)&&(e(i).status==="fermenting"||e(i).status==="conditioning")?D(It):D(Nt,!1)})}var Vt=s(_t,2);{var Ht=D=>{Ya(D,{get notes(){return e(i).notes}})};u(Vt,D=>{e(i).notes&&D(Ht)})}t(ot),t(lt),f(()=>{n(Pt,`#${(e(i).batch_number||"?")??""}`),n(Dt,e(i).name||e(i).recipe?.name||"Unnamed Batch"),he.disabled=e(h),Ee(he,`color: ${e(b).color??""}; background: ${e(b).bg??""};`),rt!==(rt=e(i).status)&&(he.value=(he.__value=e(i).status)??"",ta(he,e(i).status))}),l(De,tt)};u(St,De=>{e(I)?De(qt):De(Mt,!1)},!0)}l(ke,Ue)};u(Q,ke=>{e(i)?ke(Re,!1):ke(be)},!0)}l(W,ae)};u(G,W=>{e(T)?W(N):W(pe,!1)},!0)}l(v,y)};u(re,v=>{e(B)?v(Be):v(xe,!1)})}t(O);var S=s(O,2);{var q=v=>{var y=xs();y.__click=()=>g(j,!1);var G=a(y);G.__click=Re=>Re.stopPropagation();var N=s(a(G),2),pe=a(N);t(N);var W=s(N,2),ae=a(W);ae.__click=()=>g(j,!1);var Q=s(ae,2);Q.__click=K;var be=a(Q,!0);t(Q),t(W),t(G),t(y),f(()=>{n(pe,`Are you sure you want to delete "${(e(i)?.name||"this batch")??""}"? This cannot be undone.`),ae.disabled=e(z),Q.disabled=e(z),n(be,e(z)?"Deleting...":"Delete Batch")}),l(v,y)};u(S,v=>{e(j)&&v(q)})}l(E,U),Pe(),m()}Ne(["click","change"]);export{Ns as component,Is as universal};
