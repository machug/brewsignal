import{d as qe,f as v,s as _,a as o,c as Ge,t as He}from"../chunks/_XOVx4lj.js";import{a as ze,d as s,g as l,j as a,i as e,l as C,t as x,h as Oe,n as pe,f as fe,s as X,p as Ee,o as Ke,av as We,c as w,e as Xe,at as Ze}from"../chunks/DB-qchCW.js";import{e as $e}from"../chunks/BGNkgO3t.js";import{i as m}from"../chunks/CxlJqsN3.js";import{h as et}from"../chunks/D33WWFu2.js";import{s as tt,r as at}from"../chunks/N6Y6k7Jx.js";import{s as oe}from"../chunks/D_MCKjsL.js";import{b as st}from"../chunks/BAqk-K3z.js";import{g as Ne}from"../chunks/DCKtIW32.js";import{P as rt,Q as nt,R as it,S as lt,T as ot,U as ct}from"../chunks/1yiRDCQX.js";import{s as me}from"../chunks/Cyhgece8.js";import{p as Ie}from"../chunks/BkP0kwBq.js";import{b as vt,d as dt,e as ut,g as _t}from"../chunks/Cr6P68AF.js";import{t as Qe}from"../chunks/B-gTNqYv.js";var gt=v('<span class="recipe-name svelte-6cd32a"> </span>'),mt=v('<span class="activity-badge svelte-6cd32a"> </span>'),pt=v('<span class="status-dot svelte-6cd32a"></span>'),ft=v('<div class="metric svelte-6cd32a"><div class="metric-value temp svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span> <span class="temp-indicator svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a">Temp</div></div>'),bt=v('<div class="metric svelte-6cd32a"><div class="metric-value progress-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a">%</span></div> <div class="metric-label svelte-6cd32a">Progress</div></div>'),ht=v('<div class="progress-bar-container svelte-6cd32a"><div class="progress-bar svelte-6cd32a"></div> <div class="progress-markers svelte-6cd32a"><span class="svelte-6cd32a">0%</span> <span class="svelte-6cd32a">50%</span> <span class="svelte-6cd32a">100%</span></div></div>'),wt=v('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">ABV</span> <span class="stat-value svelte-6cd32a"> </span></div> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Atten</span> <span class="stat-value svelte-6cd32a"> </span></div>',1),yt=v('<div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Target FG</span> <span class="stat-value svelte-6cd32a"> </span></div>'),xt=v('<button type="button" class="action-btn svelte-6cd32a">View <svg class="action-icon svelte-6cd32a" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" class="svelte-6cd32a"></path></svg></button>'),kt=v('<button type="button" class="expand-btn svelte-6cd32a"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" class="svelte-6cd32a"></path></svg></button>'),Bt=v('<div><div class="accent-stripe svelte-6cd32a"></div> <div class="card-content svelte-6cd32a"><div class="header svelte-6cd32a"><div class="header-left svelte-6cd32a"><div class="batch-number svelte-6cd32a"> </div> <div class="title-group svelte-6cd32a"><h3 class="batch-name svelte-6cd32a"> </h3> <!></div></div> <div class="header-right svelte-6cd32a"><!> <button type="button" class="status-pill svelte-6cd32a"><!> </button></div></div> <div class="metrics-row svelte-6cd32a"><div class="metric svelte-6cd32a"><div class="metric-value svelte-6cd32a"> <span class="metric-unit svelte-6cd32a"> </span></div> <div class="metric-label svelte-6cd32a"> </div></div> <!> <!></div> <!> <div class="stats-row svelte-6cd32a"><!> <!> <div class="stat svelte-6cd32a"><span class="stat-label svelte-6cd32a">Brewed</span> <span class="stat-value svelte-6cd32a"> </span></div></div> <div class="footer svelte-6cd32a"><span class="brew-date svelte-6cd32a"> </span> <div class="footer-actions svelte-6cd32a"><!> <!></div></div></div></div>');function Ct(Se,r){ze(r,!0);let A=Ie(r,"liveReading",3,null),Z=Ie(r,"expanded",3,!1);const $={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},Q={in_range:{icon:"‚úì",color:"var(--positive)"},too_cold:{icon:"‚Üì",color:"#3b82f6"},too_hot:{icon:"‚Üë",color:"var(--negative)"},unknown:{icon:"?",color:"var(--text-muted)"}};let f=C(()=>$[r.batch.status]||$.planning),F=C(()=>r.progress?.temperature?.status?Q[r.progress.temperature.status]:Q.unknown),R=C(vt),Te=C(_t),ee=C(()=>{if(r.batch.status!=="fermenting"&&r.batch.status!=="conditioning")return null;const t=A()?.sg_rate;if(t==null)return null;const n=Math.abs(t);return n>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:n>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:n>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),ce=C(()=>A()?.is_anomaly??!1);function P(t){return t==null?"--":dt(t)}function je(t){return t==null?"--":ut(t)}function Ae(){if(!r.batch.brew_date)return"--";const t=new Date(r.batch.brew_date),c=Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24));return c===0?"Today":c===1?"1 day":`${c} days`}function Re(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}let te=C(Ae),ve=C(()=>r.batch.name||r.batch.recipe?.name||"Unnamed Batch");var q=Bt();let be;var ae=s(q),he=l(ae,2),z=s(he),O=s(z),Y=s(O),we=s(Y);a(Y);var se=l(Y,2),re=s(se),ye=s(re,!0);a(re);var xe=l(re,2);{var ke=t=>{var n=gt(),c=s(n,!0);a(n),x(()=>_(c,r.batch.recipe.name)),o(t,n)};m(xe,t=>{r.batch.recipe?.name&&r.batch.name&&r.batch.name!==r.batch.recipe.name&&t(ke)})}a(se),a(O);var de=l(O,2),Be=s(de);{var Le=t=>{var n=mt(),c=s(n);a(n),x(()=>{me(n,`color: ${e(ee).color??""};`),_(c,`${e(ee).emoji??""} ${e(ee).label??""}`)}),o(t,n)};m(Be,t=>{e(ee)&&t(Le)})}var ne=l(Be,2);ne.__click=()=>r.onStatusChange?.(r.batch.status);var i=s(ne);{var d=t=>{var n=pt();o(t,n)};m(i,t=>{r.batch.status==="fermenting"&&t(d)})}var h=l(i);a(ne),a(de),a(z);var p=l(z,2),g=s(p),u=s(g),S=s(u),G=l(S),ue=s(G,!0);a(G),a(u);var ie=l(u,2),H=s(ie,!0);a(ie),a(g);var L=l(g,2);{var J=t=>{var n=ft(),c=s(n),M=s(c),j=l(M),Me=s(j,!0);a(j);var ge=l(j,2),Fe=s(ge,!0);a(ge),a(c),pe(2),a(n),x(Pe=>{me(c,`color: ${e(F).color??""};`),_(M,`${Pe??""} `),_(Me,e(Te)),_(Fe,e(F).icon)},[()=>je(r.progress.temperature.current)]),o(t,n)};m(L,t=>{r.progress?.temperature?.current!=null&&t(J)})}var b=l(L,2);{var K=t=>{var n=bt(),c=s(n),M=s(c);pe(),a(c),pe(2),a(n),x(j=>_(M,`${j??""} `),[()=>r.progress.progress.percent_complete.toFixed(0)]),o(t,n)};m(b,t=>{r.progress?.progress?.percent_complete!==void 0&&r.progress.progress.percent_complete!==null&&t(K)})}a(p);var D=l(p,2);{var N=t=>{var n=ht(),c=s(n);pe(2),a(n),x(()=>me(c,`width: ${r.progress?.progress?.percent_complete??0??""}%;`)),o(t,n)};m(D,t=>{(r.batch.status==="fermenting"||r.batch.status==="conditioning")&&t(N)})}var U=l(D,2),le=s(U);{var W=t=>{var n=wt(),c=fe(n),M=l(s(c),2),j=s(M);a(M),a(c);var Me=l(c,2),ge=l(s(Me),2),Fe=s(ge);a(ge),a(Me),x((Pe,Je)=>{_(j,`${Pe??""}%`),_(Fe,`${Je??""}%`)},[()=>r.progress.measured.abv?.toFixed(1)??"--",()=>r.progress.measured.attenuation?.toFixed(0)??"--"]),o(t,n)};m(le,t=>{r.batch.measured_og&&r.progress?.measured?.current_sg&&t(W)})}var y=l(le,2);{var k=t=>{var n=yt(),c=l(s(n),2),M=s(c,!0);a(c),a(n),x(j=>_(M,j),[()=>P(r.progress.targets.fg)]),o(t,n)};m(y,t=>{r.progress?.targets?.fg&&t(k)})}var V=l(y,2),E=l(s(V),2),Ue=s(E,!0);a(E),a(V),a(U);var B=l(U,2),T=s(B),Ve=s(T,!0);a(T);var Ce=l(T,2),De=s(Ce);{var I=t=>{var n=xt();n.__click=function(...c){r.onViewDetails?.apply(this,c)},o(t,n)};m(De,t=>{r.onViewDetails&&t(I)})}var _e=l(De,2);{var Ye=t=>{var n=kt();n.__click=function(...j){r.onToggleExpand?.apply(this,j)};var c=s(n);let M;a(n),x(()=>{tt(n,"aria-label",Z()?"Collapse":"Expand"),M=oe(c,0,"expand-icon svelte-6cd32a",null,M,{"rotate-180":Z()})}),o(t,n)};m(_e,t=>{r.onToggleExpand&&t(Ye)})}a(Ce),a(B),a(he),a(q),x((t,n)=>{be=oe(q,1,"batch-card svelte-6cd32a",null,be,{expanded:Z(),fermenting:r.batch.status==="fermenting","has-anomaly":e(ce)}),me(ae,`background: ${(e(ce)?"#f59e0b":e(f).color)??""};`),_(we,`#${(r.batch.batch_number||"?")??""}`),_(ye,e(ve)),me(ne,`color: ${e(f).color??""}; background: ${e(f).bg??""};`),_(h,` ${e(f).label??""}`),_(S,`${t??""} `),_(ue,e(R)!=="SG"?e(R):""),_(H,r.progress?.measured?.current_sg?"Current":"OG"),_(Ue,e(te)),_(Ve,n)},[()=>P(r.progress?.measured?.current_sg??r.batch.measured_og),()=>Re(r.batch.brew_date)]),o(Se,q),Oe()}qe(["click"]);var Dt=v('<div><span> </span> <button type="button" class="notification-close svelte-40gn7n">√ó</button></div>'),Mt=v('<div class="loading-state svelte-40gn7n"><div class="spinner svelte-40gn7n"></div> <span>Loading batches...</span></div>'),St=v('<div class="error-state svelte-40gn7n"><span class="error-icon svelte-40gn7n">!</span> <p> </p> <button type="button" class="retry-btn svelte-40gn7n">Retry</button></div>'),Tt=v('<button type="button" class="create-btn svelte-40gn7n">Create Batch</button>'),jt=v('<div class="empty-icon svelte-40gn7n">üç∫</div> <h3 class="svelte-40gn7n"> </h3> <p class="svelte-40gn7n"><!></p> <!>',1),At=v('<div class="empty-icon svelte-40gn7n">üîç</div> <h3 class="svelte-40gn7n">No matches</h3> <p class="svelte-40gn7n">Try adjusting your search query</p>',1),Rt=v('<div class="empty-state svelte-40gn7n"><!></div>'),Lt=v('<div class="deleted-badge svelte-40gn7n"><svg class="badge-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg> </div>'),Ut=v('<div class="batch-actions svelte-40gn7n"><button type="button" class="action-restore svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Restore</button> <button type="button" class="action-delete svelte-40gn7n"><svg class="action-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg> Permanent Delete</button></div>'),Vt=v('<div class="batch-wrapper svelte-40gn7n"><!> <!> <!></div>'),Ft=v('<div class="batches-grid svelte-40gn7n"></div>'),Pt=v('<div class="page-container svelte-40gn7n"><!> <div class="page-header svelte-40gn7n"><div class="header-content svelte-40gn7n"><h1 class="page-title svelte-40gn7n">Batches</h1> <p class="page-description svelte-40gn7n">Track your fermentation batches</p></div> <button type="button" class="create-btn svelte-40gn7n"><svg class="btn-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg> New Batch</button></div> <div class="tabs-container svelte-40gn7n"><div class="tabs svelte-40gn7n"><button type="button">Active</button> <button type="button">Completed</button> <button type="button">Deleted</button></div> <div class="search-box svelte-40gn7n"><svg class="search-icon svelte-40gn7n" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Search batches..." class="search-input svelte-40gn7n"/></div></div> <!></div>');function Zt(Se,r){ze(r,!0);let A=X(Ee([])),Z=X(Ee(new Map)),$=X(!0),Q=X(null),f=X("active"),F=X(""),R=X(null),Te=C(()=>new Map(e(A).filter(i=>i.device_id&&(i.status==="fermenting"||i.status==="conditioning")).map(i=>[i.device_id,i.id]))),ee=C(()=>{const i=new Map(e(Z));for(const[d,h]of e(Te)){const p=Qe.tilts.get(d);if(p){const g=i.get(h)||{batch_id:h,status:"fermenting",measured:{},temperature:{status:"unknown"},progress:{},targets:{}};i.set(h,{...g,measured:{...g.measured,current_sg:p.sg},temperature:{...g.temperature,current:p.temp,status:g.temperature.yeast_min!==void 0&&g.temperature.yeast_max!==void 0?p.temp<g.temperature.yeast_min?"too_cold":p.temp>g.temperature.yeast_max?"too_hot":"in_range":g.temperature.status}})}}return i}),ce=C(()=>e(A).filter(i=>!e(F)||(i.name?.toLowerCase().includes(e(F).toLowerCase())??!1)||(i.recipe?.name?.toLowerCase().includes(e(F).toLowerCase())??!1)));async function P(){w($,!0),w(Q,null);try{switch(e(f)){case"active":w(A,await it(),!0);break;case"completed":w(A,await nt(),!0);break;case"deleted":w(A,await rt(),!0);break}const i=["fermenting","conditioning"],h=e(A).filter(u=>i.includes(u.status)).map(async u=>{try{const S=await lt(u.id);return[u.id,S]}catch{return null}}),p=await Promise.all(h),g=new Map;for(const u of p)u&&g.set(u[0],u[1]);w(Z,g,!0)}catch(i){w(Q,i instanceof Error?i.message:"Failed to load batches",!0)}finally{w($,!1)}}function je(i){Ne(`/batches/${i}`)}async function Ae(i,d){const h=e(f)==="deleted",p=h?"This will permanently delete this batch. This cannot be undone. Are you sure?":`Soft delete "${d}"? You can restore it later from the Deleted tab.`;if(confirm(p))try{await ct(i,h),te("Batch deleted successfully","success"),await P()}catch{te("Failed to delete batch","error")}}async function Re(i,d){try{await ot(i),te(`"${d}" restored successfully`,"success"),await P()}catch{te("Failed to restore batch","error")}}function te(i,d){w(R,{message:i,type:d},!0),setTimeout(()=>{w(R,null)},3e3)}Ke(()=>{P()}),We(()=>{e(f)!==void 0&&P()});var ve=Pt();et("40gn7n",i=>{Xe(()=>{Ze.title="Batches | BrewSignal"})});var q=s(ve);{var be=i=>{var d=Dt();let h;var p=s(d),g=s(p,!0);a(p);var u=l(p,2);u.__click=()=>w(R,null),a(d),x(()=>{h=oe(d,1,"notification svelte-40gn7n",null,h,{success:e(R).type==="success",error:e(R).type==="error"}),_(g,e(R).message)}),o(i,d)};m(q,i=>{e(R)&&i(be)})}var ae=l(q,2),he=l(s(ae),2);he.__click=()=>Ne("/batches/new"),a(ae);var z=l(ae,2),O=s(z),Y=s(O);let we;Y.__click=()=>w(f,"active");var se=l(Y,2);let re;se.__click=()=>w(f,"completed");var ye=l(se,2);let xe;ye.__click=()=>w(f,"deleted"),a(O);var ke=l(O,2),de=l(s(ke),2);at(de),a(ke),a(z);var Be=l(z,2);{var Le=i=>{var d=Mt();o(i,d)},ne=i=>{var d=Ge(),h=fe(d);{var p=u=>{var S=St(),G=l(s(S),2),ue=s(G,!0);a(G);var ie=l(G,2);ie.__click=P,a(S),x(()=>_(ue,e(Q))),o(u,S)},g=u=>{var S=Ge(),G=fe(S);{var ue=H=>{var L=Rt(),J=s(L);{var b=D=>{var N=jt(),U=l(fe(N),2),le=s(U);a(U);var W=l(U,2),y=s(W);{var k=B=>{var T=He("Create your first batch to start tracking fermentation");o(B,T)},V=B=>{var T=Ge(),Ve=fe(T);{var Ce=I=>{var _e=He("Complete a batch to see it here");o(I,_e)},De=I=>{var _e=He("Deleted batches will appear here");o(I,_e)};m(Ve,I=>{e(f)==="completed"?I(Ce):I(De,!1)},!0)}o(B,T)};m(y,B=>{e(f)==="active"?B(k):B(V,!1)})}a(W);var E=l(W,2);{var Ue=B=>{var T=Tt();T.__click=()=>Ne("/batches/new"),o(B,T)};m(E,B=>{e(f)==="active"&&B(Ue)})}x(()=>_(le,`No ${e(f)??""} batches yet`)),o(D,N)},K=D=>{var N=At();pe(4),o(D,N)};m(J,D=>{e(A).length===0?D(b):D(K,!1)})}a(L),o(H,L)},ie=H=>{var L=Ft();$e(L,21,()=>e(ce),J=>J.id,(J,b)=>{var K=Vt(),D=s(K);{var N=y=>{var k=Lt(),V=l(s(k));a(k),x(E=>_(V,` Deleted ${E??""}`),[()=>new Date(e(b).deleted_at).toLocaleDateString()]),o(y,k)};m(D,y=>{e(b).deleted_at&&y(N)})}var U=l(D,2);{let y=C(()=>e(ee).get(e(b).id)),k=C(()=>e(b).device_id?Qe.tilts.get(e(b).device_id):null);Ct(U,{get batch(){return e(b)},get progress(){return e(y)},get liveReading(){return e(k)},onViewDetails:()=>je(e(b).id)})}var le=l(U,2);{var W=y=>{var k=Ut(),V=s(k);V.__click=()=>Re(e(b).id,e(b).name||e(b).recipe?.name||"Unnamed Batch");var E=l(V,2);E.__click=()=>Ae(e(b).id,e(b).name||e(b).recipe?.name||"Unnamed Batch"),a(k),o(y,k)};m(le,y=>{e(b).deleted_at&&y(W)})}a(K),o(J,K)}),a(L),o(H,L)};m(G,H=>{e(ce).length===0?H(ue):H(ie,!1)},!0)}o(u,S)};m(h,u=>{e(Q)?u(p):u(g,!1)},!0)}o(i,d)};m(Be,i=>{e($)?i(Le):i(ne,!1)})}a(ve),x(()=>{we=oe(Y,1,"tab svelte-40gn7n",null,we,{active:e(f)==="active"}),re=oe(se,1,"tab svelte-40gn7n",null,re,{active:e(f)==="completed"}),xe=oe(ye,1,"tab svelte-40gn7n",null,xe,{active:e(f)==="deleted"})}),st(de,()=>e(F),i=>w(F,i)),o(Se,ve),Oe()}qe(["click"]);export{Zt as component};
