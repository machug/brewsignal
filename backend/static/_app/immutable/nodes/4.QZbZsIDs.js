import{d as et,f as n,s as v,a as l,c as ye}from"../chunks/BQ88CgEU.js";import{al as a,ak as s,an as t,as as g,ah as Re,ar as Y,c as e,ai as N,at as qe,aj as De,ao as de,p as Yt,ap as kt,s as j,aL as Kt,aF as Xt,am as Zt}from"../chunks/CGXqq0_G.js";import{e as wt,i as zt}from"../chunks/payu-7ZH.js";import{i as u}from"../chunks/ziKwUJ4R.js";import{h as $t}from"../chunks/BP8qDDK3.js";import{s as Ft}from"../chunks/D2zVhfuI.js";import{s as Ce}from"../chunks/DqcjHxzZ.js";import{s as Pe}from"../chunks/BSw_pJTS.js";import{i as ea,s as ta}from"../chunks/C5J5lxM1.js";import{s as aa,a as sa}from"../chunks/C-ohbqfQ.js";import{p as ra}from"../chunks/DCG9bEow.js";import{g as ia}from"../chunks/BpLNeknb.js";import{o as la,g as jt,w as Ne,h as va,u as yt,x as Ze}from"../chunks/AheCACzJ.js";import{b as na,g as Ct,d as Ie,e as Bt,c as xt}from"../chunks/Dq6yox8V.js";import{t as oa}from"../chunks/DThvY6M2.js";import{B as da}from"../chunks/BXkRwvHZ.js";import{s as ca}from"../chunks/CUQuFe4_.js";import{p as $e}from"../chunks/B3wItnqC.js";const ua=!1,Es=Object.freeze(Object.defineProperty({__proto__:null,prerender:ua},Symbol.toStringTag,{value:"Module"}));function _a(I){return I>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:I>=-60?{bars:3,color:"var(--positive)",label:"Good"}:I>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function St(I){const r=Math.floor((Date.now()-new Date(I).getTime())/1e3);if(r<10)return"just now";if(r<60)return`${r}s ago`;const o=Math.floor(r/60);if(o<60)return`${o}m ago`;const O=Math.floor(o/60);return O<24?`${O}h ago`:`${Math.floor(O/24)}d ago`}var ga=n('<div class="accent-bar svelte-1oyrwd9"></div>'),fa=n('<span class="card-icon svelte-1oyrwd9"> </span>'),pa=n('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),ma=n('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function Ae(I,r){let o=$e(r,"highlight",3,!1),O=$e(r,"collapsible",3,!1),m=$e(r,"expanded",3,!1);var R=ma();let p;var i=a(R);{var D=w=>{var T=ga();l(w,T)};u(i,w=>{o()&&w(D)})}var d=s(i,2),_=a(d),y=a(_);{var A=w=>{var T=fa(),H=a(T,!0);t(T),g(()=>v(H,r.icon)),l(w,T)};u(y,w=>{r.icon&&w(A)})}var f=s(y,2),x=a(f,!0);t(f),t(_);var b=s(_,2);{var k=w=>{var T=pa();T.__click=function(...E){r.onToggle?.apply(this,E)};var H=a(T);let G;t(T),g(()=>{Ft(T,"aria-label",m()?"Collapse":"Expand"),G=Ce(H,0,"expand-icon svelte-1oyrwd9",null,G,{"rotate-180":m()})}),l(w,T)};u(b,w=>{O()&&r.onToggle&&w(k)})}t(d);var C=s(d,2);let h;var S=a(C);ca(S,()=>r.children),t(C),t(R),g(()=>{p=Ce(R,1,"batch-card svelte-1oyrwd9",null,p,{highlight:o()}),v(x,r.title),h=Ce(C,1,"card-content svelte-1oyrwd9",null,h,{collapsed:O()&&!m()})}),l(I,R)}et(["click"]);var ba=n('<span class="unit svelte-lzskfi"> </span>'),ha=n('<div class="raw-values svelte-lzskfi"><span class="raw-label svelte-lzskfi">Raw:</span> <span class="raw-value svelte-lzskfi"> </span> <span class="raw-separator svelte-lzskfi">¬∑</span> <span class="raw-value svelte-lzskfi"> </span></div>'),ja=n('<div class="last-seen svelte-lzskfi"> </div>'),ya=n('<div class="live-badge svelte-lzskfi"><span class="live-dot svelte-lzskfi"></span> <span class="live-text svelte-lzskfi">LIVE</span></div> <div class="readings-grid svelte-lzskfi"><div class="reading svelte-lzskfi"><div class="reading-value svelte-lzskfi"> <!></div> <div class="reading-label svelte-lzskfi"> </div></div> <div class="reading svelte-lzskfi"><div class="reading-value temp svelte-lzskfi"> <span class="unit svelte-lzskfi"> </span></div> <div class="reading-label svelte-lzskfi">Temperature</div></div></div> <!> <!>',1);function xa(I,r){Re(r,!0);let o=N(()=>r.liveReading?.sg??r.currentSg),O=N(()=>r.liveReading?.temp??r.currentTemp),m=N(()=>r.liveReading?.sg_raw),R=N(()=>r.liveReading?.temp_raw),p=N(()=>r.liveReading?.last_seen),i=N(()=>r.liveReading&&(r.liveReading.sg!==r.liveReading.sg_raw||r.liveReading.temp!==r.liveReading.temp_raw)),D=N(na),d=N(Ct);function _(f){return f==null?"--":Ie(f)}function y(f){return f==null?"--":Bt(f)}let A=N(()=>e(p)?St(e(p)):null);Ae(I,{title:"Live Readings",highlight:!0,children:(f,x)=>{var b=ya(),k=s(Y(b),2),C=a(k),h=a(C),S=a(h),w=s(S);{var T=q=>{var M=ba(),V=a(M,!0);t(M),g(()=>v(V,e(D))),l(q,M)};u(w,q=>{e(D)!=="SG"&&q(T)})}t(h);var H=s(h,2),G=a(H,!0);t(H),t(C);var E=s(C,2),K=a(E),ee=a(K),ae=s(ee),z=a(ae,!0);t(ae),t(K),qe(2),t(E),t(k);var F=s(k,2);{var B=q=>{var M=ha(),V=s(a(M),2),pe=a(V,!0);t(V);var xe=s(V,4),re=a(xe);t(xe),t(M),g((ie,c)=>{v(pe,ie),v(re,`${c??""}${e(d)??""}`)},[()=>_(e(m)),()=>y(e(R))]),l(q,M)};u(F,q=>{e(i)&&q(B)})}var P=s(F,2);{var X=q=>{var M=ja(),V=a(M);t(M),g(()=>v(V,`Updated ${e(A)??""}`)),l(q,M)};u(P,q=>{e(A)&&q(X)})}g((q,M)=>{v(S,`${q??""} `),v(G,e(D)==="SG"?"Gravity":e(D)==="¬∞P"?"Plato":"Brix"),v(ee,`${M??""} `),v(z,e(d))},[()=>_(e(o)),()=>y(e(O))]),l(f,b)},$$slots:{default:!0}}),De()}var ka=n('<div class="gravity-point target svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Target FG</div> <div class="point-value svelte-t80j9z"> </div></div>'),wa=n('<div class="progress-remaining svelte-t80j9z"> </div>'),za=n('<div class="progress-section svelte-t80j9z"><div class="progress-header svelte-t80j9z"><span class="progress-label svelte-t80j9z">Fermentation Progress</span> <span class="progress-percent svelte-t80j9z"> </span></div> <div class="progress-bar-container svelte-t80j9z"><div class="progress-bar-bg svelte-t80j9z"></div> <div class="progress-bar-fill svelte-t80j9z"></div> <div class="progress-bar-shine svelte-t80j9z"></div></div> <!></div>'),Fa=n('<div class="current-sg svelte-t80j9z"><div class="sg-label svelte-t80j9z">Current Specific Gravity</div> <div class="sg-value svelte-t80j9z"> <span class="fermenting-badge svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> Fermenting</span></div></div> <div class="gravity-timeline svelte-t80j9z"><div class="timeline-line svelte-t80j9z"></div> <div class="gravity-point start svelte-t80j9z"><div class="point-marker svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Original Gravity</div> <div class="point-value svelte-t80j9z"> </div></div> <!> <div class="gravity-point current svelte-t80j9z"><div class="point-marker pulsing svelte-t80j9z"></div> <div class="point-label svelte-t80j9z">Current FG</div> <div class="point-value svelte-t80j9z"> </div></div></div> <div class="metrics-grid svelte-t80j9z"><div class="metric abv-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">%</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Alcohol by Volume</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div> <div class="metric attenuation-metric svelte-t80j9z"><div class="metric-icon svelte-t80j9z">‚Üì</div> <div class="metric-content svelte-t80j9z"><div class="metric-label svelte-t80j9z">Apparent Attenuation</div> <div class="metric-value svelte-t80j9z"> <span class="live-indicator svelte-t80j9z">LIVE</span></div></div></div></div> <!>',1),Ca=n('<div class="measurements-grid svelte-t80j9z"><div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Original Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Final Gravity</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">ABV</div> <div class="measurement-value svelte-t80j9z"> </div></div> <div class="measurement svelte-t80j9z"><div class="measurement-label svelte-t80j9z">Attenuation</div> <div class="measurement-value svelte-t80j9z"> </div></div></div>'),Ba=n('<div class="no-data svelte-t80j9z"><div class="no-data-icon svelte-t80j9z">‚óã</div> <p class="no-data-text svelte-t80j9z">Set Original Gravity to begin tracking fermentation metrics</p></div>');function Sa(I,r){Re(r,!0);let o=N(()=>{if(!r.batch.measured_og)return null;const p=r.currentSg??r.progress?.measured?.current_sg;if(!p)return null;const i=(r.batch.measured_og-p)*131.25,D=r.batch.measured_og-1,d=D!==0?(r.batch.measured_og-p)/D*100:0;return{currentSg:p,abv:Math.max(0,i),attenuation:Math.max(0,Math.min(100,d)),isFermenting:r.batch.status==="fermenting"||r.batch.status==="conditioning"}}),O=N(()=>e(o)?.isFermenting??!1);function m(p){return p==null?"--":Ie(p)}function R(p){return p==null?"--":`${p.toFixed(1)}%`}{let p=N(()=>e(O)?"Fermentation Progress":"Fermentation Measurements");Ae(I,{get title(){return e(p)},children:(i,D)=>{var d=ye(),_=Y(d);{var y=f=>{var x=Fa(),b=Y(x),k=s(a(b),2),C=a(k);qe(),t(k),t(b);var h=s(b,2),S=s(a(h),2),w=s(a(S),4),T=a(w,!0);t(w),t(S);var H=s(S,2);{var G=re=>{var ie=ka(),c=s(a(ie),4),U=a(c,!0);t(c),t(ie),g(W=>v(U,W),[()=>m(r.batch.recipe.fg_target)]),l(re,ie)};u(H,re=>{r.batch.recipe?.fg_target&&re(G)})}var E=s(H,2),K=s(a(E),4),ee=a(K,!0);t(K),t(E),t(h);var ae=s(h,2),z=a(ae),F=s(a(z),2),B=s(a(F),2),P=a(B);qe(),t(B),t(F),t(z);var X=s(z,2),q=s(a(X),2),M=s(a(q),2),V=a(M);qe(),t(M),t(q),t(X),t(ae);var pe=s(ae,2);{var xe=re=>{var ie=za(),c=a(ie),U=s(a(c),2),W=a(U);t(U),t(c);var Z=s(c,2),Ee=s(a(Z),2);qe(2),t(Z);var ce=s(Z,2);{var oe=te=>{var me=wa(),Be=a(me);t(me),g(ke=>v(Be,`${ke??""} gravity points remaining`),[()=>r.progress.progress.sg_remaining.toFixed(3)]),l(te,me)};u(ce,te=>{r.progress.progress.sg_remaining!=null&&te(oe)})}t(ie),g(te=>{v(W,`${te??""}%`),Pe(Ee,`width: ${r.progress.progress.percent_complete??""}%`)},[()=>r.progress.progress.percent_complete.toFixed(0)]),l(re,ie)};u(pe,re=>{r.progress?.progress?.percent_complete!=null&&re(xe)})}g((re,ie,c,U,W)=>{v(C,`${re??""} `),v(T,ie),v(ee,c),v(P,`${U??""} `),v(V,`${W??""} `)},[()=>m(e(o).currentSg),()=>m(r.batch.measured_og),()=>m(e(o).currentSg),()=>R(e(o).abv),()=>R(e(o).attenuation)]),l(f,x)},A=f=>{var x=ye(),b=Y(x);{var k=h=>{var S=Ca(),w=a(S),T=s(a(w),2),H=a(T,!0);t(T),t(w);var G=s(w,2),E=s(a(G),2),K=a(E,!0);t(E),t(G);var ee=s(G,2),ae=s(a(ee),2),z=a(ae,!0);t(ae),t(ee);var F=s(ee,2),B=s(a(F),2),P=a(B,!0);t(B),t(F),t(S),g((X,q,M,V)=>{v(H,X),v(K,q),v(z,M),v(P,V)},[()=>m(r.batch.measured_og),()=>m(r.batch.measured_fg),()=>r.batch.measured_abv!=null?R(r.batch.measured_abv):"--",()=>r.batch.measured_attenuation!=null?R(r.batch.measured_attenuation):"--"]),l(h,S)},C=h=>{var S=Ba();l(h,S)};u(b,h=>{r.batch.measured_og?h(k):h(C,!1)},!0)}l(f,x)};u(_,f=>{e(o)&&e(O)?f(y):f(A,!1)})}l(i,d)},$$slots:{default:!0}})}De()}var Ta=n('<div class="timeline svelte-yskb8i"><div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Brew Date</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Started</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Ended</span> <span class="timeline-value svelte-yskb8i"> </span></div> <div class="timeline-item svelte-yskb8i"><span class="timeline-label svelte-yskb8i">Created</span> <span class="timeline-value svelte-yskb8i"> </span></div></div>');function qa(I,r){Re(r,!0);function o(m){return m?new Date(m).toLocaleDateString("en-GB",{weekday:"short",day:"numeric",month:"short",year:"numeric"}):"--"}function O(m){return m?new Date(m).toLocaleString("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit"}):"--"}Ae(I,{title:"Timeline",children:(m,R)=>{var p=Ta(),i=a(p),D=s(a(i),2),d=a(D,!0);t(D),t(i);var _=s(i,2),y=s(a(_),2),A=a(y,!0);t(y),t(_);var f=s(_,2),x=s(a(f),2),b=a(x,!0);t(x),t(f);var k=s(f,2),C=s(a(k),2),h=a(C,!0);t(C),t(k),t(p),g((S,w,T,H)=>{v(d,S),v(A,w),v(b,T),v(h,H)},[()=>o(r.batch.brew_date),()=>O(r.batch.start_time),()=>O(r.batch.end_time),()=>O(r.batch.created_at)]),l(m,p)},$$slots:{default:!0}}),De()}var Ra=n('<div class="signal-bar svelte-1kdxwtz"></div>'),Da=n('<div class="signal-details svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="signal-text svelte-1kdxwtz"> </span></div>'),Ma=n('<div class="device-last-seen svelte-1kdxwtz"> </div>'),La=n('<div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!> <!>',1),Oa=n('<div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <div class="device-last-seen svelte-1kdxwtz">Not receiving data</div>',1),Ga=n('<div class="device-info svelte-1kdxwtz"><!></div>'),Pa=n('<button type="button" class="link-btn svelte-1kdxwtz">Link a device</button>'),Aa=n('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function Ea(I,r){Re(r,!0);let o=N(()=>r.liveReading?.rssi?_a(r.liveReading.rssi):null),O=N(()=>r.liveReading?.last_seen?St(r.liveReading.last_seen):null);Ae(I,{title:"Tracking Device",children:(m,R)=>{var p=ye(),i=Y(p);{var D=_=>{var y=Ga(),A=a(y);{var f=b=>{var k=La(),C=Y(k),h=s(a(C));t(C);var S=s(C,2);{var w=G=>{var E=Da(),K=a(E);wt(K,20,()=>Array(4),zt,(z,F,B)=>{var P=Ra();g(()=>Pe(P,`
										height: ${6+B*3}px;
										background: ${(B<e(o).bars?e(o).color:"var(--bg-hover)")??""};
										opacity: ${B<e(o).bars?1:.4};
									`)),l(z,P)}),t(K);var ee=s(K,2),ae=a(ee);t(ee),t(E),g(()=>{Pe(ee,`color: ${e(o).color??""}`),v(ae,`${e(o).label??""} (${r.liveReading.rssi??""} dBm)`)}),l(G,E)};u(S,G=>{e(o)&&G(w)})}var T=s(S,2);{var H=G=>{var E=Ma(),K=a(E);t(E),g(()=>v(K,`Updated ${e(O)??""}`)),l(G,E)};u(T,G=>{e(O)&&G(H)})}g(()=>v(h,` ${r.liveReading.color??""} Tilt - Connected`)),l(b,k)},x=b=>{var k=Oa(),C=Y(k),h=s(a(C));t(C),qe(2),g(()=>v(h,` Device: ${r.batch.device_id??""}`)),l(b,k)};u(A,b=>{r.liveReading?b(f):b(x,!1)})}t(y),l(_,y)},d=_=>{var y=Aa(),A=s(a(y),2);{var f=x=>{var b=Pa();b.__click=function(...k){r.onEdit?.apply(this,k)},l(x,b)};u(A,x=>{r.onEdit&&x(f)})}t(y),l(_,y)};u(i,_=>{r.batch.device_id?_(D):_(d,!1)})}l(m,p)},$$slots:{default:!0}}),De()}et(["click"]);const Ua=131.25;var Na=n('<div class="target wide svelte-19u9n31"><span class="target-label svelte-19u9n31">Yeast</span> <span class="target-value svelte-19u9n31"> </span></div>'),Ia=n('<div class="targets-grid svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div> <!></div>');function Va(I,r){Re(r,!0);function o(m){return m==null?"--":Ie(m)}let O=N(()=>r.recipe.abv_target!=null?r.recipe.abv_target:r.recipe.og_target&&r.recipe.fg_target?(r.recipe.og_target-r.recipe.fg_target)*Ua:null);Ae(I,{title:"Recipe Targets",children:(m,R)=>{var p=Ia(),i=a(p),D=s(a(i),2),d=a(D,!0);t(D),t(i);var _=s(i,2),y=s(a(_),2),A=a(y,!0);t(y),t(_);var f=s(_,2),x=s(a(f),2),b=a(x,!0);t(x),t(f);var k=s(f,2);{var C=h=>{var S=Na(),w=s(a(S),2),T=a(w,!0);t(w),t(S),g(()=>v(T,r.recipe.yeast_name)),l(h,S)};u(k,h=>{r.recipe.yeast_name&&h(C)})}t(p),g((h,S,w)=>{v(d,h),v(A,S),v(b,w)},[()=>o(r.recipe.og_target),()=>o(r.recipe.fg_target),()=>e(O)!=null?`${e(O).toFixed(1)}%`:"--"]),l(m,p)},$$slots:{default:!0}}),De()}var Ha=n('<p class="notes-content svelte-hkv31i"> </p>');function Wa(I,r){Ae(I,{title:"Notes",children:(o,O)=>{var m=Ha(),R=a(m,!0);t(m),g(()=>v(R,r.notes)),l(o,m)},$$slots:{default:!0}})}var Ja=n('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),Qa=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Ya=n('<span class="days svelte-1xs394q"> </span>'),Ka=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"> <!></span></div>'),Xa=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Confidence:</span> <div class="progress-wrapper svelte-1xs394q"><div class="progress-bar svelte-1xs394q"><div class="fill svelte-1xs394q"></div></div> <span class="percentage svelte-1xs394q"> </span></div></div>'),Za=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Data Quality:</span> <div class="progress-wrapper svelte-1xs394q"><div class="progress-bar svelte-1xs394q"><div class="fill svelte-1xs394q"></div></div> <span class="percentage svelte-1xs394q"> </span></div></div>'),$a=n('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Readings:</span> <span class="value svelte-1xs394q"> </span></div>'),es=n('<div class="ml-panel svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">ML Predictions</h3> <div class="metrics svelte-1xs394q"><!> <!> <!> <!> <!></div></div>'),ts=n('<div class="ml-panel disabled svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable (insufficient data)</p></div>');function as(I,r){Re(r,!0);let o=de(Yt({available:!1})),O=de(!0);kt(async()=>{try{const _=await fetch(`/api/batches/${r.batchId}/predictions`);j(o,await _.json(),!0)}catch(_){console.error("Failed to load ML predictions:",_)}finally{j(O,!1)}});function m(_){return _?new Date(_).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function R(_){if(!_)return null;const y=new Date(_),A=new Date,f=y.getTime()-A.getTime();return Math.ceil(f/(1e3*60*60*24))}var p=ye(),i=Y(p);{var D=_=>{var y=Ja();l(_,y)},d=_=>{var y=ye(),A=Y(y);{var f=b=>{var k=es(),C=s(a(k),2),h=a(C);{var S=z=>{var F=Qa(),B=s(a(F),2),P=a(B,!0);t(B),t(F),g(X=>v(P,X),[()=>Ie(e(o).predicted_fg)]),l(z,F)};u(h,z=>{e(o).predicted_fg&&z(S)})}var w=s(h,2);{var T=z=>{const F=N(()=>R(e(o).estimated_completion));var B=Ka(),P=s(a(B),2),X=a(P),q=s(X);{var M=V=>{var pe=Ya(),xe=a(pe);t(pe),g(()=>v(xe,`(${e(F)??""} ${e(F)===1?"day":"days"})`)),l(V,pe)};u(q,V=>{e(F)!==null&&V(M)})}t(P),t(B),g(V=>v(X,`${V??""} `),[()=>m(e(o).estimated_completion)]),l(z,B)};u(w,z=>{e(o).estimated_completion&&z(T)})}var H=s(w,2);{var G=z=>{var F=Xa(),B=s(a(F),2),P=a(B),X=a(P);t(P);var q=s(P,2),M=a(q);t(q),t(B),t(F),g(V=>{Pe(X,`width: ${e(o).confidence*100}%`),v(M,`${V??""}%`)},[()=>(e(o).confidence*100).toFixed(0)]),l(z,F)};u(H,z=>{e(o).confidence!==void 0&&z(G)})}var E=s(H,2);{var K=z=>{var F=Za(),B=s(a(F),2),P=a(B),X=a(P);t(P);var q=s(P,2),M=a(q);t(q),t(B),t(F),g(V=>{Pe(X,`width: ${e(o).data_quality*100}%`),v(M,`${V??""}%`)},[()=>(e(o).data_quality*100).toFixed(0)]),l(z,F)};u(E,z=>{e(o).data_quality!==void 0&&z(K)})}var ee=s(E,2);{var ae=z=>{var F=$a(),B=s(a(F),2),P=a(B);t(B),t(F),g(()=>v(P,`${e(o).num_readings??""} points`)),l(z,F)};u(ee,z=>{e(o).num_readings&&z(ae)})}t(C),t(k),l(b,k)},x=b=>{var k=ts();l(b,k)};u(A,b=>{e(o).available?b(f):b(x,!1)},!0)}l(_,y)};u(i,_=>{e(O)?_(D):_(d,!1)})}l(I,p),De()}var ss=n('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),rs=n('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),is=n('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),ls=n('<span class="recipe-type svelte-g5au2j"> </span>'),vs=n('<a class="recipe-link svelte-g5au2j"> <!></a>'),ns=n('<option class="svelte-g5au2j"> </option>'),os=n('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),ds=n('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),cs=n('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),us=n('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),_s=n('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),gs=n('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),fs=n('<div><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="device-status-grid svelte-g5au2j"><!> <!></div> <!></div>'),ps=n('<span class="svelte-g5au2j"> </span>'),ms=n('<span class="svelte-g5au2j"> </span>'),bs=n('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),hs=n('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div>',1),js=n('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),ys=n('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Us(I,r){Re(r,!0);const o=()=>sa(ra,"$page",O),[O,m]=aa();let R=null,p=null,i=de(null),D=de(null),d=de(null),_=de(!0),y=de(null),A=de(!1),f=de(!1),x=de(!1),b=de(!1),k=de(!1),C=N(()=>parseInt(o().params.id??"0"));const h={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},S=["planning","fermenting","conditioning","completed","archived"];let w=N(()=>e(i)?h[e(i).status]:h.planning),T=N(Ct),H=N(()=>xt.config.ha_enabled&&xt.config.temp_control_enabled&&(e(i)?.heater_entity_id||e(i)?.cooler_entity_id)),G=N(()=>{if(!e(i)?.device_id)return null;const c=e(i).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!c?.[1])return null;const U=c[1].toUpperCase();for(const W of oa.tilts.values())if(W.color.toUpperCase()===U)return W;return null});async function E(){j(_,!0),j(y,null);try{if(j(i,await la(e(C)),!0),e(i).status==="fermenting"||e(i).status==="conditioning")try{j(D,await jt(e(C)),!0)}catch{}if(e(i).heater_entity_id||e(i).cooler_entity_id)try{j(d,await Ne(e(C)),!0)}catch{}}catch(c){j(y,c instanceof Error?c.message:"Failed to load batch",!0)}finally{j(_,!1)}}async function K(c){if(!(!e(i)||e(f))){j(f,!0);try{j(i,await yt(e(i).id,{status:c}),!0),(c==="fermenting"||c==="conditioning")&&j(D,await jt(e(i).id),!0)}catch(U){console.error("Failed to update status:",U)}finally{j(f,!1)}}}async function ee(c){if(e(i)&&(j(i,await yt(e(i).id,c),!0),j(A,!1),e(i).heater_entity_id||e(i).cooler_entity_id))try{j(d,await Ne(e(i).id),!0)}catch{}}async function ae(){if(e(i)){j(k,!0);try{await va(e(i).id),ia("/batches")}catch(c){j(y,c instanceof Error?c.message:"Failed to delete batch",!0),j(k,!1),j(b,!1)}}}async function z(c,U){if(!(!e(i)||e(x))){j(x,!0);try{await Ze(e(i).id,U,60,c),j(d,await Ne(e(i).id),!0)}catch(W){console.error("Failed to set override:",W)}finally{j(x,!1)}}}async function F(){if(!(!e(i)||e(x))){j(x,!0);try{e(i).heater_entity_id&&await Ze(e(i).id,null,60,"heater"),e(i).cooler_entity_id&&await Ze(e(i).id,null,60,"cooler"),j(d,await Ne(e(i).id),!0)}catch(c){console.error("Failed to clear overrides:",c)}finally{j(x,!1)}}}function B(){if(R?.readyState===WebSocket.OPEN)return;const U=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;R=new WebSocket(U),R.onmessage=async W=>{try{const Z=JSON.parse(W.data);Z.type==="control_event"&&Z.batch_id===e(C)&&e(d)&&(Z.action==="heat_on"?j(d,{...e(d),heater_state:"on"},!0):Z.action==="heat_off"?j(d,{...e(d),heater_state:"off"},!0):Z.action==="cool_on"?j(d,{...e(d),cooler_state:"on"},!0):Z.action==="cool_off"&&j(d,{...e(d),cooler_state:"off"},!0))}catch{}},R.onclose=()=>{R=null,p=setTimeout(B,3e3)},R.onerror=()=>{R?.close()}}function P(){p&&(clearTimeout(p),p=null),R?.close(),R=null}function X(c){return c==null?"--":Bt(c)}kt(()=>{E(),B()}),Kt(()=>{P()});var q=ys();$t("g5au2j",c=>{Xt(()=>{Zt.title=`${(e(i)?.name||"Batch")??""} | BrewSignal`})});var M=Y(q),V=s(a(M),2);{var pe=c=>{var U=ss();l(c,U)},xe=c=>{var U=ye(),W=Y(U);{var Z=ce=>{var oe=rs(),te=s(a(oe),2),me=a(te,!0);t(te);var Be=s(te,2);Be.__click=E,t(oe),g(()=>v(me,e(y))),l(ce,oe)},Ee=ce=>{var oe=ye(),te=Y(oe);{var me=ke=>{var Ue=is();l(ke,Ue)},Be=ke=>{var Ue=ye(),Tt=Y(Ue);{var qt=Me=>{da(Me,{get batch(){return e(i)},onSubmit:ee,onCancel:()=>j(A,!1)})},Rt=Me=>{var tt=hs(),Ve=Y(tt),He=a(Ve),We=a(He),Dt=a(We);t(We);var at=s(We,2),Je=a(at),Mt=a(Je,!0);t(Je);var Lt=s(Je,2);{var Ot=L=>{var J=vs(),se=a(J),he=s(se);{var ue=je=>{var we=ls(),Le=a(we);t(we),g(()=>v(Le,`(${e(i).recipe.type??""})`)),l(je,we)};u(he,je=>{e(i).recipe.type&&je(ue)})}t(J),g(()=>{Ft(J,"href",`/recipes/${e(i).recipe.id??""}`),v(se,`${e(i).recipe.name??""} `)}),l(L,J)};u(Lt,L=>{e(i).recipe&&L(Ot)})}t(at),t(He);var st=s(He,2),Qe=a(st),be=a(Qe);be.__change=L=>K(L.currentTarget.value),wt(be,21,()=>S,zt,(L,J)=>{var se=ns(),he=a(se,!0);t(se);var ue={};g(()=>{v(he,h[e(J)].label),ue!==(ue=e(J))&&(se.value=(se.__value=e(J))??"")}),l(L,se)}),t(be);var rt;ea(be),t(Qe);var it=s(Qe,2);it.__click=()=>j(A,!0);var Gt=s(it,2);Gt.__click=()=>j(b,!0),t(st),t(Ve);var lt=s(Ve,2),Ye=a(lt),vt=a(Ye);{var Pt=L=>{{let J=N(()=>e(D)?.measured?.current_sg),se=N(()=>e(D)?.temperature?.current);xa(L,{get liveReading(){return e(G)},get currentSg(){return e(J)},get currentTemp(){return e(se)}})}};u(vt,L=>{(e(G)||e(D)?.measured?.current_sg!=null)&&L(Pt)})}var nt=s(vt,2);{let L=N(()=>e(G)?.sg??e(D)?.measured?.current_sg);Sa(nt,{get batch(){return e(i)},get currentSg(){return e(L)},get progress(){return e(D)}})}var At=s(nt,2);{var Et=L=>{Va(L,{get recipe(){return e(i).recipe}})};u(At,L=>{e(i).recipe&&L(Et)})}t(Ye);var ot=s(Ye,2),dt=a(ot);qa(dt,{get batch(){return e(i)}});var ct=s(dt,2);Ea(ct,{get batch(){return e(i)},get liveReading(){return e(G)},onEdit:()=>j(A,!0)});var ut=s(ct,2);as(ut,{get batchId(){return e(i).id}});var _t=s(ut,2);{var Ut=L=>{var J=fs();let se;var he=s(a(J),2),ue=a(he);{var je=le=>{var Q=os(),$=a(Q);let ve;var ze=s($,2),_e=s(a(ze),2);let Fe;var Oe=a(_e,!0);t(_e);var Se=s(_e,2),Ge=a(Se,!0);t(Se),t(ze),t(Q),g(()=>{ve=Ce($,1,"device-icon-wrap svelte-g5au2j",null,ve,{active:e(d)?.heater_state==="on"}),Fe=Ce(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(d)?.heater_state==="on"}),v(Oe,e(d)?.heater_state==="on"?"ON":"OFF"),v(Ge,e(i).heater_entity_id)}),l(le,Q)};u(ue,le=>{e(i).heater_entity_id&&le(je)})}var we=s(ue,2);{var Le=le=>{var Q=ds(),$=a(Q);let ve;var ze=s($,2),_e=s(a(ze),2);let Fe;var Oe=a(_e,!0);t(_e);var Se=s(_e,2),Ge=a(Se,!0);t(Se),t(ze),t(Q),g(()=>{ve=Ce($,1,"device-icon-wrap svelte-g5au2j",null,ve,{active:e(d)?.cooler_state==="on"}),Fe=Ce(_e,1,"device-state svelte-g5au2j",null,Fe,{on:e(d)?.cooler_state==="on"}),v(Oe,e(d)?.cooler_state==="on"?"ON":"OFF"),v(Ge,e(i).cooler_entity_id)}),l(le,Q)};u(we,le=>{e(i).cooler_entity_id&&le(Le)})}t(he);var Ke=s(he,2);{var Xe=le=>{var Q=gs(),$=Y(Q),ve=a($),ze=s(a(ve),2),_e=a(ze);t(ze),t(ve);var Fe=s(ve,2),Oe=s(a(Fe),2),Se=a(Oe);t(Oe),t(Fe),t($);var Ge=s($,2);{var Ht=ne=>{var ge=cs(),fe=s(a(ge),2),Te=a(fe);t(fe);var ht=s(fe,2);ht.__click=()=>F(),t(ge),g(Qt=>{v(Te,`Override active: ${Qt??""}`),ht.disabled=e(x)},[()=>e(d).override_state?.toUpperCase()]),l(ne,ge)};u(Ge,ne=>{e(d).override_active&&ne(Ht)})}var gt=s(Ge,2),ft=s(a(gt),2),pt=a(ft);{var Wt=ne=>{var ge=us(),fe=Y(ge);fe.__click=()=>z("heater","on");var Te=s(fe,2);Te.__click=()=>z("heater","off"),g(()=>{fe.disabled=e(x),Te.disabled=e(x)}),l(ne,ge)};u(pt,ne=>{e(i).heater_entity_id&&ne(Wt)})}var mt=s(pt,2);{var Jt=ne=>{var ge=_s(),fe=Y(ge);fe.__click=()=>z("cooler","on");var Te=s(fe,2);Te.__click=()=>z("cooler","off"),g(()=>{fe.disabled=e(x),Te.disabled=e(x)}),l(ne,ge)};u(mt,ne=>{e(i).cooler_entity_id&&ne(Jt)})}var bt=s(mt,2);bt.__click=()=>F(),t(ft),t(gt),g((ne,ge)=>{v(_e,`${ne??""}${e(T)??""}`),v(Se,`¬±${ge??""}${e(T)??""}`),bt.disabled=e(x)},[()=>X(e(d).target_temp),()=>e(d).hysteresis?.toFixed(1)||"--"]),l(le,Q)};u(Ke,le=>{e(d)&&le(Xe)})}t(J),g(()=>se=Ce(J,1,"info-card temp-control-card svelte-g5au2j",null,se,{"heater-on":e(d)?.heater_state==="on","cooler-on":e(d)?.cooler_state==="on"})),l(L,J)},Nt=L=>{var J=ye(),se=Y(J);{var he=ue=>{var je=bs(),we=s(a(je),2),Le=a(we);{var Ke=Q=>{var $=ps(),ve=a($);t($),g(()=>v(ve,`Heater: ${e(i).heater_entity_id??""}`)),l(Q,$)};u(Le,Q=>{e(i).heater_entity_id&&Q(Ke)})}var Xe=s(Le,2);{var le=Q=>{var $=ms(),ve=a($);t($),g(()=>v(ve,`Cooler: ${e(i).cooler_entity_id??""}`)),l(Q,$)};u(Xe,Q=>{e(i).cooler_entity_id&&Q(le)})}qe(2),t(we),t(je),l(ue,je)};u(se,ue=>{(e(i).heater_entity_id||e(i).cooler_entity_id)&&e(i).status!=="fermenting"&&ue(he)},!0)}l(L,J)};u(_t,L=>{e(H)&&e(i).status==="fermenting"?L(Ut):L(Nt,!1)})}var It=s(_t,2);{var Vt=L=>{Wa(L,{get notes(){return e(i).notes}})};u(It,L=>{e(i).notes&&L(Vt)})}t(ot),t(lt),g(()=>{v(Dt,`#${(e(i).batch_number||"?")??""}`),v(Mt,e(i).name||e(i).recipe?.name||"Unnamed Batch"),be.disabled=e(f),Pe(be,`color: ${e(w).color??""}; background: ${e(w).bg??""};`),rt!==(rt=e(i).status)&&(be.value=(be.__value=e(i).status)??"",ta(be,e(i).status))}),l(Me,tt)};u(Tt,Me=>{e(A)?Me(qt):Me(Rt,!1)},!0)}l(ke,Ue)};u(te,ke=>{e(i)?ke(Be,!1):ke(me)},!0)}l(ce,oe)};u(W,ce=>{e(y)?ce(Z):ce(Ee,!1)},!0)}l(c,U)};u(V,c=>{e(_)?c(pe):c(xe,!1)})}t(M);var re=s(M,2);{var ie=c=>{var U=js();U.__click=()=>j(b,!1);var W=a(U);W.__click=Be=>Be.stopPropagation();var Z=s(a(W),2),Ee=a(Z);t(Z);var ce=s(Z,2),oe=a(ce);oe.__click=()=>j(b,!1);var te=s(oe,2);te.__click=ae;var me=a(te,!0);t(te),t(ce),t(W),t(U),g(()=>{v(Ee,`Are you sure you want to delete "${(e(i)?.name||"this batch")??""}"? This cannot be undone.`),oe.disabled=e(k),te.disabled=e(k),v(me,e(k)?"Deleting...":"Delete Batch")}),l(c,U)};u(re,c=>{e(b)&&c(ie)})}l(I,q),De(),m()}et(["click","change"]);export{Us as component,Es as universal};
