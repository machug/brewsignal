import{d as zt,f as i,s as o,a as l,c as he,t as Wt}from"../chunks/CsQfwH0S.js";import{al as a,ak as s,an as t,ar as u,ah as jt,at as G,c as e,ai as F,as as Ce,aj as yt,aq as Fe,p as Qt,ao as Xt,s as _,aL as ba,ay as xa,am as ja}from"../chunks/fKkNMI8q.js";import{e as Zt,i as $t}from"../chunks/COk1ZY4R.js";import{i as v}from"../chunks/BvBRaQNg.js";import{h as ya}from"../chunks/DLseniaC.js";import{s as ft}from"../chunks/DbN3nGCc.js";import{s as Ue}from"../chunks/BDI2zAFW.js";import{s as tt}from"../chunks/CcRNvR1k.js";import{i as wa,s as ka}from"../chunks/C8srtpii.js";import{s as za,a as qa}from"../chunks/C51ud8ec.js";import{p as Fa}from"../chunks/bt9WLr8I.js";import{g as Ca}from"../chunks/KatSMpOa.js";import{B as Ra,C as Ba,t as Ma,j as Yt,D as wt,k as Ta,z as Jt,E as Rt}from"../chunks/BYOGxEKx.js";import{d as xt,e as ea,g as ta,c as kt}from"../chunks/CPwbAm-l.js";import{t as Kt}from"../chunks/C8NDSE1R.js";import{B as Sa}from"../chunks/JhzoKK4p.js";import{s as Da}from"../chunks/Bdaed-dN.js";import{p as _t}from"../chunks/CllCHKBI.js";const Pa=!1,Br=Object.freeze(Object.defineProperty({__proto__:null,prerender:Pa},Symbol.toStringTag,{value:"Module"}));function Oa(ie){return ie>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:ie>=-60?{bars:3,color:"var(--positive)",label:"Good"}:ie>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function aa(ie){const n=Math.floor((Date.now()-new Date(ie).getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const P=Math.floor(n/60);if(P<60)return`${P}m ago`;const V=Math.floor(P/60);return V<24?`${V}h ago`:`${Math.floor(V/24)}d ago`}var Aa=i('<div class="accent-bar svelte-1oyrwd9"></div>'),Ea=i('<span class="card-icon svelte-1oyrwd9"> </span>'),Ga=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),La=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function qt(ie,n){let P=_t(n,"highlight",3,!1),V=_t(n,"compact",3,!1),O=_t(n,"collapsible",3,!1),m=_t(n,"expanded",3,!1);var A=La();let r;var S=a(A);{var g=b=>{var d=Aa();l(b,d)};v(S,b=>{P()&&b(g)})}var L=s(S,2),se=a(L),de=a(se);{var z=b=>{var d=Ea(),j=a(d,!0);t(d),u(()=>o(j,n.icon)),l(b,d)};v(de,b=>{n.icon&&b(z)})}var B=s(de,2),U=a(B,!0);t(B),t(se);var J=s(se,2);{var K=b=>{var d=Ga();d.__click=function(...H){n.onToggle?.apply(this,H)};var j=a(d);let C;t(d),u(()=>{ft(d,"aria-label",m()?"Collapse":"Expand"),C=Ue(j,0,"expand-icon svelte-1oyrwd9",null,C,{"rotate-180":m()})}),l(b,d)};v(J,b=>{O()&&n.onToggle&&b(K)})}t(L);var ve=s(L,2);let N;var Q=a(ve);Da(Q,()=>n.children),t(ve),t(A),u(()=>{r=Ue(A,1,"batch-card svelte-1oyrwd9",null,r,{highlight:P(),compact:V()}),o(U,n.title),N=Ue(ve,1,"card-content svelte-1oyrwd9",null,N,{collapsed:O()&&!m()})}),l(ie,A)}zt(["click"]);var Ua=i('<span class="updated-text svelte-t80j9z"> </span>'),Na=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),Va=i('<div class="remaining-text svelte-t80j9z"> </div>'),Ha=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),Ia=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),Wa=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),Ya=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),Ja=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function Ka(ie,n){jt(n,!0);let P=F(()=>n.currentSg??n.progress?.measured?.current_sg),V=F(()=>n.liveReading?.temp??n.progress?.temperature?.current),O=F(()=>n.liveReading?.last_seen),m=F(()=>e(O)?aa(e(O)):null),A=F(ta),r=F(()=>{if(!n.batch.measured_og||!e(P))return null;const z=Math.max(0,(n.batch.measured_og-e(P))*131.25),B=n.batch.measured_og-1,U=B!==0?Math.max(0,Math.min(100,(n.batch.measured_og-e(P))/B*100)):0;return{abv:z,attenuation:U}}),S=F(()=>{const z=n.batch.measured_og,B=n.batch.recipe?.fg;if(!z||!B||!e(P))return null;const U=z-B,J=z-e(P);return U<=0?null:Math.max(0,Math.min(100,J/U*100))}),g=F(()=>n.batch.status==="fermenting"||n.batch.status==="conditioning");function L(z){return z==null?"--":xt(z)}function se(z){return z==null?"--":`${z.toFixed(1)}%`}function de(z){return z==null?"--":ea(z)}qt(ie,{title:"Fermentation",children:(z,B)=>{var U=he(),J=G(U);{var K=N=>{var Q=Wa(),b=G(Q),d=s(a(b),2);{var j=M=>{var T=Ua(),y=a(T);t(T),u(()=>o(y,`Updated ${e(m)??""}`)),l(M,T)};v(d,M=>{e(m)&&M(j)})}t(b);var C=s(b,2),H=a(C),be=a(H),E=a(be,!0);t(be),Ce(2),t(H);var xe=s(H,2);{var Re=M=>{var T=Na(),y=s(G(T),2),I=a(y),X=a(I,!0),te=s(X),re=a(te,!0);t(te),t(I),Ce(2),t(y),u(ue=>{o(X,ue),o(re,e(A))},[()=>de(e(V))]),l(M,T)};v(xe,M=>{e(V)!=null&&M(Re)})}t(C);var oe=s(C,2);{var je=M=>{var T=Ha(),y=a(T),I=a(y),X=a(I),te=a(X,!0);t(X),Ce(2),t(I);var re=s(I,2),ue=a(re),Ne=a(ue);t(ue),t(re);var ye=s(re,2),Ve=a(ye),De=a(Ve,!0);t(Ve),Ce(2),t(ye),t(y);var c=s(y,2),x=a(c),W=s(x,2);let w;var fe=s(a(W),2),we=a(fe,!0);t(fe),t(W),t(c);var Be=s(c,2);{var Me=h=>{var p=Va(),q=a(p);t(p),u(Z=>o(q,`${Z??""} points to go`),[()=>n.progress.progress.sg_remaining.toFixed(3)]),l(h,p)};v(Be,h=>{n.progress?.progress?.sg_remaining!=null&&n.progress.progress.sg_remaining>0&&h(Me)})}t(T),u((h,p,q,Z)=>{o(te,h),o(Ne,`${p??""}%`),o(De,q),tt(x,`width: ${e(S)??""}%`),w=Ue(W,1,"progress-marker svelte-t80j9z",null,w,{"at-start":e(S)<3}),tt(W,`left: ${e(S)??""}%`),o(we,Z)},[()=>L(n.batch.measured_og),()=>e(S).toFixed(0),()=>L(n.batch.recipe.fg),()=>L(e(P))]),l(M,T)};v(oe,M=>{e(S)!==null&&n.batch.measured_og&&n.batch.recipe?.fg&&M(je)})}var ee=s(oe,2);{var ce=M=>{var T=Ia(),y=a(T),I=a(y),X=a(I,!0);t(I),Ce(2),t(y);var te=s(y,2),re=a(te),ue=a(re,!0);t(re),Ce(2),t(te),t(T),u((Ne,ye)=>{o(X,Ne),o(ue,ye)},[()=>se(e(r).abv),()=>se(e(r).attenuation)]),l(M,T)};v(ee,M=>{e(r)&&M(ce)})}u(M=>o(E,M),[()=>L(e(P))]),l(N,Q)},ve=N=>{var Q=he(),b=G(Q);{var d=C=>{var H=Ya(),be=a(H),E=a(be),xe=a(E,!0);t(E),Ce(2),t(be);var Re=s(be,2),oe=a(Re),je=a(oe,!0);t(oe),Ce(2),t(Re);var ee=s(Re,2),ce=a(ee),M=a(ce,!0);t(ce),Ce(2),t(ee);var T=s(ee,2),y=a(T),I=a(y,!0);t(y),Ce(2),t(T),t(H),u((X,te,re,ue)=>{o(xe,X),o(je,te),o(M,re),o(I,ue)},[()=>L(n.batch.measured_og),()=>L(n.batch.measured_fg),()=>n.batch.measured_abv!=null?se(n.batch.measured_abv):"--",()=>n.batch.measured_attenuation!=null?se(n.batch.measured_attenuation):"--"]),l(C,H)},j=C=>{var H=Ja();l(C,H)};v(b,C=>{n.batch.measured_og?C(d):C(j,!1)},!0)}l(N,Q)};v(J,N=>{e(P)&&e(g)?N(K):N(ve,!1)})}l(z,U)},$$slots:{default:!0}}),yt()}var Qa=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),Xa=i('<div class="signal-bar svelte-1kdxwtz"></div>'),Za=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),$a=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),es=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),ts=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),as=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),ss=i('<div class="device-info svelte-1kdxwtz"><!></div>'),rs=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),ls=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function ns(ie,n){jt(n,!0);let P=F(()=>n.liveReading?.device_type==="tilt"),V=F(()=>e(P)&&n.liveReading?.rssi?Oa(n.liveReading.rssi):null),O=F(()=>n.liveReading?.last_seen?aa(n.liveReading.last_seen):null),m=F(()=>n.liveReading?.battery_percent!=null||n.liveReading?.battery_voltage!=null),A=F(()=>n.liveReading?.battery_percent),r=F(()=>n.liveReading?.battery_voltage),S=F(()=>e(A)?e(A)>50?"var(--positive)":e(A)>20?"#f59e0b":"var(--negative)":"var(--text-muted)"),g=F(()=>{if(!n.liveReading)return n.batch.device_id||"Unknown";const L=n.liveReading.device_type;return L==="tilt"?`${n.liveReading.color} Tilt`:L==="gravitymon"?`GravityMon (${n.liveReading.id})`:L==="ispindel"?`iSpindel (${n.liveReading.id})`:L==="floaty"?`Floaty (${n.liveReading.id})`:n.liveReading.color||n.liveReading.id});qt(ie,{title:"Tracking Device",compact:!0,children:(L,se)=>{var de=he(),z=G(de);{var B=J=>{var K=ss(),ve=a(K);{var N=b=>{var d=ts(),j=G(d),C=a(j),H=s(a(C));t(C);var be=s(C,2);{var E=oe=>{var je=Qa(),ee=a(je,!0);t(je),u(()=>o(ee,e(O))),l(oe,je)};v(be,oe=>{e(O)&&oe(E)})}t(j);var xe=s(j,2);{var Re=oe=>{var je=es(),ee=a(je);{var ce=y=>{var I=Za(),X=a(I);Zt(X,20,()=>Array(4),$t,(ue,Ne,ye)=>{var Ve=Xa();u(()=>tt(Ve,`height: ${4+ye*2}px; background: ${(ye<e(V).bars?e(V).color:"var(--bg-hover)")??""}; opacity: ${ye<e(V).bars?1:.4};`)),l(ue,Ve)}),t(X);var te=s(X,2),re=a(te);t(te),t(I),u(()=>{tt(te,`color: ${e(V).color??""}`),o(re,`${n.liveReading.rssi??""}dBm`)}),l(y,I)};v(ee,y=>{e(V)&&y(ce)})}var M=s(ee,2);{var T=y=>{var I=$a(),X=a(I),te=s(a(X)),re=s(te);t(X);var ue=s(X,2),Ne=a(ue);{var ye=De=>{var c=Wt();u(x=>o(c,`${x??""}%`),[()=>e(A).toFixed(0)]),l(De,c)},Ve=De=>{var c=he(),x=G(c);{var W=w=>{var fe=Wt();u(we=>o(fe,`${we??""}V`),[()=>e(r).toFixed(2)]),l(w,fe)};v(x,w=>{e(r)!=null&&w(W)},!0)}l(De,c)};v(Ne,De=>{e(A)!=null?De(ye):De(Ve,!1)})}t(ue),t(I),u(()=>{ft(X,"stroke",e(S)),ft(te,"width",(e(A)??50)*.14),ft(te,"fill",e(S)),ft(re,"fill",e(S)),tt(ue,`color: ${e(S)??""}`)}),l(y,I)};v(M,y=>{e(m)&&y(T)})}t(je),l(oe,je)};v(xe,oe=>{(e(V)||e(m))&&oe(Re)})}u(()=>o(H,` ${e(g)??""}`)),l(b,d)},Q=b=>{var d=as(),j=a(d),C=s(a(j));t(j),Ce(2),t(d),u(()=>o(C,` ${n.batch.device_id??""}`)),l(b,d)};v(ve,b=>{n.liveReading?b(N):b(Q,!1)})}t(K),l(J,K)},U=J=>{var K=ls(),ve=s(a(K),2);{var N=Q=>{var b=rs();b.__click=function(...d){n.onEdit?.apply(this,d)},l(Q,b)};v(ve,Q=>{n.onEdit&&Q(N)})}t(K),l(J,K)};v(z,J=>{n.batch.device_id?J(B):J(U,!1)})}l(L,de)},$$slots:{default:!0}}),yt()}zt(["click"]);const is=131.25;var vs=i('<div class="yeast-row svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span></div>'),os=i('<div class="targets-row svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div></div> <!>',1);function ds(ie,n){jt(n,!0);function P(O){return O==null?"--":xt(O)}let V=F(()=>n.recipe.abv!=null?n.recipe.abv:n.recipe.og&&n.recipe.fg?(n.recipe.og-n.recipe.fg)*is:null);qt(ie,{title:"Recipe Targets",compact:!0,children:(O,m)=>{var A=os(),r=G(A),S=a(r),g=s(a(S),2),L=a(g,!0);t(g),t(S);var se=s(S,2),de=s(a(se),2),z=a(de,!0);t(de),t(se);var B=s(se,2),U=s(a(B),2),J=a(U,!0);t(U),t(B),t(r);var K=s(r,2);{var ve=N=>{var Q=vs(),b=s(a(Q),2),d=a(b,!0);t(b),t(Q),u(()=>o(d,n.recipe.yeast_name)),l(N,Q)};v(K,N=>{n.recipe.yeast_name&&N(ve)})}u((N,Q,b)=>{o(L,N),o(z,Q),o(J,b)},[()=>P(n.recipe.og),()=>P(n.recipe.fg),()=>e(V)!=null?`${e(V).toFixed(1)}%`:"--"]),l(O,A)},$$slots:{default:!0}}),yt()}var cs=i('<p class="notes-content svelte-hkv31i"> </p>');function us(ie,n){qt(ie,{title:"Notes",children:(P,V)=>{var O=cs(),m=a(O,!0);t(O),u(()=>o(m,n.notes)),l(P,O)},$$slots:{default:!0}})}var _s=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),gs=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),ps=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),fs=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),ms=i('<span class="activity-badge svelte-1xs394q"> </span>'),hs=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),bs=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),xs=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),js=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),ys=i('<span class="days svelte-1xs394q"> </span>'),ws=i(" <!>",1),ks=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),zs=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),qs=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Data points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Fs=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!></div></div></div>'),Cs=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q">Predictions require at least 10 readings over 2+ hours</p></div>');function Rs(ie,n){jt(n,!0);let P=_t(n,"measuredOg",3,null),V=_t(n,"currentSg",3,null),O=_t(n,"liveReading",3,null),m=Fe(Qt({available:!1})),A=Fe(!0),r=Fe(!1),S=Fe(null);async function g(){_(A,!0),_(S,null);try{_(m,await Ra(n.batchId),!0)}catch(d){_(S,d instanceof Error?d.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",d)}finally{_(A,!1)}}async function L(){_(r,!0),_(S,null);try{const d=await Ba(n.batchId);console.log("Reloaded predictions:",d.message),await g()}catch(d){_(S,d instanceof Error?d.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",d)}finally{_(r,!1)}}Xt(g);function se(d){return d?new Date(d).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function de(d){if(!d)return null;const j=new Date(d),C=new Date,H=j.getTime()-C.getTime();return Math.ceil(H/(1e3*60*60*24))}let z=F(()=>{const d=P()??e(m).predicted_og,j=e(m).predicted_fg,C=V()??O()?.sg;if(!d||!j||!C||d<=j)return null;const H=d-j,E=(d-C)/H*100;return Math.min(100,Math.max(0,E))}),B=F(()=>{const d=P()??e(m).predicted_og,j=V()??O()?.sg;if(!d||!j||d<=1)return null;const C=(d-j)/(d-1)*100;return Math.min(100,Math.max(0,C))}),U=F(()=>{const d=O()?.sg_rate;if(d==null)return null;const j=Math.abs(d);return j>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:j>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:j>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),J=F(()=>O()?.is_anomaly??!1),K=F(()=>O()?.anomaly_reasons??[]);var ve=he(),N=G(ve);{var Q=d=>{var j=_s();l(d,j)},b=d=>{var j=he(),C=G(j);{var H=E=>{var xe=gs(),Re=a(xe),oe=a(Re);t(Re),t(xe),u(()=>o(oe,`‚ö†Ô∏è ${e(S)??""}`)),l(E,xe)},be=E=>{var xe=he(),Re=G(xe);{var oe=ee=>{var ce=Fs();let M;var T=a(ce),y=s(a(T),2);y.__click=L;var I=a(y,!0);t(y),t(T);var X=s(T,2);{var te=h=>{var p=fs(),q=s(a(p),2),Z=s(a(q),2);{var Pe=He=>{var Xe=ps(),_e=a(Xe,!0);t(Xe),u(Oe=>o(_e,Oe),[()=>e(K).join(", ")]),l(He,Xe)};v(Z,He=>{e(K).length>0&&He(Pe)})}t(q),t(p),l(h,p)};v(X,h=>{e(J)&&h(te)})}var re=s(X,2);{var ue=h=>{var p=hs(),q=a(p),Z=s(a(q),2);{var Pe=Ie=>{var rt=ms(),gt=a(rt);t(rt),u(()=>{tt(rt,`color: ${e(U).color??""}`),o(gt,`${e(U).emoji??""} ${e(U).label??""}`)}),l(Ie,rt)};v(Z,Ie=>{e(U)&&Ie(Pe)})}t(q);var He=s(q,2),Xe=a(He);t(He);var _e=s(He,2),Oe=a(_e),at=a(Oe);t(Oe);var Ze=s(Oe,2),ot=a(Ze);t(Ze);var Ke=s(Ze,2),st=a(Ke);t(Ke),t(_e),t(p),u((Ie,rt,gt)=>{tt(Xe,`width: ${e(z)??""}%`),o(at,`OG: ${Ie??""}`),o(ot,`${rt??""}%`),o(st,`FG: ${gt??""}`)},[()=>xt(P()??e(m).predicted_og??0),()=>e(z).toFixed(0),()=>xt(e(m).predicted_fg??0)]),l(h,p)};v(re,h=>{e(z)!==null&&h(ue)})}var Ne=s(re,2),ye=a(Ne);{var Ve=h=>{var p=bs(),q=s(a(p),2),Z=a(q,!0);t(q),t(p),u(Pe=>o(Z,Pe),[()=>xt(e(m).predicted_fg)]),l(h,p)};v(ye,h=>{e(m).predicted_fg&&h(Ve)})}var De=s(ye,2);{var c=h=>{var p=xs(),q=s(a(p),2),Z=a(q);t(q),t(p),u(Pe=>o(Z,`${Pe??""}%`),[()=>e(B).toFixed(1)]),l(h,p)};v(De,h=>{e(B)!==null&&h(c)})}var x=s(De,2);{var W=h=>{const p=F(()=>de(e(m).estimated_completion));var q=ks(),Z=s(a(q),2),Pe=a(Z);{var He=_e=>{var Oe=js();l(_e,Oe)},Xe=_e=>{var Oe=ws(),at=G(Oe),Ze=s(at);{var ot=Ke=>{var st=ys(),Ie=a(st);t(st),u(()=>o(Ie,`(${e(p)??""} ${e(p)===1?"day":"days"})`)),l(Ke,st)};v(Ze,Ke=>{e(p)!==null&&Ke(ot)})}u(Ke=>o(at,`${Ke??""} `),[()=>se(e(m).estimated_completion)]),l(_e,Oe)};v(Pe,_e=>{e(p)!==null&&e(p)<=0?_e(He):_e(Xe,!1)})}t(Z),t(q),l(h,q)};v(x,h=>{e(m).estimated_completion&&h(W)})}var w=s(x,2),fe=a(w);{var we=h=>{var p=zs(),q=s(a(p),2),Z=a(q);t(q),t(p),u(Pe=>o(Z,`${Pe??""}%`),[()=>(e(m).r_squared*100).toFixed(0)]),l(h,p)};v(fe,h=>{e(m).r_squared!==void 0&&h(we)})}var Be=s(fe,2);{var Me=h=>{var p=qs(),q=s(a(p),2),Z=a(q,!0);t(q),t(p),u(()=>o(Z,e(m).num_readings)),l(h,p)};v(Be,h=>{e(m).num_readings&&h(Me)})}t(w),t(Ne),t(ce),u(()=>{M=Ue(ce,1,"ml-panel svelte-1xs394q",null,M,{"has-anomaly":e(J)}),y.disabled=e(r)||e(A),o(I,e(r)?"Reloading...":"‚Üª Reload")}),l(ee,ce)},je=ee=>{var ce=Cs(),M=a(ce),T=s(a(M),2);T.__click=L;var y=a(T,!0);t(T),t(M),Ce(2),t(ce),u(()=>{T.disabled=e(r)||e(A),o(y,e(r)?"Reloading...":"‚Üª Reload")}),l(ee,ce)};v(Re,ee=>{e(m).available?ee(oe):ee(je,!1)},!0)}l(E,xe)};v(C,E=>{e(S)?E(H):E(be,!1)},!0)}l(d,j)};v(N,d=>{e(A)?d(Q):d(b,!1)})}l(ie,ve),yt()}zt(["click"]);var Bs=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),Ms=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),Ts=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),Ss=i('<span class="recipe-type svelte-g5au2j"> </span>'),Ds=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),Ps=i('<span class="yeast-producer svelte-g5au2j"> </span>'),Os=i('<span class="yeast-temp svelte-g5au2j"> </span>'),As=i('<div class="yeast-strain-info svelte-g5au2j"><span class="yeast-label svelte-g5au2j">Yeast:</span> <span class="yeast-name svelte-g5au2j"> </span> <!> <!></div>'),Es=i('<div class="batch-timing svelte-g5au2j"> </div>'),Gs=i('<div class="batch-timing svelte-g5au2j"> </div>'),Ls=i('<option class="svelte-g5au2j"> </option>'),Us=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),Ns=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),Vs=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),Hs=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),Is=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),Ws=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),Ys=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),Js=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),Ks=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),Qs=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),Xs=i('<span class="status-badge idle svelte-g5au2j"> </span>'),Zs=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),$s=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),er=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),tr=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),ar=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),sr=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),rr=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),lr=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),nr=i('<span class="svelte-g5au2j"> </span>'),ir=i('<span class="svelte-g5au2j"> </span>'),vr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),or=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!></div></div>',1),dr=i('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),cr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Mr(ie,n){jt(n,!0);const P=()=>qa(Fa,"$page",V),[V,O]=za();let m=null,A=null,r=Fe(null),S=Fe(null),g=Fe(null);Qt([]);let L=Fe(!0),se=Fe(null),de=Fe(!1),z=Fe(!1),B=Fe(!1),U=Fe(!1),J=Fe(!1),K=Fe(!1),ve=F(()=>parseInt(P().params.id??"0"));const N={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},Q=["planning","fermenting","conditioning","completed","archived"];let b=F(()=>e(r)?N[e(r).status]:N.planning),d=F(ta),j=F(()=>kt.config.ha_enabled&&kt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),C=F(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),H=F(()=>!e(C)||!e(E)?.temp||!e(r)?.temp_target?!1:e(E).temp<=e(r).temp_target),be=F(()=>{if(!e(C)||!e(E)?.temp||!e(r)?.temp_target)return null;const c=e(r).temp_target+30,x=e(E).temp,W=e(r).temp_target;if(x<=W)return 100;if(x>=c)return 0;const w=(c-x)/(c-W)*100;return Math.min(100,Math.max(0,w))}),E=F(()=>{if(!e(r)?.device_id)return null;const c=Kt.tilts.get(e(r).device_id);if(c)return c;const x=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!x?.[1])return null;const W=x[1].toUpperCase();for(const w of Kt.tilts.values())if(w.color&&w.color.toUpperCase()===W)return w;return null});async function xe(){_(L,!0),_(se,null);try{if(_(r,await Ma(e(ve)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{_(S,await Yt(e(ve)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{_(g,await wt(e(ve)),!0)}catch{}}catch(c){_(se,c instanceof Error?c.message:"Failed to load batch",!0)}finally{_(L,!1)}}async function Re(c){if(!(!e(r)||e(z))&&!(c==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){_(z,!0);try{_(r,await Jt(e(r).id,{status:c}),!0),(c==="fermenting"||c==="conditioning")&&_(S,await Yt(e(r).id),!0)}catch(x){console.error("Failed to update status:",x)}finally{_(z,!1)}}}async function oe(c){if(e(r)&&(_(r,await Jt(e(r).id,c),!0),_(de,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{_(g,await wt(e(r).id),!0)}catch{}}async function je(){if(e(r)){_(J,!0);try{await Ta(e(r).id),Ca("/batches")}catch(c){_(se,c instanceof Error?c.message:"Failed to delete batch",!0),_(J,!1),_(U,!1)}}}async function ee(c,x){if(!(!e(r)||e(B))){_(B,!0);try{await Rt(e(r).id,x,60,c),_(g,await wt(e(r).id),!0)}catch(W){console.error("Failed to set override:",W)}finally{_(B,!1)}}}async function ce(){if(!(!e(r)||e(B))){_(B,!0);try{e(r).heater_entity_id&&await Rt(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Rt(e(r).id,null,60,"cooler"),_(g,await wt(e(r).id),!0)}catch(c){console.error("Failed to clear overrides:",c)}finally{_(B,!1)}}}function M(){if(m?.readyState===WebSocket.OPEN)return;const x=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;m=new WebSocket(x),m.onmessage=async W=>{try{const w=JSON.parse(W.data);w.type==="control_event"&&w.batch_id===e(ve)&&e(g)&&(w.action==="heat_on"?_(g,{...e(g),heater_state:"on"},!0):w.action==="heat_off"?_(g,{...e(g),heater_state:"off"},!0):w.action==="cool_on"?_(g,{...e(g),cooler_state:"on"},!0):w.action==="cool_off"&&_(g,{...e(g),cooler_state:"off"},!0))}catch{}},m.onclose=()=>{m=null,A=setTimeout(M,3e3)},m.onerror=()=>{m?.close()}}function T(){A&&(clearTimeout(A),A=null),m?.close(),m=null}function y(c){return c==null?"--":ea(c)}function I(c){return c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function X(c){if(!c)return"--";const x=new Date(c),w=(new Date().getTime()-x.getTime())/(1e3*60*60);if(w<1)return`${Math.round(w*60)}m`;if(w<24)return`${w.toFixed(1)}h`;const fe=w/24;return fe<7?`${fe.toFixed(1)}d`:`${Math.round(fe)}d`}Xt(()=>{xe(),M()}),ba(()=>{T()});var te=cr();ya("g5au2j",c=>{xa(()=>{ja.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var re=G(te),ue=s(a(re),2);{var Ne=c=>{var x=Bs();l(c,x)},ye=c=>{var x=he(),W=G(x);{var w=we=>{var Be=Ms(),Me=s(a(Be),2),h=a(Me,!0);t(Me);var p=s(Me,2);p.__click=xe,t(Be),u(()=>o(h,e(se))),l(we,Be)},fe=we=>{var Be=he(),Me=G(Be);{var h=q=>{var Z=Ts();l(q,Z)},p=q=>{var Z=he(),Pe=G(Z);{var He=_e=>{Sa(_e,{get batch(){return e(r)},onSubmit:oe,onCancel:()=>_(de,!1)})},Xe=_e=>{var Oe=or(),at=G(Oe),Ze=a(at),ot=a(Ze),Ke=a(ot);t(ot);var st=s(ot,2),Ie=a(st),rt=a(Ie,!0);t(Ie);var gt=s(Ie,2);{var sa=f=>{var R=Ds(),Y=a(R),le=s(Y);{var ae=ge=>{var Te=Ss(),Ae=a(Te);t(Te),u(()=>o(Ae,`(${e(r).recipe.type??""})`)),l(ge,Te)};v(le,ge=>{e(r).recipe.type&&ge(ae)})}t(R),u(()=>{ft(R,"href",`/recipes/${e(r).recipe.id??""}`),o(Y,`${e(r).recipe.name??""} `)}),l(f,R)};v(gt,f=>{e(r).recipe&&f(sa)})}var Bt=s(gt,2);{var ra=f=>{var R=As(),Y=s(a(R),2),le=a(Y,!0);t(Y);var ae=s(Y,2);{var ge=ke=>{var me=Ps(),Qe=a(me);t(me),u(()=>o(Qe,`(${e(r).yeast_strain.producer??""})`)),l(ke,me)};v(ae,ke=>{e(r).yeast_strain.producer&&ke(ge)})}var Te=s(ae,2);{var Ae=ke=>{var me=Os(),Qe=a(me);t(me),u((Ee,$)=>o(Qe,`${Ee??""}-${$??""}¬∞C`),[()=>e(r).yeast_strain.temp_low.toFixed(0),()=>e(r).yeast_strain.temp_high.toFixed(0)]),l(ke,me)};v(Te,ke=>{e(r).yeast_strain.temp_low&&e(r).yeast_strain.temp_high&&ke(Ae)})}t(R),u(()=>o(le,e(r).yeast_strain.name)),l(f,R)};v(Bt,f=>{e(r).yeast_strain&&f(ra)})}var la=s(Bt,2);{var na=f=>{var R=Es(),Y=a(R);t(R),u((le,ae)=>o(Y,`Started ${le??""} ¬∑ ${ae??""} ago`),[()=>I(e(r).start_time),()=>X(e(r).start_time)]),l(f,R)},ia=f=>{var R=he(),Y=G(R);{var le=ae=>{var ge=Gs(),Te=a(ge);t(ge),u(Ae=>o(Te,`Brewed ${Ae??""}`),[()=>I(e(r).brew_date)]),l(ae,ge)};v(Y,ae=>{e(r).brew_date&&ae(le)},!0)}l(f,R)};v(la,f=>{e(r).start_time?f(na):f(ia,!1)})}t(st),t(Ze);var Mt=s(Ze,2),Ft=a(Mt),$e=a(Ft);$e.__change=f=>Re(f.currentTarget.value),Zt($e,21,()=>Q,$t,(f,R)=>{var Y=Ls(),le=a(Y,!0);t(Y);var ae={};u(()=>{o(le,N[e(R)].label),ae!==(ae=e(R))&&(Y.value=(Y.__value=e(R))??"")}),l(f,Y)}),t($e);var Tt;wa($e),t(Ft);var St=s(Ft,2);St.__click=()=>_(de,!0);var va=s(St,2);va.__click=()=>_(U,!0),t(Mt),t(at);var Dt=s(at,2);{var oa=f=>{var R=Js();let Y;var le=a(R),ae=a(le);{var ge=k=>{var D=Us();Ce(2),l(k,D)},Te=k=>{var D=Ns();Ce(2),l(k,D)};v(ae,k=>{e(H)?k(ge):k(Te,!1)})}t(le);var Ae=s(le,2),ke=a(Ae),me=a(ke),Qe=s(a(me),2),Ee=a(Qe,!0);t(Qe),t(me);var $=s(me,4),Se=s(a($),2),dt=a(Se,!0);t(Se),t($),t(ke);var ct=s(ke,2);{var mt=k=>{var D=Vs(),pe=a(D),ze=a(pe);t(pe);var Ge=s(pe,2),ne=a(Ge);t(Ge),t(D),u(qe=>{tt(ze,`width: ${e(be)??""}%`),o(ne,`${qe??""}% to target`)},[()=>Math.round(e(be))]),l(k,D)};v(ct,k=>{e(be)!=null&&!e(H)&&k(mt)})}var We=s(ct,2),lt=a(We);{var ht=k=>{var D=Hs();l(k,D)},bt=k=>{var D=he(),pe=G(D);{var ze=ne=>{var qe=Is();l(ne,qe)},Ge=ne=>{var qe=he(),nt=G(qe);{var et=vt=>{var pt=Ws();l(vt,pt)},it=vt=>{var pt=Ys();l(vt,pt)};v(nt,vt=>{e(H)?vt(et):vt(it,!1)},!0)}l(ne,qe)};v(pe,ne=>{!kt.config.ha_enabled||!kt.config.temp_control_enabled?ne(ze):ne(Ge,!1)},!0)}l(k,D)};v(lt,k=>{e(r).cooler_entity_id?k(bt,!1):k(ht)})}t(We),t(Ae),t(R),u((k,D)=>{Y=Ue(R,1,"chilling-banner svelte-g5au2j",null,Y,{ready:e(H)}),o(Ee,k),o(dt,D)},[()=>e(E)?.temp!=null?y(e(E).temp):"--",()=>e(r).temp_target!=null?y(e(r).temp_target):"--"]),l(f,R)};v(Dt,f=>{e(C)&&f(oa)})}var Pt=s(Dt,2),Ct=a(Pt),Ot=a(Ct);{let f=F(()=>e(E)?.sg??e(S)?.measured?.current_sg);Ka(Ot,{get batch(){return e(r)},get currentSg(){return e(f)},get progress(){return e(S)},get liveReading(){return e(E)}})}var da=s(Ot,2);{var ca=f=>{ds(f,{get recipe(){return e(r).recipe}})};v(da,f=>{e(r).recipe&&f(ca)})}t(Ct);var At=s(Ct,2),Et=a(At);ns(Et,{get batch(){return e(r)},get liveReading(){return e(E)},onEdit:()=>_(de,!0)});var Gt=s(Et,2);{let f=F(()=>e(E)?.sg);Rs(Gt,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(f)},get liveReading(){return e(E)}})}var Lt=s(Gt,2);{var ua=f=>{var R=lr();let Y;var le=a(R);le.__click=()=>_(K,!e(K));var ae=s(a(le),2),ge=a(ae);{var Te=$=>{var Se=Ks();l($,Se)},Ae=$=>{var Se=he(),dt=G(Se);{var ct=We=>{var lt=Qs();l(We,lt)},mt=We=>{var lt=he(),ht=G(lt);{var bt=k=>{var D=Xs(),pe=a(D);t(D),u(ze=>o(pe,`üéØ ${ze??""}${e(d)??""}`),[()=>y(e(g).target_temp)]),l(k,D)};v(ht,k=>{e(K)&&e(g)&&k(bt)},!0)}l(We,lt)};v(dt,We=>{e(g)?.cooler_state==="on"?We(ct):We(mt,!1)},!0)}l($,Se)};v(ge,$=>{e(g)?.heater_state==="on"?$(Te):$(Ae,!1)})}var ke=s(ge,2);let me;t(ae),t(le);var Qe=s(le,2);{var Ee=$=>{var Se=rr(),dt=G(Se),ct=a(dt);{var mt=k=>{var D=Zs(),pe=a(D);let ze;var Ge=s(pe,2),ne=s(a(Ge),2);let qe;var nt=a(ne,!0);t(ne);var et=s(ne,2),it=a(et,!0);t(et),t(Ge),t(D),u(()=>{ze=Ue(pe,1,"device-icon-wrap svelte-g5au2j",null,ze,{active:e(g)?.heater_state==="on"}),qe=Ue(ne,1,"device-state svelte-g5au2j",null,qe,{on:e(g)?.heater_state==="on"}),o(nt,e(g)?.heater_state==="on"?"ON":"OFF"),o(it,e(r).heater_entity_id)}),l(k,D)};v(ct,k=>{e(r).heater_entity_id&&k(mt)})}var We=s(ct,2);{var lt=k=>{var D=$s(),pe=a(D);let ze;var Ge=s(pe,2),ne=s(a(Ge),2);let qe;var nt=a(ne,!0);t(ne);var et=s(ne,2),it=a(et,!0);t(et),t(Ge),t(D),u(()=>{ze=Ue(pe,1,"device-icon-wrap svelte-g5au2j",null,ze,{active:e(g)?.cooler_state==="on"}),qe=Ue(ne,1,"device-state svelte-g5au2j",null,qe,{on:e(g)?.cooler_state==="on"}),o(nt,e(g)?.cooler_state==="on"?"ON":"OFF"),o(it,e(r).cooler_entity_id)}),l(k,D)};v(We,k=>{e(r).cooler_entity_id&&k(lt)})}t(dt);var ht=s(dt,2);{var bt=k=>{var D=sr(),pe=G(D),ze=a(pe),Ge=s(a(ze),2),ne=a(Ge);t(Ge),t(ze);var qe=s(ze,2),nt=s(a(qe),2),et=a(nt);t(nt),t(qe),t(pe);var it=s(pe,2);{var vt=Le=>{var Ye=er(),Je=s(a(Ye),2),ut=a(Je);t(Je);var It=s(Je,2);It.__click=()=>ce(),t(Ye),u(ha=>{o(ut,`Override active: ${ha??""}`),It.disabled=e(B)},[()=>e(g).override_state?.toUpperCase()]),l(Le,Ye)};v(it,Le=>{e(g).override_active&&Le(vt)})}var pt=s(it,2),Ut=s(a(pt),2),Nt=a(Ut);{var fa=Le=>{var Ye=tr(),Je=G(Ye);Je.__click=()=>ee("heater","on");var ut=s(Je,2);ut.__click=()=>ee("heater","off"),u(()=>{Je.disabled=e(B),ut.disabled=e(B)}),l(Le,Ye)};v(Nt,Le=>{e(r).heater_entity_id&&Le(fa)})}var Vt=s(Nt,2);{var ma=Le=>{var Ye=ar(),Je=G(Ye);Je.__click=()=>ee("cooler","on");var ut=s(Je,2);ut.__click=()=>ee("cooler","off"),u(()=>{Je.disabled=e(B),ut.disabled=e(B)}),l(Le,Ye)};v(Vt,Le=>{e(r).cooler_entity_id&&Le(ma)})}var Ht=s(Vt,2);Ht.__click=()=>ce(),t(Ut),t(pt),u((Le,Ye)=>{o(ne,`${Le??""}${e(d)??""}`),o(et,`¬±${Ye??""}${e(d)??""}`),Ht.disabled=e(B)},[()=>y(e(g).target_temp),()=>e(g).hysteresis?.toFixed(1)||"--"]),l(k,D)};v(ht,k=>{e(g)&&k(bt)})}l($,Se)};v(Qe,$=>{e(K)||$(Ee)})}t(R),u(()=>{Y=Ue(R,1,"info-card temp-control-card svelte-g5au2j",null,Y,{"heater-on":e(g)?.heater_state==="on","cooler-on":e(g)?.cooler_state==="on",collapsed:e(K)}),me=Ue(ke,0,"chevron svelte-g5au2j",null,me,{rotated:!e(K)})}),l(f,R)},_a=f=>{var R=he(),Y=G(R);{var le=ae=>{var ge=vr(),Te=s(a(ge),2),Ae=a(Te);{var ke=Ee=>{var $=nr(),Se=a($);t($),u(()=>o(Se,`Heater: ${e(r).heater_entity_id??""}`)),l(Ee,$)};v(Ae,Ee=>{e(r).heater_entity_id&&Ee(ke)})}var me=s(Ae,2);{var Qe=Ee=>{var $=ir(),Se=a($);t($),u(()=>o(Se,`Cooler: ${e(r).cooler_entity_id??""}`)),l(Ee,$)};v(me,Ee=>{e(r).cooler_entity_id&&Ee(Qe)})}Ce(2),t(Te),t(ge),l(ae,ge)};v(Y,ae=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&ae(le)},!0)}l(f,R)};v(Lt,f=>{e(j)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?f(ua):f(_a,!1)})}var ga=s(Lt,2);{var pa=f=>{us(f,{get notes(){return e(r).notes}})};v(ga,f=>{e(r).notes&&f(pa)})}t(At),t(Pt),u(()=>{o(Ke,`#${(e(r).batch_number||"?")??""}`),o(rt,e(r).name||e(r).recipe?.name||"Unnamed Batch"),$e.disabled=e(z),tt($e,`color: ${e(b).color??""}; background: ${e(b).bg??""};`),Tt!==(Tt=e(r).status)&&($e.value=($e.__value=e(r).status)??"",ka($e,e(r).status))}),l(_e,Oe)};v(Pe,_e=>{e(de)?_e(He):_e(Xe,!1)},!0)}l(q,Z)};v(Me,q=>{e(r)?q(p,!1):q(h)},!0)}l(we,Be)};v(W,we=>{e(se)?we(w):we(fe,!1)},!0)}l(c,x)};v(ue,c=>{e(L)?c(Ne):c(ye,!1)})}t(re);var Ve=s(re,2);{var De=c=>{var x=dr();x.__click=()=>_(U,!1);var W=a(x);W.__click=p=>p.stopPropagation();var w=s(a(W),2),fe=a(w);t(w);var we=s(w,2),Be=a(we);Be.__click=()=>_(U,!1);var Me=s(Be,2);Me.__click=je;var h=a(Me,!0);t(Me),t(we),t(W),t(x),u(()=>{o(fe,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),Be.disabled=e(J),Me.disabled=e(J),o(h,e(J)?"Deleting...":"Delete Batch")}),l(c,x)};v(Ve,c=>{e(U)&&c(De)})}l(ie,te),yt(),O()}zt(["click","change"]);export{Mr as component,Br as universal};
