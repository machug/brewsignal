import{d as Bt,f as i,s as o,a as l,c as ye,t as wt,h as Ut}from"../chunks/Bkky6kvZ.js";import{d as a,e as s,r as t,t as u,a as zt,f as O,h as e,u as I,n as Ae,g as Ft,s as _e,p as It,o as oa,c as g,az as qa,aI as Ma,aJ as Sa,ax as Ba}from"../chunks/813s5maz.js";import{e as At,i as Ht}from"../chunks/j9QCVC2i.js";import{i as v}from"../chunks/Bf7HnLem.js";import{h as Ta}from"../chunks/BgIwEmqo.js";import{s as st}from"../chunks/UKAZQVVw.js";import{s as Ve}from"../chunks/LBYG0Yba.js";import{s as Xe}from"../chunks/C7upzuIa.js";import{b as Da,i as Aa,s as Pa}from"../chunks/D4jp30Ch.js";import{s as Oa,a as La}from"../chunks/Rx9Mwdtx.js";import{p as Ea}from"../chunks/6DBoBEM4.js";import{g as Ga}from"../chunks/DrYmoi98.js";import{a8 as Na,a9 as Ua,aa as Ia,ab as Ha,ac as Va,U as Wa,P as ia,ad as Tt,a2 as Ja,N as Et,ae as Gt}from"../chunks/CfO1AGIo.js";import{d as St,e as da,g as ca,c as Dt}from"../chunks/CbPjToI1.js";import{t as va}from"../chunks/DVuldl-p.js";import{B as Ya}from"../chunks/DPP-ovDV.js";import{s as Ka}from"../chunks/BB07oCeu.js";import{p as ht}from"../chunks/B-xGjlKy.js";import{F as Qa}from"../chunks/BHjz8HwJ.js";import{s as Nt}from"../chunks/BuoPMR_v.js";const Xa=!1,cl=Object.freeze(Object.defineProperty({__proto__:null,prerender:Xa},Symbol.toStringTag,{value:"Module"}));function Za(ge){return ge>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:ge>=-60?{bars:3,color:"var(--positive)",label:"Good"}:ge>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function ua(ge){const n=Math.floor((Date.now()-new Date(ge).getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const S=Math.floor(n/60);if(S<60)return`${S}m ago`;const Z=Math.floor(S/60);return Z<24?`${Z}h ago`:`${Math.floor(Z/24)}d ago`}var $a=i('<div class="accent-bar svelte-1oyrwd9"></div>'),es=i('<span class="card-icon svelte-1oyrwd9"> </span>'),ts=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),as=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function kt(ge,n){let S=ht(n,"highlight",3,!1),Z=ht(n,"compact",3,!1),T=ht(n,"collapsible",3,!1),m=ht(n,"expanded",3,!1);var L=as();let r;var H=a(L);{var h=j=>{var k=$a();l(j,k)};v(H,j=>{S()&&j(h)})}var se=s(H,2),de=a(se),ve=a(de);{var B=j=>{var k=es(),te=a(k,!0);t(k),u(()=>o(te,n.icon)),l(j,k)};v(ve,j=>{n.icon&&j(B)})}var oe=s(ve,2),V=a(oe,!0);t(oe),t(de);var re=s(de,2);{var b=j=>{var k=ts();k.__click=function(..._){n.onToggle?.apply(this,_)};var te=a(k);let W;t(k),u(()=>{st(k,"aria-label",m()?"Collapse":"Expand"),W=Ve(te,0,"expand-icon svelte-1oyrwd9",null,W,{"rotate-180":m()})}),l(j,k)};v(re,j=>{T()&&n.onToggle&&j(b)})}t(se);var D=s(se,2);let E;var G=a(D);Ka(G,()=>n.children),t(D),t(L),u(()=>{r=Ve(L,1,"batch-card svelte-1oyrwd9",null,r,{highlight:S(),compact:Z()}),o(V,n.title),E=Ve(D,1,"card-content svelte-1oyrwd9",null,E,{collapsed:T()&&!m()})}),l(ge,L)}Bt(["click"]);var ss=i('<span class="updated-text svelte-t80j9z"> </span>'),rs=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),ls=i('<div class="remaining-text svelte-t80j9z"> </div>'),ns=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),is=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),vs=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),os=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),ds=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function cs(ge,n){zt(n,!0);let S=I(()=>n.currentSg??n.progress?.measured?.current_sg),Z=I(()=>n.liveReading?.temp??n.progress?.temperature?.current),T=I(()=>n.liveReading?.last_seen),m=I(()=>e(T)?ua(e(T)):null),L=I(ca),r=I(()=>{if(!n.batch.measured_og||!e(S))return null;const B=Math.max(0,(n.batch.measured_og-e(S))*131.25),oe=n.batch.measured_og-1,V=oe!==0?Math.max(0,Math.min(100,(n.batch.measured_og-e(S))/oe*100)):0;return{abv:B,attenuation:V}}),H=I(()=>{const B=n.batch.measured_og,oe=n.batch.recipe?.fg;if(!B||!oe||!e(S))return null;const V=B-oe,re=B-e(S);return V<=0?null:Math.max(0,Math.min(100,re/V*100))}),h=I(()=>n.batch.status==="fermenting"||n.batch.status==="conditioning");function se(B){return B==null?"--":St(B)}function de(B){return B==null?"--":`${B.toFixed(1)}%`}function ve(B){return B==null?"--":da(B)}kt(ge,{title:"Fermentation",children:(B,oe)=>{var V=ye(),re=O(V);{var b=E=>{var G=vs(),j=O(G),k=s(a(j),2);{var te=w=>{var d=ss(),p=a(d);t(d),u(()=>o(p,`Updated ${e(m)??""}`)),l(w,d)};v(k,w=>{e(m)&&w(te)})}t(j);var W=s(j,2),_=a(W),z=a(_),ae=a(z,!0);t(z),Ae(2),t(_);var N=s(_,2);{var ie=w=>{var d=rs(),p=s(O(d),2),F=a(p),R=a(F,!0),Y=s(R),K=a(Y,!0);t(Y),t(F),Ae(2),t(p),u($=>{o(R,$),o(K,e(L))},[()=>ve(e(Z))]),l(w,d)};v(N,w=>{e(Z)!=null&&w(ie)})}t(W);var J=s(W,2);{var le=w=>{var d=ns(),p=a(d),F=a(p),R=a(F),Y=a(R,!0);t(R),Ae(2),t(F);var K=s(F,2),$=a(K),Te=a($);t($),t(K);var fe=s(K,2),xe=a(fe),ce=a(xe,!0);t(xe),Ae(2),t(fe),t(p);var Me=s(p,2),De=a(Me),c=s(De,2);let y;var U=s(a(c),2),A=a(U,!0);t(U),t(c),t(Me);var ke=s(Me,2);{var Se=ee=>{var ne=ls(),je=a(ne);t(ne),u(Ce=>o(je,`${Ce??""} points to go`),[()=>n.progress.progress.sg_remaining.toFixed(3)]),l(ee,ne)};v(ke,ee=>{n.progress?.progress?.sg_remaining!=null&&n.progress.progress.sg_remaining>0&&ee(Se)})}t(d),u((ee,ne,je,Ce)=>{o(Y,ee),o(Te,`${ne??""}%`),o(ce,je),Xe(De,`width: ${e(H)??""}%`),y=Ve(c,1,"progress-marker svelte-t80j9z",null,y,{"at-start":e(H)<3}),Xe(c,`left: ${e(H)??""}%`),o(A,Ce)},[()=>se(n.batch.measured_og),()=>e(H).toFixed(0),()=>se(n.batch.recipe.fg),()=>se(e(S))]),l(w,d)};v(J,w=>{e(H)!==null&&n.batch.measured_og&&n.batch.recipe?.fg&&w(le)})}var pe=s(J,2);{var Fe=w=>{var d=is(),p=a(d),F=a(p),R=a(F,!0);t(F),Ae(2),t(p);var Y=s(p,2),K=a(Y),$=a(K,!0);t(K),Ae(2),t(Y),t(d),u((Te,fe)=>{o(R,Te),o($,fe)},[()=>de(e(r).abv),()=>de(e(r).attenuation)]),l(w,d)};v(pe,w=>{e(r)&&w(Fe)})}u(w=>o(ae,w),[()=>se(e(S))]),l(E,G)},D=E=>{var G=ye(),j=O(G);{var k=W=>{var _=os(),z=a(_),ae=a(z),N=a(ae,!0);t(ae),Ae(2),t(z);var ie=s(z,2),J=a(ie),le=a(J,!0);t(J),Ae(2),t(ie);var pe=s(ie,2),Fe=a(pe),w=a(Fe,!0);t(Fe),Ae(2),t(pe);var d=s(pe,2),p=a(d),F=a(p,!0);t(p),Ae(2),t(d),t(_),u((R,Y,K,$)=>{o(N,R),o(le,Y),o(w,K),o(F,$)},[()=>se(n.batch.measured_og),()=>se(n.batch.measured_fg),()=>n.batch.measured_abv!=null?de(n.batch.measured_abv):"--",()=>n.batch.measured_attenuation!=null?de(n.batch.measured_attenuation):"--"]),l(W,_)},te=W=>{var _=ds();l(W,_)};v(j,W=>{n.batch.measured_og?W(k):W(te,!1)},!0)}l(E,G)};v(re,E=>{e(S)&&e(h)?E(b):E(D,!1)})}l(B,V)},$$slots:{default:!0}}),Ft()}var us=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),_s=i('<div class="signal-bar svelte-1kdxwtz"></div>'),gs=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),ps=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),fs=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),ms=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),hs=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),bs=i('<div class="device-info svelte-1kdxwtz"><!></div>'),ys=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),xs=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function js(ge,n){zt(n,!0);let S=I(()=>n.liveReading?.device_type==="tilt"),Z=I(()=>e(S)&&n.liveReading?.rssi?Za(n.liveReading.rssi):null),T=I(()=>n.liveReading?.last_seen?ua(n.liveReading.last_seen):null),m=I(()=>n.liveReading?.battery_percent!=null||n.liveReading?.battery_voltage!=null),L=I(()=>n.liveReading?.battery_percent),r=I(()=>n.liveReading?.battery_voltage),H=I(()=>e(L)?e(L)>50?"var(--positive)":e(L)>20?"var(--warning)":"var(--negative)":"var(--text-muted)"),h=I(()=>{if(!n.liveReading)return n.batch.device_id||"Unknown";const se=n.liveReading.device_type;return se==="tilt"?`${n.liveReading.color} Tilt`:se==="gravitymon"?`GravityMon (${n.liveReading.id})`:se==="ispindel"?`iSpindel (${n.liveReading.id})`:se==="floaty"?`Floaty (${n.liveReading.id})`:n.liveReading.color||n.liveReading.id});kt(ge,{title:"Tracking Device",compact:!0,children:(se,de)=>{var ve=ye(),B=O(ve);{var oe=re=>{var b=bs(),D=a(b);{var E=j=>{var k=ms(),te=O(k),W=a(te),_=s(a(W));t(W);var z=s(W,2);{var ae=J=>{var le=us(),pe=a(le,!0);t(le),u(()=>o(pe,e(T))),l(J,le)};v(z,J=>{e(T)&&J(ae)})}t(te);var N=s(te,2);{var ie=J=>{var le=fs(),pe=a(le);{var Fe=p=>{var F=gs(),R=a(F);At(R,20,()=>Array(4),Ht,($,Te,fe)=>{var xe=_s();u(()=>Xe(xe,`height: ${4+fe*2}px; background: ${(fe<e(Z).bars?e(Z).color:"var(--bg-hover)")??""}; opacity: ${fe<e(Z).bars?1:.4};`)),l($,xe)}),t(R);var Y=s(R,2),K=a(Y);t(Y),t(F),u(()=>{Xe(Y,`color: ${e(Z).color??""}`),o(K,`${n.liveReading.rssi??""}dBm`)}),l(p,F)};v(pe,p=>{e(Z)&&p(Fe)})}var w=s(pe,2);{var d=p=>{var F=ps(),R=a(F),Y=s(a(R)),K=s(Y);t(R);var $=s(R,2),Te=a($);{var fe=ce=>{var Me=wt();u(De=>o(Me,`${De??""}%`),[()=>e(L).toFixed(0)]),l(ce,Me)},xe=ce=>{var Me=ye(),De=O(Me);{var c=y=>{var U=wt();u(A=>o(U,`${A??""}V`),[()=>e(r).toFixed(2)]),l(y,U)};v(De,y=>{e(r)!=null&&y(c)},!0)}l(ce,Me)};v(Te,ce=>{e(L)!=null?ce(fe):ce(xe,!1)})}t($),t(F),u(()=>{st(R,"stroke",e(H)),st(Y,"width",(e(L)??50)*.14),st(Y,"fill",e(H)),st(K,"fill",e(H)),Xe($,`color: ${e(H)??""}`)}),l(p,F)};v(w,p=>{e(m)&&p(d)})}t(le),l(J,le)};v(N,J=>{(e(Z)||e(m))&&J(ie)})}u(()=>o(_,` ${e(h)??""}`)),l(j,k)},G=j=>{var k=hs(),te=a(k),W=s(a(te));t(te),Ae(2),t(k),u(()=>o(W,` ${n.batch.device_id??""}`)),l(j,k)};v(D,j=>{n.liveReading?j(E):j(G,!1)})}t(b),l(re,b)},V=re=>{var b=xs(),D=s(a(b),2);{var E=G=>{var j=ys();j.__click=function(...k){n.onEdit?.apply(this,k)},l(G,j)};v(D,G=>{n.onEdit&&G(E)})}t(b),l(re,b)};v(B,re=>{n.batch.device_id?re(oe):re(V,!1)})}l(se,ve)},$$slots:{default:!0}}),Ft()}Bt(["click"]);const ws=131.25;var ks=i('<span class="yeast-producer svelte-19u9n31"> </span>'),zs=i('<span class="yeast-temp svelte-19u9n31"> </span>'),Fs=i('<div class="yeast-row recipe svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Recipe</span> <span class="yeast-value muted svelte-19u9n31"> </span></div>'),Cs=i('<div class="yeast-row actual svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span> <!> <!></div> <!>',1),Rs=i('<div class="yeast-row svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span></div>'),qs=i('<div class="yeast-section svelte-19u9n31"><!></div>'),Ms=i('<div class="targets-row svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div></div> <!>',1);function Ss(ge,n){zt(n,!0);function S(T){return T==null?"--":St(T)}let Z=I(()=>n.recipe.abv!=null?n.recipe.abv:n.recipe.og&&n.recipe.fg?(n.recipe.og-n.recipe.fg)*ws:null);kt(ge,{title:"Recipe Targets",compact:!0,children:(T,m)=>{var L=Ms(),r=O(L),H=a(r),h=s(a(H),2),se=a(h,!0);t(h),t(H);var de=s(H,2),ve=s(a(de),2),B=a(ve,!0);t(ve),t(de);var oe=s(de,2),V=s(a(oe),2),re=a(V,!0);t(V),t(oe),t(r);var b=s(r,2);{var D=E=>{var G=qs(),j=a(G);{var k=W=>{var _=Cs(),z=O(_),ae=s(a(z),2),N=a(ae,!0);t(ae);var ie=s(ae,2);{var J=d=>{var p=ks(),F=a(p);t(p),u(()=>o(F,`(${n.yeastStrain.producer??""})`)),l(d,p)};v(ie,d=>{n.yeastStrain.producer&&d(J)})}var le=s(ie,2);{var pe=d=>{var p=zs(),F=a(p);t(p),u((R,Y)=>o(F,`${R??""}-${Y??""}¬∞C`),[()=>n.yeastStrain.temp_low.toFixed(0),()=>n.yeastStrain.temp_high.toFixed(0)]),l(d,p)};v(le,d=>{n.yeastStrain.temp_low&&n.yeastStrain.temp_high&&d(pe)})}t(z);var Fe=s(z,2);{var w=d=>{var p=Fs(),F=s(a(p),2),R=a(F,!0);t(F),t(p),u(()=>o(R,n.recipe.yeast_name)),l(d,p)};v(Fe,d=>{n.recipe.yeast_name&&d(w)})}u(()=>o(N,n.yeastStrain.name)),l(W,_)},te=W=>{var _=ye(),z=O(_);{var ae=N=>{var ie=Rs(),J=s(a(ie),2),le=a(J,!0);t(J),t(ie),u(()=>o(le,n.recipe.yeast_name)),l(N,ie)};v(z,N=>{n.recipe.yeast_name&&N(ae)},!0)}l(W,_)};v(j,W=>{n.yeastStrain?W(k):W(te,!1)})}t(G),l(E,G)};v(b,E=>{(n.yeastStrain||n.recipe.yeast_name)&&E(D)})}u((E,G,j)=>{o(se,E),o(B,G),o(re,j)},[()=>S(n.recipe.og),()=>S(n.recipe.fg),()=>e(Z)!=null?`${e(Z).toFixed(1)}%`:"--"]),l(T,L)},$$slots:{default:!0}}),Ft()}var Bs=i('<p class="notes-content svelte-hkv31i"> </p>');function Ts(ge,n){kt(ge,{title:"Notes",children:(S,Z)=>{var T=Bs(),m=a(T,!0);t(T),u(()=>o(m,n.notes)),l(S,T)},$$slots:{default:!0}})}var Ds=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),As=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Ps=i("<option> </option>"),Os=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),Ls=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),Es=i('<span class="activity-badge svelte-1xs394q"> </span>'),Gs=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),Ns=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Us=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),Is=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),Hs=i('<span class="days svelte-1xs394q"> </span>'),Vs=i(" <!>",1),Ws=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),Js=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model:</span> <span class="model-value model-type svelte-1xs394q"> </span></div>'),Ys=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Ks=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Qs=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <div class="header-controls svelte-1xs394q"><select class="model-select svelte-1xs394q" title="Select prediction model"></select> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!> <!></div></div></div>'),Xs=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q"><!></p></div>');function Zs(ge,n){zt(n,!0);let S=ht(n,"measuredOg",3,null),Z=ht(n,"currentSg",3,null),T=ht(n,"liveReading",3,null),m=_e(It({available:!1})),L=_e(!0),r=_e(!1),H=_e(null),h=_e("auto");const se=[{value:"auto",label:"Auto (Best Fit)"},{value:"exponential",label:"Exponential"},{value:"gompertz",label:"Gompertz (S-Curve)"},{value:"logistic",label:"Logistic"}];async function de(){g(L,!0),g(H,null);try{g(m,await Ua(n.batchId,e(h)),!0)}catch(_){g(H,_ instanceof Error?_.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",_)}finally{g(L,!1)}}async function ve(){g(r,!0),g(H,null);try{const _=await Na(n.batchId);console.log("Reloaded predictions:",_.message),await de()}catch(_){g(H,_ instanceof Error?_.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",_)}finally{g(r,!1)}}function B(){de()}oa(ve);function oe(_){return _?new Date(_).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function V(_){if(!_)return null;const z=new Date(_),ae=new Date,N=z.getTime()-ae.getTime();return Math.ceil(N/(1e3*60*60*24))}let re=I(()=>{const _=S()??e(m).predicted_og,z=e(m).predicted_fg,ae=Z()??T()?.sg;if(!_||!z||!ae||_<=z)return null;const N=_-z,J=(_-ae)/N*100;return Math.min(100,Math.max(0,J))}),b=I(()=>{const _=S()??e(m).predicted_og,z=Z()??T()?.sg;if(!_||!z||_<=1)return null;const ae=(_-z)/(_-1)*100;return Math.min(100,Math.max(0,ae))}),D=I(()=>{const _=T()?.sg_rate;if(_==null)return null;const z=Math.abs(_);return z>.002?{label:"Very Active",color:"var(--activity-very-active)",emoji:"üî•"}:z>5e-4?{label:"Active",color:"var(--activity-active)",emoji:"‚ú®"}:z>1e-4?{label:"Slowing",color:"var(--activity-slowing)",emoji:"üê¢"}:{label:"Complete",color:"var(--activity-complete)",emoji:"‚úì"}}),E=I(()=>T()?.is_anomaly??!1),G=I(()=>T()?.anomaly_reasons??[]);var j=ye(),k=O(j);{var te=_=>{var z=Ds();l(_,z)},W=_=>{var z=ye(),ae=O(z);{var N=J=>{var le=As(),pe=a(le),Fe=a(pe);t(pe),t(le),u(()=>o(Fe,`‚ö†Ô∏è ${e(H)??""}`)),l(J,le)},ie=J=>{var le=ye(),pe=O(le);{var Fe=d=>{var p=Qs();let F;var R=a(p),Y=s(a(R),2),K=a(Y);K.__change=B,At(K,21,()=>se,Ht,(M,C)=>{var q=Ps(),me=a(q,!0);t(q);var Re={};u(()=>{o(me,e(C).label),Re!==(Re=e(C).value)&&(q.value=(q.__value=e(C).value)??"")}),l(M,q)}),t(K);var $=s(K,2);$.__click=ve;var Te=a($,!0);t($),t(Y),t(R);var fe=s(R,2);{var xe=M=>{var C=Ls(),q=s(a(C),2),me=s(a(q),2);{var Re=Ge=>{var We=Os(),Ne=a(We,!0);t(We),u(Ue=>o(Ne,Ue),[()=>e(G).join(", ")]),l(Ge,We)};v(me,Ge=>{e(G).length>0&&Ge(Re)})}t(q),t(C),l(M,C)};v(fe,M=>{e(E)&&M(xe)})}var ce=s(fe,2);{var Me=M=>{var C=Gs(),q=a(C),me=s(a(q),2);{var Re=et=>{var nt=Es(),yt=a(nt);t(nt),u(()=>{Xe(nt,`color: ${e(D).color??""}`),o(yt,`${e(D).emoji??""} ${e(D).label??""}`)}),l(et,nt)};v(me,et=>{e(D)&&et(Re)})}t(q);var Ge=s(q,2),We=a(Ge);t(Ge);var Ne=s(Ge,2),Ue=a(Ne),lt=a(Ue);t(Ue);var ut=s(Ue,2),bt=a(ut);t(ut);var $e=s(ut,2),_t=a($e);t($e),t(Ne),t(C),u((et,nt,yt)=>{Xe(We,`width: ${e(re)??""}%`),o(lt,`OG: ${et??""}`),o(bt,`${nt??""}%`),o(_t,`FG: ${yt??""}`)},[()=>St(S()??e(m).predicted_og??0),()=>e(re).toFixed(0),()=>St(e(m).predicted_fg??0)]),l(M,C)};v(ce,M=>{e(re)!==null&&M(Me)})}var De=s(ce,2),c=a(De);{var y=M=>{var C=Ns(),q=s(a(C),2),me=a(q,!0);t(q),t(C),u(Re=>o(me,Re),[()=>St(e(m).predicted_fg)]),l(M,C)};v(c,M=>{e(m).predicted_fg&&M(y)})}var U=s(c,2);{var A=M=>{var C=Us(),q=s(a(C),2),me=a(q);t(q),t(C),u(Re=>o(me,`${Re??""}%`),[()=>e(b).toFixed(1)]),l(M,C)};v(U,M=>{e(b)!==null&&M(A)})}var ke=s(U,2);{var Se=M=>{const C=I(()=>V(e(m).estimated_completion));var q=Ws(),me=s(a(q),2),Re=a(me);{var Ge=Ne=>{var Ue=Is();l(Ne,Ue)},We=Ne=>{var Ue=Vs(),lt=O(Ue),ut=s(lt);{var bt=$e=>{var _t=Hs(),et=a(_t);t(_t),u(()=>o(et,`(${e(C)??""} ${e(C)===1?"day":"days"})`)),l($e,_t)};v(ut,$e=>{e(C)!==null&&$e(bt)})}u($e=>o(lt,`${$e??""} `),[()=>oe(e(m).estimated_completion)]),l(Ne,Ue)};v(Re,Ne=>{e(C)!==null&&e(C)<=0?Ne(Ge):Ne(We,!1)})}t(me),t(q),l(M,q)};v(ke,M=>{e(m).estimated_completion&&M(Se)})}var ee=s(ke,2),ne=a(ee);{var je=M=>{var C=Js(),q=s(a(C),2),me=a(q,!0);t(q),t(C),u(()=>o(me,e(m).model_type)),l(M,C)};v(ne,M=>{e(m).model_type&&M(je)})}var Ce=s(ne,2);{var Ze=M=>{var C=Ys(),q=s(a(C),2),me=a(q);t(q),t(C),u(Re=>o(me,`${Re??""}%`),[()=>(e(m).r_squared*100).toFixed(0)]),l(M,C)};v(Ce,M=>{e(m).r_squared!==void 0&&M(Ze)})}var rt=s(Ce,2);{var Ct=M=>{var C=Ks(),q=s(a(C),2),me=a(q,!0);t(q),t(C),u(()=>o(me,e(m).num_readings)),l(M,C)};v(rt,M=>{e(m).num_readings&&M(Ct)})}t(ee),t(De),t(p),u(()=>{F=Ve(p,1,"ml-panel svelte-1xs394q",null,F,{"has-anomaly":e(E)}),K.disabled=e(L)||e(r),$.disabled=e(r)||e(L),o(Te,e(r)?"Reloading...":"‚Üª")}),Da(K,()=>e(h),M=>g(h,M)),l(d,p)},w=d=>{var p=Xs(),F=a(p),R=s(a(F),2);R.__click=ve;var Y=a(R,!0);t(R),t(F);var K=s(F,2),$=a(K);{var Te=xe=>{var ce=wt("Waiting for fermentation to progress (need visible SG drop)");l(xe,ce)},fe=xe=>{var ce=ye(),Me=O(ce);{var De=y=>{var U=wt("Need more fermentation curve data for reliable prediction");l(y,U)},c=y=>{var U=ye(),A=O(U);{var ke=ee=>{var ne=wt("Need at least 10 readings to make predictions");l(ee,ne)},Se=ee=>{var ne=wt("Predictions will appear once fermentation is underway");l(ee,ne)};v(A,ee=>{e(m).reason==="insufficient_data"?ee(ke):ee(Se,!1)},!0)}l(y,U)};v(Me,y=>{e(m).reason==="insufficient_curve_data"?y(De):y(c,!1)},!0)}l(xe,ce)};v($,xe=>{e(m).reason==="insufficient_fermentation_progress"?xe(Te):xe(fe,!1)})}t(K),t(p),u(()=>{R.disabled=e(r)||e(L),o(Y,e(r)?"Reloading...":"‚Üª Reload")}),l(d,p)};v(pe,d=>{e(m).available?d(Fe):d(w,!1)},!0)}l(J,le)};v(ae,J=>{e(H)?J(N):J(ie,!1)},!0)}l(_,z)};v(k,_=>{e(L)?_(te):_(W,!1)})}l(ge,j),Ft()}Bt(["change","click"]);var $s=i('<div class="loading svelte-1hws0u6">Loading alerts...</div>'),er=i('<div class="error-banner svelte-1hws0u6"><span> </span> <button type="button" class="dismiss-error svelte-1hws0u6">√ó</button></div>'),tr=i('<button type="button" class="dismiss-all-btn svelte-1hws0u6"> </button>'),ar=i('<span class="spinner svelte-1hws0u6"></span>'),sr=Ut('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hws0u6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>'),rr=i('<div class="alert-item svelte-1hws0u6"><div class="alert-icon svelte-1hws0u6"> </div> <div class="alert-content svelte-1hws0u6"><div class="alert-header svelte-1hws0u6"><span class="alert-type svelte-1hws0u6"> </span> <span class="severity-badge svelte-1hws0u6"> </span></div> <p class="alert-message svelte-1hws0u6"> </p> <div class="alert-meta svelte-1hws0u6"><span class="alert-time svelte-1hws0u6"> </span> <span class="alert-separator svelte-1hws0u6">¬∑</span> <span class="alert-time svelte-1hws0u6"> </span></div></div> <button type="button" class="dismiss-btn svelte-1hws0u6" title="Dismiss alert"><!></button></div>'),lr=i('<!> <div class="alerts-header svelte-1hws0u6"><span class="alert-count svelte-1hws0u6"> </span> <!></div> <div class="alerts-list svelte-1hws0u6"></div>',1);function nr(ge,n){zt(n,!0);let S=_e(It([])),Z=_e(!0),T=_e(null),m=_e(null),L=_e(!1);qa(()=>{r()});async function r(){try{g(Z,!0),g(T,null),g(S,await Ia(n.batchId,!1),!0)}catch(b){g(T,b instanceof Error?b.message:"Failed to load alerts",!0)}finally{g(Z,!1)}}async function H(b){try{g(m,b,!0),await Ha(n.batchId,b),g(S,e(S).filter(D=>D.id!==b),!0)}catch(D){g(T,D instanceof Error?D.message:"Failed to dismiss alert",!0)}finally{g(m,null)}}async function h(){try{g(L,!0),await Va(n.batchId),g(S,[],!0)}catch(b){g(T,b instanceof Error?b.message:"Failed to dismiss alerts",!0)}finally{g(L,!1)}}function se(b){switch(b){case"critical":return"var(--negative)";case"warning":return"var(--warning)";case"info":return"var(--accent)";default:return"var(--text-muted)"}}function de(b){switch(b){case"stall":return"‚è∏";case"temperature_high":return"üî•";case"temperature_low":return"‚ùÑ";case"anomaly":return"‚ö†";default:return"‚ö†"}}function ve(b){const D=new Date(b),G=new Date().getTime()-D.getTime(),j=Math.floor(G/6e4),k=Math.floor(j/60),te=Math.floor(k/24);return te>0?`${te}d ago`:k>0?`${k}h ago`:j>0?`${j}m ago`:"just now"}var B=ye(),oe=O(B);{var V=b=>{kt(b,{title:"Alerts",icon:"üîî",children:(D,E)=>{var G=$s();l(D,G)},$$slots:{default:!0}})},re=b=>{var D=ye(),E=O(D);{var G=k=>{},j=k=>{kt(k,{title:"Active Alerts",icon:"üîî",highlight:!0,children:(te,W)=>{var _=lr(),z=O(_);{var ae=w=>{var d=er(),p=a(d),F=a(p,!0);t(p);var R=s(p,2);R.__click=()=>g(T,null),t(d),u(()=>o(F,e(T))),l(w,d)};v(z,w=>{e(T)&&w(ae)})}var N=s(z,2),ie=a(N),J=a(ie);t(ie);var le=s(ie,2);{var pe=w=>{var d=tr();d.__click=h;var p=a(d,!0);t(d),u(()=>{d.disabled=e(L),o(p,e(L)?"Dismissing...":"Dismiss All")}),l(w,d)};v(le,w=>{e(S).length>1&&w(pe)})}t(N);var Fe=s(N,2);At(Fe,21,()=>e(S),w=>w.id,(w,d)=>{var p=rr(),F=a(p),R=a(F,!0);t(F);var Y=s(F,2),K=a(Y),$=a(K),Te=a($,!0);t($);var fe=s($,2),xe=a(fe,!0);t(fe),t(K);var ce=s(K,2),Me=a(ce,!0);t(ce);var De=s(ce,2),c=a(De),y=a(c);t(c);var U=s(c,4),A=a(U);t(U),t(De),t(Y);var ke=s(Y,2);ke.__click=()=>H(e(d).id);var Se=a(ke);{var ee=je=>{var Ce=ar();l(je,Ce)},ne=je=>{var Ce=sr();l(je,Ce)};v(Se,je=>{e(m)===e(d).id?je(ee):je(ne,!1)})}t(ke),t(p),u((je,Ce,Ze,rt,Ct,M,C,q)=>{Xe(p,`--severity-color: ${je??""}`),o(R,Ce),o(Te,Ze),Xe(fe,`background: ${rt??""}`),o(xe,e(d).severity),o(Me,e(d).message),st(c,"title",`First detected: ${Ct??""}`),o(y,`First: ${M??""}`),st(U,"title",`Last seen: ${C??""}`),o(A,`Last: ${q??""}`),ke.disabled=e(m)===e(d).id},[()=>se(e(d).severity),()=>de(e(d).alert_type),()=>e(d).alert_type.replace("_"," "),()=>se(e(d).severity),()=>new Date(e(d).first_detected_at).toLocaleString(),()=>ve(e(d).first_detected_at),()=>new Date(e(d).last_seen_at).toLocaleString(),()=>ve(e(d).last_seen_at)]),l(w,p)}),t(Fe),u(()=>o(J,`${e(S).length??""} active`)),l(te,_)},$$slots:{default:!0}})};v(E,k=>{e(S).length===0?k(G):k(j,!1)},!0)}l(b,D)};v(oe,b=>{e(Z)?b(V):b(re,!1)})}l(ge,B),Ft()}Bt(["click"]);var ir=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),vr=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),or=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),dr=i('<span class="recipe-type svelte-g5au2j"> </span>'),cr=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),ur=i('<div class="batch-timing svelte-g5au2j"> </div>'),_r=i('<div class="batch-timing svelte-g5au2j"> </div>'),gr=i('<option class="svelte-g5au2j"> </option>'),pr=Ut('<svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" class="svelte-g5au2j"></path><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> Resume',1),fr=Ut('<svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> Pause',1),mr=i('<button type="button"><!></button>'),hr=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),br=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),yr=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),xr=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),jr=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),wr=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),kr=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),zr=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),Fr=i(`<div class="paused-banner svelte-g5au2j"><div class="paused-header svelte-g5au2j"><svg class="paused-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> <h3 class="paused-title svelte-g5au2j">Readings Paused</h3></div> <p class="paused-text svelte-g5au2j">Hydrometer readings are not being stored. Live readings still display but won't be saved to the fermentation history.</p> <button type="button" class="resume-btn svelte-g5au2j"> </button></div>`),Cr=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),Rr=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),qr=i('<span class="status-badge idle svelte-g5au2j"> </span>'),Mr=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Sr=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Br=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Tr=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),Dr=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),Ar=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),Pr=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),Or=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),Lr=i('<span class="svelte-g5au2j"> </span>'),Er=i('<span class="svelte-g5au2j"> </span>'),Gr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Nr=i('<div class="chart-section svelte-g5au2j"><!></div>'),Ur=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <!> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div> <!>',1),Ir=i('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),Hr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function ul(ge,n){zt(n,!0);const S=()=>La(Ea,"$page",Z),[Z,T]=Oa();let m=null,L=null,r=_e(null),H=_e(null),h=_e(null),se=It([]),de=_e(!0),ve=_e(null),B=_e(!1),oe=_e(!1),V=_e(!1),re=_e(!1),b=_e(!1),D=_e(!1),E=_e(!1),G=I(()=>parseInt(S().params.id??"0"));const j=["planning","fermenting","conditioning","completed","archived"];let k=I(()=>e(r)?Nt[e(r).status]:Nt.planning),te=I(ca),W=I(()=>Dt.config.ha_enabled&&Dt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),_=I(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),z=I(()=>!e(_)||!e(N)?.temp||!e(r)?.temp_target?!1:e(N).temp<=e(r).temp_target),ae=I(()=>{if(!e(_)||!e(N)?.temp||!e(r)?.temp_target)return null;const c=e(r).temp_target+30,y=e(N).temp,U=e(r).temp_target;if(y<=U)return 100;if(y>=c)return 0;const A=(c-y)/(c-U)*100;return Math.min(100,Math.max(0,A))}),N=I(()=>{if(!e(r)?.device_id)return null;const c=va.tilts.get(e(r).device_id);if(c)return c;const y=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!y?.[1])return null;const U=y[1].toUpperCase();for(const A of va.tilts.values())if(A.color&&A.color.toUpperCase()===U)return A;return null});async function ie(){g(de,!0),g(ve,null);try{if(g(r,await Wa(e(G)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{g(H,await ia(e(G)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{g(h,await Tt(e(G)),!0)}catch{}}catch(c){g(ve,c instanceof Error?c.message:"Failed to load batch",!0)}finally{g(de,!1)}}async function J(c){if(!(!e(r)||e(oe))&&!(c==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){g(oe,!0);try{g(r,await Et(e(r).id,{status:c}),!0),(c==="fermenting"||c==="conditioning")&&g(H,await ia(e(r).id),!0)}catch(y){console.error("Failed to update status:",y)}finally{g(oe,!1)}}}async function le(c){if(e(r)&&(g(r,await Et(e(r).id,c),!0),g(B,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{g(h,await Tt(e(r).id),!0)}catch{}}async function pe(){if(e(r)){g(b,!0);try{await Ja(e(r).id),Ga("/batches")}catch(c){g(ve,c instanceof Error?c.message:"Failed to delete batch",!0),g(b,!1),g(re,!1)}}}async function Fe(){if(!(!e(r)||e(E))){g(E,!0);try{g(r,await Et(e(r).id,{readings_paused:!e(r).readings_paused}),!0)}catch(c){console.error("Failed to toggle pause:",c)}finally{g(E,!1)}}}async function w(c,y){if(!(!e(r)||e(V))){g(V,!0);try{await Gt(e(r).id,y,60,c),g(h,await Tt(e(r).id),!0)}catch(U){console.error("Failed to set override:",U)}finally{g(V,!1)}}}async function d(){if(!(!e(r)||e(V))){g(V,!0);try{e(r).heater_entity_id&&await Gt(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Gt(e(r).id,null,60,"cooler"),g(h,await Tt(e(r).id),!0)}catch(c){console.error("Failed to clear overrides:",c)}finally{g(V,!1)}}}function p(){if(m?.readyState===WebSocket.OPEN)return;const y=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;m=new WebSocket(y),m.onmessage=async U=>{try{const A=JSON.parse(U.data);A.type==="control_event"&&A.batch_id===e(G)&&e(h)&&(A.action==="heat_on"?g(h,{...e(h),heater_state:"on"},!0):A.action==="heat_off"?g(h,{...e(h),heater_state:"off"},!0):A.action==="cool_on"?g(h,{...e(h),cooler_state:"on"},!0):A.action==="cool_off"&&g(h,{...e(h),cooler_state:"off"},!0))}catch{}},m.onclose=()=>{m=null,L=setTimeout(p,3e3)},m.onerror=()=>{m?.close()}}function F(){L&&(clearTimeout(L),L=null),m?.close(),m=null}function R(c){return c==null?"--":da(c)}function Y(c){return c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function K(c){if(!c)return"--";const y=new Date(c),A=(new Date().getTime()-y.getTime())/(1e3*60*60);if(A<1)return`${Math.round(A*60)}m`;if(A<24)return`${A.toFixed(1)}h`;const ke=A/24;return ke<7?`${ke.toFixed(1)}d`:`${Math.round(ke)}d`}oa(()=>{ie(),p()}),Ma(()=>{F()});var $=Hr();Ta("g5au2j",c=>{Sa(()=>{Ba.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var Te=O($),fe=s(a(Te),2);{var xe=c=>{var y=ir();l(c,y)},ce=c=>{var y=ye(),U=O(y);{var A=Se=>{var ee=vr(),ne=s(a(ee),2),je=a(ne,!0);t(ne);var Ce=s(ne,2);Ce.__click=ie,t(ee),u(()=>o(je,e(ve))),l(Se,ee)},ke=Se=>{var ee=ye(),ne=O(ee);{var je=Ze=>{var rt=or();l(Ze,rt)},Ce=Ze=>{var rt=ye(),Ct=O(rt);{var M=q=>{Ya(q,{get batch(){return e(r)},onSubmit:le,onCancel:()=>g(B,!1)})},C=q=>{var me=Ur(),Re=O(me),Ge=a(Re),We=a(Ge),Ne=a(We);t(We);var Ue=s(We,2),lt=a(Ue),ut=a(lt,!0);t(lt);var bt=s(lt,2);{var $e=f=>{var x=cr(),Q=a(x),ue=s(Q);{var he=qe=>{var ze=dr(),Pe=a(ze);t(ze),u(()=>o(Pe,`(${e(r).recipe.type??""})`)),l(qe,ze)};v(ue,qe=>{e(r).recipe.type&&qe(he)})}t(x),u(()=>{st(x,"href",`/recipes/${e(r).recipe.id??""}`),o(Q,`${e(r).recipe.name??""} `)}),l(f,x)};v(bt,f=>{e(r).recipe&&f($e)})}var _t=s(bt,2);{var et=f=>{var x=ur(),Q=a(x);t(x),u((ue,he)=>o(Q,`Started ${ue??""} ¬∑ ${he??""} ago`),[()=>Y(e(r).start_time),()=>K(e(r).start_time)]),l(f,x)},nt=f=>{var x=ye(),Q=O(x);{var ue=he=>{var qe=_r(),ze=a(qe);t(qe),u(Pe=>o(ze,`Brewed ${Pe??""}`),[()=>Y(e(r).brew_date)]),l(he,qe)};v(Q,he=>{e(r).brew_date&&he(ue)},!0)}l(f,x)};v(_t,f=>{e(r).start_time?f(et):f(nt,!1)})}t(Ue),t(Ge);var yt=s(Ge,2),Pt=a(yt),tt=a(Pt);tt.__change=f=>J(f.currentTarget.value),At(tt,21,()=>j,Ht,(f,x)=>{var Q=gr(),ue=a(Q,!0);t(Q);var he={};u(()=>{o(ue,Nt[e(x)].label),he!==(he=e(x))&&(Q.value=(Q.__value=e(x))??"")}),l(f,Q)}),t(tt);var Vt;Aa(tt),t(Pt);var Wt=s(Pt,2);{var _a=f=>{var x=mr();let Q;x.__click=Fe;var ue=a(x);{var he=ze=>{var Pe=pr();Ae(),l(ze,Pe)},qe=ze=>{var Pe=fr();Ae(),l(ze,Pe)};v(ue,ze=>{e(r).readings_paused?ze(he):ze(qe,!1)})}t(x),u(()=>{Q=Ve(x,1,"pause-btn svelte-g5au2j",null,Q,{paused:e(r).readings_paused}),x.disabled=e(E),st(x,"title",e(r).readings_paused?"Resume storing readings":"Pause storing readings")}),l(f,x)};v(Wt,f=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(_a)})}var Jt=s(Wt,2);Jt.__click=()=>g(B,!0);var ga=s(Jt,2);ga.__click=()=>g(re,!0),t(yt),t(Re);var Yt=s(Re,2);{var pa=f=>{var x=zr();let Q;var ue=a(x),he=a(ue);{var qe=P=>{var X=hr();Ae(2),l(P,X)},ze=P=>{var X=br();Ae(2),l(P,X)};v(he,P=>{e(z)?P(qe):P(ze,!1)})}t(ue);var Pe=s(ue,2),gt=a(Pe),it=a(gt),xt=s(a(it),2),Je=a(xt,!0);t(xt),t(it);var be=s(it,4),Ee=s(a(be),2),pt=a(Ee,!0);t(Ee),t(be),t(gt);var ft=s(gt,2);{var Rt=P=>{var X=yr(),Be=a(X),Oe=a(Be);t(Be);var Ie=s(Be,2),we=a(Ie);t(Ie),t(X),u(Le=>{Xe(Oe,`width: ${e(ae)??""}%`),o(we,`${Le??""}% to target`)},[()=>Math.round(e(ae))]),l(P,X)};v(ft,P=>{e(ae)!=null&&!e(z)&&P(Rt)})}var Ye=s(ft,2),vt=a(Ye);{var qt=P=>{var X=xr();l(P,X)},Mt=P=>{var X=ye(),Be=O(X);{var Oe=we=>{var Le=jr();l(we,Le)},Ie=we=>{var Le=ye(),ot=O(Le);{var at=ct=>{var jt=wr();l(ct,jt)},dt=ct=>{var jt=kr();l(ct,jt)};v(ot,ct=>{e(z)?ct(at):ct(dt,!1)},!0)}l(we,Le)};v(Be,we=>{!Dt.config.ha_enabled||!Dt.config.temp_control_enabled?we(Oe):we(Ie,!1)},!0)}l(P,X)};v(vt,P=>{e(r).cooler_entity_id?P(Mt,!1):P(qt)})}t(Ye),t(Pe),t(x),u((P,X)=>{Q=Ve(x,1,"chilling-banner svelte-g5au2j",null,Q,{ready:e(z)}),o(Je,P),o(pt,X)},[()=>e(N)?.temp!=null?R(e(N).temp):"--",()=>e(r).temp_target!=null?R(e(r).temp_target):"--"]),l(f,x)};v(Yt,f=>{e(_)&&f(pa)})}var Kt=s(Yt,2);{var fa=f=>{var x=Fr(),Q=s(a(x),4);Q.__click=Fe;var ue=a(Q,!0);t(Q),t(x),u(()=>{Q.disabled=e(E),o(ue,e(E)?"Resuming...":"Resume Readings")}),l(f,x)};v(Kt,f=>{e(r).readings_paused&&(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(fa)})}var Ot=s(Kt,2),Lt=a(Ot),Qt=a(Lt);{let f=I(()=>e(N)?.sg??e(H)?.measured?.current_sg);cs(Qt,{get batch(){return e(r)},get currentSg(){return e(f)},get progress(){return e(H)},get liveReading(){return e(N)}})}var ma=s(Qt,2);{var ha=f=>{Ss(f,{get recipe(){return e(r).recipe},get yeastStrain(){return e(r).yeast_strain}})};v(ma,f=>{e(r).recipe&&f(ha)})}t(Lt);var Xt=s(Lt,2),Zt=a(Xt);js(Zt,{get batch(){return e(r)},get liveReading(){return e(N)},onEdit:()=>g(B,!0)});var $t=s(Zt,2);{var ba=f=>{nr(f,{get batchId(){return e(r).id}})};v($t,f=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(ba)})}var ea=s($t,2);{let f=I(()=>e(N)?.sg);Zs(ea,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(f)},get liveReading(){return e(N)}})}var ta=s(ea,2);{var ya=f=>{var x=Or();let Q;var ue=a(x);ue.__click=()=>g(D,!e(D));var he=s(a(ue),2),qe=a(he);{var ze=be=>{var Ee=Cr();l(be,Ee)},Pe=be=>{var Ee=ye(),pt=O(Ee);{var ft=Ye=>{var vt=Rr();l(Ye,vt)},Rt=Ye=>{var vt=ye(),qt=O(vt);{var Mt=P=>{var X=qr(),Be=a(X);t(X),u(Oe=>o(Be,`üéØ ${Oe??""}${e(te)??""}`),[()=>R(e(h).target_temp)]),l(P,X)};v(qt,P=>{e(D)&&e(h)&&P(Mt)},!0)}l(Ye,vt)};v(pt,Ye=>{e(h)?.cooler_state==="on"?Ye(ft):Ye(Rt,!1)},!0)}l(be,Ee)};v(qe,be=>{e(h)?.heater_state==="on"?be(ze):be(Pe,!1)})}var gt=s(qe,2);let it;t(he),t(ue);var xt=s(ue,2);{var Je=be=>{var Ee=Pr(),pt=O(Ee),ft=a(pt);{var Rt=P=>{var X=Mr(),Be=a(X);let Oe;var Ie=s(Be,2),we=s(a(Ie),2);let Le;var ot=a(we,!0);t(we);var at=s(we,2),dt=a(at,!0);t(at),t(Ie),t(X),u(()=>{Oe=Ve(Be,1,"device-icon-wrap svelte-g5au2j",null,Oe,{active:e(h)?.heater_state==="on"}),Le=Ve(we,1,"device-state svelte-g5au2j",null,Le,{on:e(h)?.heater_state==="on"}),o(ot,e(h)?.heater_state==="on"?"ON":"OFF"),o(dt,e(r).heater_entity_id)}),l(P,X)};v(ft,P=>{e(r).heater_entity_id&&P(Rt)})}var Ye=s(ft,2);{var vt=P=>{var X=Sr(),Be=a(X);let Oe;var Ie=s(Be,2),we=s(a(Ie),2);let Le;var ot=a(we,!0);t(we);var at=s(we,2),dt=a(at,!0);t(at),t(Ie),t(X),u(()=>{Oe=Ve(Be,1,"device-icon-wrap svelte-g5au2j",null,Oe,{active:e(h)?.cooler_state==="on"}),Le=Ve(we,1,"device-state svelte-g5au2j",null,Le,{on:e(h)?.cooler_state==="on"}),o(ot,e(h)?.cooler_state==="on"?"ON":"OFF"),o(dt,e(r).cooler_entity_id)}),l(P,X)};v(Ye,P=>{e(r).cooler_entity_id&&P(vt)})}t(pt);var qt=s(pt,2);{var Mt=P=>{var X=Ar(),Be=O(X),Oe=a(Be),Ie=s(a(Oe),2),we=a(Ie);t(Ie),t(Oe);var Le=s(Oe,2),ot=s(a(Le),2),at=a(ot);t(ot),t(Le),t(Be);var dt=s(Be,2);{var ct=He=>{var Ke=Br(),Qe=s(a(Ke),2),mt=a(Qe);t(Qe);var na=s(Qe,2);na.__click=()=>d(),t(Ke),u(Ra=>{o(mt,`Override active: ${Ra??""}`),na.disabled=e(V)},[()=>e(h).override_state?.toUpperCase()]),l(He,Ke)};v(dt,He=>{e(h).override_active&&He(ct)})}var jt=s(dt,2),aa=s(a(jt),2),sa=a(aa);{var Fa=He=>{var Ke=Tr(),Qe=O(Ke);Qe.__click=()=>w("heater","on");var mt=s(Qe,2);mt.__click=()=>w("heater","off"),u(()=>{Qe.disabled=e(V),mt.disabled=e(V)}),l(He,Ke)};v(sa,He=>{e(r).heater_entity_id&&He(Fa)})}var ra=s(sa,2);{var Ca=He=>{var Ke=Dr(),Qe=O(Ke);Qe.__click=()=>w("cooler","on");var mt=s(Qe,2);mt.__click=()=>w("cooler","off"),u(()=>{Qe.disabled=e(V),mt.disabled=e(V)}),l(He,Ke)};v(ra,He=>{e(r).cooler_entity_id&&He(Ca)})}var la=s(ra,2);la.__click=()=>d(),t(aa),t(jt),u((He,Ke)=>{o(we,`${He??""}${e(te)??""}`),o(at,`¬±${Ke??""}${e(te)??""}`),la.disabled=e(V)},[()=>R(e(h).target_temp),()=>e(h).hysteresis?.toFixed(1)||"--"]),l(P,X)};v(qt,P=>{e(h)&&P(Mt)})}l(be,Ee)};v(xt,be=>{e(D)||be(Je)})}t(x),u(()=>{Q=Ve(x,1,"info-card temp-control-card svelte-g5au2j",null,Q,{"heater-on":e(h)?.heater_state==="on","cooler-on":e(h)?.cooler_state==="on",collapsed:e(D)}),it=Ve(gt,0,"chevron svelte-g5au2j",null,it,{rotated:!e(D)})}),l(f,x)},xa=f=>{var x=ye(),Q=O(x);{var ue=he=>{var qe=Gr(),ze=s(a(qe),2),Pe=a(ze);{var gt=Je=>{var be=Lr(),Ee=a(be);t(be),u(()=>o(Ee,`Heater: ${e(r).heater_entity_id??""}`)),l(Je,be)};v(Pe,Je=>{e(r).heater_entity_id&&Je(gt)})}var it=s(Pe,2);{var xt=Je=>{var be=Er(),Ee=a(be);t(be),u(()=>o(Ee,`Cooler: ${e(r).cooler_entity_id??""}`)),l(Je,be)};v(it,Je=>{e(r).cooler_entity_id&&Je(xt)})}Ae(2),t(ze),t(qe),l(he,qe)};v(Q,he=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&he(ue)},!0)}l(f,x)};v(ta,f=>{e(W)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?f(ya):f(xa,!1)})}var ja=s(ta,2);{var wa=f=>{Ts(f,{get notes(){return e(r).notes}})};v(ja,f=>{e(r).notes&&f(wa)})}t(Xt),t(Ot);var ka=s(Ot,2);{var za=f=>{var x=Nr(),Q=a(x);Qa(Q,{get batchId(){return e(r).id},get deviceColor(){return e(r).device_id},get originalGravity(){return e(r).measured_og},get controlEvents(){return se}}),t(x),l(f,x)};v(ka,f=>{e(r).device_id&&f(za)})}u(()=>{o(Ne,`#${(e(r).batch_number||"?")??""}`),o(ut,e(r).name||e(r).recipe?.name||"Unnamed Batch"),tt.disabled=e(oe),Xe(tt,`color: ${e(k).color??""}; background: ${e(k).bg??""};`),Vt!==(Vt=e(r).status)&&(tt.value=(tt.__value=e(r).status)??"",Pa(tt,e(r).status))}),l(q,me)};v(Ct,q=>{e(B)?q(M):q(C,!1)},!0)}l(Ze,rt)};v(ne,Ze=>{e(r)?Ze(Ce,!1):Ze(je)},!0)}l(Se,ee)};v(U,Se=>{e(ve)?Se(A):Se(ke,!1)},!0)}l(c,y)};v(fe,c=>{e(de)?c(xe):c(ce,!1)})}t(Te);var Me=s(Te,2);{var De=c=>{var y=Ir();y.__click=()=>g(re,!1);var U=a(y);U.__click=Ce=>Ce.stopPropagation();var A=s(a(U),2),ke=a(A);t(A);var Se=s(A,2),ee=a(Se);ee.__click=()=>g(re,!1);var ne=s(ee,2);ne.__click=pe;var je=a(ne,!0);t(ne),t(Se),t(U),t(y),u(()=>{o(ke,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),ee.disabled=e(b),ne.disabled=e(b),o(je,e(b)?"Deleting...":"Delete Batch")}),l(c,y)};v(Me,c=>{e(re)&&c(De)})}l(ge,$),Ft(),T()}Bt(["click","change"]);export{ul as component,cl as universal};
