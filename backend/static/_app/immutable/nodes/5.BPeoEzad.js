import{d as Bt,f as i,s as o,a as l,c as xe,t as wt,h as Ut}from"../chunks/BPY3LF1i.js";import{d as a,e as s,r as t,t as u,a as zt,f as E,h as e,u as I,n as Ae,g as Ft,s as ge,p as It,o as oa,c as g,az as qa,aJ as Ma,aC as Sa,ax as Ba}from"../chunks/WzhiZOZ9.js";import{e as At,i as Ht}from"../chunks/DnC7am1E.js";import{i as v}from"../chunks/DTo_ih-i.js";import{h as Ta}from"../chunks/BJzfFUzm.js";import{s as st}from"../chunks/D5Ox4mlS.js";import{s as Ve}from"../chunks/BYYdgBsh.js";import{s as Ke}from"../chunks/6KfV5OBv.js";import{b as Da,i as Aa,s as Pa}from"../chunks/BX-VZZUc.js";import{s as Oa,a as Ea}from"../chunks/fcLv_oK9.js";import{p as La}from"../chunks/8B-NeCpe.js";import{g as Ga}from"../chunks/BAXQlhq-.js";import{a8 as Na,a9 as Ua,aa as Ia,ab as Ha,ac as Va,X as Wa,S as ia,ad as Tt,a3 as Ja,Q as Lt,ae as Gt}from"../chunks/BKVJalqB.js";import{b as St,d as da,g as ca,c as Dt}from"../chunks/DHBlVBC1.js";import{t as va}from"../chunks/DGrXzhna.js";import{B as Ya}from"../chunks/DdJ3H5kn.js";import{s as Qa}from"../chunks/sGHY5uTo.js";import{p as ht}from"../chunks/AVMQxM7Q.js";import{F as Xa}from"../chunks/D00h4oxf.js";import{s as Nt}from"../chunks/BuoPMR_v.js";const Ka=!1,cl=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ka},Symbol.toStringTag,{value:"Module"}));function Za(pe){return pe>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:pe>=-60?{bars:3,color:"var(--positive)",label:"Good"}:pe>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function ua(pe){const n=Math.floor((Date.now()-new Date(pe).getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const S=Math.floor(n/60);if(S<60)return`${S}m ago`;const Z=Math.floor(S/60);return Z<24?`${Z}h ago`:`${Math.floor(Z/24)}d ago`}var $a=i('<div class="accent-bar svelte-1oyrwd9"></div>'),es=i('<span class="card-icon svelte-1oyrwd9"> </span>'),ts=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),as=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function kt(pe,n){let S=ht(n,"highlight",3,!1),Z=ht(n,"compact",3,!1),T=ht(n,"collapsible",3,!1),m=ht(n,"expanded",3,!1);var L=as();let r;var H=a(L);{var h=j=>{var k=$a();l(j,k)};v(H,j=>{S()&&j(h)})}var re=s(H,2),de=a(re),ve=a(de);{var B=j=>{var k=es(),ae=a(k,!0);t(k),u(()=>o(ae,n.icon)),l(j,k)};v(ve,j=>{n.icon&&j(B)})}var oe=s(ve,2),V=a(oe,!0);t(oe),t(de);var te=s(de,2);{var b=j=>{var k=ts();k.__click=function(..._){n.onToggle?.apply(this,_)};var ae=a(k);let W;t(k),u(()=>{st(k,"aria-label",m()?"Collapse":"Expand"),W=Ve(ae,0,"expand-icon svelte-1oyrwd9",null,W,{"rotate-180":m()})}),l(j,k)};v(te,j=>{T()&&n.onToggle&&j(b)})}t(re);var D=s(re,2);let G;var N=a(D);Qa(N,()=>n.children),t(D),t(L),u(()=>{r=Ve(L,1,"batch-card svelte-1oyrwd9",null,r,{highlight:S(),compact:Z()}),o(V,n.title),G=Ve(D,1,"card-content svelte-1oyrwd9",null,G,{collapsed:T()&&!m()})}),l(pe,L)}Bt(["click"]);var ss=i('<span class="updated-text svelte-t80j9z"> </span>'),rs=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),ls=i('<div class="remaining-text svelte-t80j9z"> </div>'),ns=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),is=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),vs=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),os=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),ds=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function cs(pe,n){zt(n,!0);let S=I(()=>n.currentSg??n.progress?.measured?.current_sg),Z=I(()=>n.liveReading?.temp??n.progress?.temperature?.current),T=I(()=>n.liveReading?.last_seen),m=I(()=>e(T)?ua(e(T)):null),L=I(ca),r=I(()=>{if(!n.batch.measured_og||!e(S))return null;const B=Math.max(0,(n.batch.measured_og-e(S))*131.25),oe=n.batch.measured_og-1,V=oe!==0?Math.max(0,Math.min(100,(n.batch.measured_og-e(S))/oe*100)):0;return{abv:B,attenuation:V}}),H=I(()=>{const B=n.batch.measured_og,oe=n.batch.recipe?.fg;if(!B||!oe||!e(S))return null;const V=B-oe,te=B-e(S);return V<=0?null:Math.max(0,Math.min(100,te/V*100))}),h=I(()=>n.batch.status==="fermenting"||n.batch.status==="conditioning");function re(B){return B==null?"--":St(B)}function de(B){return B==null?"--":`${B.toFixed(1)}%`}function ve(B){return B==null?"--":da(B)}kt(pe,{title:"Fermentation",children:(B,oe)=>{var V=xe(),te=E(V);{var b=G=>{var N=vs(),j=E(N),k=s(a(j),2);{var ae=w=>{var d=ss(),p=a(d);t(d),u(()=>o(p,`Updated ${e(m)??""}`)),l(w,d)};v(k,w=>{e(m)&&w(ae)})}t(j);var W=s(j,2),_=a(W),z=a(_),se=a(z,!0);t(z),Ae(2),t(_);var U=s(_,2);{var ie=w=>{var d=rs(),p=s(E(d),2),F=a(p),R=a(F,!0),Y=s(R),Q=a(Y,!0);t(Y),t(F),Ae(2),t(p),u($=>{o(R,$),o(Q,e(L))},[()=>ve(e(Z))]),l(w,d)};v(U,w=>{e(Z)!=null&&w(ie)})}t(W);var J=s(W,2);{var le=w=>{var d=ns(),p=a(d),F=a(p),R=a(F),Y=a(R,!0);t(R),Ae(2),t(F);var Q=s(F,2),$=a(Q),Te=a($);t($),t(Q);var me=s(Q,2),je=a(me),ce=a(je,!0);t(je),Ae(2),t(me),t(p);var Me=s(p,2),De=a(Me),c=s(De,2);let y;var O=s(a(c),2),A=a(O,!0);t(O),t(c),t(Me);var ze=s(Me,2);{var Se=ee=>{var ne=ls(),we=a(ne);t(ne),u(ue=>o(we,`${ue??""} points to go`),[()=>n.progress.progress.sg_remaining.toFixed(3)]),l(ee,ne)};v(ze,ee=>{n.progress?.progress?.sg_remaining!=null&&n.progress.progress.sg_remaining>0&&ee(Se)})}t(d),u((ee,ne,we,ue)=>{o(Y,ee),o(Te,`${ne??""}%`),o(ce,we),Ke(De,`width: ${e(H)??""}%`),y=Ve(c,1,"progress-marker svelte-t80j9z",null,y,{"at-start":e(H)<3}),Ke(c,`left: ${e(H)??""}%`),o(A,ue)},[()=>re(n.batch.measured_og),()=>e(H).toFixed(0),()=>re(n.batch.recipe.fg),()=>re(e(S))]),l(w,d)};v(J,w=>{e(H)!==null&&n.batch.measured_og&&n.batch.recipe?.fg&&w(le)})}var fe=s(J,2);{var Ce=w=>{var d=is(),p=a(d),F=a(p),R=a(F,!0);t(F),Ae(2),t(p);var Y=s(p,2),Q=a(Y),$=a(Q,!0);t(Q),Ae(2),t(Y),t(d),u((Te,me)=>{o(R,Te),o($,me)},[()=>de(e(r).abv),()=>de(e(r).attenuation)]),l(w,d)};v(fe,w=>{e(r)&&w(Ce)})}u(w=>o(se,w),[()=>re(e(S))]),l(G,N)},D=G=>{var N=xe(),j=E(N);{var k=W=>{var _=os(),z=a(_),se=a(z),U=a(se,!0);t(se),Ae(2),t(z);var ie=s(z,2),J=a(ie),le=a(J,!0);t(J),Ae(2),t(ie);var fe=s(ie,2),Ce=a(fe),w=a(Ce,!0);t(Ce),Ae(2),t(fe);var d=s(fe,2),p=a(d),F=a(p,!0);t(p),Ae(2),t(d),t(_),u((R,Y,Q,$)=>{o(U,R),o(le,Y),o(w,Q),o(F,$)},[()=>re(n.batch.measured_og),()=>re(n.batch.measured_fg),()=>n.batch.measured_abv!=null?de(n.batch.measured_abv):"--",()=>n.batch.measured_attenuation!=null?de(n.batch.measured_attenuation):"--"]),l(W,_)},ae=W=>{var _=ds();l(W,_)};v(j,W=>{n.batch.measured_og?W(k):W(ae,!1)},!0)}l(G,N)};v(te,G=>{e(S)&&e(h)?G(b):G(D,!1)})}l(B,V)},$$slots:{default:!0}}),Ft()}var us=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),_s=i('<div class="signal-bar svelte-1kdxwtz"></div>'),gs=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),ps=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),fs=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),ms=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),hs=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),bs=i('<div class="device-info svelte-1kdxwtz"><!></div>'),ys=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),xs=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function js(pe,n){zt(n,!0);let S=I(()=>n.liveReading?.device_type==="tilt"),Z=I(()=>e(S)&&n.liveReading?.rssi?Za(n.liveReading.rssi):null),T=I(()=>n.liveReading?.last_seen?ua(n.liveReading.last_seen):null),m=I(()=>n.liveReading?.battery_percent!=null||n.liveReading?.battery_voltage!=null),L=I(()=>n.liveReading?.battery_percent),r=I(()=>n.liveReading?.battery_voltage),H=I(()=>e(L)?e(L)>50?"var(--positive)":e(L)>20?"var(--warning)":"var(--negative)":"var(--text-muted)"),h=I(()=>{if(!n.liveReading)return n.batch.device_id||"Unknown";const re=n.liveReading.device_type;return re==="tilt"?`${n.liveReading.color} Tilt`:re==="gravitymon"?`GravityMon (${n.liveReading.id})`:re==="ispindel"?`iSpindel (${n.liveReading.id})`:re==="floaty"?`Floaty (${n.liveReading.id})`:n.liveReading.color||n.liveReading.id});kt(pe,{title:"Tracking Device",compact:!0,children:(re,de)=>{var ve=xe(),B=E(ve);{var oe=te=>{var b=bs(),D=a(b);{var G=j=>{var k=ms(),ae=E(k),W=a(ae),_=s(a(W));t(W);var z=s(W,2);{var se=J=>{var le=us(),fe=a(le,!0);t(le),u(()=>o(fe,e(T))),l(J,le)};v(z,J=>{e(T)&&J(se)})}t(ae);var U=s(ae,2);{var ie=J=>{var le=fs(),fe=a(le);{var Ce=p=>{var F=gs(),R=a(F);At(R,20,()=>Array(4),Ht,($,Te,me)=>{var je=_s();u(()=>Ke(je,`height: ${4+me*2}px; background: ${(me<e(Z).bars?e(Z).color:"var(--bg-hover)")??""}; opacity: ${me<e(Z).bars?1:.4};`)),l($,je)}),t(R);var Y=s(R,2),Q=a(Y);t(Y),t(F),u(()=>{Ke(Y,`color: ${e(Z).color??""}`),o(Q,`${n.liveReading.rssi??""}dBm`)}),l(p,F)};v(fe,p=>{e(Z)&&p(Ce)})}var w=s(fe,2);{var d=p=>{var F=ps(),R=a(F),Y=s(a(R)),Q=s(Y);t(R);var $=s(R,2),Te=a($);{var me=ce=>{var Me=wt();u(De=>o(Me,`${De??""}%`),[()=>e(L).toFixed(0)]),l(ce,Me)},je=ce=>{var Me=xe(),De=E(Me);{var c=y=>{var O=wt();u(A=>o(O,`${A??""}V`),[()=>e(r).toFixed(2)]),l(y,O)};v(De,y=>{e(r)!=null&&y(c)},!0)}l(ce,Me)};v(Te,ce=>{e(L)!=null?ce(me):ce(je,!1)})}t($),t(F),u(()=>{st(R,"stroke",e(H)),st(Y,"width",(e(L)??50)*.14),st(Y,"fill",e(H)),st(Q,"fill",e(H)),Ke($,`color: ${e(H)??""}`)}),l(p,F)};v(w,p=>{e(m)&&p(d)})}t(le),l(J,le)};v(U,J=>{(e(Z)||e(m))&&J(ie)})}u(()=>o(_,` ${e(h)??""}`)),l(j,k)},N=j=>{var k=hs(),ae=a(k),W=s(a(ae));t(ae),Ae(2),t(k),u(()=>o(W,` ${n.batch.device_id??""}`)),l(j,k)};v(D,j=>{n.liveReading?j(G):j(N,!1)})}t(b),l(te,b)},V=te=>{var b=xs(),D=s(a(b),2);{var G=N=>{var j=ys();j.__click=function(...k){n.onEdit?.apply(this,k)},l(N,j)};v(D,N=>{n.onEdit&&N(G)})}t(b),l(te,b)};v(B,te=>{n.batch.device_id?te(oe):te(V,!1)})}l(re,ve)},$$slots:{default:!0}}),Ft()}Bt(["click"]);const ws=131.25;var ks=i('<span class="yeast-producer svelte-19u9n31"> </span>'),zs=i('<span class="yeast-temp svelte-19u9n31"> </span>'),Fs=i('<div class="yeast-row recipe svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Recipe</span> <span class="yeast-value muted svelte-19u9n31"> </span></div>'),Cs=i('<div class="yeast-row actual svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span> <!> <!></div> <!>',1),Rs=i('<div class="yeast-row svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span></div>'),qs=i('<div class="yeast-section svelte-19u9n31"><!></div>'),Ms=i('<div class="targets-row svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div></div> <!>',1);function Ss(pe,n){zt(n,!0);function S(T){return T==null?"--":St(T)}let Z=I(()=>n.recipe.abv!=null?n.recipe.abv:n.recipe.og&&n.recipe.fg?(n.recipe.og-n.recipe.fg)*ws:null);kt(pe,{title:"Recipe Targets",compact:!0,children:(T,m)=>{var L=Ms(),r=E(L),H=a(r),h=s(a(H),2),re=a(h,!0);t(h),t(H);var de=s(H,2),ve=s(a(de),2),B=a(ve,!0);t(ve),t(de);var oe=s(de,2),V=s(a(oe),2),te=a(V,!0);t(V),t(oe),t(r);var b=s(r,2);{var D=G=>{var N=qs(),j=a(N);{var k=W=>{var _=Cs(),z=E(_),se=s(a(z),2),U=a(se,!0);t(se);var ie=s(se,2);{var J=d=>{var p=ks(),F=a(p);t(p),u(()=>o(F,`(${n.yeastStrain.producer??""})`)),l(d,p)};v(ie,d=>{n.yeastStrain.producer&&d(J)})}var le=s(ie,2);{var fe=d=>{var p=zs(),F=a(p);t(p),u((R,Y)=>o(F,`${R??""}-${Y??""}¬∞C`),[()=>n.yeastStrain.temp_low.toFixed(0),()=>n.yeastStrain.temp_high.toFixed(0)]),l(d,p)};v(le,d=>{n.yeastStrain.temp_low&&n.yeastStrain.temp_high&&d(fe)})}t(z);var Ce=s(z,2);{var w=d=>{var p=Fs(),F=s(a(p),2),R=a(F,!0);t(F),t(p),u(()=>o(R,n.recipe.yeast_name)),l(d,p)};v(Ce,d=>{n.recipe.yeast_name&&d(w)})}u(()=>o(U,n.yeastStrain.name)),l(W,_)},ae=W=>{var _=xe(),z=E(_);{var se=U=>{var ie=Rs(),J=s(a(ie),2),le=a(J,!0);t(J),t(ie),u(()=>o(le,n.recipe.yeast_name)),l(U,ie)};v(z,U=>{n.recipe.yeast_name&&U(se)},!0)}l(W,_)};v(j,W=>{n.yeastStrain?W(k):W(ae,!1)})}t(N),l(G,N)};v(b,G=>{(n.yeastStrain||n.recipe.yeast_name)&&G(D)})}u((G,N,j)=>{o(re,G),o(B,N),o(te,j)},[()=>S(n.recipe.og),()=>S(n.recipe.fg),()=>e(Z)!=null?`${e(Z).toFixed(1)}%`:"--"]),l(T,L)},$$slots:{default:!0}}),Ft()}var Bs=i('<p class="notes-content svelte-hkv31i"> </p>');function Ts(pe,n){kt(pe,{title:"Notes",children:(S,Z)=>{var T=Bs(),m=a(T,!0);t(T),u(()=>o(m,n.notes)),l(S,T)},$$slots:{default:!0}})}var Ds=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),As=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Ps=i("<option> </option>"),Os=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),Es=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),Ls=i('<span class="activity-badge svelte-1xs394q"> </span>'),Gs=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),Ns=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Us=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),Is=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),Hs=i('<span class="days svelte-1xs394q"> </span>'),Vs=i(" <!>",1),Ws=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),Js=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model:</span> <span class="model-value model-type svelte-1xs394q"> </span></div>'),Ys=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Qs=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Xs=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <div class="header-controls svelte-1xs394q"><select class="model-select svelte-1xs394q" title="Select prediction model"></select> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!> <!></div></div></div>'),Ks=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q"><!></p></div>');function Zs(pe,n){zt(n,!0);let S=ht(n,"measuredOg",3,null),Z=ht(n,"currentSg",3,null),T=ht(n,"liveReading",3,null),m=ge(It({available:!1})),L=ge(!0),r=ge(!1),H=ge(null),h=ge("auto");const re=[{value:"auto",label:"Auto (Best Fit)"},{value:"exponential",label:"Exponential"},{value:"gompertz",label:"Gompertz (S-Curve)"},{value:"logistic",label:"Logistic"}];async function de(){g(L,!0),g(H,null);try{g(m,await Ua(n.batchId,e(h)),!0)}catch(_){g(H,_ instanceof Error?_.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",_)}finally{g(L,!1)}}async function ve(){g(r,!0),g(H,null);try{const _=await Na(n.batchId);console.log("Reloaded predictions:",_.message),await de()}catch(_){g(H,_ instanceof Error?_.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",_)}finally{g(r,!1)}}function B(){de()}oa(ve);function oe(_){return _?new Date(_).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function V(_){if(!_)return null;const z=new Date(_),se=new Date,U=z.getTime()-se.getTime();return Math.ceil(U/(1e3*60*60*24))}let te=I(()=>{const _=S()??e(m).predicted_og,z=e(m).predicted_fg,se=Z()??T()?.sg;if(!_||!z||!se||_<=z)return null;const U=_-z,J=(_-se)/U*100;return Math.min(100,Math.max(0,J))}),b=I(()=>{const _=S()??e(m).predicted_og,z=Z()??T()?.sg;if(!_||!z||_<=1)return null;const se=(_-z)/(_-1)*100;return Math.min(100,Math.max(0,se))}),D=I(()=>{const _=T()?.sg_rate;if(_==null)return null;const z=Math.abs(_);return z>.002?{label:"Very Active",color:"var(--activity-very-active)",emoji:"üî•"}:z>5e-4?{label:"Active",color:"var(--activity-active)",emoji:"‚ú®"}:z>1e-4?{label:"Slowing",color:"var(--activity-slowing)",emoji:"üê¢"}:{label:"Complete",color:"var(--activity-complete)",emoji:"‚úì"}}),G=I(()=>T()?.is_anomaly??!1),N=I(()=>T()?.anomaly_reasons??[]);var j=xe(),k=E(j);{var ae=_=>{var z=Ds();l(_,z)},W=_=>{var z=xe(),se=E(z);{var U=J=>{var le=As(),fe=a(le),Ce=a(fe);t(fe),t(le),u(()=>o(Ce,`‚ö†Ô∏è ${e(H)??""}`)),l(J,le)},ie=J=>{var le=xe(),fe=E(le);{var Ce=d=>{var p=Xs();let F;var R=a(p),Y=s(a(R),2),Q=a(Y);Q.__change=B,At(Q,21,()=>re,Ht,(M,C)=>{var q=Ps(),he=a(q,!0);t(q);var Re={};u(()=>{o(he,e(C).label),Re!==(Re=e(C).value)&&(q.value=(q.__value=e(C).value)??"")}),l(M,q)}),t(Q);var $=s(Q,2);$.__click=ve;var Te=a($,!0);t($),t(Y),t(R);var me=s(R,2);{var je=M=>{var C=Es(),q=s(a(C),2),he=s(a(q),2);{var Re=Ge=>{var We=Os(),Ne=a(We,!0);t(We),u(Ue=>o(Ne,Ue),[()=>e(N).join(", ")]),l(Ge,We)};v(he,Ge=>{e(N).length>0&&Ge(Re)})}t(q),t(C),l(M,C)};v(me,M=>{e(G)&&M(je)})}var ce=s(me,2);{var Me=M=>{var C=Gs(),q=a(C),he=s(a(q),2);{var Re=et=>{var nt=Ls(),yt=a(nt);t(nt),u(()=>{Ke(nt,`color: ${e(D).color??""}`),o(yt,`${e(D).emoji??""} ${e(D).label??""}`)}),l(et,nt)};v(he,et=>{e(D)&&et(Re)})}t(q);var Ge=s(q,2),We=a(Ge);t(Ge);var Ne=s(Ge,2),Ue=a(Ne),lt=a(Ue);t(Ue);var ut=s(Ue,2),bt=a(ut);t(ut);var $e=s(ut,2),_t=a($e);t($e),t(Ne),t(C),u((et,nt,yt)=>{Ke(We,`width: ${e(te)??""}%`),o(lt,`OG: ${et??""}`),o(bt,`${nt??""}%`),o(_t,`FG: ${yt??""}`)},[()=>St(S()??e(m).predicted_og??0),()=>e(te).toFixed(0),()=>St(e(m).predicted_fg??0)]),l(M,C)};v(ce,M=>{e(te)!==null&&M(Me)})}var De=s(ce,2),c=a(De);{var y=M=>{var C=Ns(),q=s(a(C),2),he=a(q,!0);t(q),t(C),u(Re=>o(he,Re),[()=>St(e(m).predicted_fg)]),l(M,C)};v(c,M=>{e(m).predicted_fg&&M(y)})}var O=s(c,2);{var A=M=>{var C=Us(),q=s(a(C),2),he=a(q);t(q),t(C),u(Re=>o(he,`${Re??""}%`),[()=>e(b).toFixed(1)]),l(M,C)};v(O,M=>{e(b)!==null&&M(A)})}var ze=s(O,2);{var Se=M=>{const C=I(()=>V(e(m).estimated_completion));var q=Ws(),he=s(a(q),2),Re=a(he);{var Ge=Ne=>{var Ue=Is();l(Ne,Ue)},We=Ne=>{var Ue=Vs(),lt=E(Ue),ut=s(lt);{var bt=$e=>{var _t=Hs(),et=a(_t);t(_t),u(()=>o(et,`(${e(C)??""} ${e(C)===1?"day":"days"})`)),l($e,_t)};v(ut,$e=>{e(C)!==null&&$e(bt)})}u($e=>o(lt,`${$e??""} `),[()=>oe(e(m).estimated_completion)]),l(Ne,Ue)};v(Re,Ne=>{e(C)!==null&&e(C)<=0?Ne(Ge):Ne(We,!1)})}t(he),t(q),l(M,q)};v(ze,M=>{e(m).estimated_completion&&M(Se)})}var ee=s(ze,2),ne=a(ee);{var we=M=>{var C=Js(),q=s(a(C),2),he=a(q,!0);t(q),t(C),u(()=>o(he,e(m).model_type)),l(M,C)};v(ne,M=>{e(m).model_type&&M(we)})}var ue=s(ne,2);{var Ze=M=>{var C=Ys(),q=s(a(C),2),he=a(q);t(q),t(C),u(Re=>o(he,`${Re??""}%`),[()=>(e(m).r_squared*100).toFixed(0)]),l(M,C)};v(ue,M=>{e(m).r_squared!==void 0&&M(Ze)})}var rt=s(ue,2);{var Ct=M=>{var C=Qs(),q=s(a(C),2),he=a(q,!0);t(q),t(C),u(()=>o(he,e(m).num_readings)),l(M,C)};v(rt,M=>{e(m).num_readings&&M(Ct)})}t(ee),t(De),t(p),u(()=>{F=Ve(p,1,"ml-panel svelte-1xs394q",null,F,{"has-anomaly":e(G)}),Q.disabled=e(L)||e(r),$.disabled=e(r)||e(L),o(Te,e(r)?"Reloading...":"‚Üª")}),Da(Q,()=>e(h),M=>g(h,M)),l(d,p)},w=d=>{var p=Ks(),F=a(p),R=s(a(F),2);R.__click=ve;var Y=a(R,!0);t(R),t(F);var Q=s(F,2),$=a(Q);{var Te=je=>{var ce=wt("Waiting for fermentation to progress (need visible SG drop)");l(je,ce)},me=je=>{var ce=xe(),Me=E(ce);{var De=y=>{var O=wt("Need more fermentation curve data for reliable prediction");l(y,O)},c=y=>{var O=xe(),A=E(O);{var ze=ee=>{var ne=wt("Need at least 10 readings to make predictions");l(ee,ne)},Se=ee=>{var ne=wt("Predictions will appear once fermentation is underway");l(ee,ne)};v(A,ee=>{e(m).reason==="insufficient_data"?ee(ze):ee(Se,!1)},!0)}l(y,O)};v(Me,y=>{e(m).reason==="insufficient_curve_data"?y(De):y(c,!1)},!0)}l(je,ce)};v($,je=>{e(m).reason==="insufficient_fermentation_progress"?je(Te):je(me,!1)})}t(Q),t(p),u(()=>{R.disabled=e(r)||e(L),o(Y,e(r)?"Reloading...":"‚Üª Reload")}),l(d,p)};v(fe,d=>{e(m).available?d(Ce):d(w,!1)},!0)}l(J,le)};v(se,J=>{e(H)?J(U):J(ie,!1)},!0)}l(_,z)};v(k,_=>{e(L)?_(ae):_(W,!1)})}l(pe,j),Ft()}Bt(["change","click"]);var $s=i('<div class="loading svelte-1hws0u6">Loading alerts...</div>'),er=i('<div class="error-banner svelte-1hws0u6"><span> </span> <button type="button" class="dismiss-error svelte-1hws0u6">√ó</button></div>'),tr=i('<button type="button" class="dismiss-all-btn svelte-1hws0u6"> </button>'),ar=i('<span class="spinner svelte-1hws0u6"></span>'),sr=Ut('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hws0u6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>'),rr=i('<div class="alert-item svelte-1hws0u6"><div class="alert-icon svelte-1hws0u6"> </div> <div class="alert-content svelte-1hws0u6"><div class="alert-header svelte-1hws0u6"><span class="alert-type svelte-1hws0u6"> </span> <span class="severity-badge svelte-1hws0u6"> </span></div> <p class="alert-message svelte-1hws0u6"> </p> <div class="alert-meta svelte-1hws0u6"><span class="alert-time svelte-1hws0u6"> </span> <span class="alert-separator svelte-1hws0u6">¬∑</span> <span class="alert-time svelte-1hws0u6"> </span></div></div> <button type="button" class="dismiss-btn svelte-1hws0u6" title="Dismiss alert"><!></button></div>'),lr=i('<!> <div class="alerts-header svelte-1hws0u6"><span class="alert-count svelte-1hws0u6"> </span> <!></div> <div class="alerts-list svelte-1hws0u6"></div>',1);function nr(pe,n){zt(n,!0);let S=ge(It([])),Z=ge(!0),T=ge(null),m=ge(null),L=ge(!1);qa(()=>{r()});async function r(){try{g(Z,!0),g(T,null),g(S,await Ia(n.batchId,!1),!0)}catch(b){g(T,b instanceof Error?b.message:"Failed to load alerts",!0)}finally{g(Z,!1)}}async function H(b){try{g(m,b,!0),await Ha(n.batchId,b),g(S,e(S).filter(D=>D.id!==b),!0)}catch(D){g(T,D instanceof Error?D.message:"Failed to dismiss alert",!0)}finally{g(m,null)}}async function h(){try{g(L,!0),await Va(n.batchId),g(S,[],!0)}catch(b){g(T,b instanceof Error?b.message:"Failed to dismiss alerts",!0)}finally{g(L,!1)}}function re(b){switch(b){case"critical":return"var(--negative)";case"warning":return"var(--warning)";case"info":return"var(--accent)";default:return"var(--text-muted)"}}function de(b){switch(b){case"stall":return"‚è∏";case"temperature_high":return"üî•";case"temperature_low":return"‚ùÑ";case"anomaly":return"‚ö†";default:return"‚ö†"}}function ve(b){const D=new Date(b),N=new Date().getTime()-D.getTime(),j=Math.floor(N/6e4),k=Math.floor(j/60),ae=Math.floor(k/24);return ae>0?`${ae}d ago`:k>0?`${k}h ago`:j>0?`${j}m ago`:"just now"}var B=xe(),oe=E(B);{var V=b=>{kt(b,{title:"Alerts",icon:"üîî",children:(D,G)=>{var N=$s();l(D,N)},$$slots:{default:!0}})},te=b=>{var D=xe(),G=E(D);{var N=k=>{},j=k=>{kt(k,{title:"Active Alerts",icon:"üîî",highlight:!0,children:(ae,W)=>{var _=lr(),z=E(_);{var se=w=>{var d=er(),p=a(d),F=a(p,!0);t(p);var R=s(p,2);R.__click=()=>g(T,null),t(d),u(()=>o(F,e(T))),l(w,d)};v(z,w=>{e(T)&&w(se)})}var U=s(z,2),ie=a(U),J=a(ie);t(ie);var le=s(ie,2);{var fe=w=>{var d=tr();d.__click=h;var p=a(d,!0);t(d),u(()=>{d.disabled=e(L),o(p,e(L)?"Dismissing...":"Dismiss All")}),l(w,d)};v(le,w=>{e(S).length>1&&w(fe)})}t(U);var Ce=s(U,2);At(Ce,21,()=>e(S),w=>w.id,(w,d)=>{var p=rr(),F=a(p),R=a(F,!0);t(F);var Y=s(F,2),Q=a(Y),$=a(Q),Te=a($,!0);t($);var me=s($,2),je=a(me,!0);t(me),t(Q);var ce=s(Q,2),Me=a(ce,!0);t(ce);var De=s(ce,2),c=a(De),y=a(c);t(c);var O=s(c,4),A=a(O);t(O),t(De),t(Y);var ze=s(Y,2);ze.__click=()=>H(e(d).id);var Se=a(ze);{var ee=we=>{var ue=ar();l(we,ue)},ne=we=>{var ue=sr();l(we,ue)};v(Se,we=>{e(m)===e(d).id?we(ee):we(ne,!1)})}t(ze),t(p),u((we,ue,Ze,rt,Ct,M,C,q)=>{Ke(p,`--severity-color: ${we??""}`),o(R,ue),o(Te,Ze),Ke(me,`background: ${rt??""}`),o(je,e(d).severity),o(Me,e(d).message),st(c,"title",`First detected: ${Ct??""}`),o(y,`First: ${M??""}`),st(O,"title",`Last seen: ${C??""}`),o(A,`Last: ${q??""}`),ze.disabled=e(m)===e(d).id},[()=>re(e(d).severity),()=>de(e(d).alert_type),()=>e(d).alert_type.replace("_"," "),()=>re(e(d).severity),()=>new Date(e(d).first_detected_at).toLocaleString(),()=>ve(e(d).first_detected_at),()=>new Date(e(d).last_seen_at).toLocaleString(),()=>ve(e(d).last_seen_at)]),l(w,p)}),t(Ce),u(()=>o(J,`${e(S).length??""} active`)),l(ae,_)},$$slots:{default:!0}})};v(G,k=>{e(S).length===0?k(N):k(j,!1)},!0)}l(b,D)};v(oe,b=>{e(Z)?b(V):b(te,!1)})}l(pe,B),Ft()}Bt(["click"]);var ir=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),vr=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),or=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),dr=i('<span class="recipe-type svelte-g5au2j"> </span>'),cr=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),ur=i('<div class="batch-timing svelte-g5au2j"> </div>'),_r=i('<div class="batch-timing svelte-g5au2j"> </div>'),gr=i('<option class="svelte-g5au2j"> </option>'),pr=Ut('<svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" class="svelte-g5au2j"></path><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> Resume',1),fr=Ut('<svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> Pause',1),mr=i('<button type="button"><!></button>'),hr=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),br=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),yr=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),xr=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),jr=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),wr=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),kr=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),zr=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),Fr=i(`<div class="paused-banner svelte-g5au2j"><div class="paused-header svelte-g5au2j"><svg class="paused-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> <h3 class="paused-title svelte-g5au2j">Readings Paused</h3></div> <p class="paused-text svelte-g5au2j">Hydrometer readings are not being stored. Live readings still display but won't be saved to the fermentation history.</p> <button type="button" class="resume-btn svelte-g5au2j"> </button></div>`),Cr=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),Rr=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),qr=i('<span class="status-badge idle svelte-g5au2j"> </span>'),Mr=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Sr=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Br=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Tr=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),Dr=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),Ar=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),Pr=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),Or=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),Er=i('<span class="svelte-g5au2j"> </span>'),Lr=i('<span class="svelte-g5au2j"> </span>'),Gr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Nr=i('<div class="chart-section svelte-g5au2j"><!></div>'),Ur=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <!> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div> <!>',1),Ir=i('<div class="modal-overlay svelte-g5au2j" role="presentation"><div class="modal svelte-g5au2j" role="dialog" aria-modal="true" aria-labelledby="delete-modal-title" tabindex="-1"><h2 id="delete-modal-title" class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),Hr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function ul(pe,n){zt(n,!0);const S=()=>Ea(La,"$page",Z),[Z,T]=Oa();let m=null,L=null,r=ge(null),H=ge(null),h=ge(null),re=It([]),de=ge(!0),ve=ge(null),B=ge(!1),oe=ge(!1),V=ge(!1),te=ge(!1),b=ge(!1),D=ge(!1),G=ge(!1),N=I(()=>parseInt(S().params.id??"0"));const j=["planning","fermenting","conditioning","completed","archived"];let k=I(()=>e(r)?Nt[e(r).status]:Nt.planning),ae=I(ca),W=I(()=>Dt.config.ha_enabled&&Dt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),_=I(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),z=I(()=>!e(_)||!e(U)?.temp||!e(r)?.temp_target?!1:e(U).temp<=e(r).temp_target),se=I(()=>{if(!e(_)||!e(U)?.temp||!e(r)?.temp_target)return null;const c=e(r).temp_target+30,y=e(U).temp,O=e(r).temp_target;if(y<=O)return 100;if(y>=c)return 0;const A=(c-y)/(c-O)*100;return Math.min(100,Math.max(0,A))}),U=I(()=>{if(!e(r)?.device_id)return null;const c=va.tilts.get(e(r).device_id);if(c)return c;const y=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!y?.[1])return null;const O=y[1].toUpperCase();for(const A of va.tilts.values())if(A.color&&A.color.toUpperCase()===O)return A;return null});async function ie(){g(de,!0),g(ve,null);try{if(g(r,await Wa(e(N)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{g(H,await ia(e(N)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{g(h,await Tt(e(N)),!0)}catch{}}catch(c){g(ve,c instanceof Error?c.message:"Failed to load batch",!0)}finally{g(de,!1)}}async function J(c){if(!(!e(r)||e(oe))&&!(c==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){g(oe,!0);try{g(r,await Lt(e(r).id,{status:c}),!0),(c==="fermenting"||c==="conditioning")&&g(H,await ia(e(r).id),!0)}catch(y){console.error("Failed to update status:",y)}finally{g(oe,!1)}}}async function le(c){if(e(r)&&(g(r,await Lt(e(r).id,c),!0),g(B,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{g(h,await Tt(e(r).id),!0)}catch{}}async function fe(){if(e(r)){g(b,!0);try{await Ja(e(r).id),Ga("/batches")}catch(c){g(ve,c instanceof Error?c.message:"Failed to delete batch",!0),g(b,!1),g(te,!1)}}}async function Ce(){if(!(!e(r)||e(G))){g(G,!0);try{g(r,await Lt(e(r).id,{readings_paused:!e(r).readings_paused}),!0)}catch(c){console.error("Failed to toggle pause:",c)}finally{g(G,!1)}}}async function w(c,y){if(!(!e(r)||e(V))){g(V,!0);try{await Gt(e(r).id,y,60,c),g(h,await Tt(e(r).id),!0)}catch(O){console.error("Failed to set override:",O)}finally{g(V,!1)}}}async function d(){if(!(!e(r)||e(V))){g(V,!0);try{e(r).heater_entity_id&&await Gt(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Gt(e(r).id,null,60,"cooler"),g(h,await Tt(e(r).id),!0)}catch(c){console.error("Failed to clear overrides:",c)}finally{g(V,!1)}}}function p(){if(m?.readyState===WebSocket.OPEN)return;const y=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;m=new WebSocket(y),m.onmessage=async O=>{try{const A=JSON.parse(O.data);A.type==="control_event"&&A.batch_id===e(N)&&e(h)&&(A.action==="heat_on"?g(h,{...e(h),heater_state:"on"},!0):A.action==="heat_off"?g(h,{...e(h),heater_state:"off"},!0):A.action==="cool_on"?g(h,{...e(h),cooler_state:"on"},!0):A.action==="cool_off"&&g(h,{...e(h),cooler_state:"off"},!0))}catch{}},m.onclose=()=>{m=null,L=setTimeout(p,3e3)},m.onerror=()=>{m?.close()}}function F(){L&&(clearTimeout(L),L=null),m?.close(),m=null}function R(c){return c==null?"--":da(c)}function Y(c){return c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function Q(c){if(!c)return"--";const y=new Date(c),A=(new Date().getTime()-y.getTime())/(1e3*60*60);if(A<1)return`${Math.round(A*60)}m`;if(A<24)return`${A.toFixed(1)}h`;const ze=A/24;return ze<7?`${ze.toFixed(1)}d`:`${Math.round(ze)}d`}oa(()=>{ie(),p()}),Ma(()=>{F()});var $=Hr();Ta("g5au2j",c=>{Sa(()=>{Ba.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var Te=E($),me=s(a(Te),2);{var je=c=>{var y=ir();l(c,y)},ce=c=>{var y=xe(),O=E(y);{var A=Se=>{var ee=vr(),ne=s(a(ee),2),we=a(ne,!0);t(ne);var ue=s(ne,2);ue.__click=ie,t(ee),u(()=>o(we,e(ve))),l(Se,ee)},ze=Se=>{var ee=xe(),ne=E(ee);{var we=Ze=>{var rt=or();l(Ze,rt)},ue=Ze=>{var rt=xe(),Ct=E(rt);{var M=q=>{Ya(q,{get batch(){return e(r)},onSubmit:le,onCancel:()=>g(B,!1)})},C=q=>{var he=Ur(),Re=E(he),Ge=a(Re),We=a(Ge),Ne=a(We);t(We);var Ue=s(We,2),lt=a(Ue),ut=a(lt,!0);t(lt);var bt=s(lt,2);{var $e=f=>{var x=cr(),X=a(x),_e=s(X);{var be=qe=>{var Fe=dr(),Pe=a(Fe);t(Fe),u(()=>o(Pe,`(${e(r).recipe.type??""})`)),l(qe,Fe)};v(_e,qe=>{e(r).recipe.type&&qe(be)})}t(x),u(()=>{st(x,"href",`/recipes/${e(r).recipe.id??""}`),o(X,`${e(r).recipe.name??""} `)}),l(f,x)};v(bt,f=>{e(r).recipe&&f($e)})}var _t=s(bt,2);{var et=f=>{var x=ur(),X=a(x);t(x),u((_e,be)=>o(X,`Started ${_e??""} ¬∑ ${be??""} ago`),[()=>Y(e(r).start_time),()=>Q(e(r).start_time)]),l(f,x)},nt=f=>{var x=xe(),X=E(x);{var _e=be=>{var qe=_r(),Fe=a(qe);t(qe),u(Pe=>o(Fe,`Brewed ${Pe??""}`),[()=>Y(e(r).brew_date)]),l(be,qe)};v(X,be=>{e(r).brew_date&&be(_e)},!0)}l(f,x)};v(_t,f=>{e(r).start_time?f(et):f(nt,!1)})}t(Ue),t(Ge);var yt=s(Ge,2),Pt=a(yt),tt=a(Pt);tt.__change=f=>J(f.currentTarget.value),At(tt,21,()=>j,Ht,(f,x)=>{var X=gr(),_e=a(X,!0);t(X);var be={};u(()=>{o(_e,Nt[e(x)].label),be!==(be=e(x))&&(X.value=(X.__value=e(x))??"")}),l(f,X)}),t(tt);var Vt;Aa(tt),t(Pt);var Wt=s(Pt,2);{var _a=f=>{var x=mr();let X;x.__click=Ce;var _e=a(x);{var be=Fe=>{var Pe=pr();Ae(),l(Fe,Pe)},qe=Fe=>{var Pe=fr();Ae(),l(Fe,Pe)};v(_e,Fe=>{e(r).readings_paused?Fe(be):Fe(qe,!1)})}t(x),u(()=>{X=Ve(x,1,"pause-btn svelte-g5au2j",null,X,{paused:e(r).readings_paused}),x.disabled=e(G),st(x,"title",e(r).readings_paused?"Resume storing readings":"Pause storing readings")}),l(f,x)};v(Wt,f=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(_a)})}var Jt=s(Wt,2);Jt.__click=()=>g(B,!0);var ga=s(Jt,2);ga.__click=()=>g(te,!0),t(yt),t(Re);var Yt=s(Re,2);{var pa=f=>{var x=zr();let X;var _e=a(x),be=a(_e);{var qe=P=>{var K=hr();Ae(2),l(P,K)},Fe=P=>{var K=br();Ae(2),l(P,K)};v(be,P=>{e(z)?P(qe):P(Fe,!1)})}t(_e);var Pe=s(_e,2),gt=a(Pe),it=a(gt),xt=s(a(it),2),Je=a(xt,!0);t(xt),t(it);var ye=s(it,4),Le=s(a(ye),2),pt=a(Le,!0);t(Le),t(ye),t(gt);var ft=s(gt,2);{var Rt=P=>{var K=yr(),Be=a(K),Oe=a(Be);t(Be);var Ie=s(Be,2),ke=a(Ie);t(Ie),t(K),u(Ee=>{Ke(Oe,`width: ${e(se)??""}%`),o(ke,`${Ee??""}% to target`)},[()=>Math.round(e(se))]),l(P,K)};v(ft,P=>{e(se)!=null&&!e(z)&&P(Rt)})}var Ye=s(ft,2),vt=a(Ye);{var qt=P=>{var K=xr();l(P,K)},Mt=P=>{var K=xe(),Be=E(K);{var Oe=ke=>{var Ee=jr();l(ke,Ee)},Ie=ke=>{var Ee=xe(),ot=E(Ee);{var at=ct=>{var jt=wr();l(ct,jt)},dt=ct=>{var jt=kr();l(ct,jt)};v(ot,ct=>{e(z)?ct(at):ct(dt,!1)},!0)}l(ke,Ee)};v(Be,ke=>{!Dt.config.ha_enabled||!Dt.config.temp_control_enabled?ke(Oe):ke(Ie,!1)},!0)}l(P,K)};v(vt,P=>{e(r).cooler_entity_id?P(Mt,!1):P(qt)})}t(Ye),t(Pe),t(x),u((P,K)=>{X=Ve(x,1,"chilling-banner svelte-g5au2j",null,X,{ready:e(z)}),o(Je,P),o(pt,K)},[()=>e(U)?.temp!=null?R(e(U).temp):"--",()=>e(r).temp_target!=null?R(e(r).temp_target):"--"]),l(f,x)};v(Yt,f=>{e(_)&&f(pa)})}var Qt=s(Yt,2);{var fa=f=>{var x=Fr(),X=s(a(x),4);X.__click=Ce;var _e=a(X,!0);t(X),t(x),u(()=>{X.disabled=e(G),o(_e,e(G)?"Resuming...":"Resume Readings")}),l(f,x)};v(Qt,f=>{e(r).readings_paused&&(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(fa)})}var Ot=s(Qt,2),Et=a(Ot),Xt=a(Et);{let f=I(()=>e(U)?.sg??e(H)?.measured?.current_sg);cs(Xt,{get batch(){return e(r)},get currentSg(){return e(f)},get progress(){return e(H)},get liveReading(){return e(U)}})}var ma=s(Xt,2);{var ha=f=>{Ss(f,{get recipe(){return e(r).recipe},get yeastStrain(){return e(r).yeast_strain}})};v(ma,f=>{e(r).recipe&&f(ha)})}t(Et);var Kt=s(Et,2),Zt=a(Kt);js(Zt,{get batch(){return e(r)},get liveReading(){return e(U)},onEdit:()=>g(B,!0)});var $t=s(Zt,2);{var ba=f=>{nr(f,{get batchId(){return e(r).id}})};v($t,f=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(ba)})}var ea=s($t,2);{let f=I(()=>e(U)?.sg);Zs(ea,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(f)},get liveReading(){return e(U)}})}var ta=s(ea,2);{var ya=f=>{var x=Or();let X;var _e=a(x);_e.__click=()=>g(D,!e(D));var be=s(a(_e),2),qe=a(be);{var Fe=ye=>{var Le=Cr();l(ye,Le)},Pe=ye=>{var Le=xe(),pt=E(Le);{var ft=Ye=>{var vt=Rr();l(Ye,vt)},Rt=Ye=>{var vt=xe(),qt=E(vt);{var Mt=P=>{var K=qr(),Be=a(K);t(K),u(Oe=>o(Be,`üéØ ${Oe??""}${e(ae)??""}`),[()=>R(e(h).target_temp)]),l(P,K)};v(qt,P=>{e(D)&&e(h)&&P(Mt)},!0)}l(Ye,vt)};v(pt,Ye=>{e(h)?.cooler_state==="on"?Ye(ft):Ye(Rt,!1)},!0)}l(ye,Le)};v(qe,ye=>{e(h)?.heater_state==="on"?ye(Fe):ye(Pe,!1)})}var gt=s(qe,2);let it;t(be),t(_e);var xt=s(_e,2);{var Je=ye=>{var Le=Pr(),pt=E(Le),ft=a(pt);{var Rt=P=>{var K=Mr(),Be=a(K);let Oe;var Ie=s(Be,2),ke=s(a(Ie),2);let Ee;var ot=a(ke,!0);t(ke);var at=s(ke,2),dt=a(at,!0);t(at),t(Ie),t(K),u(()=>{Oe=Ve(Be,1,"device-icon-wrap svelte-g5au2j",null,Oe,{active:e(h)?.heater_state==="on"}),Ee=Ve(ke,1,"device-state svelte-g5au2j",null,Ee,{on:e(h)?.heater_state==="on"}),o(ot,e(h)?.heater_state==="on"?"ON":"OFF"),o(dt,e(r).heater_entity_id)}),l(P,K)};v(ft,P=>{e(r).heater_entity_id&&P(Rt)})}var Ye=s(ft,2);{var vt=P=>{var K=Sr(),Be=a(K);let Oe;var Ie=s(Be,2),ke=s(a(Ie),2);let Ee;var ot=a(ke,!0);t(ke);var at=s(ke,2),dt=a(at,!0);t(at),t(Ie),t(K),u(()=>{Oe=Ve(Be,1,"device-icon-wrap svelte-g5au2j",null,Oe,{active:e(h)?.cooler_state==="on"}),Ee=Ve(ke,1,"device-state svelte-g5au2j",null,Ee,{on:e(h)?.cooler_state==="on"}),o(ot,e(h)?.cooler_state==="on"?"ON":"OFF"),o(dt,e(r).cooler_entity_id)}),l(P,K)};v(Ye,P=>{e(r).cooler_entity_id&&P(vt)})}t(pt);var qt=s(pt,2);{var Mt=P=>{var K=Ar(),Be=E(K),Oe=a(Be),Ie=s(a(Oe),2),ke=a(Ie);t(Ie),t(Oe);var Ee=s(Oe,2),ot=s(a(Ee),2),at=a(ot);t(ot),t(Ee),t(Be);var dt=s(Be,2);{var ct=He=>{var Qe=Br(),Xe=s(a(Qe),2),mt=a(Xe);t(Xe);var na=s(Xe,2);na.__click=()=>d(),t(Qe),u(Ra=>{o(mt,`Override active: ${Ra??""}`),na.disabled=e(V)},[()=>e(h).override_state?.toUpperCase()]),l(He,Qe)};v(dt,He=>{e(h).override_active&&He(ct)})}var jt=s(dt,2),aa=s(a(jt),2),sa=a(aa);{var Fa=He=>{var Qe=Tr(),Xe=E(Qe);Xe.__click=()=>w("heater","on");var mt=s(Xe,2);mt.__click=()=>w("heater","off"),u(()=>{Xe.disabled=e(V),mt.disabled=e(V)}),l(He,Qe)};v(sa,He=>{e(r).heater_entity_id&&He(Fa)})}var ra=s(sa,2);{var Ca=He=>{var Qe=Dr(),Xe=E(Qe);Xe.__click=()=>w("cooler","on");var mt=s(Xe,2);mt.__click=()=>w("cooler","off"),u(()=>{Xe.disabled=e(V),mt.disabled=e(V)}),l(He,Qe)};v(ra,He=>{e(r).cooler_entity_id&&He(Ca)})}var la=s(ra,2);la.__click=()=>d(),t(aa),t(jt),u((He,Qe)=>{o(ke,`${He??""}${e(ae)??""}`),o(at,`¬±${Qe??""}${e(ae)??""}`),la.disabled=e(V)},[()=>R(e(h).target_temp),()=>e(h).hysteresis?.toFixed(1)||"--"]),l(P,K)};v(qt,P=>{e(h)&&P(Mt)})}l(ye,Le)};v(xt,ye=>{e(D)||ye(Je)})}t(x),u(()=>{X=Ve(x,1,"info-card temp-control-card svelte-g5au2j",null,X,{"heater-on":e(h)?.heater_state==="on","cooler-on":e(h)?.cooler_state==="on",collapsed:e(D)}),it=Ve(gt,0,"chevron svelte-g5au2j",null,it,{rotated:!e(D)})}),l(f,x)},xa=f=>{var x=xe(),X=E(x);{var _e=be=>{var qe=Gr(),Fe=s(a(qe),2),Pe=a(Fe);{var gt=Je=>{var ye=Er(),Le=a(ye);t(ye),u(()=>o(Le,`Heater: ${e(r).heater_entity_id??""}`)),l(Je,ye)};v(Pe,Je=>{e(r).heater_entity_id&&Je(gt)})}var it=s(Pe,2);{var xt=Je=>{var ye=Lr(),Le=a(ye);t(ye),u(()=>o(Le,`Cooler: ${e(r).cooler_entity_id??""}`)),l(Je,ye)};v(it,Je=>{e(r).cooler_entity_id&&Je(xt)})}Ae(2),t(Fe),t(qe),l(be,qe)};v(X,be=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&be(_e)},!0)}l(f,x)};v(ta,f=>{e(W)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?f(ya):f(xa,!1)})}var ja=s(ta,2);{var wa=f=>{Ts(f,{get notes(){return e(r).notes}})};v(ja,f=>{e(r).notes&&f(wa)})}t(Kt),t(Ot);var ka=s(Ot,2);{var za=f=>{var x=Nr(),X=a(x);Xa(X,{get batchId(){return e(r).id},get deviceColor(){return e(r).device_id},get originalGravity(){return e(r).measured_og},get controlEvents(){return re}}),t(x),l(f,x)};v(ka,f=>{e(r).device_id&&f(za)})}u(()=>{o(Ne,`#${(e(r).batch_number||"?")??""}`),o(ut,e(r).name||e(r).recipe?.name||"Unnamed Batch"),tt.disabled=e(oe),Ke(tt,`color: ${e(k).color??""}; background: ${e(k).bg??""};`),Vt!==(Vt=e(r).status)&&(tt.value=(tt.__value=e(r).status)??"",Pa(tt,e(r).status))}),l(q,he)};v(Ct,q=>{e(B)?q(M):q(C,!1)},!0)}l(Ze,rt)};v(ne,Ze=>{e(r)?Ze(ue,!1):Ze(we)},!0)}l(Se,ee)};v(O,Se=>{e(ve)?Se(A):Se(ze,!1)},!0)}l(c,y)};v(me,c=>{e(de)?c(je):c(ce,!1)})}t(Te);var Me=s(Te,2);{var De=c=>{var y=Ir();y.__click=()=>g(te,!1),y.__keydown=ue=>ue.key==="Escape"&&g(te,!1);var O=a(y);O.__click=ue=>ue.stopPropagation(),O.__keydown=ue=>ue.stopPropagation();var A=s(a(O),2),ze=a(A);t(A);var Se=s(A,2),ee=a(Se);ee.__click=()=>g(te,!1);var ne=s(ee,2);ne.__click=fe;var we=a(ne,!0);t(ne),t(Se),t(O),t(y),u(()=>{o(ze,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),ee.disabled=e(b),ne.disabled=e(b),o(we,e(b)?"Deleting...":"Delete Batch")}),l(c,y)};v(Me,c=>{e(te)&&c(De)})}l(pe,$),Ft(),T()}Bt(["click","change","keydown"]);export{ul as component,cl as universal};
