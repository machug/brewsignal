import{d as Bt,f as i,s as o,a as l,c as he,t as yt,h as ja}from"../chunks/Bkky6kvZ.js";import{d as a,e as s,r as t,t as u,a as wt,f as P,h as e,u as G,n as Le,g as kt,s as me,p as Lt,o as ra,c as g,az as wa,aI as ka,aJ as za,ax as Fa}from"../chunks/813s5maz.js";import{e as At,i as Gt}from"../chunks/j9QCVC2i.js";import{i as v}from"../chunks/Bf7HnLem.js";import{h as Ca}from"../chunks/BgIwEmqo.js";import{s as dt}from"../chunks/UKAZQVVw.js";import{s as He}from"../chunks/LBYG0Yba.js";import{s as Ke}from"../chunks/C7upzuIa.js";import{b as qa,i as Sa,s as Ma}from"../chunks/D4jp30Ch.js";import{s as Ra,a as Ba}from"../chunks/Rx9Mwdtx.js";import{p as Ta}from"../chunks/BdUxBLgr.js";import{g as Da}from"../chunks/C2HKSj-8.js";import{a8 as Aa,a9 as Pa,aa as Oa,ab as Ea,ac as La,Z as Ga,P as ta,ad as Tt,U as Na,N as aa,ae as Et}from"../chunks/D3bWYmks.js";import{d as Rt,e as la,g as na,c as Dt}from"../chunks/CbPjToI1.js";import{t as sa}from"../chunks/DVuldl-p.js";import{B as Ua}from"../chunks/DHmv3sWa.js";import{s as Ia}from"../chunks/BB07oCeu.js";import{p as mt}from"../chunks/B-xGjlKy.js";import{F as Ha}from"../chunks/D-9AEWgs.js";const Va=!1,el=Object.freeze(Object.defineProperty({__proto__:null,prerender:Va},Symbol.toStringTag,{value:"Module"}));function Wa(ue){return ue>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:ue>=-60?{bars:3,color:"var(--positive)",label:"Good"}:ue>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function ia(ue){const n=Math.floor((Date.now()-new Date(ue).getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const M=Math.floor(n/60);if(M<60)return`${M}m ago`;const X=Math.floor(M/60);return X<24?`${X}h ago`:`${Math.floor(X/24)}d ago`}var Ja=i('<div class="accent-bar svelte-1oyrwd9"></div>'),Ya=i('<span class="card-icon svelte-1oyrwd9"> </span>'),Za=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),Ka=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function jt(ue,n){let M=mt(n,"highlight",3,!1),X=mt(n,"compact",3,!1),T=mt(n,"collapsible",3,!1),f=mt(n,"expanded",3,!1);var O=Ka();let r;var I=a(O);{var h=k=>{var z=Ja();l(k,z)};v(I,k=>{M()&&k(h)})}var ae=s(I,2),ve=a(ae),ne=a(ve);{var R=k=>{var z=Ya(),ee=a(z,!0);t(z),u(()=>o(ee,n.icon)),l(k,z)};v(ne,k=>{n.icon&&k(R)})}var ie=s(ne,2),H=a(ie,!0);t(ie),t(ve);var se=s(ve,2);{var b=k=>{var z=Za();z.__click=function(...c){n.onToggle?.apply(this,c)};var ee=a(z);let W;t(z),u(()=>{dt(z,"aria-label",f()?"Collapse":"Expand"),W=He(ee,0,"expand-icon svelte-1oyrwd9",null,W,{"rotate-180":f()})}),l(k,z)};v(se,k=>{T()&&n.onToggle&&k(b)})}t(ae);var D=s(ae,2);let V;var N=a(D);Ia(N,()=>n.children),t(D),t(O),u(()=>{r=He(O,1,"batch-card svelte-1oyrwd9",null,r,{highlight:M(),compact:X()}),o(H,n.title),V=He(D,1,"card-content svelte-1oyrwd9",null,V,{collapsed:T()&&!f()})}),l(ue,O)}Bt(["click"]);var Qa=i('<span class="updated-text svelte-t80j9z"> </span>'),Xa=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),$a=i('<div class="remaining-text svelte-t80j9z"> </div>'),es=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),ts=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),as=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),ss=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),rs=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function ls(ue,n){wt(n,!0);let M=G(()=>n.currentSg??n.progress?.measured?.current_sg),X=G(()=>n.liveReading?.temp??n.progress?.temperature?.current),T=G(()=>n.liveReading?.last_seen),f=G(()=>e(T)?ia(e(T)):null),O=G(na),r=G(()=>{if(!n.batch.measured_og||!e(M))return null;const R=Math.max(0,(n.batch.measured_og-e(M))*131.25),ie=n.batch.measured_og-1,H=ie!==0?Math.max(0,Math.min(100,(n.batch.measured_og-e(M))/ie*100)):0;return{abv:R,attenuation:H}}),I=G(()=>{const R=n.batch.measured_og,ie=n.batch.recipe?.fg;if(!R||!ie||!e(M))return null;const H=R-ie,se=R-e(M);return H<=0?null:Math.max(0,Math.min(100,se/H*100))}),h=G(()=>n.batch.status==="fermenting"||n.batch.status==="conditioning");function ae(R){return R==null?"--":Rt(R)}function ve(R){return R==null?"--":`${R.toFixed(1)}%`}function ne(R){return R==null?"--":la(R)}jt(ue,{title:"Fermentation",children:(R,ie)=>{var H=he(),se=P(H);{var b=V=>{var N=as(),k=P(N),z=s(a(k),2);{var ee=C=>{var d=Qa(),p=a(d);t(d),u(()=>o(p,`Updated ${e(f)??""}`)),l(C,d)};v(z,C=>{e(f)&&C(ee)})}t(k);var W=s(k,2),c=a(W),F=a(c),te=a(F,!0);t(F),Le(2),t(c);var E=s(c,2);{var le=C=>{var d=Xa(),p=s(P(d),2),y=a(p),S=a(y,!0),Z=s(S),Y=a(Z,!0);t(Z),t(y),Le(2),t(p),u(K=>{o(S,K),o(Y,e(O))},[()=>ne(e(X))]),l(C,d)};v(E,C=>{e(X)!=null&&C(le)})}t(W);var J=s(W,2);{var re=C=>{var d=es(),p=a(d),y=a(p),S=a(y),Z=a(S,!0);t(S),Le(2),t(y);var Y=s(y,2),K=a(Y),Ae=a(K);t(K),t(Y);var ge=s(Y,2),xe=a(ge),oe=a(xe,!0);t(xe),Le(2),t(ge),t(p);var Se=s(p,2),_=a(Se),j=s(_,2);let L;var w=s(a(j),2),Me=a(w,!0);t(w),t(j),t(Se);var pe=s(Se,2);{var Fe=$=>{var ye=$a(),je=a(ye);t(ye),u(ke=>o(je,`${ke??""} points to go`),[()=>n.progress.progress.sg_remaining.toFixed(3)]),l($,ye)};v(pe,$=>{n.progress?.progress?.sg_remaining!=null&&n.progress.progress.sg_remaining>0&&$(Fe)})}t(d),u(($,ye,je,ke)=>{o(Z,$),o(Ae,`${ye??""}%`),o(oe,je),Ke(_,`width: ${e(I)??""}%`),L=He(j,1,"progress-marker svelte-t80j9z",null,L,{"at-start":e(I)<3}),Ke(j,`left: ${e(I)??""}%`),o(Me,ke)},[()=>ae(n.batch.measured_og),()=>e(I).toFixed(0),()=>ae(n.batch.recipe.fg),()=>ae(e(M))]),l(C,d)};v(J,C=>{e(I)!==null&&n.batch.measured_og&&n.batch.recipe?.fg&&C(re)})}var _e=s(J,2);{var be=C=>{var d=ts(),p=a(d),y=a(p),S=a(y,!0);t(y),Le(2),t(p);var Z=s(p,2),Y=a(Z),K=a(Y,!0);t(Y),Le(2),t(Z),t(d),u((Ae,ge)=>{o(S,Ae),o(K,ge)},[()=>ve(e(r).abv),()=>ve(e(r).attenuation)]),l(C,d)};v(_e,C=>{e(r)&&C(be)})}u(C=>o(te,C),[()=>ae(e(M))]),l(V,N)},D=V=>{var N=he(),k=P(N);{var z=W=>{var c=ss(),F=a(c),te=a(F),E=a(te,!0);t(te),Le(2),t(F);var le=s(F,2),J=a(le),re=a(J,!0);t(J),Le(2),t(le);var _e=s(le,2),be=a(_e),C=a(be,!0);t(be),Le(2),t(_e);var d=s(_e,2),p=a(d),y=a(p,!0);t(p),Le(2),t(d),t(c),u((S,Z,Y,K)=>{o(E,S),o(re,Z),o(C,Y),o(y,K)},[()=>ae(n.batch.measured_og),()=>ae(n.batch.measured_fg),()=>n.batch.measured_abv!=null?ve(n.batch.measured_abv):"--",()=>n.batch.measured_attenuation!=null?ve(n.batch.measured_attenuation):"--"]),l(W,c)},ee=W=>{var c=rs();l(W,c)};v(k,W=>{n.batch.measured_og?W(z):W(ee,!1)},!0)}l(V,N)};v(se,V=>{e(M)&&e(h)?V(b):V(D,!1)})}l(R,H)},$$slots:{default:!0}}),kt()}var ns=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),is=i('<div class="signal-bar svelte-1kdxwtz"></div>'),vs=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),os=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),ds=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),cs=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),us=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),_s=i('<div class="device-info svelte-1kdxwtz"><!></div>'),gs=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),ps=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function fs(ue,n){wt(n,!0);let M=G(()=>n.liveReading?.device_type==="tilt"),X=G(()=>e(M)&&n.liveReading?.rssi?Wa(n.liveReading.rssi):null),T=G(()=>n.liveReading?.last_seen?ia(n.liveReading.last_seen):null),f=G(()=>n.liveReading?.battery_percent!=null||n.liveReading?.battery_voltage!=null),O=G(()=>n.liveReading?.battery_percent),r=G(()=>n.liveReading?.battery_voltage),I=G(()=>e(O)?e(O)>50?"var(--positive)":e(O)>20?"#f59e0b":"var(--negative)":"var(--text-muted)"),h=G(()=>{if(!n.liveReading)return n.batch.device_id||"Unknown";const ae=n.liveReading.device_type;return ae==="tilt"?`${n.liveReading.color} Tilt`:ae==="gravitymon"?`GravityMon (${n.liveReading.id})`:ae==="ispindel"?`iSpindel (${n.liveReading.id})`:ae==="floaty"?`Floaty (${n.liveReading.id})`:n.liveReading.color||n.liveReading.id});jt(ue,{title:"Tracking Device",compact:!0,children:(ae,ve)=>{var ne=he(),R=P(ne);{var ie=se=>{var b=_s(),D=a(b);{var V=k=>{var z=cs(),ee=P(z),W=a(ee),c=s(a(W));t(W);var F=s(W,2);{var te=J=>{var re=ns(),_e=a(re,!0);t(re),u(()=>o(_e,e(T))),l(J,re)};v(F,J=>{e(T)&&J(te)})}t(ee);var E=s(ee,2);{var le=J=>{var re=ds(),_e=a(re);{var be=p=>{var y=vs(),S=a(y);At(S,20,()=>Array(4),Gt,(K,Ae,ge)=>{var xe=is();u(()=>Ke(xe,`height: ${4+ge*2}px; background: ${(ge<e(X).bars?e(X).color:"var(--bg-hover)")??""}; opacity: ${ge<e(X).bars?1:.4};`)),l(K,xe)}),t(S);var Z=s(S,2),Y=a(Z);t(Z),t(y),u(()=>{Ke(Z,`color: ${e(X).color??""}`),o(Y,`${n.liveReading.rssi??""}dBm`)}),l(p,y)};v(_e,p=>{e(X)&&p(be)})}var C=s(_e,2);{var d=p=>{var y=os(),S=a(y),Z=s(a(S)),Y=s(Z);t(S);var K=s(S,2),Ae=a(K);{var ge=oe=>{var Se=yt();u(_=>o(Se,`${_??""}%`),[()=>e(O).toFixed(0)]),l(oe,Se)},xe=oe=>{var Se=he(),_=P(Se);{var j=L=>{var w=yt();u(Me=>o(w,`${Me??""}V`),[()=>e(r).toFixed(2)]),l(L,w)};v(_,L=>{e(r)!=null&&L(j)},!0)}l(oe,Se)};v(Ae,oe=>{e(O)!=null?oe(ge):oe(xe,!1)})}t(K),t(y),u(()=>{dt(S,"stroke",e(I)),dt(Z,"width",(e(O)??50)*.14),dt(Z,"fill",e(I)),dt(Y,"fill",e(I)),Ke(K,`color: ${e(I)??""}`)}),l(p,y)};v(C,p=>{e(f)&&p(d)})}t(re),l(J,re)};v(E,J=>{(e(X)||e(f))&&J(le)})}u(()=>o(c,` ${e(h)??""}`)),l(k,z)},N=k=>{var z=us(),ee=a(z),W=s(a(ee));t(ee),Le(2),t(z),u(()=>o(W,` ${n.batch.device_id??""}`)),l(k,z)};v(D,k=>{n.liveReading?k(V):k(N,!1)})}t(b),l(se,b)},H=se=>{var b=ps(),D=s(a(b),2);{var V=N=>{var k=gs();k.__click=function(...z){n.onEdit?.apply(this,z)},l(N,k)};v(D,N=>{n.onEdit&&N(V)})}t(b),l(se,b)};v(R,se=>{n.batch.device_id?se(ie):se(H,!1)})}l(ae,ne)},$$slots:{default:!0}}),kt()}Bt(["click"]);const ms=131.25;var hs=i('<span class="yeast-producer svelte-19u9n31"> </span>'),bs=i('<span class="yeast-temp svelte-19u9n31"> </span>'),xs=i('<div class="yeast-row recipe svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Recipe</span> <span class="yeast-value muted svelte-19u9n31"> </span></div>'),ys=i('<div class="yeast-row actual svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span> <!> <!></div> <!>',1),js=i('<div class="yeast-row svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span></div>'),ws=i('<div class="yeast-section svelte-19u9n31"><!></div>'),ks=i('<div class="targets-row svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div></div> <!>',1);function zs(ue,n){wt(n,!0);function M(T){return T==null?"--":Rt(T)}let X=G(()=>n.recipe.abv!=null?n.recipe.abv:n.recipe.og&&n.recipe.fg?(n.recipe.og-n.recipe.fg)*ms:null);jt(ue,{title:"Recipe Targets",compact:!0,children:(T,f)=>{var O=ks(),r=P(O),I=a(r),h=s(a(I),2),ae=a(h,!0);t(h),t(I);var ve=s(I,2),ne=s(a(ve),2),R=a(ne,!0);t(ne),t(ve);var ie=s(ve,2),H=s(a(ie),2),se=a(H,!0);t(H),t(ie),t(r);var b=s(r,2);{var D=V=>{var N=ws(),k=a(N);{var z=W=>{var c=ys(),F=P(c),te=s(a(F),2),E=a(te,!0);t(te);var le=s(te,2);{var J=d=>{var p=hs(),y=a(p);t(p),u(()=>o(y,`(${n.yeastStrain.producer??""})`)),l(d,p)};v(le,d=>{n.yeastStrain.producer&&d(J)})}var re=s(le,2);{var _e=d=>{var p=bs(),y=a(p);t(p),u((S,Z)=>o(y,`${S??""}-${Z??""}¬∞C`),[()=>n.yeastStrain.temp_low.toFixed(0),()=>n.yeastStrain.temp_high.toFixed(0)]),l(d,p)};v(re,d=>{n.yeastStrain.temp_low&&n.yeastStrain.temp_high&&d(_e)})}t(F);var be=s(F,2);{var C=d=>{var p=xs(),y=s(a(p),2),S=a(y,!0);t(y),t(p),u(()=>o(S,n.recipe.yeast_name)),l(d,p)};v(be,d=>{n.recipe.yeast_name&&d(C)})}u(()=>o(E,n.yeastStrain.name)),l(W,c)},ee=W=>{var c=he(),F=P(c);{var te=E=>{var le=js(),J=s(a(le),2),re=a(J,!0);t(J),t(le),u(()=>o(re,n.recipe.yeast_name)),l(E,le)};v(F,E=>{n.recipe.yeast_name&&E(te)},!0)}l(W,c)};v(k,W=>{n.yeastStrain?W(z):W(ee,!1)})}t(N),l(V,N)};v(b,V=>{(n.yeastStrain||n.recipe.yeast_name)&&V(D)})}u((V,N,k)=>{o(ae,V),o(R,N),o(se,k)},[()=>M(n.recipe.og),()=>M(n.recipe.fg),()=>e(X)!=null?`${e(X).toFixed(1)}%`:"--"]),l(T,O)},$$slots:{default:!0}}),kt()}var Fs=i('<p class="notes-content svelte-hkv31i"> </p>');function Cs(ue,n){jt(ue,{title:"Notes",children:(M,X)=>{var T=Fs(),f=a(T,!0);t(T),u(()=>o(f,n.notes)),l(M,T)},$$slots:{default:!0}})}var qs=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),Ss=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Ms=i("<option> </option>"),Rs=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),Bs=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),Ts=i('<span class="activity-badge svelte-1xs394q"> </span>'),Ds=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),As=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Ps=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),Os=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),Es=i('<span class="days svelte-1xs394q"> </span>'),Ls=i(" <!>",1),Gs=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),Ns=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model:</span> <span class="model-value model-type svelte-1xs394q"> </span></div>'),Us=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Is=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Hs=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <div class="header-controls svelte-1xs394q"><select class="model-select svelte-1xs394q" title="Select prediction model"></select> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!> <!></div></div></div>'),Vs=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q"><!></p></div>');function Ws(ue,n){wt(n,!0);let M=mt(n,"measuredOg",3,null),X=mt(n,"currentSg",3,null),T=mt(n,"liveReading",3,null),f=me(Lt({available:!1})),O=me(!0),r=me(!1),I=me(null),h=me("auto");const ae=[{value:"auto",label:"Auto (Best Fit)"},{value:"exponential",label:"Exponential"},{value:"gompertz",label:"Gompertz (S-Curve)"},{value:"logistic",label:"Logistic"}];async function ve(){g(O,!0),g(I,null);try{g(f,await Pa(n.batchId,e(h)),!0)}catch(c){g(I,c instanceof Error?c.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",c)}finally{g(O,!1)}}async function ne(){g(r,!0),g(I,null);try{const c=await Aa(n.batchId);console.log("Reloaded predictions:",c.message),await ve()}catch(c){g(I,c instanceof Error?c.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",c)}finally{g(r,!1)}}function R(){ve()}ra(ne);function ie(c){return c?new Date(c).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function H(c){if(!c)return null;const F=new Date(c),te=new Date,E=F.getTime()-te.getTime();return Math.ceil(E/(1e3*60*60*24))}let se=G(()=>{const c=M()??e(f).predicted_og,F=e(f).predicted_fg,te=X()??T()?.sg;if(!c||!F||!te||c<=F)return null;const E=c-F,J=(c-te)/E*100;return Math.min(100,Math.max(0,J))}),b=G(()=>{const c=M()??e(f).predicted_og,F=X()??T()?.sg;if(!c||!F||c<=1)return null;const te=(c-F)/(c-1)*100;return Math.min(100,Math.max(0,te))}),D=G(()=>{const c=T()?.sg_rate;if(c==null)return null;const F=Math.abs(c);return F>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:F>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:F>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),V=G(()=>T()?.is_anomaly??!1),N=G(()=>T()?.anomaly_reasons??[]);var k=he(),z=P(k);{var ee=c=>{var F=qs();l(c,F)},W=c=>{var F=he(),te=P(F);{var E=J=>{var re=Ss(),_e=a(re),be=a(_e);t(_e),t(re),u(()=>o(be,`‚ö†Ô∏è ${e(I)??""}`)),l(J,re)},le=J=>{var re=he(),_e=P(re);{var be=d=>{var p=Hs();let y;var S=a(p),Z=s(a(S),2),Y=a(Z);Y.__change=R,At(Y,21,()=>ae,Gt,(q,m)=>{var B=Ms(),de=a(B,!0);t(B);var Ce={};u(()=>{o(de,e(m).label),Ce!==(Ce=e(m).value)&&(B.value=(B.__value=e(m).value)??"")}),l(q,B)}),t(Y);var K=s(Y,2);K.__click=ne;var Ae=a(K,!0);t(K),t(Z),t(S);var ge=s(S,2);{var xe=q=>{var m=Bs(),B=s(a(m),2),de=s(a(B),2);{var Ce=Ge=>{var Xe=Rs(),Pe=a(Xe,!0);t(Xe),u(Oe=>o(Pe,Oe),[()=>e(N).join(", ")]),l(Ge,Xe)};v(de,Ge=>{e(N).length>0&&Ge(Ce)})}t(B),t(m),l(q,m)};v(ge,q=>{e(V)&&q(xe)})}var oe=s(ge,2);{var Se=q=>{var m=Ds(),B=a(m),de=s(a(B),2);{var Ce=$e=>{var et=Ts(),ut=a(et);t(et),u(()=>{Ke(et,`color: ${e(D).color??""}`),o(ut,`${e(D).emoji??""} ${e(D).label??""}`)}),l($e,et)};v(de,$e=>{e(D)&&$e(Ce)})}t(B);var Ge=s(B,2),Xe=a(Ge);t(Ge);var Pe=s(Ge,2),Oe=a(Pe),ht=a(Oe);t(Oe);var rt=s(Oe,2),Ct=a(rt);t(rt);var Qe=s(rt,2),ct=a(Qe);t(Qe),t(Pe),t(m),u(($e,et,ut)=>{Ke(Xe,`width: ${e(se)??""}%`),o(ht,`OG: ${$e??""}`),o(Ct,`${et??""}%`),o(ct,`FG: ${ut??""}`)},[()=>Rt(M()??e(f).predicted_og??0),()=>e(se).toFixed(0),()=>Rt(e(f).predicted_fg??0)]),l(q,m)};v(oe,q=>{e(se)!==null&&q(Se)})}var _=s(oe,2),j=a(_);{var L=q=>{var m=As(),B=s(a(m),2),de=a(B,!0);t(B),t(m),u(Ce=>o(de,Ce),[()=>Rt(e(f).predicted_fg)]),l(q,m)};v(j,q=>{e(f).predicted_fg&&q(L)})}var w=s(j,2);{var Me=q=>{var m=Ps(),B=s(a(m),2),de=a(B);t(B),t(m),u(Ce=>o(de,`${Ce??""}%`),[()=>e(b).toFixed(1)]),l(q,m)};v(w,q=>{e(b)!==null&&q(Me)})}var pe=s(w,2);{var Fe=q=>{const m=G(()=>H(e(f).estimated_completion));var B=Gs(),de=s(a(B),2),Ce=a(de);{var Ge=Pe=>{var Oe=Os();l(Pe,Oe)},Xe=Pe=>{var Oe=Ls(),ht=P(Oe),rt=s(ht);{var Ct=Qe=>{var ct=Es(),$e=a(ct);t(ct),u(()=>o($e,`(${e(m)??""} ${e(m)===1?"day":"days"})`)),l(Qe,ct)};v(rt,Qe=>{e(m)!==null&&Qe(Ct)})}u(Qe=>o(ht,`${Qe??""} `),[()=>ie(e(f).estimated_completion)]),l(Pe,Oe)};v(Ce,Pe=>{e(m)!==null&&e(m)<=0?Pe(Ge):Pe(Xe,!1)})}t(de),t(B),l(q,B)};v(pe,q=>{e(f).estimated_completion&&q(Fe)})}var $=s(pe,2),ye=a($);{var je=q=>{var m=Ns(),B=s(a(m),2),de=a(B,!0);t(B),t(m),u(()=>o(de,e(f).model_type)),l(q,m)};v(ye,q=>{e(f).model_type&&q(je)})}var ke=s(ye,2);{var st=q=>{var m=Us(),B=s(a(m),2),de=a(B);t(B),t(m),u(Ce=>o(de,`${Ce??""}%`),[()=>(e(f).r_squared*100).toFixed(0)]),l(q,m)};v(ke,q=>{e(f).r_squared!==void 0&&q(st)})}var zt=s(ke,2);{var Ft=q=>{var m=Is(),B=s(a(m),2),de=a(B,!0);t(B),t(m),u(()=>o(de,e(f).num_readings)),l(q,m)};v(zt,q=>{e(f).num_readings&&q(Ft)})}t($),t(_),t(p),u(()=>{y=He(p,1,"ml-panel svelte-1xs394q",null,y,{"has-anomaly":e(V)}),Y.disabled=e(O)||e(r),K.disabled=e(r)||e(O),o(Ae,e(r)?"Reloading...":"‚Üª")}),qa(Y,()=>e(h),q=>g(h,q)),l(d,p)},C=d=>{var p=Vs(),y=a(p),S=s(a(y),2);S.__click=ne;var Z=a(S,!0);t(S),t(y);var Y=s(y,2),K=a(Y);{var Ae=xe=>{var oe=yt("Waiting for fermentation to progress (need visible SG drop)");l(xe,oe)},ge=xe=>{var oe=he(),Se=P(oe);{var _=L=>{var w=yt("Need more fermentation curve data for reliable prediction");l(L,w)},j=L=>{var w=he(),Me=P(w);{var pe=$=>{var ye=yt("Need at least 10 readings to make predictions");l($,ye)},Fe=$=>{var ye=yt("Predictions will appear once fermentation is underway");l($,ye)};v(Me,$=>{e(f).reason==="insufficient_data"?$(pe):$(Fe,!1)},!0)}l(L,w)};v(Se,L=>{e(f).reason==="insufficient_curve_data"?L(_):L(j,!1)},!0)}l(xe,oe)};v(K,xe=>{e(f).reason==="insufficient_fermentation_progress"?xe(Ae):xe(ge,!1)})}t(Y),t(p),u(()=>{S.disabled=e(r)||e(O),o(Z,e(r)?"Reloading...":"‚Üª Reload")}),l(d,p)};v(_e,d=>{e(f).available?d(be):d(C,!1)},!0)}l(J,re)};v(te,J=>{e(I)?J(E):J(le,!1)},!0)}l(c,F)};v(z,c=>{e(O)?c(ee):c(W,!1)})}l(ue,k),kt()}Bt(["change","click"]);var Js=i('<div class="loading svelte-1hws0u6">Loading alerts...</div>'),Ys=i('<div class="error-banner svelte-1hws0u6"><span> </span> <button type="button" class="dismiss-error svelte-1hws0u6">√ó</button></div>'),Zs=i('<button type="button" class="dismiss-all-btn svelte-1hws0u6"> </button>'),Ks=i('<span class="spinner svelte-1hws0u6"></span>'),Qs=ja('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hws0u6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>'),Xs=i('<div class="alert-item svelte-1hws0u6"><div class="alert-icon svelte-1hws0u6"> </div> <div class="alert-content svelte-1hws0u6"><div class="alert-header svelte-1hws0u6"><span class="alert-type svelte-1hws0u6"> </span> <span class="severity-badge svelte-1hws0u6"> </span></div> <p class="alert-message svelte-1hws0u6"> </p> <div class="alert-meta svelte-1hws0u6"><span class="alert-time svelte-1hws0u6"> </span> <span class="alert-separator svelte-1hws0u6">¬∑</span> <span class="alert-time svelte-1hws0u6"> </span></div></div> <button type="button" class="dismiss-btn svelte-1hws0u6" title="Dismiss alert"><!></button></div>'),$s=i('<!> <div class="alerts-header svelte-1hws0u6"><span class="alert-count svelte-1hws0u6"> </span> <!></div> <div class="alerts-list svelte-1hws0u6"></div>',1);function er(ue,n){wt(n,!0);let M=me(Lt([])),X=me(!0),T=me(null),f=me(null),O=me(!1);wa(()=>{r()});async function r(){try{g(X,!0),g(T,null),g(M,await Oa(n.batchId,!1),!0)}catch(b){g(T,b instanceof Error?b.message:"Failed to load alerts",!0)}finally{g(X,!1)}}async function I(b){try{g(f,b,!0),await Ea(n.batchId,b),g(M,e(M).filter(D=>D.id!==b),!0)}catch(D){g(T,D instanceof Error?D.message:"Failed to dismiss alert",!0)}finally{g(f,null)}}async function h(){try{g(O,!0),await La(n.batchId),g(M,[],!0)}catch(b){g(T,b instanceof Error?b.message:"Failed to dismiss alerts",!0)}finally{g(O,!1)}}function ae(b){switch(b){case"critical":return"var(--negative)";case"warning":return"#f59e0b";case"info":return"var(--accent)";default:return"var(--text-muted)"}}function ve(b){switch(b){case"stall":return"‚è∏";case"temperature_high":return"üî•";case"temperature_low":return"‚ùÑ";case"anomaly":return"‚ö†";default:return"‚ö†"}}function ne(b){const D=new Date(b),N=new Date().getTime()-D.getTime(),k=Math.floor(N/6e4),z=Math.floor(k/60),ee=Math.floor(z/24);return ee>0?`${ee}d ago`:z>0?`${z}h ago`:k>0?`${k}m ago`:"just now"}var R=he(),ie=P(R);{var H=b=>{jt(b,{title:"Alerts",icon:"üîî",children:(D,V)=>{var N=Js();l(D,N)},$$slots:{default:!0}})},se=b=>{var D=he(),V=P(D);{var N=z=>{},k=z=>{jt(z,{title:"Active Alerts",icon:"üîî",highlight:!0,children:(ee,W)=>{var c=$s(),F=P(c);{var te=C=>{var d=Ys(),p=a(d),y=a(p,!0);t(p);var S=s(p,2);S.__click=()=>g(T,null),t(d),u(()=>o(y,e(T))),l(C,d)};v(F,C=>{e(T)&&C(te)})}var E=s(F,2),le=a(E),J=a(le);t(le);var re=s(le,2);{var _e=C=>{var d=Zs();d.__click=h;var p=a(d,!0);t(d),u(()=>{d.disabled=e(O),o(p,e(O)?"Dismissing...":"Dismiss All")}),l(C,d)};v(re,C=>{e(M).length>1&&C(_e)})}t(E);var be=s(E,2);At(be,21,()=>e(M),C=>C.id,(C,d)=>{var p=Xs(),y=a(p),S=a(y,!0);t(y);var Z=s(y,2),Y=a(Z),K=a(Y),Ae=a(K,!0);t(K);var ge=s(K,2),xe=a(ge,!0);t(ge),t(Y);var oe=s(Y,2),Se=a(oe,!0);t(oe);var _=s(oe,2),j=a(_),L=a(j);t(j);var w=s(j,4),Me=a(w);t(w),t(_),t(Z);var pe=s(Z,2);pe.__click=()=>I(e(d).id);var Fe=a(pe);{var $=je=>{var ke=Ks();l(je,ke)},ye=je=>{var ke=Qs();l(je,ke)};v(Fe,je=>{e(f)===e(d).id?je($):je(ye,!1)})}t(pe),t(p),u((je,ke,st,zt,Ft,q,m,B)=>{Ke(p,`--severity-color: ${je??""}`),o(S,ke),o(Ae,st),Ke(ge,`background: ${zt??""}`),o(xe,e(d).severity),o(Se,e(d).message),dt(j,"title",`First detected: ${Ft??""}`),o(L,`First: ${q??""}`),dt(w,"title",`Last seen: ${m??""}`),o(Me,`Last: ${B??""}`),pe.disabled=e(f)===e(d).id},[()=>ae(e(d).severity),()=>ve(e(d).alert_type),()=>e(d).alert_type.replace("_"," "),()=>ae(e(d).severity),()=>new Date(e(d).first_detected_at).toLocaleString(),()=>ne(e(d).first_detected_at),()=>new Date(e(d).last_seen_at).toLocaleString(),()=>ne(e(d).last_seen_at)]),l(C,p)}),t(be),u(()=>o(J,`${e(M).length??""} active`)),l(ee,c)},$$slots:{default:!0}})};v(V,z=>{e(M).length===0?z(N):z(k,!1)},!0)}l(b,D)};v(ie,b=>{e(X)?b(H):b(se,!1)})}l(ue,R),kt()}Bt(["click"]);var tr=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),ar=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),sr=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),rr=i('<span class="recipe-type svelte-g5au2j"> </span>'),lr=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),nr=i('<div class="batch-timing svelte-g5au2j"> </div>'),ir=i('<div class="batch-timing svelte-g5au2j"> </div>'),vr=i('<option class="svelte-g5au2j"> </option>'),or=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),dr=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),cr=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),ur=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),_r=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),gr=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),pr=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),fr=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),mr=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),hr=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),br=i('<span class="status-badge idle svelte-g5au2j"> </span>'),xr=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),yr=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),jr=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),wr=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),kr=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),zr=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),Fr=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),Cr=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),qr=i('<span class="svelte-g5au2j"> </span>'),Sr=i('<span class="svelte-g5au2j"> </span>'),Mr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Rr=i('<div class="chart-section svelte-g5au2j"><!></div>'),Br=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div> <!>',1),Tr=i('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),Dr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function tl(ue,n){wt(n,!0);const M=()=>Ba(Ta,"$page",X),[X,T]=Ra();let f=null,O=null,r=me(null),I=me(null),h=me(null),ae=Lt([]),ve=me(!0),ne=me(null),R=me(!1),ie=me(!1),H=me(!1),se=me(!1),b=me(!1),D=me(!1),V=G(()=>parseInt(M().params.id??"0"));const N={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},k=["planning","fermenting","conditioning","completed","archived"];let z=G(()=>e(r)?N[e(r).status]:N.planning),ee=G(na),W=G(()=>Dt.config.ha_enabled&&Dt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),c=G(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),F=G(()=>!e(c)||!e(E)?.temp||!e(r)?.temp_target?!1:e(E).temp<=e(r).temp_target),te=G(()=>{if(!e(c)||!e(E)?.temp||!e(r)?.temp_target)return null;const _=e(r).temp_target+30,j=e(E).temp,L=e(r).temp_target;if(j<=L)return 100;if(j>=_)return 0;const w=(_-j)/(_-L)*100;return Math.min(100,Math.max(0,w))}),E=G(()=>{if(!e(r)?.device_id)return null;const _=sa.tilts.get(e(r).device_id);if(_)return _;const j=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!j?.[1])return null;const L=j[1].toUpperCase();for(const w of sa.tilts.values())if(w.color&&w.color.toUpperCase()===L)return w;return null});async function le(){g(ve,!0),g(ne,null);try{if(g(r,await Ga(e(V)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{g(I,await ta(e(V)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{g(h,await Tt(e(V)),!0)}catch{}}catch(_){g(ne,_ instanceof Error?_.message:"Failed to load batch",!0)}finally{g(ve,!1)}}async function J(_){if(!(!e(r)||e(ie))&&!(_==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){g(ie,!0);try{g(r,await aa(e(r).id,{status:_}),!0),(_==="fermenting"||_==="conditioning")&&g(I,await ta(e(r).id),!0)}catch(j){console.error("Failed to update status:",j)}finally{g(ie,!1)}}}async function re(_){if(e(r)&&(g(r,await aa(e(r).id,_),!0),g(R,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{g(h,await Tt(e(r).id),!0)}catch{}}async function _e(){if(e(r)){g(b,!0);try{await Na(e(r).id),Da("/batches")}catch(_){g(ne,_ instanceof Error?_.message:"Failed to delete batch",!0),g(b,!1),g(se,!1)}}}async function be(_,j){if(!(!e(r)||e(H))){g(H,!0);try{await Et(e(r).id,j,60,_),g(h,await Tt(e(r).id),!0)}catch(L){console.error("Failed to set override:",L)}finally{g(H,!1)}}}async function C(){if(!(!e(r)||e(H))){g(H,!0);try{e(r).heater_entity_id&&await Et(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Et(e(r).id,null,60,"cooler"),g(h,await Tt(e(r).id),!0)}catch(_){console.error("Failed to clear overrides:",_)}finally{g(H,!1)}}}function d(){if(f?.readyState===WebSocket.OPEN)return;const j=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;f=new WebSocket(j),f.onmessage=async L=>{try{const w=JSON.parse(L.data);w.type==="control_event"&&w.batch_id===e(V)&&e(h)&&(w.action==="heat_on"?g(h,{...e(h),heater_state:"on"},!0):w.action==="heat_off"?g(h,{...e(h),heater_state:"off"},!0):w.action==="cool_on"?g(h,{...e(h),cooler_state:"on"},!0):w.action==="cool_off"&&g(h,{...e(h),cooler_state:"off"},!0))}catch{}},f.onclose=()=>{f=null,O=setTimeout(d,3e3)},f.onerror=()=>{f?.close()}}function p(){O&&(clearTimeout(O),O=null),f?.close(),f=null}function y(_){return _==null?"--":la(_)}function S(_){return _?new Date(_).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function Z(_){if(!_)return"--";const j=new Date(_),w=(new Date().getTime()-j.getTime())/(1e3*60*60);if(w<1)return`${Math.round(w*60)}m`;if(w<24)return`${w.toFixed(1)}h`;const Me=w/24;return Me<7?`${Me.toFixed(1)}d`:`${Math.round(Me)}d`}ra(()=>{le(),d()}),ka(()=>{p()});var Y=Dr();Ca("g5au2j",_=>{za(()=>{Fa.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var K=P(Y),Ae=s(a(K),2);{var ge=_=>{var j=tr();l(_,j)},xe=_=>{var j=he(),L=P(j);{var w=pe=>{var Fe=ar(),$=s(a(Fe),2),ye=a($,!0);t($);var je=s($,2);je.__click=le,t(Fe),u(()=>o(ye,e(ne))),l(pe,Fe)},Me=pe=>{var Fe=he(),$=P(Fe);{var ye=ke=>{var st=sr();l(ke,st)},je=ke=>{var st=he(),zt=P(st);{var Ft=m=>{Ua(m,{get batch(){return e(r)},onSubmit:re,onCancel:()=>g(R,!1)})},q=m=>{var B=Br(),de=P(B),Ce=a(de),Ge=a(Ce),Xe=a(Ge);t(Ge);var Pe=s(Ge,2),Oe=a(Pe),ht=a(Oe,!0);t(Oe);var rt=s(Oe,2);{var Ct=x=>{var U=lr(),ce=a(U),qe=s(ce);{var ze=Be=>{var Ie=rr(),Ve=a(Ie);t(Ie),u(()=>o(Ve,`(${e(r).recipe.type??""})`)),l(Be,Ie)};v(qe,Be=>{e(r).recipe.type&&Be(ze)})}t(U),u(()=>{dt(U,"href",`/recipes/${e(r).recipe.id??""}`),o(ce,`${e(r).recipe.name??""} `)}),l(x,U)};v(rt,x=>{e(r).recipe&&x(Ct)})}var Qe=s(rt,2);{var ct=x=>{var U=nr(),ce=a(U);t(U),u((qe,ze)=>o(ce,`Started ${qe??""} ¬∑ ${ze??""} ago`),[()=>S(e(r).start_time),()=>Z(e(r).start_time)]),l(x,U)},$e=x=>{var U=he(),ce=P(U);{var qe=ze=>{var Be=ir(),Ie=a(Be);t(Be),u(Ve=>o(Ie,`Brewed ${Ve??""}`),[()=>S(e(r).brew_date)]),l(ze,Be)};v(ce,ze=>{e(r).brew_date&&ze(qe)},!0)}l(x,U)};v(Qe,x=>{e(r).start_time?x(ct):x($e,!1)})}t(Pe),t(Ce);var et=s(Ce,2),ut=a(et),tt=a(ut);tt.__change=x=>J(x.currentTarget.value),At(tt,21,()=>k,Gt,(x,U)=>{var ce=vr(),qe=a(ce,!0);t(ce);var ze={};u(()=>{o(qe,N[e(U)].label),ze!==(ze=e(U))&&(ce.value=(ce.__value=e(U))??"")}),l(x,ce)}),t(tt);var Nt;Sa(tt),t(ut);var Ut=s(ut,2);Ut.__click=()=>g(R,!0);var va=s(Ut,2);va.__click=()=>g(se,!0),t(et),t(de);var It=s(de,2);{var oa=x=>{var U=fr();let ce;var qe=a(U),ze=a(qe);{var Be=A=>{var Q=or();Le(2),l(A,Q)},Ie=A=>{var Q=dr();Le(2),l(A,Q)};v(ze,A=>{e(F)?A(Be):A(Ie,!1)})}t(qe);var Ve=s(qe,2),_t=a(Ve),lt=a(_t),bt=s(a(lt),2),We=a(bt,!0);t(bt),t(lt);var fe=s(lt,4),Ee=s(a(fe),2),gt=a(Ee,!0);t(Ee),t(fe),t(_t);var pt=s(_t,2);{var qt=A=>{var Q=cr(),Re=a(Q),Te=a(Re);t(Re);var Ne=s(Re,2),we=a(Ne);t(Ne),t(Q),u(De=>{Ke(Te,`width: ${e(te)??""}%`),o(we,`${De??""}% to target`)},[()=>Math.round(e(te))]),l(A,Q)};v(pt,A=>{e(te)!=null&&!e(F)&&A(qt)})}var Je=s(pt,2),nt=a(Je);{var St=A=>{var Q=ur();l(A,Q)},Mt=A=>{var Q=he(),Re=P(Q);{var Te=we=>{var De=_r();l(we,De)},Ne=we=>{var De=he(),it=P(De);{var at=ot=>{var xt=gr();l(ot,xt)},vt=ot=>{var xt=pr();l(ot,xt)};v(it,ot=>{e(F)?ot(at):ot(vt,!1)},!0)}l(we,De)};v(Re,we=>{!Dt.config.ha_enabled||!Dt.config.temp_control_enabled?we(Te):we(Ne,!1)},!0)}l(A,Q)};v(nt,A=>{e(r).cooler_entity_id?A(Mt,!1):A(St)})}t(Je),t(Ve),t(U),u((A,Q)=>{ce=He(U,1,"chilling-banner svelte-g5au2j",null,ce,{ready:e(F)}),o(We,A),o(gt,Q)},[()=>e(E)?.temp!=null?y(e(E).temp):"--",()=>e(r).temp_target!=null?y(e(r).temp_target):"--"]),l(x,U)};v(It,x=>{e(c)&&x(oa)})}var Pt=s(It,2),Ot=a(Pt),Ht=a(Ot);{let x=G(()=>e(E)?.sg??e(I)?.measured?.current_sg);ls(Ht,{get batch(){return e(r)},get currentSg(){return e(x)},get progress(){return e(I)},get liveReading(){return e(E)}})}var da=s(Ht,2);{var ca=x=>{zs(x,{get recipe(){return e(r).recipe},get yeastStrain(){return e(r).yeast_strain}})};v(da,x=>{e(r).recipe&&x(ca)})}t(Ot);var Vt=s(Ot,2),Wt=a(Vt);fs(Wt,{get batch(){return e(r)},get liveReading(){return e(E)},onEdit:()=>g(R,!0)});var Jt=s(Wt,2);{var ua=x=>{er(x,{get batchId(){return e(r).id}})};v(Jt,x=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&x(ua)})}var Yt=s(Jt,2);{let x=G(()=>e(E)?.sg);Ws(Yt,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(x)},get liveReading(){return e(E)}})}var Zt=s(Yt,2);{var _a=x=>{var U=Cr();let ce;var qe=a(U);qe.__click=()=>g(D,!e(D));var ze=s(a(qe),2),Be=a(ze);{var Ie=fe=>{var Ee=mr();l(fe,Ee)},Ve=fe=>{var Ee=he(),gt=P(Ee);{var pt=Je=>{var nt=hr();l(Je,nt)},qt=Je=>{var nt=he(),St=P(nt);{var Mt=A=>{var Q=br(),Re=a(Q);t(Q),u(Te=>o(Re,`üéØ ${Te??""}${e(ee)??""}`),[()=>y(e(h).target_temp)]),l(A,Q)};v(St,A=>{e(D)&&e(h)&&A(Mt)},!0)}l(Je,nt)};v(gt,Je=>{e(h)?.cooler_state==="on"?Je(pt):Je(qt,!1)},!0)}l(fe,Ee)};v(Be,fe=>{e(h)?.heater_state==="on"?fe(Ie):fe(Ve,!1)})}var _t=s(Be,2);let lt;t(ze),t(qe);var bt=s(qe,2);{var We=fe=>{var Ee=Fr(),gt=P(Ee),pt=a(gt);{var qt=A=>{var Q=xr(),Re=a(Q);let Te;var Ne=s(Re,2),we=s(a(Ne),2);let De;var it=a(we,!0);t(we);var at=s(we,2),vt=a(at,!0);t(at),t(Ne),t(Q),u(()=>{Te=He(Re,1,"device-icon-wrap svelte-g5au2j",null,Te,{active:e(h)?.heater_state==="on"}),De=He(we,1,"device-state svelte-g5au2j",null,De,{on:e(h)?.heater_state==="on"}),o(it,e(h)?.heater_state==="on"?"ON":"OFF"),o(vt,e(r).heater_entity_id)}),l(A,Q)};v(pt,A=>{e(r).heater_entity_id&&A(qt)})}var Je=s(pt,2);{var nt=A=>{var Q=yr(),Re=a(Q);let Te;var Ne=s(Re,2),we=s(a(Ne),2);let De;var it=a(we,!0);t(we);var at=s(we,2),vt=a(at,!0);t(at),t(Ne),t(Q),u(()=>{Te=He(Re,1,"device-icon-wrap svelte-g5au2j",null,Te,{active:e(h)?.cooler_state==="on"}),De=He(we,1,"device-state svelte-g5au2j",null,De,{on:e(h)?.cooler_state==="on"}),o(it,e(h)?.cooler_state==="on"?"ON":"OFF"),o(vt,e(r).cooler_entity_id)}),l(A,Q)};v(Je,A=>{e(r).cooler_entity_id&&A(nt)})}t(gt);var St=s(gt,2);{var Mt=A=>{var Q=zr(),Re=P(Q),Te=a(Re),Ne=s(a(Te),2),we=a(Ne);t(Ne),t(Te);var De=s(Te,2),it=s(a(De),2),at=a(it);t(it),t(De),t(Re);var vt=s(Re,2);{var ot=Ue=>{var Ye=jr(),Ze=s(a(Ye),2),ft=a(Ze);t(Ze);var ea=s(Ze,2);ea.__click=()=>C(),t(Ye),u(ya=>{o(ft,`Override active: ${ya??""}`),ea.disabled=e(H)},[()=>e(h).override_state?.toUpperCase()]),l(Ue,Ye)};v(vt,Ue=>{e(h).override_active&&Ue(ot)})}var xt=s(vt,2),Kt=s(a(xt),2),Qt=a(Kt);{var ba=Ue=>{var Ye=wr(),Ze=P(Ye);Ze.__click=()=>be("heater","on");var ft=s(Ze,2);ft.__click=()=>be("heater","off"),u(()=>{Ze.disabled=e(H),ft.disabled=e(H)}),l(Ue,Ye)};v(Qt,Ue=>{e(r).heater_entity_id&&Ue(ba)})}var Xt=s(Qt,2);{var xa=Ue=>{var Ye=kr(),Ze=P(Ye);Ze.__click=()=>be("cooler","on");var ft=s(Ze,2);ft.__click=()=>be("cooler","off"),u(()=>{Ze.disabled=e(H),ft.disabled=e(H)}),l(Ue,Ye)};v(Xt,Ue=>{e(r).cooler_entity_id&&Ue(xa)})}var $t=s(Xt,2);$t.__click=()=>C(),t(Kt),t(xt),u((Ue,Ye)=>{o(we,`${Ue??""}${e(ee)??""}`),o(at,`¬±${Ye??""}${e(ee)??""}`),$t.disabled=e(H)},[()=>y(e(h).target_temp),()=>e(h).hysteresis?.toFixed(1)||"--"]),l(A,Q)};v(St,A=>{e(h)&&A(Mt)})}l(fe,Ee)};v(bt,fe=>{e(D)||fe(We)})}t(U),u(()=>{ce=He(U,1,"info-card temp-control-card svelte-g5au2j",null,ce,{"heater-on":e(h)?.heater_state==="on","cooler-on":e(h)?.cooler_state==="on",collapsed:e(D)}),lt=He(_t,0,"chevron svelte-g5au2j",null,lt,{rotated:!e(D)})}),l(x,U)},ga=x=>{var U=he(),ce=P(U);{var qe=ze=>{var Be=Mr(),Ie=s(a(Be),2),Ve=a(Ie);{var _t=We=>{var fe=qr(),Ee=a(fe);t(fe),u(()=>o(Ee,`Heater: ${e(r).heater_entity_id??""}`)),l(We,fe)};v(Ve,We=>{e(r).heater_entity_id&&We(_t)})}var lt=s(Ve,2);{var bt=We=>{var fe=Sr(),Ee=a(fe);t(fe),u(()=>o(Ee,`Cooler: ${e(r).cooler_entity_id??""}`)),l(We,fe)};v(lt,We=>{e(r).cooler_entity_id&&We(bt)})}Le(2),t(Ie),t(Be),l(ze,Be)};v(ce,ze=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&ze(qe)},!0)}l(x,U)};v(Zt,x=>{e(W)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?x(_a):x(ga,!1)})}var pa=s(Zt,2);{var fa=x=>{Cs(x,{get notes(){return e(r).notes}})};v(pa,x=>{e(r).notes&&x(fa)})}t(Vt),t(Pt);var ma=s(Pt,2);{var ha=x=>{var U=Rr(),ce=a(U);Ha(ce,{get batchId(){return e(r).id},get deviceColor(){return e(r).device_id},get originalGravity(){return e(r).measured_og},get controlEvents(){return ae}}),t(U),l(x,U)};v(ma,x=>{e(r).device_id&&x(ha)})}u(()=>{o(Xe,`#${(e(r).batch_number||"?")??""}`),o(ht,e(r).name||e(r).recipe?.name||"Unnamed Batch"),tt.disabled=e(ie),Ke(tt,`color: ${e(z).color??""}; background: ${e(z).bg??""};`),Nt!==(Nt=e(r).status)&&(tt.value=(tt.__value=e(r).status)??"",Ma(tt,e(r).status))}),l(m,B)};v(zt,m=>{e(R)?m(Ft):m(q,!1)},!0)}l(ke,st)};v($,ke=>{e(r)?ke(je,!1):ke(ye)},!0)}l(pe,Fe)};v(L,pe=>{e(ne)?pe(w):pe(Me,!1)},!0)}l(_,j)};v(Ae,_=>{e(ve)?_(ge):_(xe,!1)})}t(K);var oe=s(K,2);{var Se=_=>{var j=Tr();j.__click=()=>g(se,!1);var L=a(j);L.__click=je=>je.stopPropagation();var w=s(a(L),2),Me=a(w);t(w);var pe=s(w,2),Fe=a(pe);Fe.__click=()=>g(se,!1);var $=s(Fe,2);$.__click=_e;var ye=a($,!0);t($),t(pe),t(L),t(j),u(()=>{o(Me,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),Fe.disabled=e(b),$.disabled=e(b),o(ye,e(b)?"Deleting...":"Delete Batch")}),l(_,j)};v(oe,_=>{e(se)&&_(Se)})}l(ue,Y),kt(),T()}Bt(["click","change"]);export{tl as component,el as universal};
