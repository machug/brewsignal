import{d as zt,f as i,s as o,a as l,c as he,t as ft,h as ja}from"../chunks/Bkky6kvZ.js";import{d as a,e as s,r as t,t as _,a as ht,f as O,h as e,u as L,n as Ae,g as bt,s as ye,p as Bt,o as $t,c as g,az as wa,aI as ka,aJ as za,ax as Fa}from"../chunks/813s5maz.js";import{e as Tt,i as ea}from"../chunks/j9QCVC2i.js";import{i as v}from"../chunks/Bf7HnLem.js";import{h as Ca}from"../chunks/BgIwEmqo.js";import{s as nt}from"../chunks/UKAZQVVw.js";import{s as Ne}from"../chunks/LBYG0Yba.js";import{s as Ye}from"../chunks/C7upzuIa.js";import{i as Ra,s as qa}from"../chunks/D4jp30Ch.js";import{s as Sa,a as Ma}from"../chunks/Rx9Mwdtx.js";import{p as Ba}from"../chunks/-1OZXiMr.js";import{g as Ta}from"../chunks/DRZf0tbC.js";import{a8 as Da,a9 as Aa,aa as Pa,ab as Oa,ac as Ea,Z as La,P as Kt,ad as Ft,U as Ga,N as Qt,ae as Mt}from"../chunks/BNr2WsGx.js";import{d as kt,e as ta,g as aa,c as Ct}from"../chunks/CbPjToI1.js";import{t as Xt}from"../chunks/DVuldl-p.js";import{B as Na}from"../chunks/CKS2T1CY.js";import{s as Ua}from"../chunks/BB07oCeu.js";import{p as _t}from"../chunks/B-xGjlKy.js";import{F as Ia}from"../chunks/DwTJ7Idk.js";const Ha=!1,Qr=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ha},Symbol.toStringTag,{value:"Module"}));function Va(ue){return ue>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:ue>=-60?{bars:3,color:"var(--positive)",label:"Good"}:ue>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function sa(ue){const n=Math.floor((Date.now()-new Date(ue).getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const M=Math.floor(n/60);if(M<60)return`${M}m ago`;const Q=Math.floor(M/60);return Q<24?`${Q}h ago`:`${Math.floor(Q/24)}d ago`}var Wa=i('<div class="accent-bar svelte-1oyrwd9"></div>'),Ja=i('<span class="card-icon svelte-1oyrwd9"> </span>'),Ya=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),Za=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function mt(ue,n){let M=_t(n,"highlight",3,!1),Q=_t(n,"compact",3,!1),B=_t(n,"collapsible",3,!1),f=_t(n,"expanded",3,!1);var G=Za();let r;var I=a(G);{var j=F=>{var d=Wa();l(F,d)};v(I,F=>{M()&&F(j)})}var X=s(I,2),_e=a(X),ge=a(_e);{var q=F=>{var d=Ja(),x=a(d,!0);t(d),_(()=>o(x,n.icon)),l(F,d)};v(ge,F=>{n.icon&&F(q)})}var ne=s(ge,2),D=a(ne,!0);t(ne),t(_e);var se=s(_e,2);{var h=F=>{var d=Ya();d.__click=function(...N){n.onToggle?.apply(this,N)};var x=a(d);let S;t(d),_(()=>{nt(d,"aria-label",f()?"Collapse":"Expand"),S=Ne(x,0,"expand-icon svelte-1oyrwd9",null,S,{"rotate-180":f()})}),l(F,d)};v(se,F=>{B()&&n.onToggle&&F(h)})}t(X);var E=s(X,2);let J;var H=a(E);Ua(H,()=>n.children),t(E),t(G),_(()=>{r=Ne(G,1,"batch-card svelte-1oyrwd9",null,r,{highlight:M(),compact:Q()}),o(D,n.title),J=Ne(E,1,"card-content svelte-1oyrwd9",null,J,{collapsed:B()&&!f()})}),l(ue,G)}zt(["click"]);var Ka=i('<span class="updated-text svelte-t80j9z"> </span>'),Qa=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),Xa=i('<div class="remaining-text svelte-t80j9z"> </div>'),$a=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),es=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),ts=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),as=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),ss=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function rs(ue,n){ht(n,!0);let M=L(()=>n.currentSg??n.progress?.measured?.current_sg),Q=L(()=>n.liveReading?.temp??n.progress?.temperature?.current),B=L(()=>n.liveReading?.last_seen),f=L(()=>e(B)?sa(e(B)):null),G=L(aa),r=L(()=>{if(!n.batch.measured_og||!e(M))return null;const q=Math.max(0,(n.batch.measured_og-e(M))*131.25),ne=n.batch.measured_og-1,D=ne!==0?Math.max(0,Math.min(100,(n.batch.measured_og-e(M))/ne*100)):0;return{abv:q,attenuation:D}}),I=L(()=>{const q=n.batch.measured_og,ne=n.batch.recipe?.fg;if(!q||!ne||!e(M))return null;const D=q-ne,se=q-e(M);return D<=0?null:Math.max(0,Math.min(100,se/D*100))}),j=L(()=>n.batch.status==="fermenting"||n.batch.status==="conditioning");function X(q){return q==null?"--":kt(q)}function _e(q){return q==null?"--":`${q.toFixed(1)}%`}function ge(q){return q==null?"--":ta(q)}mt(ue,{title:"Fermentation",children:(q,ne)=>{var D=he(),se=O(D);{var h=J=>{var H=ts(),F=O(H),d=s(a(F),2);{var x=b=>{var c=Ka(),p=a(c);t(c),_(()=>o(p,`Updated ${e(f)??""}`)),l(b,c)};v(d,b=>{e(f)&&b(x)})}t(F);var S=s(F,2),N=a(S),re=a(N),$=a(re,!0);t(re),Ae(2),t(N);var A=s(N,2);{var ee=b=>{var c=Qa(),p=s(O(c),2),k=a(p),P=a(k,!0),Y=s(P),ae=a(Y,!0);t(Y),t(k),Ae(2),t(p),_(V=>{o(P,V),o(ae,e(G))},[()=>ge(e(Q))]),l(b,c)};v(A,b=>{e(Q)!=null&&b(ee)})}t(S);var te=s(S,2);{var pe=b=>{var c=$a(),p=a(c),k=a(p),P=a(k),Y=a(P,!0);t(P),Ae(2),t(k);var ae=s(k,2),V=a(ae),ke=a(V);t(V),t(ae);var fe=s(ae,2),Se=a(fe),xe=a(Se,!0);t(Se),Ae(2),t(fe),t(p);var ve=s(p,2),u=a(ve),z=s(u,2);let Z;var R=s(a(z),2),oe=a(R,!0);t(R),t(z),t(ve);var de=s(ve,2);{var Re=m=>{var w=Xa(),C=a(w);t(w),_(W=>o(C,`${W??""} points to go`),[()=>n.progress.progress.sg_remaining.toFixed(3)]),l(m,w)};v(de,m=>{n.progress?.progress?.sg_remaining!=null&&n.progress.progress.sg_remaining>0&&m(Re)})}t(c),_((m,w,C,W)=>{o(Y,m),o(ke,`${w??""}%`),o(xe,C),Ye(u,`width: ${e(I)??""}%`),Z=Ne(z,1,"progress-marker svelte-t80j9z",null,Z,{"at-start":e(I)<3}),Ye(z,`left: ${e(I)??""}%`),o(oe,W)},[()=>X(n.batch.measured_og),()=>e(I).toFixed(0),()=>X(n.batch.recipe.fg),()=>X(e(M))]),l(b,c)};v(te,b=>{e(I)!==null&&n.batch.measured_og&&n.batch.recipe?.fg&&b(pe)})}var ie=s(te,2);{var le=b=>{var c=es(),p=a(c),k=a(p),P=a(k,!0);t(k),Ae(2),t(p);var Y=s(p,2),ae=a(Y),V=a(ae,!0);t(ae),Ae(2),t(Y),t(c),_((ke,fe)=>{o(P,ke),o(V,fe)},[()=>_e(e(r).abv),()=>_e(e(r).attenuation)]),l(b,c)};v(ie,b=>{e(r)&&b(le)})}_(b=>o($,b),[()=>X(e(M))]),l(J,H)},E=J=>{var H=he(),F=O(H);{var d=S=>{var N=as(),re=a(N),$=a(re),A=a($,!0);t($),Ae(2),t(re);var ee=s(re,2),te=a(ee),pe=a(te,!0);t(te),Ae(2),t(ee);var ie=s(ee,2),le=a(ie),b=a(le,!0);t(le),Ae(2),t(ie);var c=s(ie,2),p=a(c),k=a(p,!0);t(p),Ae(2),t(c),t(N),_((P,Y,ae,V)=>{o(A,P),o(pe,Y),o(b,ae),o(k,V)},[()=>X(n.batch.measured_og),()=>X(n.batch.measured_fg),()=>n.batch.measured_abv!=null?_e(n.batch.measured_abv):"--",()=>n.batch.measured_attenuation!=null?_e(n.batch.measured_attenuation):"--"]),l(S,N)},x=S=>{var N=ss();l(S,N)};v(F,S=>{n.batch.measured_og?S(d):S(x,!1)},!0)}l(J,H)};v(se,J=>{e(M)&&e(j)?J(h):J(E,!1)})}l(q,D)},$$slots:{default:!0}}),bt()}var ls=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),ns=i('<div class="signal-bar svelte-1kdxwtz"></div>'),is=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),vs=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),os=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),ds=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),cs=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),us=i('<div class="device-info svelte-1kdxwtz"><!></div>'),_s=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),gs=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function ps(ue,n){ht(n,!0);let M=L(()=>n.liveReading?.device_type==="tilt"),Q=L(()=>e(M)&&n.liveReading?.rssi?Va(n.liveReading.rssi):null),B=L(()=>n.liveReading?.last_seen?sa(n.liveReading.last_seen):null),f=L(()=>n.liveReading?.battery_percent!=null||n.liveReading?.battery_voltage!=null),G=L(()=>n.liveReading?.battery_percent),r=L(()=>n.liveReading?.battery_voltage),I=L(()=>e(G)?e(G)>50?"var(--positive)":e(G)>20?"#f59e0b":"var(--negative)":"var(--text-muted)"),j=L(()=>{if(!n.liveReading)return n.batch.device_id||"Unknown";const X=n.liveReading.device_type;return X==="tilt"?`${n.liveReading.color} Tilt`:X==="gravitymon"?`GravityMon (${n.liveReading.id})`:X==="ispindel"?`iSpindel (${n.liveReading.id})`:X==="floaty"?`Floaty (${n.liveReading.id})`:n.liveReading.color||n.liveReading.id});mt(ue,{title:"Tracking Device",compact:!0,children:(X,_e)=>{var ge=he(),q=O(ge);{var ne=se=>{var h=us(),E=a(h);{var J=F=>{var d=ds(),x=O(d),S=a(x),N=s(a(S));t(S);var re=s(S,2);{var $=te=>{var pe=ls(),ie=a(pe,!0);t(pe),_(()=>o(ie,e(B))),l(te,pe)};v(re,te=>{e(B)&&te($)})}t(x);var A=s(x,2);{var ee=te=>{var pe=os(),ie=a(pe);{var le=p=>{var k=is(),P=a(k);Tt(P,20,()=>Array(4),ea,(V,ke,fe)=>{var Se=ns();_(()=>Ye(Se,`height: ${4+fe*2}px; background: ${(fe<e(Q).bars?e(Q).color:"var(--bg-hover)")??""}; opacity: ${fe<e(Q).bars?1:.4};`)),l(V,Se)}),t(P);var Y=s(P,2),ae=a(Y);t(Y),t(k),_(()=>{Ye(Y,`color: ${e(Q).color??""}`),o(ae,`${n.liveReading.rssi??""}dBm`)}),l(p,k)};v(ie,p=>{e(Q)&&p(le)})}var b=s(ie,2);{var c=p=>{var k=vs(),P=a(k),Y=s(a(P)),ae=s(Y);t(P);var V=s(P,2),ke=a(V);{var fe=xe=>{var ve=ft();_(u=>o(ve,`${u??""}%`),[()=>e(G).toFixed(0)]),l(xe,ve)},Se=xe=>{var ve=he(),u=O(ve);{var z=Z=>{var R=ft();_(oe=>o(R,`${oe??""}V`),[()=>e(r).toFixed(2)]),l(Z,R)};v(u,Z=>{e(r)!=null&&Z(z)},!0)}l(xe,ve)};v(ke,xe=>{e(G)!=null?xe(fe):xe(Se,!1)})}t(V),t(k),_(()=>{nt(P,"stroke",e(I)),nt(Y,"width",(e(G)??50)*.14),nt(Y,"fill",e(I)),nt(ae,"fill",e(I)),Ye(V,`color: ${e(I)??""}`)}),l(p,k)};v(b,p=>{e(f)&&p(c)})}t(pe),l(te,pe)};v(A,te=>{(e(Q)||e(f))&&te(ee)})}_(()=>o(N,` ${e(j)??""}`)),l(F,d)},H=F=>{var d=cs(),x=a(d),S=s(a(x));t(x),Ae(2),t(d),_(()=>o(S,` ${n.batch.device_id??""}`)),l(F,d)};v(E,F=>{n.liveReading?F(J):F(H,!1)})}t(h),l(se,h)},D=se=>{var h=gs(),E=s(a(h),2);{var J=H=>{var F=_s();F.__click=function(...d){n.onEdit?.apply(this,d)},l(H,F)};v(E,H=>{n.onEdit&&H(J)})}t(h),l(se,h)};v(q,se=>{n.batch.device_id?se(ne):se(D,!1)})}l(X,ge)},$$slots:{default:!0}}),bt()}zt(["click"]);const fs=131.25;var ms=i('<span class="yeast-producer svelte-19u9n31"> </span>'),hs=i('<span class="yeast-temp svelte-19u9n31"> </span>'),bs=i('<div class="yeast-row recipe svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Recipe</span> <span class="yeast-value muted svelte-19u9n31"> </span></div>'),ys=i('<div class="yeast-row actual svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span> <!> <!></div> <!>',1),xs=i('<div class="yeast-row svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span></div>'),js=i('<div class="yeast-section svelte-19u9n31"><!></div>'),ws=i('<div class="targets-row svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div></div> <!>',1);function ks(ue,n){ht(n,!0);function M(B){return B==null?"--":kt(B)}let Q=L(()=>n.recipe.abv!=null?n.recipe.abv:n.recipe.og&&n.recipe.fg?(n.recipe.og-n.recipe.fg)*fs:null);mt(ue,{title:"Recipe Targets",compact:!0,children:(B,f)=>{var G=ws(),r=O(G),I=a(r),j=s(a(I),2),X=a(j,!0);t(j),t(I);var _e=s(I,2),ge=s(a(_e),2),q=a(ge,!0);t(ge),t(_e);var ne=s(_e,2),D=s(a(ne),2),se=a(D,!0);t(D),t(ne),t(r);var h=s(r,2);{var E=J=>{var H=js(),F=a(H);{var d=S=>{var N=ys(),re=O(N),$=s(a(re),2),A=a($,!0);t($);var ee=s($,2);{var te=c=>{var p=ms(),k=a(p);t(p),_(()=>o(k,`(${n.yeastStrain.producer??""})`)),l(c,p)};v(ee,c=>{n.yeastStrain.producer&&c(te)})}var pe=s(ee,2);{var ie=c=>{var p=hs(),k=a(p);t(p),_((P,Y)=>o(k,`${P??""}-${Y??""}¬∞C`),[()=>n.yeastStrain.temp_low.toFixed(0),()=>n.yeastStrain.temp_high.toFixed(0)]),l(c,p)};v(pe,c=>{n.yeastStrain.temp_low&&n.yeastStrain.temp_high&&c(ie)})}t(re);var le=s(re,2);{var b=c=>{var p=bs(),k=s(a(p),2),P=a(k,!0);t(k),t(p),_(()=>o(P,n.recipe.yeast_name)),l(c,p)};v(le,c=>{n.recipe.yeast_name&&c(b)})}_(()=>o(A,n.yeastStrain.name)),l(S,N)},x=S=>{var N=he(),re=O(N);{var $=A=>{var ee=xs(),te=s(a(ee),2),pe=a(te,!0);t(te),t(ee),_(()=>o(pe,n.recipe.yeast_name)),l(A,ee)};v(re,A=>{n.recipe.yeast_name&&A($)},!0)}l(S,N)};v(F,S=>{n.yeastStrain?S(d):S(x,!1)})}t(H),l(J,H)};v(h,J=>{(n.yeastStrain||n.recipe.yeast_name)&&J(E)})}_((J,H,F)=>{o(X,J),o(q,H),o(se,F)},[()=>M(n.recipe.og),()=>M(n.recipe.fg),()=>e(Q)!=null?`${e(Q).toFixed(1)}%`:"--"]),l(B,G)},$$slots:{default:!0}}),bt()}var zs=i('<p class="notes-content svelte-hkv31i"> </p>');function Fs(ue,n){mt(ue,{title:"Notes",children:(M,Q)=>{var B=zs(),f=a(B,!0);t(B),_(()=>o(f,n.notes)),l(M,B)},$$slots:{default:!0}})}var Cs=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),Rs=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),qs=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),Ss=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),Ms=i('<span class="activity-badge svelte-1xs394q"> </span>'),Bs=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),Ts=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Ds=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),As=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),Ps=i('<span class="days svelte-1xs394q"> </span>'),Os=i(" <!>",1),Es=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),Ls=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Gs=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Data points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Ns=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!></div></div></div>'),Us=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q"><!></p></div>');function Is(ue,n){ht(n,!0);let M=_t(n,"measuredOg",3,null),Q=_t(n,"currentSg",3,null),B=_t(n,"liveReading",3,null),f=ye(Bt({available:!1})),G=ye(!0),r=ye(!1),I=ye(null);async function j(){g(G,!0),g(I,null);try{g(f,await Aa(n.batchId),!0)}catch(d){g(I,d instanceof Error?d.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",d)}finally{g(G,!1)}}async function X(){g(r,!0),g(I,null);try{const d=await Da(n.batchId);console.log("Reloaded predictions:",d.message),await j()}catch(d){g(I,d instanceof Error?d.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",d)}finally{g(r,!1)}}$t(X);function _e(d){return d?new Date(d).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function ge(d){if(!d)return null;const x=new Date(d),S=new Date,N=x.getTime()-S.getTime();return Math.ceil(N/(1e3*60*60*24))}let q=L(()=>{const d=M()??e(f).predicted_og,x=e(f).predicted_fg,S=Q()??B()?.sg;if(!d||!x||!S||d<=x)return null;const N=d-x,$=(d-S)/N*100;return Math.min(100,Math.max(0,$))}),ne=L(()=>{const d=M()??e(f).predicted_og,x=Q()??B()?.sg;if(!d||!x||d<=1)return null;const S=(d-x)/(d-1)*100;return Math.min(100,Math.max(0,S))}),D=L(()=>{const d=B()?.sg_rate;if(d==null)return null;const x=Math.abs(d);return x>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:x>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:x>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),se=L(()=>B()?.is_anomaly??!1),h=L(()=>B()?.anomaly_reasons??[]);var E=he(),J=O(E);{var H=d=>{var x=Cs();l(d,x)},F=d=>{var x=he(),S=O(x);{var N=$=>{var A=Rs(),ee=a(A),te=a(ee);t(ee),t(A),_(()=>o(te,`‚ö†Ô∏è ${e(I)??""}`)),l($,A)},re=$=>{var A=he(),ee=O(A);{var te=ie=>{var le=Ns();let b;var c=a(le),p=s(a(c),2);p.__click=X;var k=a(p,!0);t(p),t(c);var P=s(c,2);{var Y=m=>{var w=Ss(),C=s(a(w),2),W=s(a(C),2);{var ze=Pe=>{var Ue=qs(),Me=a(Ue,!0);t(Ue),_(je=>o(Me,je),[()=>e(h).join(", ")]),l(Pe,Ue)};v(W,Pe=>{e(h).length>0&&Pe(ze)})}t(C),t(w),l(m,w)};v(P,m=>{e(se)&&m(Y)})}var ae=s(P,2);{var V=m=>{var w=Bs(),C=a(w),W=s(a(C),2);{var ze=Ze=>{var Ke=Ms(),yt=a(Ke);t(Ke),_(()=>{Ye(Ke,`color: ${e(D).color??""}`),o(yt,`${e(D).emoji??""} ${e(D).label??""}`)}),l(Ze,Ke)};v(W,Ze=>{e(D)&&Ze(ze)})}t(C);var Pe=s(C,2),Ue=a(Pe);t(Pe);var Me=s(Pe,2),je=a(Me),Qe=a(je);t(je);var Xe=s(je,2),it=a(Xe);t(Xe);var Le=s(Xe,2),vt=a(Le);t(Le),t(Me),t(w),_((Ze,Ke,yt)=>{Ye(Ue,`width: ${e(q)??""}%`),o(Qe,`OG: ${Ze??""}`),o(it,`${Ke??""}%`),o(vt,`FG: ${yt??""}`)},[()=>kt(M()??e(f).predicted_og??0),()=>e(q).toFixed(0),()=>kt(e(f).predicted_fg??0)]),l(m,w)};v(ae,m=>{e(q)!==null&&m(V)})}var ke=s(ae,2),fe=a(ke);{var Se=m=>{var w=Ts(),C=s(a(w),2),W=a(C,!0);t(C),t(w),_(ze=>o(W,ze),[()=>kt(e(f).predicted_fg)]),l(m,w)};v(fe,m=>{e(f).predicted_fg&&m(Se)})}var xe=s(fe,2);{var ve=m=>{var w=Ds(),C=s(a(w),2),W=a(C);t(C),t(w),_(ze=>o(W,`${ze??""}%`),[()=>e(ne).toFixed(1)]),l(m,w)};v(xe,m=>{e(ne)!==null&&m(ve)})}var u=s(xe,2);{var z=m=>{const w=L(()=>ge(e(f).estimated_completion));var C=Es(),W=s(a(C),2),ze=a(W);{var Pe=Me=>{var je=As();l(Me,je)},Ue=Me=>{var je=Os(),Qe=O(je),Xe=s(Qe);{var it=Le=>{var vt=Ps(),Ze=a(vt);t(vt),_(()=>o(Ze,`(${e(w)??""} ${e(w)===1?"day":"days"})`)),l(Le,vt)};v(Xe,Le=>{e(w)!==null&&Le(it)})}_(Le=>o(Qe,`${Le??""} `),[()=>_e(e(f).estimated_completion)]),l(Me,je)};v(ze,Me=>{e(w)!==null&&e(w)<=0?Me(Pe):Me(Ue,!1)})}t(W),t(C),l(m,C)};v(u,m=>{e(f).estimated_completion&&m(z)})}var Z=s(u,2),R=a(Z);{var oe=m=>{var w=Ls(),C=s(a(w),2),W=a(C);t(C),t(w),_(ze=>o(W,`${ze??""}%`),[()=>(e(f).r_squared*100).toFixed(0)]),l(m,w)};v(R,m=>{e(f).r_squared!==void 0&&m(oe)})}var de=s(R,2);{var Re=m=>{var w=Gs(),C=s(a(w),2),W=a(C,!0);t(C),t(w),_(()=>o(W,e(f).num_readings)),l(m,w)};v(de,m=>{e(f).num_readings&&m(Re)})}t(Z),t(ke),t(le),_(()=>{b=Ne(le,1,"ml-panel svelte-1xs394q",null,b,{"has-anomaly":e(se)}),p.disabled=e(r)||e(G),o(k,e(r)?"Reloading...":"‚Üª Reload")}),l(ie,le)},pe=ie=>{var le=Us(),b=a(le),c=s(a(b),2);c.__click=X;var p=a(c,!0);t(c),t(b);var k=s(b,2),P=a(k);{var Y=V=>{var ke=ft("Waiting for fermentation to progress (need visible SG drop)");l(V,ke)},ae=V=>{var ke=he(),fe=O(ke);{var Se=ve=>{var u=ft("Need more fermentation curve data for reliable prediction");l(ve,u)},xe=ve=>{var u=he(),z=O(u);{var Z=oe=>{var de=ft("Need at least 10 readings to make predictions");l(oe,de)},R=oe=>{var de=ft("Predictions will appear once fermentation is underway");l(oe,de)};v(z,oe=>{e(f).reason==="insufficient_data"?oe(Z):oe(R,!1)},!0)}l(ve,u)};v(fe,ve=>{e(f).reason==="insufficient_curve_data"?ve(Se):ve(xe,!1)},!0)}l(V,ke)};v(P,V=>{e(f).reason==="insufficient_fermentation_progress"?V(Y):V(ae,!1)})}t(k),t(le),_(()=>{c.disabled=e(r)||e(G),o(p,e(r)?"Reloading...":"‚Üª Reload")}),l(ie,le)};v(ee,ie=>{e(f).available?ie(te):ie(pe,!1)},!0)}l($,A)};v(S,$=>{e(I)?$(N):$(re,!1)},!0)}l(d,x)};v(J,d=>{e(G)?d(H):d(F,!1)})}l(ue,E),bt()}zt(["click"]);var Hs=i('<div class="loading svelte-1hws0u6">Loading alerts...</div>'),Vs=i('<div class="error-banner svelte-1hws0u6"><span> </span> <button type="button" class="dismiss-error svelte-1hws0u6">√ó</button></div>'),Ws=i('<button type="button" class="dismiss-all-btn svelte-1hws0u6"> </button>'),Js=i('<span class="spinner svelte-1hws0u6"></span>'),Ys=ja('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hws0u6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>'),Zs=i('<div class="alert-item svelte-1hws0u6"><div class="alert-icon svelte-1hws0u6"> </div> <div class="alert-content svelte-1hws0u6"><div class="alert-header svelte-1hws0u6"><span class="alert-type svelte-1hws0u6"> </span> <span class="severity-badge svelte-1hws0u6"> </span></div> <p class="alert-message svelte-1hws0u6"> </p> <div class="alert-meta svelte-1hws0u6"><span class="alert-time svelte-1hws0u6"> </span> <span class="alert-separator svelte-1hws0u6">¬∑</span> <span class="alert-time svelte-1hws0u6"> </span></div></div> <button type="button" class="dismiss-btn svelte-1hws0u6" title="Dismiss alert"><!></button></div>'),Ks=i('<!> <div class="alerts-header svelte-1hws0u6"><span class="alert-count svelte-1hws0u6"> </span> <!></div> <div class="alerts-list svelte-1hws0u6"></div>',1);function Qs(ue,n){ht(n,!0);let M=ye(Bt([])),Q=ye(!0),B=ye(null),f=ye(null),G=ye(!1);wa(()=>{r()});async function r(){try{g(Q,!0),g(B,null),g(M,await Pa(n.batchId,!1),!0)}catch(h){g(B,h instanceof Error?h.message:"Failed to load alerts",!0)}finally{g(Q,!1)}}async function I(h){try{g(f,h,!0),await Oa(n.batchId,h),g(M,e(M).filter(E=>E.id!==h),!0)}catch(E){g(B,E instanceof Error?E.message:"Failed to dismiss alert",!0)}finally{g(f,null)}}async function j(){try{g(G,!0),await Ea(n.batchId),g(M,[],!0)}catch(h){g(B,h instanceof Error?h.message:"Failed to dismiss alerts",!0)}finally{g(G,!1)}}function X(h){switch(h){case"critical":return"var(--negative)";case"warning":return"#f59e0b";case"info":return"var(--accent)";default:return"var(--text-muted)"}}function _e(h){switch(h){case"stall":return"‚è∏";case"temperature_high":return"üî•";case"temperature_low":return"‚ùÑ";case"anomaly":return"‚ö†";default:return"‚ö†"}}function ge(h){const E=new Date(h),H=new Date().getTime()-E.getTime(),F=Math.floor(H/6e4),d=Math.floor(F/60),x=Math.floor(d/24);return x>0?`${x}d ago`:d>0?`${d}h ago`:F>0?`${F}m ago`:"just now"}var q=he(),ne=O(q);{var D=h=>{mt(h,{title:"Alerts",icon:"üîî",children:(E,J)=>{var H=Hs();l(E,H)},$$slots:{default:!0}})},se=h=>{var E=he(),J=O(E);{var H=d=>{},F=d=>{mt(d,{title:"Active Alerts",icon:"üîî",highlight:!0,children:(x,S)=>{var N=Ks(),re=O(N);{var $=b=>{var c=Vs(),p=a(c),k=a(p,!0);t(p);var P=s(p,2);P.__click=()=>g(B,null),t(c),_(()=>o(k,e(B))),l(b,c)};v(re,b=>{e(B)&&b($)})}var A=s(re,2),ee=a(A),te=a(ee);t(ee);var pe=s(ee,2);{var ie=b=>{var c=Ws();c.__click=j;var p=a(c,!0);t(c),_(()=>{c.disabled=e(G),o(p,e(G)?"Dismissing...":"Dismiss All")}),l(b,c)};v(pe,b=>{e(M).length>1&&b(ie)})}t(A);var le=s(A,2);Tt(le,21,()=>e(M),b=>b.id,(b,c)=>{var p=Zs(),k=a(p),P=a(k,!0);t(k);var Y=s(k,2),ae=a(Y),V=a(ae),ke=a(V,!0);t(V);var fe=s(V,2),Se=a(fe,!0);t(fe),t(ae);var xe=s(ae,2),ve=a(xe,!0);t(xe);var u=s(xe,2),z=a(u),Z=a(z);t(z);var R=s(z,4),oe=a(R);t(R),t(u),t(Y);var de=s(Y,2);de.__click=()=>I(e(c).id);var Re=a(de);{var m=C=>{var W=Js();l(C,W)},w=C=>{var W=Ys();l(C,W)};v(Re,C=>{e(f)===e(c).id?C(m):C(w,!1)})}t(de),t(p),_((C,W,ze,Pe,Ue,Me,je,Qe)=>{Ye(p,`--severity-color: ${C??""}`),o(P,W),o(ke,ze),Ye(fe,`background: ${Pe??""}`),o(Se,e(c).severity),o(ve,e(c).message),nt(z,"title",`First detected: ${Ue??""}`),o(Z,`First: ${Me??""}`),nt(R,"title",`Last seen: ${je??""}`),o(oe,`Last: ${Qe??""}`),de.disabled=e(f)===e(c).id},[()=>X(e(c).severity),()=>_e(e(c).alert_type),()=>e(c).alert_type.replace("_"," "),()=>X(e(c).severity),()=>new Date(e(c).first_detected_at).toLocaleString(),()=>ge(e(c).first_detected_at),()=>new Date(e(c).last_seen_at).toLocaleString(),()=>ge(e(c).last_seen_at)]),l(b,p)}),t(le),_(()=>o(te,`${e(M).length??""} active`)),l(x,N)},$$slots:{default:!0}})};v(J,d=>{e(M).length===0?d(H):d(F,!1)},!0)}l(h,E)};v(ne,h=>{e(Q)?h(D):h(se,!1)})}l(ue,q),bt()}zt(["click"]);var Xs=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),$s=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),er=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),tr=i('<span class="recipe-type svelte-g5au2j"> </span>'),ar=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),sr=i('<div class="batch-timing svelte-g5au2j"> </div>'),rr=i('<div class="batch-timing svelte-g5au2j"> </div>'),lr=i('<option class="svelte-g5au2j"> </option>'),nr=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),ir=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),vr=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),or=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),dr=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),cr=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),ur=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),_r=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),gr=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),pr=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),fr=i('<span class="status-badge idle svelte-g5au2j"> </span>'),mr=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),hr=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),br=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),yr=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),xr=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),jr=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),wr=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),kr=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),zr=i('<span class="svelte-g5au2j"> </span>'),Fr=i('<span class="svelte-g5au2j"> </span>'),Cr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Rr=i('<div class="chart-section svelte-g5au2j"><!></div>'),qr=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div> <!>',1),Sr=i('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),Mr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function Xr(ue,n){ht(n,!0);const M=()=>Ma(Ba,"$page",Q),[Q,B]=Sa();let f=null,G=null,r=ye(null),I=ye(null),j=ye(null),X=Bt([]),_e=ye(!0),ge=ye(null),q=ye(!1),ne=ye(!1),D=ye(!1),se=ye(!1),h=ye(!1),E=ye(!1),J=L(()=>parseInt(M().params.id??"0"));const H={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},F=["planning","fermenting","conditioning","completed","archived"];let d=L(()=>e(r)?H[e(r).status]:H.planning),x=L(aa),S=L(()=>Ct.config.ha_enabled&&Ct.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),N=L(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),re=L(()=>!e(N)||!e(A)?.temp||!e(r)?.temp_target?!1:e(A).temp<=e(r).temp_target),$=L(()=>{if(!e(N)||!e(A)?.temp||!e(r)?.temp_target)return null;const u=e(r).temp_target+30,z=e(A).temp,Z=e(r).temp_target;if(z<=Z)return 100;if(z>=u)return 0;const R=(u-z)/(u-Z)*100;return Math.min(100,Math.max(0,R))}),A=L(()=>{if(!e(r)?.device_id)return null;const u=Xt.tilts.get(e(r).device_id);if(u)return u;const z=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!z?.[1])return null;const Z=z[1].toUpperCase();for(const R of Xt.tilts.values())if(R.color&&R.color.toUpperCase()===Z)return R;return null});async function ee(){g(_e,!0),g(ge,null);try{if(g(r,await La(e(J)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{g(I,await Kt(e(J)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{g(j,await Ft(e(J)),!0)}catch{}}catch(u){g(ge,u instanceof Error?u.message:"Failed to load batch",!0)}finally{g(_e,!1)}}async function te(u){if(!(!e(r)||e(ne))&&!(u==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){g(ne,!0);try{g(r,await Qt(e(r).id,{status:u}),!0),(u==="fermenting"||u==="conditioning")&&g(I,await Kt(e(r).id),!0)}catch(z){console.error("Failed to update status:",z)}finally{g(ne,!1)}}}async function pe(u){if(e(r)&&(g(r,await Qt(e(r).id,u),!0),g(q,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{g(j,await Ft(e(r).id),!0)}catch{}}async function ie(){if(e(r)){g(h,!0);try{await Ga(e(r).id),Ta("/batches")}catch(u){g(ge,u instanceof Error?u.message:"Failed to delete batch",!0),g(h,!1),g(se,!1)}}}async function le(u,z){if(!(!e(r)||e(D))){g(D,!0);try{await Mt(e(r).id,z,60,u),g(j,await Ft(e(r).id),!0)}catch(Z){console.error("Failed to set override:",Z)}finally{g(D,!1)}}}async function b(){if(!(!e(r)||e(D))){g(D,!0);try{e(r).heater_entity_id&&await Mt(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Mt(e(r).id,null,60,"cooler"),g(j,await Ft(e(r).id),!0)}catch(u){console.error("Failed to clear overrides:",u)}finally{g(D,!1)}}}function c(){if(f?.readyState===WebSocket.OPEN)return;const z=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;f=new WebSocket(z),f.onmessage=async Z=>{try{const R=JSON.parse(Z.data);R.type==="control_event"&&R.batch_id===e(J)&&e(j)&&(R.action==="heat_on"?g(j,{...e(j),heater_state:"on"},!0):R.action==="heat_off"?g(j,{...e(j),heater_state:"off"},!0):R.action==="cool_on"?g(j,{...e(j),cooler_state:"on"},!0):R.action==="cool_off"&&g(j,{...e(j),cooler_state:"off"},!0))}catch{}},f.onclose=()=>{f=null,G=setTimeout(c,3e3)},f.onerror=()=>{f?.close()}}function p(){G&&(clearTimeout(G),G=null),f?.close(),f=null}function k(u){return u==null?"--":ta(u)}function P(u){return u?new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function Y(u){if(!u)return"--";const z=new Date(u),R=(new Date().getTime()-z.getTime())/(1e3*60*60);if(R<1)return`${Math.round(R*60)}m`;if(R<24)return`${R.toFixed(1)}h`;const oe=R/24;return oe<7?`${oe.toFixed(1)}d`:`${Math.round(oe)}d`}$t(()=>{ee(),c()}),ka(()=>{p()});var ae=Mr();Ca("g5au2j",u=>{za(()=>{Fa.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var V=O(ae),ke=s(a(V),2);{var fe=u=>{var z=Xs();l(u,z)},Se=u=>{var z=he(),Z=O(z);{var R=de=>{var Re=$s(),m=s(a(Re),2),w=a(m,!0);t(m);var C=s(m,2);C.__click=ee,t(Re),_(()=>o(w,e(ge))),l(de,Re)},oe=de=>{var Re=he(),m=O(Re);{var w=W=>{var ze=er();l(W,ze)},C=W=>{var ze=he(),Pe=O(ze);{var Ue=je=>{Na(je,{get batch(){return e(r)},onSubmit:pe,onCancel:()=>g(q,!1)})},Me=je=>{var Qe=qr(),Xe=O(Qe),it=a(Xe),Le=a(it),vt=a(Le);t(Le);var Ze=s(Le,2),Ke=a(Ze),yt=a(Ke,!0);t(Ke);var Dt=s(Ke,2);{var ra=y=>{var U=ar(),ce=a(U),Fe=s(ce);{var we=qe=>{var Ge=tr(),Ie=a(Ge);t(Ge),_(()=>o(Ie,`(${e(r).recipe.type??""})`)),l(qe,Ge)};v(Fe,qe=>{e(r).recipe.type&&qe(we)})}t(U),_(()=>{nt(U,"href",`/recipes/${e(r).recipe.id??""}`),o(ce,`${e(r).recipe.name??""} `)}),l(y,U)};v(Dt,y=>{e(r).recipe&&y(ra)})}var la=s(Dt,2);{var na=y=>{var U=sr(),ce=a(U);t(U),_((Fe,we)=>o(ce,`Started ${Fe??""} ¬∑ ${we??""} ago`),[()=>P(e(r).start_time),()=>Y(e(r).start_time)]),l(y,U)},ia=y=>{var U=he(),ce=O(U);{var Fe=we=>{var qe=rr(),Ge=a(qe);t(qe),_(Ie=>o(Ge,`Brewed ${Ie??""}`),[()=>P(e(r).brew_date)]),l(we,qe)};v(ce,we=>{e(r).brew_date&&we(Fe)},!0)}l(y,U)};v(la,y=>{e(r).start_time?y(na):y(ia,!1)})}t(Ze),t(it);var At=s(it,2),Rt=a(At),$e=a(Rt);$e.__change=y=>te(y.currentTarget.value),Tt($e,21,()=>F,ea,(y,U)=>{var ce=lr(),Fe=a(ce,!0);t(ce);var we={};_(()=>{o(Fe,H[e(U)].label),we!==(we=e(U))&&(ce.value=(ce.__value=e(U))??"")}),l(y,ce)}),t($e);var Pt;Ra($e),t(Rt);var Ot=s(Rt,2);Ot.__click=()=>g(q,!0);var va=s(Ot,2);va.__click=()=>g(se,!0),t(At),t(Xe);var Et=s(Xe,2);{var oa=y=>{var U=_r();let ce;var Fe=a(U),we=a(Fe);{var qe=T=>{var K=nr();Ae(2),l(T,K)},Ge=T=>{var K=ir();Ae(2),l(T,K)};v(we,T=>{e(re)?T(qe):T(Ge,!1)})}t(Fe);var Ie=s(Fe,2),ot=a(Ie),tt=a(ot),gt=s(a(tt),2),He=a(gt,!0);t(gt),t(tt);var me=s(tt,4),De=s(a(me),2),dt=a(De,!0);t(De),t(me),t(ot);var ct=s(ot,2);{var xt=T=>{var K=vr(),Ce=a(K),Be=a(Ce);t(Ce);var Oe=s(Ce,2),be=a(Oe);t(Oe),t(K),_(Te=>{Ye(Be,`width: ${e($)??""}%`),o(be,`${Te??""}% to target`)},[()=>Math.round(e($))]),l(T,K)};v(ct,T=>{e($)!=null&&!e(re)&&T(xt)})}var Ve=s(ct,2),at=a(Ve);{var jt=T=>{var K=or();l(T,K)},wt=T=>{var K=he(),Ce=O(K);{var Be=be=>{var Te=dr();l(be,Te)},Oe=be=>{var Te=he(),st=O(Te);{var et=lt=>{var pt=cr();l(lt,pt)},rt=lt=>{var pt=ur();l(lt,pt)};v(st,lt=>{e(re)?lt(et):lt(rt,!1)},!0)}l(be,Te)};v(Ce,be=>{!Ct.config.ha_enabled||!Ct.config.temp_control_enabled?be(Be):be(Oe,!1)},!0)}l(T,K)};v(at,T=>{e(r).cooler_entity_id?T(wt,!1):T(jt)})}t(Ve),t(Ie),t(U),_((T,K)=>{ce=Ne(U,1,"chilling-banner svelte-g5au2j",null,ce,{ready:e(re)}),o(He,T),o(dt,K)},[()=>e(A)?.temp!=null?k(e(A).temp):"--",()=>e(r).temp_target!=null?k(e(r).temp_target):"--"]),l(y,U)};v(Et,y=>{e(N)&&y(oa)})}var qt=s(Et,2),St=a(qt),Lt=a(St);{let y=L(()=>e(A)?.sg??e(I)?.measured?.current_sg);rs(Lt,{get batch(){return e(r)},get currentSg(){return e(y)},get progress(){return e(I)},get liveReading(){return e(A)}})}var da=s(Lt,2);{var ca=y=>{ks(y,{get recipe(){return e(r).recipe},get yeastStrain(){return e(r).yeast_strain}})};v(da,y=>{e(r).recipe&&y(ca)})}t(St);var Gt=s(St,2),Nt=a(Gt);ps(Nt,{get batch(){return e(r)},get liveReading(){return e(A)},onEdit:()=>g(q,!0)});var Ut=s(Nt,2);{var ua=y=>{Qs(y,{get batchId(){return e(r).id}})};v(Ut,y=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&y(ua)})}var It=s(Ut,2);{let y=L(()=>e(A)?.sg);Is(It,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(y)},get liveReading(){return e(A)}})}var Ht=s(It,2);{var _a=y=>{var U=kr();let ce;var Fe=a(U);Fe.__click=()=>g(E,!e(E));var we=s(a(Fe),2),qe=a(we);{var Ge=me=>{var De=gr();l(me,De)},Ie=me=>{var De=he(),dt=O(De);{var ct=Ve=>{var at=pr();l(Ve,at)},xt=Ve=>{var at=he(),jt=O(at);{var wt=T=>{var K=fr(),Ce=a(K);t(K),_(Be=>o(Ce,`üéØ ${Be??""}${e(x)??""}`),[()=>k(e(j).target_temp)]),l(T,K)};v(jt,T=>{e(E)&&e(j)&&T(wt)},!0)}l(Ve,at)};v(dt,Ve=>{e(j)?.cooler_state==="on"?Ve(ct):Ve(xt,!1)},!0)}l(me,De)};v(qe,me=>{e(j)?.heater_state==="on"?me(Ge):me(Ie,!1)})}var ot=s(qe,2);let tt;t(we),t(Fe);var gt=s(Fe,2);{var He=me=>{var De=wr(),dt=O(De),ct=a(dt);{var xt=T=>{var K=mr(),Ce=a(K);let Be;var Oe=s(Ce,2),be=s(a(Oe),2);let Te;var st=a(be,!0);t(be);var et=s(be,2),rt=a(et,!0);t(et),t(Oe),t(K),_(()=>{Be=Ne(Ce,1,"device-icon-wrap svelte-g5au2j",null,Be,{active:e(j)?.heater_state==="on"}),Te=Ne(be,1,"device-state svelte-g5au2j",null,Te,{on:e(j)?.heater_state==="on"}),o(st,e(j)?.heater_state==="on"?"ON":"OFF"),o(rt,e(r).heater_entity_id)}),l(T,K)};v(ct,T=>{e(r).heater_entity_id&&T(xt)})}var Ve=s(ct,2);{var at=T=>{var K=hr(),Ce=a(K);let Be;var Oe=s(Ce,2),be=s(a(Oe),2);let Te;var st=a(be,!0);t(be);var et=s(be,2),rt=a(et,!0);t(et),t(Oe),t(K),_(()=>{Be=Ne(Ce,1,"device-icon-wrap svelte-g5au2j",null,Be,{active:e(j)?.cooler_state==="on"}),Te=Ne(be,1,"device-state svelte-g5au2j",null,Te,{on:e(j)?.cooler_state==="on"}),o(st,e(j)?.cooler_state==="on"?"ON":"OFF"),o(rt,e(r).cooler_entity_id)}),l(T,K)};v(Ve,T=>{e(r).cooler_entity_id&&T(at)})}t(dt);var jt=s(dt,2);{var wt=T=>{var K=jr(),Ce=O(K),Be=a(Ce),Oe=s(a(Be),2),be=a(Oe);t(Oe),t(Be);var Te=s(Be,2),st=s(a(Te),2),et=a(st);t(st),t(Te),t(Ce);var rt=s(Ce,2);{var lt=Ee=>{var We=br(),Je=s(a(We),2),ut=a(Je);t(Je);var Zt=s(Je,2);Zt.__click=()=>b(),t(We),_(xa=>{o(ut,`Override active: ${xa??""}`),Zt.disabled=e(D)},[()=>e(j).override_state?.toUpperCase()]),l(Ee,We)};v(rt,Ee=>{e(j).override_active&&Ee(lt)})}var pt=s(rt,2),Vt=s(a(pt),2),Wt=a(Vt);{var ba=Ee=>{var We=yr(),Je=O(We);Je.__click=()=>le("heater","on");var ut=s(Je,2);ut.__click=()=>le("heater","off"),_(()=>{Je.disabled=e(D),ut.disabled=e(D)}),l(Ee,We)};v(Wt,Ee=>{e(r).heater_entity_id&&Ee(ba)})}var Jt=s(Wt,2);{var ya=Ee=>{var We=xr(),Je=O(We);Je.__click=()=>le("cooler","on");var ut=s(Je,2);ut.__click=()=>le("cooler","off"),_(()=>{Je.disabled=e(D),ut.disabled=e(D)}),l(Ee,We)};v(Jt,Ee=>{e(r).cooler_entity_id&&Ee(ya)})}var Yt=s(Jt,2);Yt.__click=()=>b(),t(Vt),t(pt),_((Ee,We)=>{o(be,`${Ee??""}${e(x)??""}`),o(et,`¬±${We??""}${e(x)??""}`),Yt.disabled=e(D)},[()=>k(e(j).target_temp),()=>e(j).hysteresis?.toFixed(1)||"--"]),l(T,K)};v(jt,T=>{e(j)&&T(wt)})}l(me,De)};v(gt,me=>{e(E)||me(He)})}t(U),_(()=>{ce=Ne(U,1,"info-card temp-control-card svelte-g5au2j",null,ce,{"heater-on":e(j)?.heater_state==="on","cooler-on":e(j)?.cooler_state==="on",collapsed:e(E)}),tt=Ne(ot,0,"chevron svelte-g5au2j",null,tt,{rotated:!e(E)})}),l(y,U)},ga=y=>{var U=he(),ce=O(U);{var Fe=we=>{var qe=Cr(),Ge=s(a(qe),2),Ie=a(Ge);{var ot=He=>{var me=zr(),De=a(me);t(me),_(()=>o(De,`Heater: ${e(r).heater_entity_id??""}`)),l(He,me)};v(Ie,He=>{e(r).heater_entity_id&&He(ot)})}var tt=s(Ie,2);{var gt=He=>{var me=Fr(),De=a(me);t(me),_(()=>o(De,`Cooler: ${e(r).cooler_entity_id??""}`)),l(He,me)};v(tt,He=>{e(r).cooler_entity_id&&He(gt)})}Ae(2),t(Ge),t(qe),l(we,qe)};v(ce,we=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&we(Fe)},!0)}l(y,U)};v(Ht,y=>{e(S)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?y(_a):y(ga,!1)})}var pa=s(Ht,2);{var fa=y=>{Fs(y,{get notes(){return e(r).notes}})};v(pa,y=>{e(r).notes&&y(fa)})}t(Gt),t(qt);var ma=s(qt,2);{var ha=y=>{var U=Rr(),ce=a(U);Ia(ce,{get batchId(){return e(r).id},get deviceColor(){return e(r).device_id},get originalGravity(){return e(r).measured_og},get controlEvents(){return X}}),t(U),l(y,U)};v(ma,y=>{e(r).device_id&&y(ha)})}_(()=>{o(vt,`#${(e(r).batch_number||"?")??""}`),o(yt,e(r).name||e(r).recipe?.name||"Unnamed Batch"),$e.disabled=e(ne),Ye($e,`color: ${e(d).color??""}; background: ${e(d).bg??""};`),Pt!==(Pt=e(r).status)&&($e.value=($e.__value=e(r).status)??"",qa($e,e(r).status))}),l(je,Qe)};v(Pe,je=>{e(q)?je(Ue):je(Me,!1)},!0)}l(W,ze)};v(m,W=>{e(r)?W(C,!1):W(w)},!0)}l(de,Re)};v(Z,de=>{e(ge)?de(R):de(oe,!1)},!0)}l(u,z)};v(ke,u=>{e(_e)?u(fe):u(Se,!1)})}t(V);var xe=s(V,2);{var ve=u=>{var z=Sr();z.__click=()=>g(se,!1);var Z=a(z);Z.__click=C=>C.stopPropagation();var R=s(a(Z),2),oe=a(R);t(R);var de=s(R,2),Re=a(de);Re.__click=()=>g(se,!1);var m=s(Re,2);m.__click=ie;var w=a(m,!0);t(m),t(de),t(Z),t(z),_(()=>{o(oe,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),Re.disabled=e(h),m.disabled=e(h),o(w,e(h)?"Deleting...":"Delete Batch")}),l(u,z)};v(xe,u=>{e(se)&&u(ve)})}l(ue,ae),bt(),B()}zt(["click","change"]);export{Xr as component,Qr as universal};
