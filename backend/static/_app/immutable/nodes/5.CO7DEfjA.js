import{d as Bt,f as i,s as o,a as l,c as xe,t as jt,h as Nt}from"../chunks/Bkky6kvZ.js";import{d as a,e as s,r as t,t as u,a as kt,f as O,h as e,u as H,n as Te,g as zt,s as fe,p as Ut,o as oa,c as _,az as qa,aI as Ma,aJ as Sa,ax as Ba}from"../chunks/813s5maz.js";import{e as At,i as It}from"../chunks/j9QCVC2i.js";import{i as v}from"../chunks/Bf7HnLem.js";import{h as Ta}from"../chunks/BgIwEmqo.js";import{s as lt}from"../chunks/UKAZQVVw.js";import{s as He}from"../chunks/LBYG0Yba.js";import{s as Xe}from"../chunks/C7upzuIa.js";import{b as Da,i as Aa,s as Pa}from"../chunks/D4jp30Ch.js";import{s as Oa,a as La}from"../chunks/Rx9Mwdtx.js";import{p as Ea}from"../chunks/DDTPjCoq.js";import{g as Ga}from"../chunks/Dxc5caBS.js";import{a8 as Na,a9 as Ua,aa as Ia,ab as Ha,ac as Va,Z as Wa,P as ia,ad as Tt,U as Ja,N as Et,ae as Gt}from"../chunks/D3bWYmks.js";import{d as St,e as da,g as ca,c as Dt}from"../chunks/CbPjToI1.js";import{t as va}from"../chunks/DVuldl-p.js";import{B as Ya}from"../chunks/DHmv3sWa.js";import{s as Za}from"../chunks/BB07oCeu.js";import{p as bt}from"../chunks/B-xGjlKy.js";import{F as Ka}from"../chunks/D-9AEWgs.js";const Qa=!1,dl=Object.freeze(Object.defineProperty({__proto__:null,prerender:Qa},Symbol.toStringTag,{value:"Module"}));function Xa(me){return me>=-50?{bars:4,color:"var(--positive)",label:"Excellent"}:me>=-60?{bars:3,color:"var(--positive)",label:"Good"}:me>=-70?{bars:2,color:"var(--warning)",label:"Fair"}:{bars:1,color:"var(--negative)",label:"Weak"}}function ua(me){const n=Math.floor((Date.now()-new Date(me).getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const q=Math.floor(n/60);if(q<60)return`${q}m ago`;const Q=Math.floor(q/60);return Q<24?`${Q}h ago`:`${Math.floor(Q/24)}d ago`}var $a=i('<div class="accent-bar svelte-1oyrwd9"></div>'),es=i('<span class="card-icon svelte-1oyrwd9"> </span>'),ts=i('<button type="button" class="expand-btn svelte-1oyrwd9"><svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path></svg></button>'),as=i('<div><!> <div class="card-header svelte-1oyrwd9"><div class="header-left svelte-1oyrwd9"><!> <h3 class="card-title svelte-1oyrwd9"> </h3></div> <!></div> <div><!></div></div>');function wt(me,n){let q=bt(n,"highlight",3,!1),Q=bt(n,"compact",3,!1),T=bt(n,"collapsible",3,!1),m=bt(n,"expanded",3,!1);var L=as();let r;var W=a(L);{var h=y=>{var z=$a();l(y,z)};v(W,y=>{q()&&y(h)})}var te=s(W,2),_e=a(te),de=a(_e);{var B=y=>{var z=es(),se=a(z,!0);t(z),u(()=>o(se,n.icon)),l(y,z)};v(de,y=>{n.icon&&y(B)})}var ce=s(de,2),J=a(ce,!0);t(ce),t(_e);var ae=s(_e,2);{var b=y=>{var z=ts();z.__click=function(...g){n.onToggle?.apply(this,g)};var se=a(z);let N;t(z),u(()=>{lt(z,"aria-label",m()?"Collapse":"Expand"),N=He(se,0,"expand-icon svelte-1oyrwd9",null,N,{"rotate-180":m()})}),l(y,z)};v(ae,y=>{T()&&n.onToggle&&y(b)})}t(te);var D=s(te,2);let E;var G=a(D);Za(G,()=>n.children),t(D),t(L),u(()=>{r=He(L,1,"batch-card svelte-1oyrwd9",null,r,{highlight:q(),compact:Q()}),o(J,n.title),E=He(D,1,"card-content svelte-1oyrwd9",null,E,{collapsed:T()&&!m()})}),l(me,L)}Bt(["click"]);var ss=i('<span class="updated-text svelte-t80j9z"> </span>'),rs=i('<div class="hero-divider svelte-t80j9z"></div> <div class="hero-metric temperature svelte-t80j9z"><span class="hero-value svelte-t80j9z"> <span class="hero-unit svelte-t80j9z"> </span></span> <span class="hero-label svelte-t80j9z">Temperature</span></div>',1),ls=i('<div class="remaining-text svelte-t80j9z"> </div>'),ns=i('<div class="progress-section svelte-t80j9z"><div class="progress-labels svelte-t80j9z"><div class="progress-endpoint start svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">OG</span></div> <div class="progress-current svelte-t80j9z"><span class="current-percent svelte-t80j9z"> </span></div> <div class="progress-endpoint end svelte-t80j9z"><span class="endpoint-value svelte-t80j9z"> </span> <span class="endpoint-label svelte-t80j9z">Target FG</span></div></div> <div class="progress-track svelte-t80j9z"><div class="progress-fill svelte-t80j9z"></div> <div><div class="marker-dot svelte-t80j9z"></div> <div class="marker-value svelte-t80j9z"> </div></div></div> <!></div>'),is=i('<div class="metrics-row svelte-t80j9z"><div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">ABV</span></div> <div class="metric svelte-t80j9z"><span class="metric-value svelte-t80j9z"> </span> <span class="metric-label svelte-t80j9z">Attenuation</span></div></div>'),vs=i('<div class="status-row svelte-t80j9z"><div class="live-indicator svelte-t80j9z"><span class="pulse-dot svelte-t80j9z"></span> <span class="status-text svelte-t80j9z">LIVE</span></div> <!></div> <div class="hero-section svelte-t80j9z"><div class="hero-metric gravity svelte-t80j9z"><span class="hero-value svelte-t80j9z"> </span> <span class="hero-label svelte-t80j9z">Gravity</span></div> <!></div> <!> <!>',1),os=i('<div class="completed-grid svelte-t80j9z"><div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Original Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Final Gravity</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">ABV</span></div> <div class="completed-metric svelte-t80j9z"><span class="completed-value svelte-t80j9z"> </span> <span class="completed-label svelte-t80j9z">Attenuation</span></div></div>'),ds=i('<div class="empty-state svelte-t80j9z"><div class="empty-icon svelte-t80j9z">‚óé</div> <p class="empty-text svelte-t80j9z">Set Original Gravity to track fermentation</p></div>');function cs(me,n){kt(n,!0);let q=H(()=>n.currentSg??n.progress?.measured?.current_sg),Q=H(()=>n.liveReading?.temp??n.progress?.temperature?.current),T=H(()=>n.liveReading?.last_seen),m=H(()=>e(T)?ua(e(T)):null),L=H(ca),r=H(()=>{if(!n.batch.measured_og||!e(q))return null;const B=Math.max(0,(n.batch.measured_og-e(q))*131.25),ce=n.batch.measured_og-1,J=ce!==0?Math.max(0,Math.min(100,(n.batch.measured_og-e(q))/ce*100)):0;return{abv:B,attenuation:J}}),W=H(()=>{const B=n.batch.measured_og,ce=n.batch.recipe?.fg;if(!B||!ce||!e(q))return null;const J=B-ce,ae=B-e(q);return J<=0?null:Math.max(0,Math.min(100,ae/J*100))}),h=H(()=>n.batch.status==="fermenting"||n.batch.status==="conditioning");function te(B){return B==null?"--":St(B)}function _e(B){return B==null?"--":`${B.toFixed(1)}%`}function de(B){return B==null?"--":da(B)}wt(me,{title:"Fermentation",children:(B,ce)=>{var J=xe(),ae=O(J);{var b=E=>{var G=vs(),y=O(G),z=s(a(y),2);{var se=C=>{var d=ss(),p=a(d);t(d),u(()=>o(p,`Updated ${e(m)??""}`)),l(C,d)};v(z,C=>{e(m)&&C(se)})}t(y);var N=s(y,2),g=a(N),F=a(g),X=a(F,!0);t(F),Te(2),t(g);var le=s(g,2);{var U=C=>{var d=rs(),p=s(O(d),2),w=a(p),M=a(w,!0),I=s(M),Y=a(I,!0);t(I),t(w),Te(2),t(p),u($=>{o(M,$),o(Y,e(L))},[()=>de(e(Q))]),l(C,d)};v(le,C=>{e(Q)!=null&&C(U)})}t(N);var V=s(N,2);{var re=C=>{var d=ns(),p=a(d),w=a(p),M=a(w),I=a(M,!0);t(M),Te(2),t(w);var Y=s(w,2),$=a(Y),De=a($);t($),t(Y);var ue=s(Y,2),je=a(ue),ge=a(je,!0);t(je),Te(2),t(ue),t(p);var qe=s(p,2),Be=a(qe),ze=s(Be,2);let c;var x=s(a(ze),2),ne=a(x,!0);t(x),t(ze),t(qe);var S=s(qe,2);{var Ae=ee=>{var ie=ls(),ve=a(ie);t(ie),u(Fe=>o(ve,`${Fe??""} points to go`),[()=>n.progress.progress.sg_remaining.toFixed(3)]),l(ee,ie)};v(S,ee=>{n.progress?.progress?.sg_remaining!=null&&n.progress.progress.sg_remaining>0&&ee(Ae)})}t(d),u((ee,ie,ve,Fe)=>{o(I,ee),o(De,`${ie??""}%`),o(ge,ve),Xe(Be,`width: ${e(W)??""}%`),c=He(ze,1,"progress-marker svelte-t80j9z",null,c,{"at-start":e(W)<3}),Xe(ze,`left: ${e(W)??""}%`),o(ne,Fe)},[()=>te(n.batch.measured_og),()=>e(W).toFixed(0),()=>te(n.batch.recipe.fg),()=>te(e(q))]),l(C,d)};v(V,C=>{e(W)!==null&&n.batch.measured_og&&n.batch.recipe?.fg&&C(re)})}var he=s(V,2);{var Re=C=>{var d=is(),p=a(d),w=a(p),M=a(w,!0);t(w),Te(2),t(p);var I=s(p,2),Y=a(I),$=a(Y,!0);t(Y),Te(2),t(I),t(d),u((De,ue)=>{o(M,De),o($,ue)},[()=>_e(e(r).abv),()=>_e(e(r).attenuation)]),l(C,d)};v(he,C=>{e(r)&&C(Re)})}u(C=>o(X,C),[()=>te(e(q))]),l(E,G)},D=E=>{var G=xe(),y=O(G);{var z=N=>{var g=os(),F=a(g),X=a(F),le=a(X,!0);t(X),Te(2),t(F);var U=s(F,2),V=a(U),re=a(V,!0);t(V),Te(2),t(U);var he=s(U,2),Re=a(he),C=a(Re,!0);t(Re),Te(2),t(he);var d=s(he,2),p=a(d),w=a(p,!0);t(p),Te(2),t(d),t(g),u((M,I,Y,$)=>{o(le,M),o(re,I),o(C,Y),o(w,$)},[()=>te(n.batch.measured_og),()=>te(n.batch.measured_fg),()=>n.batch.measured_abv!=null?_e(n.batch.measured_abv):"--",()=>n.batch.measured_attenuation!=null?_e(n.batch.measured_attenuation):"--"]),l(N,g)},se=N=>{var g=ds();l(N,g)};v(y,N=>{n.batch.measured_og?N(z):N(se,!1)},!0)}l(E,G)};v(ae,E=>{e(q)&&e(h)?E(b):E(D,!1)})}l(B,J)},$$slots:{default:!0}}),zt()}var us=i('<span class="device-last-seen svelte-1kdxwtz"> </span>'),_s=i('<div class="signal-bar svelte-1kdxwtz"></div>'),gs=i('<div class="metric-item svelte-1kdxwtz"><div class="signal-bars svelte-1kdxwtz"></div> <span class="metric-text svelte-1kdxwtz"> </span></div>'),ps=i('<div class="metric-item battery svelte-1kdxwtz"><svg class="battery-icon svelte-1kdxwtz" viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="2" y="7" width="18" height="10" rx="2"></rect><rect x="4" y="9" height="6" stroke="none" rx="1"></rect><path d="M20 10v4h2v-4z" stroke="none"></path></svg> <span class="metric-text svelte-1kdxwtz"><!></span></div>'),fs=i('<div class="device-metrics svelte-1kdxwtz"><!> <!></div>'),ms=i('<div class="device-row svelte-1kdxwtz"><div class="device-status online svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <!></div> <!>',1),hs=i('<div class="device-row svelte-1kdxwtz"><div class="device-status offline svelte-1kdxwtz"><span class="device-dot svelte-1kdxwtz"></span> </div> <span class="device-last-seen svelte-1kdxwtz">No data</span></div>'),bs=i('<div class="device-info svelte-1kdxwtz"><!></div>'),ys=i('<button type="button" class="link-btn svelte-1kdxwtz">Link device</button>'),xs=i('<div class="no-device svelte-1kdxwtz"><span>No device assigned</span> <!></div>');function js(me,n){kt(n,!0);let q=H(()=>n.liveReading?.device_type==="tilt"),Q=H(()=>e(q)&&n.liveReading?.rssi?Xa(n.liveReading.rssi):null),T=H(()=>n.liveReading?.last_seen?ua(n.liveReading.last_seen):null),m=H(()=>n.liveReading?.battery_percent!=null||n.liveReading?.battery_voltage!=null),L=H(()=>n.liveReading?.battery_percent),r=H(()=>n.liveReading?.battery_voltage),W=H(()=>e(L)?e(L)>50?"var(--positive)":e(L)>20?"#f59e0b":"var(--negative)":"var(--text-muted)"),h=H(()=>{if(!n.liveReading)return n.batch.device_id||"Unknown";const te=n.liveReading.device_type;return te==="tilt"?`${n.liveReading.color} Tilt`:te==="gravitymon"?`GravityMon (${n.liveReading.id})`:te==="ispindel"?`iSpindel (${n.liveReading.id})`:te==="floaty"?`Floaty (${n.liveReading.id})`:n.liveReading.color||n.liveReading.id});wt(me,{title:"Tracking Device",compact:!0,children:(te,_e)=>{var de=xe(),B=O(de);{var ce=ae=>{var b=bs(),D=a(b);{var E=y=>{var z=ms(),se=O(z),N=a(se),g=s(a(N));t(N);var F=s(N,2);{var X=V=>{var re=us(),he=a(re,!0);t(re),u(()=>o(he,e(T))),l(V,re)};v(F,V=>{e(T)&&V(X)})}t(se);var le=s(se,2);{var U=V=>{var re=fs(),he=a(re);{var Re=p=>{var w=gs(),M=a(w);At(M,20,()=>Array(4),It,($,De,ue)=>{var je=_s();u(()=>Xe(je,`height: ${4+ue*2}px; background: ${(ue<e(Q).bars?e(Q).color:"var(--bg-hover)")??""}; opacity: ${ue<e(Q).bars?1:.4};`)),l($,je)}),t(M);var I=s(M,2),Y=a(I);t(I),t(w),u(()=>{Xe(I,`color: ${e(Q).color??""}`),o(Y,`${n.liveReading.rssi??""}dBm`)}),l(p,w)};v(he,p=>{e(Q)&&p(Re)})}var C=s(he,2);{var d=p=>{var w=ps(),M=a(w),I=s(a(M)),Y=s(I);t(M);var $=s(M,2),De=a($);{var ue=ge=>{var qe=jt();u(Be=>o(qe,`${Be??""}%`),[()=>e(L).toFixed(0)]),l(ge,qe)},je=ge=>{var qe=xe(),Be=O(qe);{var ze=c=>{var x=jt();u(ne=>o(x,`${ne??""}V`),[()=>e(r).toFixed(2)]),l(c,x)};v(Be,c=>{e(r)!=null&&c(ze)},!0)}l(ge,qe)};v(De,ge=>{e(L)!=null?ge(ue):ge(je,!1)})}t($),t(w),u(()=>{lt(M,"stroke",e(W)),lt(I,"width",(e(L)??50)*.14),lt(I,"fill",e(W)),lt(Y,"fill",e(W)),Xe($,`color: ${e(W)??""}`)}),l(p,w)};v(C,p=>{e(m)&&p(d)})}t(re),l(V,re)};v(le,V=>{(e(Q)||e(m))&&V(U)})}u(()=>o(g,` ${e(h)??""}`)),l(y,z)},G=y=>{var z=hs(),se=a(z),N=s(a(se));t(se),Te(2),t(z),u(()=>o(N,` ${n.batch.device_id??""}`)),l(y,z)};v(D,y=>{n.liveReading?y(E):y(G,!1)})}t(b),l(ae,b)},J=ae=>{var b=xs(),D=s(a(b),2);{var E=G=>{var y=ys();y.__click=function(...z){n.onEdit?.apply(this,z)},l(G,y)};v(D,G=>{n.onEdit&&G(E)})}t(b),l(ae,b)};v(B,ae=>{n.batch.device_id?ae(ce):ae(J,!1)})}l(te,de)},$$slots:{default:!0}}),zt()}Bt(["click"]);const ws=131.25;var ks=i('<span class="yeast-producer svelte-19u9n31"> </span>'),zs=i('<span class="yeast-temp svelte-19u9n31"> </span>'),Fs=i('<div class="yeast-row recipe svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Recipe</span> <span class="yeast-value muted svelte-19u9n31"> </span></div>'),Cs=i('<div class="yeast-row actual svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span> <!> <!></div> <!>',1),Rs=i('<div class="yeast-row svelte-19u9n31"><span class="yeast-label svelte-19u9n31">Yeast</span> <span class="yeast-value svelte-19u9n31"> </span></div>'),qs=i('<div class="yeast-section svelte-19u9n31"><!></div>'),Ms=i('<div class="targets-row svelte-19u9n31"><div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">OG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">FG</span> <span class="target-value svelte-19u9n31"> </span></div> <div class="target svelte-19u9n31"><span class="target-label svelte-19u9n31">ABV</span> <span class="target-value svelte-19u9n31"> </span></div></div> <!>',1);function Ss(me,n){kt(n,!0);function q(T){return T==null?"--":St(T)}let Q=H(()=>n.recipe.abv!=null?n.recipe.abv:n.recipe.og&&n.recipe.fg?(n.recipe.og-n.recipe.fg)*ws:null);wt(me,{title:"Recipe Targets",compact:!0,children:(T,m)=>{var L=Ms(),r=O(L),W=a(r),h=s(a(W),2),te=a(h,!0);t(h),t(W);var _e=s(W,2),de=s(a(_e),2),B=a(de,!0);t(de),t(_e);var ce=s(_e,2),J=s(a(ce),2),ae=a(J,!0);t(J),t(ce),t(r);var b=s(r,2);{var D=E=>{var G=qs(),y=a(G);{var z=N=>{var g=Cs(),F=O(g),X=s(a(F),2),le=a(X,!0);t(X);var U=s(X,2);{var V=d=>{var p=ks(),w=a(p);t(p),u(()=>o(w,`(${n.yeastStrain.producer??""})`)),l(d,p)};v(U,d=>{n.yeastStrain.producer&&d(V)})}var re=s(U,2);{var he=d=>{var p=zs(),w=a(p);t(p),u((M,I)=>o(w,`${M??""}-${I??""}¬∞C`),[()=>n.yeastStrain.temp_low.toFixed(0),()=>n.yeastStrain.temp_high.toFixed(0)]),l(d,p)};v(re,d=>{n.yeastStrain.temp_low&&n.yeastStrain.temp_high&&d(he)})}t(F);var Re=s(F,2);{var C=d=>{var p=Fs(),w=s(a(p),2),M=a(w,!0);t(w),t(p),u(()=>o(M,n.recipe.yeast_name)),l(d,p)};v(Re,d=>{n.recipe.yeast_name&&d(C)})}u(()=>o(le,n.yeastStrain.name)),l(N,g)},se=N=>{var g=xe(),F=O(g);{var X=le=>{var U=Rs(),V=s(a(U),2),re=a(V,!0);t(V),t(U),u(()=>o(re,n.recipe.yeast_name)),l(le,U)};v(F,le=>{n.recipe.yeast_name&&le(X)},!0)}l(N,g)};v(y,N=>{n.yeastStrain?N(z):N(se,!1)})}t(G),l(E,G)};v(b,E=>{(n.yeastStrain||n.recipe.yeast_name)&&E(D)})}u((E,G,y)=>{o(te,E),o(B,G),o(ae,y)},[()=>q(n.recipe.og),()=>q(n.recipe.fg),()=>e(Q)!=null?`${e(Q).toFixed(1)}%`:"--"]),l(T,L)},$$slots:{default:!0}}),zt()}var Bs=i('<p class="notes-content svelte-hkv31i"> </p>');function Ts(me,n){wt(me,{title:"Notes",children:(q,Q)=>{var T=Bs(),m=a(T,!0);t(T),u(()=>o(m,n.notes)),l(q,T)},$$slots:{default:!0}})}var Ds=i('<div class="ml-panel loading svelte-1xs394q"><p>Loading predictions...</p></div>'),As=i('<div class="ml-panel error svelte-1xs394q"><p class="error-text svelte-1xs394q"> </p></div>'),Ps=i("<option> </option>"),Os=i('<span class="anomaly-reasons svelte-1xs394q"> </span>'),Ls=i('<div class="anomaly-banner svelte-1xs394q"><span class="anomaly-icon svelte-1xs394q">‚ö†Ô∏è</span> <div class="anomaly-content svelte-1xs394q"><span class="anomaly-label svelte-1xs394q">Anomaly Detected</span> <!></div></div>'),Es=i('<span class="activity-badge svelte-1xs394q"> </span>'),Gs=i('<div class="progress-section svelte-1xs394q"><div class="progress-header svelte-1xs394q"><span class="progress-label svelte-1xs394q">Fermentation Progress</span> <!></div> <div class="fermentation-progress-bar svelte-1xs394q"><div class="fermentation-fill svelte-1xs394q"></div></div> <div class="progress-labels svelte-1xs394q"><span class="og-label svelte-1xs394q"> </span> <span class="progress-percent svelte-1xs394q"> </span> <span class="fg-label svelte-1xs394q"> </span></div></div>'),Ns=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Predicted FG:</span> <span class="value svelte-1xs394q"> </span></div>'),Us=i('<div class="metric svelte-1xs394q"><span class="label svelte-1xs394q">Attenuation:</span> <span class="value attenuation svelte-1xs394q"> </span></div>'),Is=i('<span class="complete-now svelte-1xs394q">Ready now!</span>'),Hs=i('<span class="days svelte-1xs394q"> </span>'),Vs=i(" <!>",1),Ws=i('<div class="metric completion-metric svelte-1xs394q"><span class="label svelte-1xs394q">Est. Completion:</span> <span class="value svelte-1xs394q"><!></span></div>'),Js=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Model:</span> <span class="model-value model-type svelte-1xs394q"> </span></div>'),Ys=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Fit:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Zs=i('<div class="model-metric svelte-1xs394q"><span class="model-label svelte-1xs394q">Points:</span> <span class="model-value svelte-1xs394q"> </span></div>'),Ks=i('<div><div class="panel-header svelte-1xs394q"><h3 class="panel-title svelte-1xs394q">Fermentation Intelligence</h3> <div class="header-controls svelte-1xs394q"><select class="model-select svelte-1xs394q" title="Select prediction model"></select> <button type="button" class="reload-btn svelte-1xs394q" title="Recalculate predictions from database history"> </button></div></div> <!> <!> <div class="metrics svelte-1xs394q"><!> <!> <!> <div class="model-info svelte-1xs394q"><!> <!> <!></div></div></div>'),Qs=i('<div class="ml-panel disabled svelte-1xs394q"><div class="disabled-header svelte-1xs394q"><p class="unavailable-text svelte-1xs394q">ML predictions unavailable</p> <button type="button" class="reload-btn svelte-1xs394q" title="Reload predictions from database"> </button></div> <p class="unavailable-hint svelte-1xs394q"><!></p></div>');function Xs(me,n){kt(n,!0);let q=bt(n,"measuredOg",3,null),Q=bt(n,"currentSg",3,null),T=bt(n,"liveReading",3,null),m=fe(Ut({available:!1})),L=fe(!0),r=fe(!1),W=fe(null),h=fe("auto");const te=[{value:"auto",label:"Auto (Best Fit)"},{value:"exponential",label:"Exponential"},{value:"gompertz",label:"Gompertz (S-Curve)"},{value:"logistic",label:"Logistic"}];async function _e(){_(L,!0),_(W,null);try{_(m,await Ua(n.batchId,e(h)),!0)}catch(g){_(W,g instanceof Error?g.message:"Failed to load predictions",!0),console.error("Failed to load ML predictions:",g)}finally{_(L,!1)}}async function de(){_(r,!0),_(W,null);try{const g=await Na(n.batchId);console.log("Reloaded predictions:",g.message),await _e()}catch(g){_(W,g instanceof Error?g.message:"Failed to reload predictions",!0),console.error("Failed to reload predictions:",g)}finally{_(r,!1)}}function B(){_e()}oa(de);function ce(g){return g?new Date(g).toLocaleDateString("en-AU",{month:"short",day:"numeric",year:"numeric"}):"N/A"}function J(g){if(!g)return null;const F=new Date(g),X=new Date,le=F.getTime()-X.getTime();return Math.ceil(le/(1e3*60*60*24))}let ae=H(()=>{const g=q()??e(m).predicted_og,F=e(m).predicted_fg,X=Q()??T()?.sg;if(!g||!F||!X||g<=F)return null;const le=g-F,V=(g-X)/le*100;return Math.min(100,Math.max(0,V))}),b=H(()=>{const g=q()??e(m).predicted_og,F=Q()??T()?.sg;if(!g||!F||g<=1)return null;const X=(g-F)/(g-1)*100;return Math.min(100,Math.max(0,X))}),D=H(()=>{const g=T()?.sg_rate;if(g==null)return null;const F=Math.abs(g);return F>.002?{label:"Very Active",color:"#22c55e",emoji:"üî•"}:F>5e-4?{label:"Active",color:"#84cc16",emoji:"‚ú®"}:F>1e-4?{label:"Slowing",color:"#eab308",emoji:"üê¢"}:{label:"Complete",color:"#6b7280",emoji:"‚úì"}}),E=H(()=>T()?.is_anomaly??!1),G=H(()=>T()?.anomaly_reasons??[]);var y=xe(),z=O(y);{var se=g=>{var F=Ds();l(g,F)},N=g=>{var F=xe(),X=O(F);{var le=V=>{var re=As(),he=a(re),Re=a(he);t(he),t(re),u(()=>o(Re,`‚ö†Ô∏è ${e(W)??""}`)),l(V,re)},U=V=>{var re=xe(),he=O(re);{var Re=d=>{var p=Ks();let w;var M=a(p),I=s(a(M),2),Y=a(I);Y.__change=B,At(Y,21,()=>te,It,(R,k)=>{var A=Ps(),oe=a(A,!0);t(A);var Me={};u(()=>{o(oe,e(k).label),Me!==(Me=e(k).value)&&(A.value=(A.__value=e(k).value)??"")}),l(R,A)}),t(Y);var $=s(Y,2);$.__click=de;var De=a($,!0);t($),t(I),t(M);var ue=s(M,2);{var je=R=>{var k=Ls(),A=s(a(k),2),oe=s(a(A),2);{var Me=Ne=>{var We=Os(),Pe=a(We,!0);t(We),u(Ve=>o(Pe,Ve),[()=>e(G).join(", ")]),l(Ne,We)};v(oe,Ne=>{e(G).length>0&&Ne(Me)})}t(A),t(k),l(R,k)};v(ue,R=>{e(E)&&R(je)})}var ge=s(ue,2);{var qe=R=>{var k=Gs(),A=a(k),oe=s(a(A),2);{var Me=at=>{var it=Es(),Ct=a(it);t(it),u(()=>{Xe(it,`color: ${e(D).color??""}`),o(Ct,`${e(D).emoji??""} ${e(D).label??""}`)}),l(at,it)};v(oe,at=>{e(D)&&at(Me)})}t(A);var Ne=s(A,2),We=a(Ne);t(Ne);var Pe=s(Ne,2),Ve=a(Pe),_t=a(Ve);t(Ve);var tt=s(Ve,2),Ft=a(tt);t(tt);var Je=s(tt,2),gt=a(Je);t(Je),t(Pe),t(k),u((at,it,Ct)=>{Xe(We,`width: ${e(ae)??""}%`),o(_t,`OG: ${at??""}`),o(Ft,`${it??""}%`),o(gt,`FG: ${Ct??""}`)},[()=>St(q()??e(m).predicted_og??0),()=>e(ae).toFixed(0),()=>St(e(m).predicted_fg??0)]),l(R,k)};v(ge,R=>{e(ae)!==null&&R(qe)})}var Be=s(ge,2),ze=a(Be);{var c=R=>{var k=Ns(),A=s(a(k),2),oe=a(A,!0);t(A),t(k),u(Me=>o(oe,Me),[()=>St(e(m).predicted_fg)]),l(R,k)};v(ze,R=>{e(m).predicted_fg&&R(c)})}var x=s(ze,2);{var ne=R=>{var k=Us(),A=s(a(k),2),oe=a(A);t(A),t(k),u(Me=>o(oe,`${Me??""}%`),[()=>e(b).toFixed(1)]),l(R,k)};v(x,R=>{e(b)!==null&&R(ne)})}var S=s(x,2);{var Ae=R=>{const k=H(()=>J(e(m).estimated_completion));var A=Ws(),oe=s(a(A),2),Me=a(oe);{var Ne=Pe=>{var Ve=Is();l(Pe,Ve)},We=Pe=>{var Ve=Vs(),_t=O(Ve),tt=s(_t);{var Ft=Je=>{var gt=Hs(),at=a(gt);t(gt),u(()=>o(at,`(${e(k)??""} ${e(k)===1?"day":"days"})`)),l(Je,gt)};v(tt,Je=>{e(k)!==null&&Je(Ft)})}u(Je=>o(_t,`${Je??""} `),[()=>ce(e(m).estimated_completion)]),l(Pe,Ve)};v(Me,Pe=>{e(k)!==null&&e(k)<=0?Pe(Ne):Pe(We,!1)})}t(oe),t(A),l(R,A)};v(S,R=>{e(m).estimated_completion&&R(Ae)})}var ee=s(S,2),ie=a(ee);{var ve=R=>{var k=Js(),A=s(a(k),2),oe=a(A,!0);t(A),t(k),u(()=>o(oe,e(m).model_type)),l(R,k)};v(ie,R=>{e(m).model_type&&R(ve)})}var Fe=s(ie,2);{var et=R=>{var k=Ys(),A=s(a(k),2),oe=a(A);t(A),t(k),u(Me=>o(oe,`${Me??""}%`),[()=>(e(m).r_squared*100).toFixed(0)]),l(R,k)};v(Fe,R=>{e(m).r_squared!==void 0&&R(et)})}var $e=s(Fe,2);{var nt=R=>{var k=Zs(),A=s(a(k),2),oe=a(A,!0);t(A),t(k),u(()=>o(oe,e(m).num_readings)),l(R,k)};v($e,R=>{e(m).num_readings&&R(nt)})}t(ee),t(Be),t(p),u(()=>{w=He(p,1,"ml-panel svelte-1xs394q",null,w,{"has-anomaly":e(E)}),Y.disabled=e(L)||e(r),$.disabled=e(r)||e(L),o(De,e(r)?"Reloading...":"‚Üª")}),Da(Y,()=>e(h),R=>_(h,R)),l(d,p)},C=d=>{var p=Qs(),w=a(p),M=s(a(w),2);M.__click=de;var I=a(M,!0);t(M),t(w);var Y=s(w,2),$=a(Y);{var De=je=>{var ge=jt("Waiting for fermentation to progress (need visible SG drop)");l(je,ge)},ue=je=>{var ge=xe(),qe=O(ge);{var Be=c=>{var x=jt("Need more fermentation curve data for reliable prediction");l(c,x)},ze=c=>{var x=xe(),ne=O(x);{var S=ee=>{var ie=jt("Need at least 10 readings to make predictions");l(ee,ie)},Ae=ee=>{var ie=jt("Predictions will appear once fermentation is underway");l(ee,ie)};v(ne,ee=>{e(m).reason==="insufficient_data"?ee(S):ee(Ae,!1)},!0)}l(c,x)};v(qe,c=>{e(m).reason==="insufficient_curve_data"?c(Be):c(ze,!1)},!0)}l(je,ge)};v($,je=>{e(m).reason==="insufficient_fermentation_progress"?je(De):je(ue,!1)})}t(Y),t(p),u(()=>{M.disabled=e(r)||e(L),o(I,e(r)?"Reloading...":"‚Üª Reload")}),l(d,p)};v(he,d=>{e(m).available?d(Re):d(C,!1)},!0)}l(V,re)};v(X,V=>{e(W)?V(le):V(U,!1)},!0)}l(g,F)};v(z,g=>{e(L)?g(se):g(N,!1)})}l(me,y),zt()}Bt(["change","click"]);var $s=i('<div class="loading svelte-1hws0u6">Loading alerts...</div>'),er=i('<div class="error-banner svelte-1hws0u6"><span> </span> <button type="button" class="dismiss-error svelte-1hws0u6">√ó</button></div>'),tr=i('<button type="button" class="dismiss-all-btn svelte-1hws0u6"> </button>'),ar=i('<span class="spinner svelte-1hws0u6"></span>'),sr=Nt('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="svelte-1hws0u6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>'),rr=i('<div class="alert-item svelte-1hws0u6"><div class="alert-icon svelte-1hws0u6"> </div> <div class="alert-content svelte-1hws0u6"><div class="alert-header svelte-1hws0u6"><span class="alert-type svelte-1hws0u6"> </span> <span class="severity-badge svelte-1hws0u6"> </span></div> <p class="alert-message svelte-1hws0u6"> </p> <div class="alert-meta svelte-1hws0u6"><span class="alert-time svelte-1hws0u6"> </span> <span class="alert-separator svelte-1hws0u6">¬∑</span> <span class="alert-time svelte-1hws0u6"> </span></div></div> <button type="button" class="dismiss-btn svelte-1hws0u6" title="Dismiss alert"><!></button></div>'),lr=i('<!> <div class="alerts-header svelte-1hws0u6"><span class="alert-count svelte-1hws0u6"> </span> <!></div> <div class="alerts-list svelte-1hws0u6"></div>',1);function nr(me,n){kt(n,!0);let q=fe(Ut([])),Q=fe(!0),T=fe(null),m=fe(null),L=fe(!1);qa(()=>{r()});async function r(){try{_(Q,!0),_(T,null),_(q,await Ia(n.batchId,!1),!0)}catch(b){_(T,b instanceof Error?b.message:"Failed to load alerts",!0)}finally{_(Q,!1)}}async function W(b){try{_(m,b,!0),await Ha(n.batchId,b),_(q,e(q).filter(D=>D.id!==b),!0)}catch(D){_(T,D instanceof Error?D.message:"Failed to dismiss alert",!0)}finally{_(m,null)}}async function h(){try{_(L,!0),await Va(n.batchId),_(q,[],!0)}catch(b){_(T,b instanceof Error?b.message:"Failed to dismiss alerts",!0)}finally{_(L,!1)}}function te(b){switch(b){case"critical":return"var(--negative)";case"warning":return"#f59e0b";case"info":return"var(--accent)";default:return"var(--text-muted)"}}function _e(b){switch(b){case"stall":return"‚è∏";case"temperature_high":return"üî•";case"temperature_low":return"‚ùÑ";case"anomaly":return"‚ö†";default:return"‚ö†"}}function de(b){const D=new Date(b),G=new Date().getTime()-D.getTime(),y=Math.floor(G/6e4),z=Math.floor(y/60),se=Math.floor(z/24);return se>0?`${se}d ago`:z>0?`${z}h ago`:y>0?`${y}m ago`:"just now"}var B=xe(),ce=O(B);{var J=b=>{wt(b,{title:"Alerts",icon:"üîî",children:(D,E)=>{var G=$s();l(D,G)},$$slots:{default:!0}})},ae=b=>{var D=xe(),E=O(D);{var G=z=>{},y=z=>{wt(z,{title:"Active Alerts",icon:"üîî",highlight:!0,children:(se,N)=>{var g=lr(),F=O(g);{var X=C=>{var d=er(),p=a(d),w=a(p,!0);t(p);var M=s(p,2);M.__click=()=>_(T,null),t(d),u(()=>o(w,e(T))),l(C,d)};v(F,C=>{e(T)&&C(X)})}var le=s(F,2),U=a(le),V=a(U);t(U);var re=s(U,2);{var he=C=>{var d=tr();d.__click=h;var p=a(d,!0);t(d),u(()=>{d.disabled=e(L),o(p,e(L)?"Dismissing...":"Dismiss All")}),l(C,d)};v(re,C=>{e(q).length>1&&C(he)})}t(le);var Re=s(le,2);At(Re,21,()=>e(q),C=>C.id,(C,d)=>{var p=rr(),w=a(p),M=a(w,!0);t(w);var I=s(w,2),Y=a(I),$=a(Y),De=a($,!0);t($);var ue=s($,2),je=a(ue,!0);t(ue),t(Y);var ge=s(Y,2),qe=a(ge,!0);t(ge);var Be=s(ge,2),ze=a(Be),c=a(ze);t(ze);var x=s(ze,4),ne=a(x);t(x),t(Be),t(I);var S=s(I,2);S.__click=()=>W(e(d).id);var Ae=a(S);{var ee=ve=>{var Fe=ar();l(ve,Fe)},ie=ve=>{var Fe=sr();l(ve,Fe)};v(Ae,ve=>{e(m)===e(d).id?ve(ee):ve(ie,!1)})}t(S),t(p),u((ve,Fe,et,$e,nt,R,k,A)=>{Xe(p,`--severity-color: ${ve??""}`),o(M,Fe),o(De,et),Xe(ue,`background: ${$e??""}`),o(je,e(d).severity),o(qe,e(d).message),lt(ze,"title",`First detected: ${nt??""}`),o(c,`First: ${R??""}`),lt(x,"title",`Last seen: ${k??""}`),o(ne,`Last: ${A??""}`),S.disabled=e(m)===e(d).id},[()=>te(e(d).severity),()=>_e(e(d).alert_type),()=>e(d).alert_type.replace("_"," "),()=>te(e(d).severity),()=>new Date(e(d).first_detected_at).toLocaleString(),()=>de(e(d).first_detected_at),()=>new Date(e(d).last_seen_at).toLocaleString(),()=>de(e(d).last_seen_at)]),l(C,p)}),t(Re),u(()=>o(V,`${e(q).length??""} active`)),l(se,g)},$$slots:{default:!0}})};v(E,z=>{e(q).length===0?z(G):z(y,!1)},!0)}l(b,D)};v(ce,b=>{e(Q)?b(J):b(ae,!1)})}l(me,B),zt()}Bt(["click"]);var ir=i('<div class="loading-state svelte-g5au2j"><div class="spinner svelte-g5au2j"></div> <span class="svelte-g5au2j">Loading batch...</span></div>'),vr=i('<div class="error-state svelte-g5au2j"><span class="error-icon svelte-g5au2j">!</span> <p class="svelte-g5au2j"> </p> <button type="button" class="retry-btn svelte-g5au2j">Retry</button></div>'),or=i('<div class="error-state svelte-g5au2j"><p class="svelte-g5au2j">Batch not found</p></div>'),dr=i('<span class="recipe-type svelte-g5au2j"> </span>'),cr=i('<a class="recipe-link svelte-g5au2j"> <!></a>'),ur=i('<div class="batch-timing svelte-g5au2j"> </div>'),_r=i('<div class="batch-timing svelte-g5au2j"> </div>'),gr=i('<option class="svelte-g5au2j"> </option>'),pr=Nt('<svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" class="svelte-g5au2j"></path><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> Resume',1),fr=Nt('<svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> Pause',1),mr=i('<button type="button"><!></button>'),hr=i('<span class="chilling-icon svelte-g5au2j">üç∫</span> <h3 class="chilling-title svelte-g5au2j">Ready to Pitch!</h3>',1),br=i('<span class="chilling-icon svelte-g5au2j">‚ùÑÔ∏è</span> <h3 class="chilling-title svelte-g5au2j">Chilling to Pitch Temperature</h3>',1),yr=i('<div class="progress-section svelte-g5au2j"><div class="progress-bar svelte-g5au2j"><div class="progress-fill svelte-g5au2j"></div></div> <span class="progress-text svelte-g5au2j"> </span></div>'),xr=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è No cooler configured - set a cooler entity to enable automated chilling</span>'),jr=i('<span class="status-warning svelte-g5au2j">‚ö†Ô∏è Temperature control disabled in settings</span>'),wr=i('<span class="status-ready svelte-g5au2j">Wort has reached pitch temperature - ready to add yeast!</span>'),kr=i('<span class="status-active svelte-g5au2j">Cooler will run automatically when temp exceeds target + hysteresis</span>'),zr=i('<div><div class="chilling-header svelte-g5au2j"><!></div> <div class="chilling-content svelte-g5au2j"><div class="temp-display svelte-g5au2j"><div class="temp-current svelte-g5au2j"><span class="temp-label svelte-g5au2j">Current</span> <span class="temp-value svelte-g5au2j"> </span></div> <div class="temp-arrow svelte-g5au2j">‚Üí</div> <div class="temp-target svelte-g5au2j"><span class="temp-label svelte-g5au2j">Target</span> <span class="temp-value svelte-g5au2j"> </span></div></div> <!> <div class="chilling-status svelte-g5au2j"><!></div></div></div>'),Fr=i(`<div class="paused-banner svelte-g5au2j"><div class="paused-header svelte-g5au2j"><svg class="paused-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" class="svelte-g5au2j"></path></svg> <h3 class="paused-title svelte-g5au2j">Readings Paused</h3></div> <p class="paused-text svelte-g5au2j">Hydrometer readings are not being stored. Live readings still display but won't be saved to the fermentation history.</p> <button type="button" class="resume-btn svelte-g5au2j"> </button></div>`),Cr=i('<span class="status-badge heater svelte-g5au2j">üî• Heating</span>'),Rr=i('<span class="status-badge cooler svelte-g5au2j">‚ùÑÔ∏è Cooling</span>'),qr=i('<span class="status-badge idle svelte-g5au2j"> </span>'),Mr=i('<div class="device-status heater svelte-g5au2j"><div>üî•</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Heater</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Sr=i('<div class="device-status cooler svelte-g5au2j"><div>‚ùÑÔ∏è</div> <div class="device-info svelte-g5au2j"><span class="device-label svelte-g5au2j">Cooler</span> <span> </span> <span class="device-entity svelte-g5au2j"> </span></div></div>'),Br=i('<div class="override-banner svelte-g5au2j"><span class="override-icon svelte-g5au2j">‚ö°</span> <span class="svelte-g5au2j"> </span> <button type="button" class="override-cancel-inline svelte-g5au2j">Cancel</button></div>'),Tr=i('<button type="button" class="override-btn heat-on svelte-g5au2j">Force Heat ON</button> <button type="button" class="override-btn heat-off svelte-g5au2j">Force Heat OFF</button>',1),Dr=i('<button type="button" class="override-btn cool-on svelte-g5au2j">Force Cool ON</button> <button type="button" class="override-btn cool-off svelte-g5au2j">Force Cool OFF</button>',1),Ar=i('<div class="control-details svelte-g5au2j"><div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Target</span> <span class="detail-value svelte-g5au2j"> </span></div> <div class="control-detail svelte-g5au2j"><span class="detail-label svelte-g5au2j">Hysteresis</span> <span class="detail-value svelte-g5au2j"> </span></div></div> <!> <div class="override-controls svelte-g5au2j"><span class="override-label svelte-g5au2j">Manual Override (1hr)</span> <div class="override-btns-grid svelte-g5au2j"><!> <!> <button type="button" class="override-btn auto-mode svelte-g5au2j">Auto Mode</button></div></div>',1),Pr=i('<div class="device-status-grid svelte-g5au2j"><!> <!></div> <!>',1),Or=i('<div><button type="button" class="collapsible-header svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="collapse-indicator svelte-g5au2j"><!> <svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" class="svelte-g5au2j"></path></svg></div></button> <!></div>'),Lr=i('<span class="svelte-g5au2j"> </span>'),Er=i('<span class="svelte-g5au2j"> </span>'),Gr=i('<div class="info-card svelte-g5au2j"><h3 class="info-title svelte-g5au2j">Temperature Control</h3> <div class="no-device svelte-g5au2j"><!> <!> <span class="hint svelte-g5au2j">Active only during fermentation</span></div></div>'),Nr=i('<div class="chart-section svelte-g5au2j"><!></div>'),Ur=i('<div class="batch-header svelte-g5au2j"><div class="header-main svelte-g5au2j"><div class="batch-number svelte-g5au2j"> </div> <div class="header-info svelte-g5au2j"><h1 class="batch-name svelte-g5au2j"> </h1> <!> <!></div></div> <div class="header-actions svelte-g5au2j"><div class="status-selector svelte-g5au2j"><select class="status-select svelte-g5au2j"></select></div> <!> <button type="button" class="edit-btn svelte-g5au2j"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" class="svelte-g5au2j"></path></svg> Edit</button> <button type="button" class="delete-btn svelte-g5au2j" aria-label="Delete batch"><svg class="btn-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" class="svelte-g5au2j"></path></svg></button></div></div> <!> <!> <div class="content-grid svelte-g5au2j"><div class="stats-section svelte-g5au2j"><!> <!></div> <div class="info-section svelte-g5au2j"><!> <!> <!> <!> <!></div></div> <!>',1),Ir=i('<div class="modal-overlay svelte-g5au2j"><div class="modal svelte-g5au2j"><h2 class="modal-title svelte-g5au2j">Delete Batch?</h2> <p class="modal-text svelte-g5au2j"> </p> <div class="modal-actions svelte-g5au2j"><button type="button" class="modal-btn cancel svelte-g5au2j">Cancel</button> <button type="button" class="modal-btn delete svelte-g5au2j"> </button></div></div></div>'),Hr=i('<div class="page-container svelte-g5au2j"><div class="back-link svelte-g5au2j"><a href="/batches" class="back-btn svelte-g5au2j"><svg class="back-icon svelte-g5au2j" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" class="svelte-g5au2j"></path></svg> Back to Batches</a></div> <!></div> <!>',1);function cl(me,n){kt(n,!0);const q=()=>La(Ea,"$page",Q),[Q,T]=Oa();let m=null,L=null,r=fe(null),W=fe(null),h=fe(null),te=Ut([]),_e=fe(!0),de=fe(null),B=fe(!1),ce=fe(!1),J=fe(!1),ae=fe(!1),b=fe(!1),D=fe(!1),E=fe(!1),G=H(()=>parseInt(q().params.id??"0"));const y={planning:{label:"Planning",color:"var(--text-secondary)",bg:"var(--bg-elevated)"},fermenting:{label:"Fermenting",color:"#f59e0b",bg:"rgba(245, 158, 11, 0.12)"},conditioning:{label:"Conditioning",color:"#8b5cf6",bg:"rgba(139, 92, 246, 0.12)"},completed:{label:"Completed",color:"var(--positive)",bg:"rgba(34, 197, 94, 0.12)"},archived:{label:"Archived",color:"var(--text-muted)",bg:"var(--bg-elevated)"}},z=["planning","fermenting","conditioning","completed","archived"];let se=H(()=>e(r)?y[e(r).status]:y.planning),N=H(ca),g=H(()=>Dt.config.ha_enabled&&Dt.config.temp_control_enabled&&(e(r)?.heater_entity_id||e(r)?.cooler_entity_id)),F=H(()=>e(r)?.status==="planning"&&e(r)?.temp_target!=null),X=H(()=>!e(F)||!e(U)?.temp||!e(r)?.temp_target?!1:e(U).temp<=e(r).temp_target),le=H(()=>{if(!e(F)||!e(U)?.temp||!e(r)?.temp_target)return null;const c=e(r).temp_target+30,x=e(U).temp,ne=e(r).temp_target;if(x<=ne)return 100;if(x>=c)return 0;const S=(c-x)/(c-ne)*100;return Math.min(100,Math.max(0,S))}),U=H(()=>{if(!e(r)?.device_id)return null;const c=va.tilts.get(e(r).device_id);if(c)return c;const x=e(r).device_id.match(/^(?:tilt-)?(\w+)$/i);if(!x?.[1])return null;const ne=x[1].toUpperCase();for(const S of va.tilts.values())if(S.color&&S.color.toUpperCase()===ne)return S;return null});async function V(){_(_e,!0),_(de,null);try{if(_(r,await Wa(e(G)),!0),e(r).status==="fermenting"||e(r).status==="conditioning")try{_(W,await ia(e(G)),!0)}catch{}if(e(r).heater_entity_id||e(r).cooler_entity_id)try{_(h,await Tt(e(G)),!0)}catch{}}catch(c){_(de,c instanceof Error?c.message:"Failed to load batch",!0)}finally{_(_e,!1)}}async function re(c){if(!(!e(r)||e(ce))&&!(c==="conditioning"&&e(r).status==="fermenting"&&!confirm(`üí° Entering Conditioning Phase

Reminder: Adjust target temperature if cold crashing.
Temperature control will continue during conditioning.

Continue?`))){_(ce,!0);try{_(r,await Et(e(r).id,{status:c}),!0),(c==="fermenting"||c==="conditioning")&&_(W,await ia(e(r).id),!0)}catch(x){console.error("Failed to update status:",x)}finally{_(ce,!1)}}}async function he(c){if(e(r)&&(_(r,await Et(e(r).id,c),!0),_(B,!1),e(r).heater_entity_id||e(r).cooler_entity_id))try{_(h,await Tt(e(r).id),!0)}catch{}}async function Re(){if(e(r)){_(b,!0);try{await Ja(e(r).id),Ga("/batches")}catch(c){_(de,c instanceof Error?c.message:"Failed to delete batch",!0),_(b,!1),_(ae,!1)}}}async function C(){if(!(!e(r)||e(E))){_(E,!0);try{_(r,await Et(e(r).id,{readings_paused:!e(r).readings_paused}),!0)}catch(c){console.error("Failed to toggle pause:",c)}finally{_(E,!1)}}}async function d(c,x){if(!(!e(r)||e(J))){_(J,!0);try{await Gt(e(r).id,x,60,c),_(h,await Tt(e(r).id),!0)}catch(ne){console.error("Failed to set override:",ne)}finally{_(J,!1)}}}async function p(){if(!(!e(r)||e(J))){_(J,!0);try{e(r).heater_entity_id&&await Gt(e(r).id,null,60,"heater"),e(r).cooler_entity_id&&await Gt(e(r).id,null,60,"cooler"),_(h,await Tt(e(r).id),!0)}catch(c){console.error("Failed to clear overrides:",c)}finally{_(J,!1)}}}function w(){if(m?.readyState===WebSocket.OPEN)return;const x=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws`;m=new WebSocket(x),m.onmessage=async ne=>{try{const S=JSON.parse(ne.data);S.type==="control_event"&&S.batch_id===e(G)&&e(h)&&(S.action==="heat_on"?_(h,{...e(h),heater_state:"on"},!0):S.action==="heat_off"?_(h,{...e(h),heater_state:"off"},!0):S.action==="cool_on"?_(h,{...e(h),cooler_state:"on"},!0):S.action==="cool_off"&&_(h,{...e(h),cooler_state:"off"},!0))}catch{}},m.onclose=()=>{m=null,L=setTimeout(w,3e3)},m.onerror=()=>{m?.close()}}function M(){L&&(clearTimeout(L),L=null),m?.close(),m=null}function I(c){return c==null?"--":da(c)}function Y(c){return c?new Date(c).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"--"}function $(c){if(!c)return"--";const x=new Date(c),S=(new Date().getTime()-x.getTime())/(1e3*60*60);if(S<1)return`${Math.round(S*60)}m`;if(S<24)return`${S.toFixed(1)}h`;const Ae=S/24;return Ae<7?`${Ae.toFixed(1)}d`:`${Math.round(Ae)}d`}oa(()=>{V(),w()}),Ma(()=>{M()});var De=Hr();Ta("g5au2j",c=>{Sa(()=>{Ba.title=`${(e(r)?.name||"Batch")??""} | BrewSignal`})});var ue=O(De),je=s(a(ue),2);{var ge=c=>{var x=ir();l(c,x)},qe=c=>{var x=xe(),ne=O(x);{var S=ee=>{var ie=vr(),ve=s(a(ie),2),Fe=a(ve,!0);t(ve);var et=s(ve,2);et.__click=V,t(ie),u(()=>o(Fe,e(de))),l(ee,ie)},Ae=ee=>{var ie=xe(),ve=O(ie);{var Fe=$e=>{var nt=or();l($e,nt)},et=$e=>{var nt=xe(),R=O(nt);{var k=oe=>{Ya(oe,{get batch(){return e(r)},onSubmit:he,onCancel:()=>_(B,!1)})},A=oe=>{var Me=Ur(),Ne=O(Me),We=a(Ne),Pe=a(We),Ve=a(Pe);t(Pe);var _t=s(Pe,2),tt=a(_t),Ft=a(tt,!0);t(tt);var Je=s(tt,2);{var gt=f=>{var j=cr(),Z=a(j),pe=s(Z);{var be=Ce=>{var ke=dr(),Oe=a(ke);t(ke),u(()=>o(Oe,`(${e(r).recipe.type??""})`)),l(Ce,ke)};v(pe,Ce=>{e(r).recipe.type&&Ce(be)})}t(j),u(()=>{lt(j,"href",`/recipes/${e(r).recipe.id??""}`),o(Z,`${e(r).recipe.name??""} `)}),l(f,j)};v(Je,f=>{e(r).recipe&&f(gt)})}var at=s(Je,2);{var it=f=>{var j=ur(),Z=a(j);t(j),u((pe,be)=>o(Z,`Started ${pe??""} ¬∑ ${be??""} ago`),[()=>Y(e(r).start_time),()=>$(e(r).start_time)]),l(f,j)},Ct=f=>{var j=xe(),Z=O(j);{var pe=be=>{var Ce=_r(),ke=a(Ce);t(Ce),u(Oe=>o(ke,`Brewed ${Oe??""}`),[()=>Y(e(r).brew_date)]),l(be,Ce)};v(Z,be=>{e(r).brew_date&&be(pe)},!0)}l(f,j)};v(at,f=>{e(r).start_time?f(it):f(Ct,!1)})}t(_t),t(We);var Ht=s(We,2),Pt=a(Ht),st=a(Pt);st.__change=f=>re(f.currentTarget.value),At(st,21,()=>z,It,(f,j)=>{var Z=gr(),pe=a(Z,!0);t(Z);var be={};u(()=>{o(pe,y[e(j)].label),be!==(be=e(j))&&(Z.value=(Z.__value=e(j))??"")}),l(f,Z)}),t(st);var Vt;Aa(st),t(Pt);var Wt=s(Pt,2);{var _a=f=>{var j=mr();let Z;j.__click=C;var pe=a(j);{var be=ke=>{var Oe=pr();Te(),l(ke,Oe)},Ce=ke=>{var Oe=fr();Te(),l(ke,Oe)};v(pe,ke=>{e(r).readings_paused?ke(be):ke(Ce,!1)})}t(j),u(()=>{Z=He(j,1,"pause-btn svelte-g5au2j",null,Z,{paused:e(r).readings_paused}),j.disabled=e(E),lt(j,"title",e(r).readings_paused?"Resume storing readings":"Pause storing readings")}),l(f,j)};v(Wt,f=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(_a)})}var Jt=s(Wt,2);Jt.__click=()=>_(B,!0);var ga=s(Jt,2);ga.__click=()=>_(ae,!0),t(Ht),t(Ne);var Yt=s(Ne,2);{var pa=f=>{var j=zr();let Z;var pe=a(j),be=a(pe);{var Ce=P=>{var K=hr();Te(2),l(P,K)},ke=P=>{var K=br();Te(2),l(P,K)};v(be,P=>{e(X)?P(Ce):P(ke,!1)})}t(pe);var Oe=s(pe,2),pt=a(Oe),vt=a(pt),yt=s(a(vt),2),Ye=a(yt,!0);t(yt),t(vt);var ye=s(vt,4),Ge=s(a(ye),2),ft=a(Ge,!0);t(Ge),t(ye),t(pt);var mt=s(pt,2);{var Rt=P=>{var K=yr(),Se=a(K),Le=a(Se);t(Se);var Ue=s(Se,2),we=a(Ue);t(Ue),t(K),u(Ee=>{Xe(Le,`width: ${e(le)??""}%`),o(we,`${Ee??""}% to target`)},[()=>Math.round(e(le))]),l(P,K)};v(mt,P=>{e(le)!=null&&!e(X)&&P(Rt)})}var Ze=s(mt,2),ot=a(Ze);{var qt=P=>{var K=xr();l(P,K)},Mt=P=>{var K=xe(),Se=O(K);{var Le=we=>{var Ee=jr();l(we,Ee)},Ue=we=>{var Ee=xe(),dt=O(Ee);{var rt=ut=>{var xt=wr();l(ut,xt)},ct=ut=>{var xt=kr();l(ut,xt)};v(dt,ut=>{e(X)?ut(rt):ut(ct,!1)},!0)}l(we,Ee)};v(Se,we=>{!Dt.config.ha_enabled||!Dt.config.temp_control_enabled?we(Le):we(Ue,!1)},!0)}l(P,K)};v(ot,P=>{e(r).cooler_entity_id?P(Mt,!1):P(qt)})}t(Ze),t(Oe),t(j),u((P,K)=>{Z=He(j,1,"chilling-banner svelte-g5au2j",null,Z,{ready:e(X)}),o(Ye,P),o(ft,K)},[()=>e(U)?.temp!=null?I(e(U).temp):"--",()=>e(r).temp_target!=null?I(e(r).temp_target):"--"]),l(f,j)};v(Yt,f=>{e(F)&&f(pa)})}var Zt=s(Yt,2);{var fa=f=>{var j=Fr(),Z=s(a(j),4);Z.__click=C;var pe=a(Z,!0);t(Z),t(j),u(()=>{Z.disabled=e(E),o(pe,e(E)?"Resuming...":"Resume Readings")}),l(f,j)};v(Zt,f=>{e(r).readings_paused&&(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(fa)})}var Ot=s(Zt,2),Lt=a(Ot),Kt=a(Lt);{let f=H(()=>e(U)?.sg??e(W)?.measured?.current_sg);cs(Kt,{get batch(){return e(r)},get currentSg(){return e(f)},get progress(){return e(W)},get liveReading(){return e(U)}})}var ma=s(Kt,2);{var ha=f=>{Ss(f,{get recipe(){return e(r).recipe},get yeastStrain(){return e(r).yeast_strain}})};v(ma,f=>{e(r).recipe&&f(ha)})}t(Lt);var Qt=s(Lt,2),Xt=a(Qt);js(Xt,{get batch(){return e(r)},get liveReading(){return e(U)},onEdit:()=>_(B,!0)});var $t=s(Xt,2);{var ba=f=>{nr(f,{get batchId(){return e(r).id}})};v($t,f=>{(e(r).status==="fermenting"||e(r).status==="conditioning")&&f(ba)})}var ea=s($t,2);{let f=H(()=>e(U)?.sg);Xs(ea,{get batchId(){return e(r).id},get measuredOg(){return e(r).measured_og},get currentSg(){return e(f)},get liveReading(){return e(U)}})}var ta=s(ea,2);{var ya=f=>{var j=Or();let Z;var pe=a(j);pe.__click=()=>_(D,!e(D));var be=s(a(pe),2),Ce=a(be);{var ke=ye=>{var Ge=Cr();l(ye,Ge)},Oe=ye=>{var Ge=xe(),ft=O(Ge);{var mt=Ze=>{var ot=Rr();l(Ze,ot)},Rt=Ze=>{var ot=xe(),qt=O(ot);{var Mt=P=>{var K=qr(),Se=a(K);t(K),u(Le=>o(Se,`üéØ ${Le??""}${e(N)??""}`),[()=>I(e(h).target_temp)]),l(P,K)};v(qt,P=>{e(D)&&e(h)&&P(Mt)},!0)}l(Ze,ot)};v(ft,Ze=>{e(h)?.cooler_state==="on"?Ze(mt):Ze(Rt,!1)},!0)}l(ye,Ge)};v(Ce,ye=>{e(h)?.heater_state==="on"?ye(ke):ye(Oe,!1)})}var pt=s(Ce,2);let vt;t(be),t(pe);var yt=s(pe,2);{var Ye=ye=>{var Ge=Pr(),ft=O(Ge),mt=a(ft);{var Rt=P=>{var K=Mr(),Se=a(K);let Le;var Ue=s(Se,2),we=s(a(Ue),2);let Ee;var dt=a(we,!0);t(we);var rt=s(we,2),ct=a(rt,!0);t(rt),t(Ue),t(K),u(()=>{Le=He(Se,1,"device-icon-wrap svelte-g5au2j",null,Le,{active:e(h)?.heater_state==="on"}),Ee=He(we,1,"device-state svelte-g5au2j",null,Ee,{on:e(h)?.heater_state==="on"}),o(dt,e(h)?.heater_state==="on"?"ON":"OFF"),o(ct,e(r).heater_entity_id)}),l(P,K)};v(mt,P=>{e(r).heater_entity_id&&P(Rt)})}var Ze=s(mt,2);{var ot=P=>{var K=Sr(),Se=a(K);let Le;var Ue=s(Se,2),we=s(a(Ue),2);let Ee;var dt=a(we,!0);t(we);var rt=s(we,2),ct=a(rt,!0);t(rt),t(Ue),t(K),u(()=>{Le=He(Se,1,"device-icon-wrap svelte-g5au2j",null,Le,{active:e(h)?.cooler_state==="on"}),Ee=He(we,1,"device-state svelte-g5au2j",null,Ee,{on:e(h)?.cooler_state==="on"}),o(dt,e(h)?.cooler_state==="on"?"ON":"OFF"),o(ct,e(r).cooler_entity_id)}),l(P,K)};v(Ze,P=>{e(r).cooler_entity_id&&P(ot)})}t(ft);var qt=s(ft,2);{var Mt=P=>{var K=Ar(),Se=O(K),Le=a(Se),Ue=s(a(Le),2),we=a(Ue);t(Ue),t(Le);var Ee=s(Le,2),dt=s(a(Ee),2),rt=a(dt);t(dt),t(Ee),t(Se);var ct=s(Se,2);{var ut=Ie=>{var Ke=Br(),Qe=s(a(Ke),2),ht=a(Qe);t(Qe);var na=s(Qe,2);na.__click=()=>p(),t(Ke),u(Ra=>{o(ht,`Override active: ${Ra??""}`),na.disabled=e(J)},[()=>e(h).override_state?.toUpperCase()]),l(Ie,Ke)};v(ct,Ie=>{e(h).override_active&&Ie(ut)})}var xt=s(ct,2),aa=s(a(xt),2),sa=a(aa);{var Fa=Ie=>{var Ke=Tr(),Qe=O(Ke);Qe.__click=()=>d("heater","on");var ht=s(Qe,2);ht.__click=()=>d("heater","off"),u(()=>{Qe.disabled=e(J),ht.disabled=e(J)}),l(Ie,Ke)};v(sa,Ie=>{e(r).heater_entity_id&&Ie(Fa)})}var ra=s(sa,2);{var Ca=Ie=>{var Ke=Dr(),Qe=O(Ke);Qe.__click=()=>d("cooler","on");var ht=s(Qe,2);ht.__click=()=>d("cooler","off"),u(()=>{Qe.disabled=e(J),ht.disabled=e(J)}),l(Ie,Ke)};v(ra,Ie=>{e(r).cooler_entity_id&&Ie(Ca)})}var la=s(ra,2);la.__click=()=>p(),t(aa),t(xt),u((Ie,Ke)=>{o(we,`${Ie??""}${e(N)??""}`),o(rt,`¬±${Ke??""}${e(N)??""}`),la.disabled=e(J)},[()=>I(e(h).target_temp),()=>e(h).hysteresis?.toFixed(1)||"--"]),l(P,K)};v(qt,P=>{e(h)&&P(Mt)})}l(ye,Ge)};v(yt,ye=>{e(D)||ye(Ye)})}t(j),u(()=>{Z=He(j,1,"info-card temp-control-card svelte-g5au2j",null,Z,{"heater-on":e(h)?.heater_state==="on","cooler-on":e(h)?.cooler_state==="on",collapsed:e(D)}),vt=He(pt,0,"chevron svelte-g5au2j",null,vt,{rotated:!e(D)})}),l(f,j)},xa=f=>{var j=xe(),Z=O(j);{var pe=be=>{var Ce=Gr(),ke=s(a(Ce),2),Oe=a(ke);{var pt=Ye=>{var ye=Lr(),Ge=a(ye);t(ye),u(()=>o(Ge,`Heater: ${e(r).heater_entity_id??""}`)),l(Ye,ye)};v(Oe,Ye=>{e(r).heater_entity_id&&Ye(pt)})}var vt=s(Oe,2);{var yt=Ye=>{var ye=Er(),Ge=a(ye);t(ye),u(()=>o(Ge,`Cooler: ${e(r).cooler_entity_id??""}`)),l(Ye,ye)};v(vt,Ye=>{e(r).cooler_entity_id&&Ye(yt)})}Te(2),t(ke),t(Ce),l(be,Ce)};v(Z,be=>{(e(r).heater_entity_id||e(r).cooler_entity_id)&&e(r).status!=="fermenting"&&be(pe)},!0)}l(f,j)};v(ta,f=>{e(g)&&(e(r).status==="fermenting"||e(r).status==="conditioning")?f(ya):f(xa,!1)})}var ja=s(ta,2);{var wa=f=>{Ts(f,{get notes(){return e(r).notes}})};v(ja,f=>{e(r).notes&&f(wa)})}t(Qt),t(Ot);var ka=s(Ot,2);{var za=f=>{var j=Nr(),Z=a(j);Ka(Z,{get batchId(){return e(r).id},get deviceColor(){return e(r).device_id},get originalGravity(){return e(r).measured_og},get controlEvents(){return te}}),t(j),l(f,j)};v(ka,f=>{e(r).device_id&&f(za)})}u(()=>{o(Ve,`#${(e(r).batch_number||"?")??""}`),o(Ft,e(r).name||e(r).recipe?.name||"Unnamed Batch"),st.disabled=e(ce),Xe(st,`color: ${e(se).color??""}; background: ${e(se).bg??""};`),Vt!==(Vt=e(r).status)&&(st.value=(st.__value=e(r).status)??"",Pa(st,e(r).status))}),l(oe,Me)};v(R,oe=>{e(B)?oe(k):oe(A,!1)},!0)}l($e,nt)};v(ve,$e=>{e(r)?$e(et,!1):$e(Fe)},!0)}l(ee,ie)};v(ne,ee=>{e(de)?ee(S):ee(Ae,!1)},!0)}l(c,x)};v(je,c=>{e(_e)?c(ge):c(qe,!1)})}t(ue);var Be=s(ue,2);{var ze=c=>{var x=Ir();x.__click=()=>_(ae,!1);var ne=a(x);ne.__click=et=>et.stopPropagation();var S=s(a(ne),2),Ae=a(S);t(S);var ee=s(S,2),ie=a(ee);ie.__click=()=>_(ae,!1);var ve=s(ie,2);ve.__click=Re;var Fe=a(ve,!0);t(ve),t(ee),t(ne),t(x),u(()=>{o(Ae,`Are you sure you want to delete "${(e(r)?.name||"this batch")??""}"? This cannot be undone.`),ie.disabled=e(b),ve.disabled=e(b),o(Fe,e(b)?"Deleting...":"Delete Batch")}),l(c,x)};v(Be,c=>{e(ae)&&c(ze)})}l(me,De),zt(),T()}Bt(["click","change"]);export{cl as component,dl as universal};
