import{d as se,f as n,a as o,c as ie,s as _}from"../chunks/BQ88CgEU.js";import{ah as le,ao as m,p as re,ap as ve,aq as oe,c as a,aj as ne,s as v,e as de,ak as l,al as t,am as ce,an as e,ar as Q,as as b,ai as M,at as pe}from"../chunks/CGXqq0_G.js";import{e as ma,i as ba}from"../chunks/payu-7ZH.js";import{i as w}from"../chunks/ziKwUJ4R.js";import{h as fe}from"../chunks/BP8qDDK3.js";import{r as X,s as Ga}from"../chunks/D2zVhfuI.js";import{s as ue}from"../chunks/BSw_pJTS.js";import{b as Y}from"../chunks/CL9D8AtU.js";import{b as _e}from"../chunks/C5J5lxM1.js";import{g as me,c as be}from"../chunks/Dq6yox8V.js";var ge=n('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Devices...</span></div>'),he=n(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Devices Found</h3> <p class="empty-description svelte-36f20v">Pair a device to start calibrating.
				Devices will appear here once paired.</p></div>`),we=n("<option> </option>"),ye=n('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),xe=n('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),ke=n('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ce=n('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Fe=n('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),Ae=n('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Se=n('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Te=n('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),De=n('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),je=n('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Ge=n('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ne=n('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Pe=n('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Re=n(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Device</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°F internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Calibration Works</h3> <p class="info-text svelte-36f20v">Add at least two calibration points for best results. The system uses linear interpolation
				between points to correct readings. For single-point calibration, only an offset is applied.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Tip:</span> <span>For SG, use distilled water (1.000) and a known sugar solution for two-point calibration.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Tip:</span> <span>For temperature, ice water (0Â°C/32Â°F) and room temp make good reference points.</span></div></div></div>`,1),$e=n('<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Calibration</h1> <p class="page-description svelte-36f20v">Fine-tune SG and temperature readings with calibration points</p></div> <!></div>');function Je(Na,Pa){le(Pa,!0);let T=m(re([])),u=m(null),Z=m(null),Ra=m("none"),ga=m(!0),O=m(!1),y=m(!1),N=m(""),P=m(""),R=m(""),$=m(""),L=M(me),aa=M(()=>be.config.temp_units==="C"),ea=M(()=>(a(Z)?.points||[]).sort((s,d)=>s[0]-d[0])),ta=M(()=>(a(Z)?.temp_points||[]).sort((s,d)=>s[0]-d[0])),sa=M(()=>a(T).find(s=>s.id===a(u)));async function $a(){try{const s=await fetch("/api/devices?paired_only=true");s.ok&&(v(T,await s.json(),!0),a(T).length>0&&!a(u)&&v(u,a(T)[0].id,!0))}catch(s){console.error("Failed to load devices:",s)}finally{v(ga,!1)}}async function ia(){if(a(u)){v(O,!0);try{const s=await fetch(`/api/devices/${a(u)}/calibration`);if(s.ok){const d=await s.json();v(Ra,d.calibration_type,!0),v(Z,d.calibration_data,!0)}}catch(s){console.error("Failed to load calibration:",s)}finally{v(O,!1)}}}async function ha(s,d,ra){if(!a(u))return;const U=parseFloat(d),q=parseFloat(ra);if(!(isNaN(U)||isNaN(q))){v(y,!0);try{(await fetch(`/api/devices/${a(u)}/calibration`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:s,raw_value:U,actual_value:q})})).ok&&(s==="sg"?(v(N,""),v(P,"")):(v(R,""),v($,"")),await ia())}catch(g){console.error("Failed to add calibration point:",g)}finally{v(y,!1)}}}async function wa(s){if(a(u)&&confirm(`Clear all ${s==="sg"?"gravity":"temperature"} calibration points?`)){v(y,!0);try{(await fetch(`/api/devices/${a(u)}/calibration/${s}`,{method:"DELETE"})).ok&&await ia()}catch(d){console.error("Failed to clear calibration:",d)}finally{v(y,!1)}}}function ya(s){return s.toFixed(3)}function xa(s){return a(aa)?((s-32)*(5/9)).toFixed(1):s.toFixed(1)}ve(()=>{$a()}),oe(()=>{a(u)&&ia()});var la=$e();fe("36f20v",s=>{de(()=>{ce.title="Calibration | BrewSignal"})});var La=l(t(la),2);{var Va=s=>{var d=ge();o(s,d)},Ba=s=>{var d=ie(),ra=Q(d);{var U=g=>{var I=he();o(g,I)},q=g=>{var I=Re(),va=Q(I),ka=l(t(va),2),Ca=t(ka),J=t(Ca);ma(J,21,()=>a(T),ba,(i,r)=>{var c=we(),x=t(c);e(c);var k={};b(()=>{_(x,`${a(r).color??""} â€” ${a(r).beer_name??""}`),k!==(k=a(r).id)&&(c.value=(c.__value=a(r).id)??"")}),o(i,c)}),e(J);var Ea=l(J,2);{var Ha=i=>{var r=ye(),c=t(r),x=l(c,2),k=t(x,!0);e(x),e(r),b(C=>{ue(c,`background: var(--tilt-${C??""});`),_(k,a(sa).id)},[()=>a(sa).color.toLowerCase()]),o(i,r)};w(Ea,i=>{a(sa)&&i(Ha)})}e(Ca),e(ka),e(va);var Fa=l(va,2),oa=t(Fa),na=t(oa),Ma=l(t(na),2);{var Oa=i=>{var r=xe();r.__click=()=>wa("sg"),b(()=>r.disabled=a(y)),o(i,r)};w(Ma,i=>{a(ea).length>0&&i(Oa)})}e(na);var Aa=l(na,2),Ua=l(t(Aa),2);{var qa=i=>{var r=ke();o(i,r)},Ia=i=>{var r=Se(),c=Q(r);{var x=p=>{var A=Fe(),E=l(t(A),2);ma(E,17,()=>a(ea),ba,(W,f)=>{var h=Ce(),S=t(h),H=t(S,!0);e(S);var z=l(S,4),K=t(z,!0);e(z),e(h),b((pa,fa)=>{_(H,pa),_(K,fa)},[()=>ya(a(f)[0]),()=>ya(a(f)[1])]),o(W,h)}),e(A),o(p,A)},k=p=>{var A=Ae();o(p,A)};w(c,p=>{a(ea).length>0?p(x):p(k,!1)})}var C=l(c,2),V=t(C),F=t(V),D=l(t(F),2);X(D),e(F);var B=l(F,4),j=l(t(B),2);X(j),e(B);var G=l(B,2);G.__click=()=>ha("sg",a(N),a(P)),e(V),e(C),b(()=>G.disabled=a(y)||!a(N)||!a(P)),Y(D,()=>a(N),p=>v(N,p)),Y(j,()=>a(P),p=>v(P,p)),o(i,r)};w(Ua,i=>{a(O)?i(qa):i(Ia,!1)})}e(Aa),e(oa);var Sa=l(oa,2),da=t(Sa),ca=t(da),Ja=t(ca);e(ca);var Wa=l(ca,2);{var za=i=>{var r=Te();r.__click=()=>wa("temp"),b(()=>r.disabled=a(y)),o(i,r)};w(Wa,i=>{a(ta).length>0&&i(za)})}e(da);var Ta=l(da,2),Ka=l(t(Ta),2);{var Qa=i=>{var r=De();o(i,r)},Xa=i=>{var r=Pe(),c=Q(r);{var x=f=>{var h=Ge(),S=t(h),H=t(S),z=t(H);e(H);var K=l(H,4),pa=t(K);e(K),e(S);var fa=l(S,2);ma(fa,17,()=>a(ta),ba,(Ya,Da)=>{var ua=je(),_a=t(ua),Za=t(_a);e(_a);var ja=l(_a,4),ae=t(ja);e(ja),e(ua),b((ee,te)=>{_(Za,`${ee??""}Â°`),_(ae,`${te??""}Â°`)},[()=>xa(a(Da)[0]),()=>xa(a(Da)[1])]),o(Ya,ua)}),e(h),b(()=>{_(z,`Raw (${a(L)??""})`),_(pa,`Actual (${a(L)??""})`)}),o(f,h)},k=f=>{var h=Ne();o(f,h)};w(c,f=>{a(ta).length>0?f(x):f(k,!1)})}var C=l(c,2),V=t(C),F=t(V),D=t(F),B=t(D);e(D);var j=l(D,2);X(j),e(F);var G=l(F,4),p=t(G),A=t(p);e(p);var E=l(p,2);X(E),e(G);var W=l(G,2);W.__click=()=>ha("temp",a(R),a($)),e(V),e(C),b(()=>{_(B,`Raw ${a(L)??""}`),Ga(j,"placeholder",a(aa)?"20.0":"68.0"),_(A,`Actual ${a(L)??""}`),Ga(E,"placeholder",a(aa)?"19.5":"67.5"),W.disabled=a(y)||!a(R)||!a($)}),Y(j,()=>a(R),f=>v(R,f)),Y(E,()=>a($),f=>v($,f)),o(i,r)};w(Ka,i=>{a(O)?i(Qa):i(Xa,!1)})}e(Ta),e(Sa),e(Fa),pe(2),b(()=>_(Ja,`Temperature (${a(L)??""})`)),_e(J,()=>a(u),i=>v(u,i)),o(g,I)};w(ra,g=>{a(T).length===0?g(U):g(q,!1)},!0)}o(s,d)};w(La,s=>{a(ga)?s(Va):s(Ba,!1)})}e(la),o(Na,la),ne()}se(["click"]);export{Je as component};
