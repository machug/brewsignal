import{d as se,f as n,a as r,c as ie,s as _}from"../chunks/BQ88CgEU.js";import{ah as le,ao as m,p as Ga,ap as ve,aq as re,c as a,aj as oe,s as o,e as ne,ak as l,al as s,am as de,an as t,ar as Q,as as b,ai as M,at as ce}from"../chunks/CGXqq0_G.js";import{e as ma,i as ba}from"../chunks/payu-7ZH.js";import{i as w}from"../chunks/ziKwUJ4R.js";import{h as pe}from"../chunks/BP8qDDK3.js";import{r as X,s as Na}from"../chunks/D2zVhfuI.js";import{s as fe}from"../chunks/BSw_pJTS.js";import{b as Y}from"../chunks/CL9D8AtU.js";import{b as ue}from"../chunks/C5J5lxM1.js";import{g as _e,c as me}from"../chunks/Dq6yox8V.js";var be=n('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Devices...</span></div>'),ge=n(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Devices Found</h3> <p class="empty-description svelte-36f20v">Pair a device to start calibrating.
				Devices will appear here once paired.</p></div>`),he=n("<option> </option>"),we=n('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),ye=n('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),xe=n('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),ke=n('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Ce=n('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),Fe=n('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Ae=n('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Se=n('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),Te=n('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),De=n('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),je=n('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ge=n('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Ne=n('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Pe=n(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Device</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°F internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Calibration Works</h3> <p class="info-text svelte-36f20v">Add at least two calibration points for best results. The system uses linear interpolation
				between points to correct readings. For single-point calibration, only an offset is applied.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Tip:</span> <span>For SG, use distilled water (1.000) and a known sugar solution for two-point calibration.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Tip:</span> <span>For temperature, ice water (0Â°C/32Â°F) and room temp make good reference points.</span></div></div></div>`,1),Re=n('<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Calibration</h1> <p class="page-description svelte-36f20v">Fine-tune SG and temperature readings with calibration points</p></div> <!></div>');function Ie(Pa,Ra){le(Ra,!0);let T=m(Ga([])),u=m(null),Z=m(Ga([])),ga=m(!0),O=m(!1),y=m(!1),N=m(""),P=m(""),R=m(""),$=m(""),L=M(_e),aa=M(()=>me.config.temp_units==="C"),ea=M(()=>a(Z).filter(e=>e.type==="sg").sort((e,p)=>e.raw_value-p.raw_value)),ta=M(()=>a(Z).filter(e=>e.type==="temp").sort((e,p)=>e.raw_value-p.raw_value)),sa=M(()=>a(T).find(e=>e.id===a(u)));async function $a(){try{const e=await fetch("/api/devices?paired_only=true");e.ok&&(o(T,await e.json(),!0),a(T).length>0&&!a(u)&&o(u,a(T)[0].id,!0))}catch(e){console.error("Failed to load devices:",e)}finally{o(ga,!1)}}async function ia(){if(a(u)){o(O,!0);try{const e=await fetch(`/api/devices/${a(u)}/calibration`);e.ok&&o(Z,await e.json(),!0)}catch(e){console.error("Failed to load calibration points:",e)}finally{o(O,!1)}}}async function ha(e,p,va){if(!a(u))return;const U=parseFloat(p),q=parseFloat(va);if(!(isNaN(U)||isNaN(q))){o(y,!0);try{(await fetch(`/api/devices/${a(u)}/calibration`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e,raw_value:U,actual_value:q})})).ok&&(e==="sg"?(o(N,""),o(P,"")):(o(R,""),o($,"")),await ia())}catch(g){console.error("Failed to add calibration point:",g)}finally{o(y,!1)}}}async function wa(e){if(a(u)&&confirm(`Clear all ${e==="sg"?"gravity":"temperature"} calibration points?`)){o(y,!0);try{(await fetch(`/api/devices/${a(u)}/calibration/${e}`,{method:"DELETE"})).ok&&await ia()}catch(p){console.error("Failed to clear calibration:",p)}finally{o(y,!1)}}}function ya(e){return e.toFixed(3)}function xa(e){return a(aa)?((e-32)*(5/9)).toFixed(1):e.toFixed(1)}ve(()=>{$a()}),re(()=>{a(u)&&ia()});var la=Re();pe("36f20v",e=>{ne(()=>{de.title="Calibration | BrewSignal"})});var La=l(s(la),2);{var Va=e=>{var p=be();r(e,p)},Ba=e=>{var p=ie(),va=Q(p);{var U=g=>{var I=ge();r(g,I)},q=g=>{var I=Pe(),ra=Q(I),ka=l(s(ra),2),Ca=s(ka),J=s(Ca);ma(J,21,()=>a(T),ba,(i,v)=>{var d=he(),x=s(d);t(d);var k={};b(()=>{_(x,`${a(v).color??""} â€” ${a(v).beer_name??""}`),k!==(k=a(v).id)&&(d.value=(d.__value=a(v).id)??"")}),r(i,d)}),t(J);var Ea=l(J,2);{var Ha=i=>{var v=we(),d=s(v),x=l(d,2),k=s(x,!0);t(x),t(v),b(C=>{fe(d,`background: var(--tilt-${C??""});`),_(k,a(sa).id)},[()=>a(sa).color.toLowerCase()]),r(i,v)};w(Ea,i=>{a(sa)&&i(Ha)})}t(Ca),t(ka),t(ra);var Fa=l(ra,2),oa=s(Fa),na=s(oa),Ma=l(s(na),2);{var Oa=i=>{var v=ye();v.__click=()=>wa("sg"),b(()=>v.disabled=a(y)),r(i,v)};w(Ma,i=>{a(ea).length>0&&i(Oa)})}t(na);var Aa=l(na,2),Ua=l(s(Aa),2);{var qa=i=>{var v=xe();r(i,v)},Ia=i=>{var v=Ae(),d=Q(v);{var x=c=>{var A=Ce(),E=l(s(A),2);ma(E,17,()=>a(ea),ba,(W,f)=>{var h=ke(),S=s(h),H=s(S,!0);t(S);var z=l(S,4),K=s(z,!0);t(z),t(h),b((pa,fa)=>{_(H,pa),_(K,fa)},[()=>ya(a(f).raw_value),()=>ya(a(f).actual_value)]),r(W,h)}),t(A),r(c,A)},k=c=>{var A=Fe();r(c,A)};w(d,c=>{a(ea).length>0?c(x):c(k,!1)})}var C=l(d,2),V=s(C),F=s(V),D=l(s(F),2);X(D),t(F);var B=l(F,4),j=l(s(B),2);X(j),t(B);var G=l(B,2);G.__click=()=>ha("sg",a(N),a(P)),t(V),t(C),b(()=>G.disabled=a(y)||!a(N)||!a(P)),Y(D,()=>a(N),c=>o(N,c)),Y(j,()=>a(P),c=>o(P,c)),r(i,v)};w(Ua,i=>{a(O)?i(qa):i(Ia,!1)})}t(Aa),t(oa);var Sa=l(oa,2),da=s(Sa),ca=s(da),Ja=s(ca);t(ca);var Wa=l(ca,2);{var za=i=>{var v=Se();v.__click=()=>wa("temp"),b(()=>v.disabled=a(y)),r(i,v)};w(Wa,i=>{a(ta).length>0&&i(za)})}t(da);var Ta=l(da,2),Ka=l(s(Ta),2);{var Qa=i=>{var v=Te();r(i,v)},Xa=i=>{var v=Ne(),d=Q(v);{var x=f=>{var h=je(),S=s(h),H=s(S),z=s(H);t(H);var K=l(H,4),pa=s(K);t(K),t(S);var fa=l(S,2);ma(fa,17,()=>a(ta),ba,(Ya,Da)=>{var ua=De(),_a=s(ua),Za=s(_a);t(_a);var ja=l(_a,4),ae=s(ja);t(ja),t(ua),b((ee,te)=>{_(Za,`${ee??""}Â°`),_(ae,`${te??""}Â°`)},[()=>xa(a(Da).raw_value),()=>xa(a(Da).actual_value)]),r(Ya,ua)}),t(h),b(()=>{_(z,`Raw (${a(L)??""})`),_(pa,`Actual (${a(L)??""})`)}),r(f,h)},k=f=>{var h=Ge();r(f,h)};w(d,f=>{a(ta).length>0?f(x):f(k,!1)})}var C=l(d,2),V=s(C),F=s(V),D=s(F),B=s(D);t(D);var j=l(D,2);X(j),t(F);var G=l(F,4),c=s(G),A=s(c);t(c);var E=l(c,2);X(E),t(G);var W=l(G,2);W.__click=()=>ha("temp",a(R),a($)),t(V),t(C),b(()=>{_(B,`Raw ${a(L)??""}`),Na(j,"placeholder",a(aa)?"20.0":"68.0"),_(A,`Actual ${a(L)??""}`),Na(E,"placeholder",a(aa)?"19.5":"67.5"),W.disabled=a(y)||!a(R)||!a($)}),Y(j,()=>a(R),f=>o(R,f)),Y(E,()=>a($),f=>o($,f)),r(i,v)};w(Ka,i=>{a(O)?i(Qa):i(Xa,!1)})}t(Ta),t(Sa),t(Fa),ce(2),b(()=>_(Ja,`Temperature (${a(L)??""})`)),ue(J,()=>a(u),i=>o(u,i)),r(g,I)};w(va,g=>{a(T).length===0?g(U):g(q,!1)},!0)}r(e,p)};w(La,e=>{a(ga)?e(Va):e(Ba,!1)})}t(la),r(Pa,la),oe()}se(["click"]);export{Ie as component};
