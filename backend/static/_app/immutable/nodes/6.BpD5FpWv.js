import{d as oe,f as d,a as o,c as ce,s as g}from"../chunks/LrF3SKCG.js";import{ah as de,aq as y,p as pe,ao as fe,ap as ue,c as a,aj as me,s as v,e as be,ak as r,al as t,am as _e,an as e,at as na,ar as T,ai as O,as as he}from"../chunks/OlDeM-au.js";import{e as ka,i as Da}from"../chunks/C8cJb_ce.js";import{i as G}from"../chunks/BY7INp_b.js";import{h as ge}from"../chunks/C70lBF8F.js";import{r as va,s as Ma}from"../chunks/Brko_7Ag.js";import{s as ye}from"../chunks/C7sKw6Td.js";import{b as oa}from"../chunks/CaQQKXWy.js";import{b as we}from"../chunks/D28421SN.js";import{g as xe,c as Ce}from"../chunks/DCnh5YbF.js";function Ua(_){return(_-32)*(5/9)}function La(_){return _*9/5+32}function Te(_,$,w){return w?[_,$]:[Ua(_),Ua($)]}function Va(_,$,w){return w?[_,$]:[La(_),La($)]}var ke=d('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Devices...</span></div>'),De=d(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Tilt Devices Found</h3> <p class="empty-description svelte-36f20v">Pair a Tilt hydrometer on the Devices page to calibrate it.
				Only Tilt devices appear here (iSpindel/GravityMon calibrate on-device).</p> <a href="/devices" class="btn-primary mt-4 svelte-36f20v">Go to Devices</a></div>`),Fe=d("<option> </option>"),Ge=d('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),Pe=d('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all gravity calibration points">Clear All</button>'),Se=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ae=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Ne=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),$e=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),je=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Re=d('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all temperature calibration points">Clear All</button>'),Me=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ue=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Le=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ve=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Be=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),He=d(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Device</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°C internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Tilt Calibration Works</h3> <p class="info-text svelte-36f20v">Tilt calibration is applied in software to raw BLE readings. Add at least two calibration
				points for accurate linear interpolation. Calibration happens app-side, not on the device.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Gravity:</span> <span>Use distilled water (1.000 SG) and a known sugar solution (1.061 or 1.110 SG) for best results.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Temperature:</span> <span>Rarely needed for Tilts (accurate 38Â°F-98Â°F range). Calibrate only if you notice consistent offsets.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">iSpindel/GravityMon:</span> <span>These devices calibrate on-board via polynomial formulas. Configure calibration through the device's web interface.</span></div></div></div>`,1),Ee=d(`<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Tilt Calibration</h1> <p class="page-description svelte-36f20v">Calibrate your Tilt hydrometer's gravity and temperature readings</p></div> <!></div>`);function Ze(_,$){de($,!0);let w=y(pe([])),f=y(null),x=y(null),Fa=y("none"),Ga=y(!0),Z=y(!1),L=y(!1),q=y(""),I=y(""),J=y(""),W=y(""),z=O(xe),C=O(()=>Ce.config.temp_units==="C"),ca=O(()=>(a(x)?.points||[]).sort((s,n)=>s[0]-n[0])),da=O(()=>(a(x)?.temp_points||[]).sort((s,n)=>s[0]-n[0])),pa=O(()=>a(w).find(s=>s.id===a(f)));async function Ba(){try{const s=await fetch("/api/devices?device_type=tilt&paired_only=true");s.ok&&(v(w,await s.json(),!0),a(w).length>0&&!a(f)&&v(f,a(w)[0].id,!0))}catch(s){console.error("Failed to load devices:",s)}finally{v(Ga,!1)}}async function Ha(){if(a(f)){v(Z,!0);try{const s=await fetch(`/api/devices/${a(f)}/calibration`);if(s.ok){const n=await s.json();v(Fa,n.calibration_type,!0),v(x,n.calibration_data,!0)}}catch(s){console.error("Failed to load calibration:",s)}finally{v(Z,!1)}}}async function aa(s){if(a(f)){v(L,!0);try{const n={calibration_type:"linear",calibration_data:s},c=await fetch(`/api/devices/${a(f)}/calibration`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(c.ok){const p=await c.json();v(Fa,p.calibration_type,!0),v(x,p.calibration_data,!0)}else{const p=await c.json().catch(()=>({detail:"Unknown error"}));alert(`Failed to save calibration: ${p.detail||c.statusText}`)}}catch(n){console.error("Failed to save calibration:",n),alert(`Failed to save calibration: ${n instanceof Error?n.message:"Unknown error"}`)}finally{v(L,!1)}}}async function Ea(s,n){if(!a(f))return;const c=parseFloat(s),p=parseFloat(n);if(isNaN(c)||isNaN(p)){alert("Please enter valid numbers for both raw and actual gravity values");return}if(c<.99||c>1.2||p<.99||p>1.2){alert("Gravity values must be between 0.990 and 1.200");return}const P=a(x)?.points||[];if(P.some(S=>Math.abs(S[0]-c)<.001)){alert("A calibration point with this raw value already exists");return}const k=[...P,[c,p]];await aa({...a(x),points:k}),v(q,""),v(I,"")}async function Oa(s,n){if(!a(f))return;const c=parseFloat(s),p=parseFloat(n);if(isNaN(c)||isNaN(p)){alert("Please enter valid numbers for both raw and actual temperature values");return}const P=a(C)?-10:14,h=a(C)?50:122;if(c<P||c>h||p<P||p>h){const D=a(C)?"Â°C":"Â°F";alert(`Temperature values must be between ${P}${D} and ${h}${D}`);return}const k=a(x)?.temp_points||[],S=a(C)?.1:.18;if(k.some(D=>{const[ta,sa]=Va(D[0],D[1],a(C));return Math.abs(ta-c)<S})){const D=a(C)?"Â°C":"Â°F";alert(`A calibration point with this raw value already exists (within ${S}${D})`);return}const[ea,V]=Te(c,p,a(C)),ma=[...k,[ea,V]];await aa({...a(x),temp_points:ma}),v(J,""),v(W,"")}async function qa(){a(f)&&confirm("Clear all gravity calibration points?")&&await aa({...a(x),points:[]})}async function Ia(){a(f)&&confirm("Clear all temperature calibration points?")&&await aa({...a(x),temp_points:[]})}function Pa(s){return s.toFixed(3)}fe(()=>{Ba()}),ue(()=>{a(f)&&Ha()});var fa=Ee();ge("36f20v",s=>{be(()=>{_e.title="Calibration | BrewSignal"})});var Ja=r(t(fa),2);{var Wa=s=>{var n=ke();o(s,n)},za=s=>{var n=ce(),c=na(n);{var p=h=>{var k=De();o(h,k)},P=h=>{var k=He(),S=na(k),ua=r(t(S),2),ea=t(ua),V=t(ea);ka(V,21,()=>a(w),Da,(i,l)=>{var u=Fe(),A=t(u);e(u);var N={};T(()=>{g(A,`${a(l).color??""} â€” ${a(l).beer_name??""}`),N!==(N=a(l).id)&&(u.value=(u.__value=a(l).id)??"")}),o(i,u)}),e(V);var ma=r(V,2);{var D=i=>{var l=Ge(),u=t(l),A=r(u,2),N=t(A,!0);e(A),e(l),T(j=>{ye(u,`background: var(--tilt-${j??""});`),g(N,a(pa).id)},[()=>a(pa).color.toLowerCase()]),o(i,l)};G(ma,i=>{a(pa)&&i(D)})}e(ea),e(ua),e(S);var ta=r(S,2),sa=t(ta),ba=t(sa),Ka=r(t(ba),2);{var Qa=i=>{var l=Pe();l.__click=()=>qa(),T(()=>l.disabled=a(L)),o(i,l)};G(Ka,i=>{a(ca).length>0&&i(Qa)})}e(ba);var Sa=r(ba,2),Xa=r(t(Sa),2);{var Ya=i=>{var l=Se();o(i,l)},Za=i=>{var l=je(),u=na(l);{var A=m=>{var M=Ne(),X=r(t(M),2);ka(X,17,()=>a(ca),Da,(ia,b)=>{var F=Ae(),U=t(F),Y=t(U,!0);e(U);var ra=r(U,4),la=t(ra,!0);e(ra),e(F),T((ga,ya)=>{g(Y,ga),g(la,ya)},[()=>Pa(a(b)[0]),()=>Pa(a(b)[1])]),o(ia,F)}),e(M),o(m,M)},N=m=>{var M=$e();o(m,M)};G(u,m=>{a(ca).length>0?m(A):m(N,!1)})}var j=r(u,2),K=t(j),R=t(K),B=r(t(R),2);va(B),e(R);var Q=r(R,4),H=r(t(Q),2);va(H),e(Q);var E=r(Q,2);E.__click=()=>Ea(a(q),a(I)),e(K),e(j),T(()=>E.disabled=a(L)||!a(q)||!a(I)),oa(B,()=>a(q),m=>v(q,m)),oa(H,()=>a(I),m=>v(I,m)),o(i,l)};G(Xa,i=>{a(Z)?i(Ya):i(Za,!1)})}e(Sa),e(sa);var Aa=r(sa,2),_a=t(Aa),ha=t(_a),ae=t(ha);e(ha);var ee=r(ha,2);{var te=i=>{var l=Re();l.__click=()=>Ia(),T(()=>l.disabled=a(L)),o(i,l)};G(ee,i=>{a(da).length>0&&i(te)})}e(_a);var Na=r(_a,2),se=r(t(Na),2);{var ie=i=>{var l=Me();o(i,l)},re=i=>{var l=Be(),u=na(l);{var A=b=>{var F=Le(),U=t(F),Y=t(U),ra=t(Y);e(Y);var la=r(Y,4),ga=t(la);e(la),e(U);var ya=r(U,2);ka(ya,17,()=>a(da),Da,(le,$a)=>{const ja=O(()=>{const[Ca,Ta]=Va(a($a)[0],a($a)[1],a(C));return{rawDisplay:Ca,actualDisplay:Ta}});var wa=Ue(),xa=t(wa),ne=t(xa);e(xa);var Ra=r(xa,4),ve=t(Ra);e(Ra),e(wa),T((Ca,Ta)=>{g(ne,`${Ca??""}Â°`),g(ve,`${Ta??""}Â°`)},[()=>a(ja).rawDisplay.toFixed(1),()=>a(ja).actualDisplay.toFixed(1)]),o(le,wa)}),e(F),T(()=>{g(ra,`Raw (${a(z)??""})`),g(ga,`Actual (${a(z)??""})`)}),o(b,F)},N=b=>{var F=Ve();o(b,F)};G(u,b=>{a(da).length>0?b(A):b(N,!1)})}var j=r(u,2),K=t(j),R=t(K),B=t(R),Q=t(B);e(B);var H=r(B,2);va(H),e(R);var E=r(R,4),m=t(E),M=t(m);e(m);var X=r(m,2);va(X),e(E);var ia=r(E,2);ia.__click=()=>Oa(a(J),a(W)),e(K),e(j),T(()=>{g(Q,`Raw ${a(z)??""}`),Ma(H,"placeholder",a(C)?"20.0":"68.0"),g(M,`Actual ${a(z)??""}`),Ma(X,"placeholder",a(C)?"19.5":"67.5"),ia.disabled=a(L)||!a(J)||!a(W)}),oa(H,()=>a(J),b=>v(J,b)),oa(X,()=>a(W),b=>v(W,b)),o(i,l)};G(se,i=>{a(Z)?i(ie):i(re,!1)})}e(Na),e(Aa),e(ta),he(2),T(()=>g(ae,`Temperature (${a(z)??""})`)),we(V,()=>a(f),i=>v(f,i)),o(h,k)};G(c,h=>{a(w).length===0?h(p):h(P,!1)},!0)}o(s,n)};G(Ja,s=>{a(Ga)?s(Wa):s(za,!1)})}e(fa),o(_,fa),me()}oe(["click"]);export{Ze as component};
