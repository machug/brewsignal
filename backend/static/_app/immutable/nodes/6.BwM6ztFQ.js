import{d as ve,f as d,a as v,c as oe,s as g}from"../chunks/LrF3SKCG.js";import{ah as de,aq as y,p as ce,ao as pe,ap as fe,c as a,aj as ue,s as o,e as me,ak as r,al as t,am as _e,an as e,at as ia,ar as x,ai as H,as as be}from"../chunks/OlDeM-au.js";import{e as xa,i as Ta}from"../chunks/C8cJb_ce.js";import{i as k}from"../chunks/BY7INp_b.js";import{h as he}from"../chunks/C70lBF8F.js";import{r as ra,s as $a}from"../chunks/Brko_7Ag.js";import{s as ge}from"../chunks/C7sKw6Td.js";import{b as la}from"../chunks/CaQQKXWy.js";import{b as ye}from"../chunks/D28421SN.js";import{g as we,c as xe}from"../chunks/DCnh5YbF.js";function Ra(h){return(h-32)*(5/9)}function Ua(h){return h*9/5+32}function Te(h,P,w){return w?[h,P]:[Ra(h),Ra(P)]}function Ce(h,P,w){return w?[h,P]:[Ua(h),Ua(P)]}var ke=d('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Devices...</span></div>'),Fe=d(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Tilt Devices Found</h3> <p class="empty-description svelte-36f20v">Pair a Tilt hydrometer on the Devices page to calibrate it.
				Only Tilt devices appear here (iSpindel/GravityMon calibrate on-device).</p> <a href="/devices" class="btn-primary mt-4 svelte-36f20v">Go to Devices</a></div>`),Ge=d("<option> </option>"),Pe=d('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),Se=d('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),De=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ae=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Ne=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),je=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),$e=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Re=d('<button type="button" class="btn-danger-small svelte-36f20v">Clear All</button>'),Ue=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Le=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Me=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ve=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Be=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),He=d(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Device</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°C internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Tilt Calibration Works</h3> <p class="info-text svelte-36f20v">Tilt calibration is applied in software to raw BLE readings. Add at least two calibration
				points for accurate linear interpolation. Calibration happens app-side, not on the device.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Gravity:</span> <span>Use distilled water (1.000 SG) and a known sugar solution (1.061 or 1.110 SG) for best results.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Temperature:</span> <span>Rarely needed for Tilts (accurate 38Â°F-98Â°F range). Calibrate only if you notice consistent offsets.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">iSpindel/GravityMon:</span> <span>These devices calibrate on-board via polynomial formulas. Configure calibration through the device's web interface.</span></div></div></div>`,1),Ee=d(`<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Tilt Calibration</h1> <p class="page-description svelte-36f20v">Calibrate your Tilt hydrometer's gravity and temperature readings</p></div> <!></div>`);function Ze(h,P){de(P,!0);let w=y(ce([])),p=y(null),T=y(null),La=y("none"),Ca=y(!0),Y=y(!1),R=y(!1),E=y(""),O=y(""),q=y(""),I=y(""),J=H(we),S=H(()=>xe.config.temp_units==="C"),na=H(()=>(a(T)?.points||[]).sort((s,n)=>s[0]-n[0])),va=H(()=>(a(T)?.temp_points||[]).sort((s,n)=>s[0]-n[0])),oa=H(()=>a(w).find(s=>s.id===a(p)));async function Ma(){try{const s=await fetch("/api/devices?device_type=tilt&paired_only=true");s.ok&&(o(w,await s.json(),!0),a(w).length>0&&!a(p)&&o(p,a(w)[0].id,!0))}catch(s){console.error("Failed to load devices:",s)}finally{o(Ca,!1)}}async function ka(){if(a(p)){o(Y,!0);try{const s=await fetch(`/api/devices/${a(p)}/calibration`);if(s.ok){const n=await s.json();o(La,n.calibration_type,!0),o(T,n.calibration_data,!0)}}catch(s){console.error("Failed to load calibration:",s)}finally{o(Y,!1)}}}async function Z(s){if(a(p)){o(R,!0);try{const n={calibration_type:"linear",calibration_data:s},c=await fetch(`/api/devices/${a(p)}/calibration`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(c.ok)await ka();else{const m=await c.json().catch(()=>({detail:"Unknown error"}));alert(`Failed to save calibration: ${m.detail||c.statusText}`)}}catch(n){console.error("Failed to save calibration:",n),alert(`Failed to save calibration: ${n instanceof Error?n.message:"Unknown error"}`)}finally{o(R,!1)}}}async function Va(s,n){if(!a(p))return;const c=parseFloat(s),m=parseFloat(n);if(isNaN(c)||isNaN(m))return;if(c<.99||c>1.2||m<.99||m>1.2){alert("Gravity values must be between 0.990 and 1.200");return}const b=[...a(T)?.points||[],[c,m]];await Z({...a(T),points:b}),o(E,""),o(O,"")}async function Ba(s,n){if(!a(p))return;const c=parseFloat(s),m=parseFloat(n);if(isNaN(c)||isNaN(m))return;const U=a(S)?-10:14,b=a(S)?50:122;if(c<U||c>b||m<U||m>b){const D=a(S)?"Â°C":"Â°F";alert(`Temperature values must be between ${U}${D} and ${b}${D}`);return}const[L,W]=Te(c,m,a(S)),aa=[...a(T)?.temp_points||[],[L,W]];await Z({...a(T),temp_points:aa}),o(q,""),o(I,"")}async function Ha(){a(p)&&confirm("Clear all gravity calibration points?")&&await Z({...a(T),points:[]})}async function Ea(){a(p)&&confirm("Clear all temperature calibration points?")&&await Z({...a(T),temp_points:[]})}function Fa(s){return s.toFixed(3)}pe(()=>{Ma()}),fe(()=>{a(p)&&ka()});var da=Ee();he("36f20v",s=>{me(()=>{_e.title="Calibration | BrewSignal"})});var Oa=r(t(da),2);{var qa=s=>{var n=ke();v(s,n)},Ia=s=>{var n=oe(),c=ia(n);{var m=b=>{var L=Fe();v(b,L)},U=b=>{var L=He(),W=ia(L),ca=r(t(W),2),aa=t(ca),D=t(aa);xa(D,21,()=>a(w),Ta,(i,l)=>{var f=Ge(),F=t(f);e(f);var G={};x(()=>{g(F,`${a(l).color??""} â€” ${a(l).beer_name??""}`),G!==(G=a(l).id)&&(f.value=(f.__value=a(l).id)??"")}),v(i,f)}),e(D);var Ja=r(D,2);{var Wa=i=>{var l=Pe(),f=t(l),F=r(f,2),G=t(F,!0);e(F),e(l),x(A=>{ge(f,`background: var(--tilt-${A??""});`),g(G,a(oa).id)},[()=>a(oa).color.toLowerCase()]),v(i,l)};k(Ja,i=>{a(oa)&&i(Wa)})}e(aa),e(ca),e(W);var Ga=r(W,2),pa=t(Ga),fa=t(pa),za=r(t(fa),2);{var Ka=i=>{var l=Se();l.__click=()=>Ha(),x(()=>l.disabled=a(R)),v(i,l)};k(za,i=>{a(na).length>0&&i(Ka)})}e(fa);var Pa=r(fa,2),Qa=r(t(Pa),2);{var Xa=i=>{var l=De();v(i,l)},Ya=i=>{var l=$e(),f=ia(l);{var F=u=>{var j=Ne(),Q=r(t(j),2);xa(Q,17,()=>a(na),Ta,(ea,_)=>{var C=Ae(),$=t(C),X=t($,!0);e($);var ta=r($,4),sa=t(ta,!0);e(ta),e(C),x((_a,ba)=>{g(X,_a),g(sa,ba)},[()=>Fa(a(_)[0]),()=>Fa(a(_)[1])]),v(ea,C)}),e(j),v(u,j)},G=u=>{var j=je();v(u,j)};k(f,u=>{a(na).length>0?u(F):u(G,!1)})}var A=r(f,2),z=t(A),N=t(z),M=r(t(N),2);ra(M),e(N);var K=r(N,4),V=r(t(K),2);ra(V),e(K);var B=r(K,2);B.__click=()=>Va(a(E),a(O)),e(z),e(A),x(()=>B.disabled=a(R)||!a(E)||!a(O)),la(M,()=>a(E),u=>o(E,u)),la(V,()=>a(O),u=>o(O,u)),v(i,l)};k(Qa,i=>{a(Y)?i(Xa):i(Ya,!1)})}e(Pa),e(pa);var Sa=r(pa,2),ua=t(Sa),ma=t(ua),Za=t(ma);e(ma);var ae=r(ma,2);{var ee=i=>{var l=Re();l.__click=()=>Ea(),x(()=>l.disabled=a(R)),v(i,l)};k(ae,i=>{a(va).length>0&&i(ee)})}e(ua);var Da=r(ua,2),te=r(t(Da),2);{var se=i=>{var l=Ue();v(i,l)},ie=i=>{var l=Be(),f=ia(l);{var F=_=>{var C=Me(),$=t(C),X=t($),ta=t(X);e(X);var sa=r(X,4),_a=t(sa);e(sa),e($);var ba=r($,2);xa(ba,17,()=>a(va),Ta,(re,Aa)=>{const Na=H(()=>{const[ya,wa]=Ce(a(Aa)[0],a(Aa)[1],a(S));return{rawDisplay:ya,actualDisplay:wa}});var ha=Le(),ga=t(ha),le=t(ga);e(ga);var ja=r(ga,4),ne=t(ja);e(ja),e(ha),x((ya,wa)=>{g(le,`${ya??""}Â°`),g(ne,`${wa??""}Â°`)},[()=>a(Na).rawDisplay.toFixed(1),()=>a(Na).actualDisplay.toFixed(1)]),v(re,ha)}),e(C),x(()=>{g(ta,`Raw (${a(J)??""})`),g(_a,`Actual (${a(J)??""})`)}),v(_,C)},G=_=>{var C=Ve();v(_,C)};k(f,_=>{a(va).length>0?_(F):_(G,!1)})}var A=r(f,2),z=t(A),N=t(z),M=t(N),K=t(M);e(M);var V=r(M,2);ra(V),e(N);var B=r(N,4),u=t(B),j=t(u);e(u);var Q=r(u,2);ra(Q),e(B);var ea=r(B,2);ea.__click=()=>Ba(a(q),a(I)),e(z),e(A),x(()=>{g(K,`Raw ${a(J)??""}`),$a(V,"placeholder",a(S)?"20.0":"68.0"),g(j,`Actual ${a(J)??""}`),$a(Q,"placeholder",a(S)?"19.5":"67.5"),ea.disabled=a(R)||!a(q)||!a(I)}),la(V,()=>a(q),_=>o(q,_)),la(Q,()=>a(I),_=>o(I,_)),v(i,l)};k(te,i=>{a(Y)?i(se):i(ie,!1)})}e(Da),e(Sa),e(Ga),be(2),x(()=>g(Za,`Temperature (${a(J)??""})`)),ye(D,()=>a(p),i=>o(p,i)),v(b,L)};k(c,b=>{a(w).length===0?b(m):b(U,!1)},!0)}v(s,n)};k(Oa,s=>{a(Ca)?s(qa):s(Ia,!1)})}e(da),v(h,da),ue()}ve(["click"]);export{Ze as component};
