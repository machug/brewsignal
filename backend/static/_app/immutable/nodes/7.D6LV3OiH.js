import{d as ce,f as d,a as v,c as de,s as g}from"../chunks/Bkky6kvZ.js";import{a as pe,s as y,p as fe,o as ue,g as be,A as me,e as r,d as t,ax as _e,h as a,r as e,c as n,f as na,t as T,u as q,n as he}from"../chunks/813s5maz.js";import{e as ka,i as Da}from"../chunks/j9QCVC2i.js";import{i as S}from"../chunks/Bf7HnLem.js";import{h as ge}from"../chunks/BgIwEmqo.js";import{r as oa,s as Ua}from"../chunks/UKAZQVVw.js";import{s as ye}from"../chunks/C7upzuIa.js";import{b as va}from"../chunks/Bjks-vZK.js";import{b as we}from"../chunks/D4jp30Ch.js";import{g as xe,c as Ce}from"../chunks/CbPjToI1.js";function La(_){return(_-32)*(5/9)}function Va(_){return _*9/5+32}function Te(_,$,w){return w?[_,$]:[La(_),La($)]}function Ba(_,$,w){return w?[_,$]:[Va(_),Va($)]}var ke=d('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Devices...</span></div>'),De=d(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Tilt Devices Found</h3> <p class="empty-description svelte-36f20v">Pair a Tilt hydrometer on the Devices page to calibrate it.
				Only Tilt devices appear here (iSpindel/GravityMon calibrate on-device).</p> <a href="/devices" class="btn-primary mt-4 svelte-36f20v">Go to Devices</a></div>`),Fe=d("<option> </option>"),Se=d('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),Ae=d('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all gravity calibration points">Clear All</button>'),Ge=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Pe=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Ne=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),$e=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),je=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Re=d('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all temperature calibration points">Clear All</button>'),Me=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ue=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Le=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ve=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Be=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),He=d(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Device</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°C internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Tilt Calibration Works</h3> <p class="info-text svelte-36f20v">Tilt calibration is applied in software to raw BLE readings. Add at least two calibration
				points for accurate linear interpolation. Calibration happens app-side, not on the device.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Gravity:</span> <span>Use distilled water (1.000 SG) and a known sugar solution (1.061 or 1.110 SG) for best results.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Temperature:</span> <span>Rarely needed for Tilts (accurate 38Â°F-98Â°F range). Calibrate only if you notice consistent offsets.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">iSpindel/GravityMon:</span> <span>These devices calibrate on-board via polynomial formulas. Configure calibration through the device's web interface.</span></div></div></div>`,1),Ee=d(`<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Tilt Calibration</h1> <p class="page-description svelte-36f20v">Calibrate your Tilt hydrometer's gravity and temperature readings</p></div> <!></div>`);function Ze(_,$){pe($,!0);let w=y(fe([])),b=y(null),x=y(null),Fa=y("none"),Sa=y(!0),Z=y(!1),V=y(!1),B=y(""),H=y(""),E=y(""),O=y(""),z=q(xe),C=q(()=>Ce.config.temp_units==="C"),ca=q(()=>(a(x)?.points||[]).toSorted((s,o)=>s[0]-o[0])),da=q(()=>(a(x)?.temp_points||[]).toSorted((s,o)=>s[0]-o[0])),pa=q(()=>a(w).find(s=>s.id===a(b)));async function Ha(){try{const s=await fetch("/api/devices?device_type=tilt&paired_only=true");s.ok&&(n(w,await s.json(),!0),a(w).length>0&&!a(b)&&(n(b,a(w)[0].id,!0),await Aa()))}catch(s){console.error("Failed to load devices:",s)}finally{n(Sa,!1)}}function Ea(){n(B,""),n(H,""),n(E,""),n(O,""),Aa()}async function Aa(){if(a(b)){n(Z,!0);try{const s=await fetch(`/api/devices/${a(b)}/calibration`);if(s.ok){const o=await s.json();n(Fa,o.calibration_type,!0),n(x,o.calibration_data,!0)}}catch(s){console.error("Failed to load calibration:",s)}finally{n(Z,!1)}}}async function aa(s){if(a(b)){n(V,!0);try{const o={calibration_type:"linear",calibration_data:s},c=await fetch(`/api/devices/${a(b)}/calibration`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(c.ok){const p=await c.json();n(Fa,p.calibration_type,!0),n(x,p.calibration_data,!0)}else{const p=await c.json().catch(()=>({detail:"Unknown error"}));alert(`Failed to save calibration: ${p.detail||c.statusText}`)}}catch(o){console.error("Failed to save calibration:",o),alert(`Failed to save calibration: ${o instanceof Error?o.message:"Unknown error"}`)}finally{n(V,!1)}}}async function Oa(s,o){if(!a(b))return;const c=parseFloat(s),p=parseFloat(o);if(isNaN(c)||isNaN(p)){alert("Please enter valid numbers for both raw and actual gravity values");return}if(c<.99||c>1.2||p<.99||p>1.2){alert("Gravity values must be between 0.990 and 1.200");return}const A=a(x)?.points||[];if(A.some(G=>Math.abs(G[0]-c)<.001)){alert("A calibration point with this raw value already exists");return}const k=[...A,[c,p]];await aa({...a(x),points:k}),n(B,""),n(H,"")}async function Ia(s,o){if(!a(b))return;const c=parseFloat(s),p=parseFloat(o);if(isNaN(c)||isNaN(p)){alert("Please enter valid numbers for both raw and actual temperature values");return}const A=a(C)?-10:14,h=a(C)?50:122;if(c<A||c>h||p<A||p>h){const D=a(C)?"Â°C":"Â°F";alert(`Temperature values must be between ${A}${D} and ${h}${D}`);return}const k=a(x)?.temp_points||[],G=a(C)?.1:.18;if(k.some(D=>{const[ta,sa]=Ba(D[0],D[1],a(C));return Math.abs(ta-c)<G})){const D=a(C)?"Â°C":"Â°F";alert(`A calibration point with this raw value already exists (within ${G}${D})`);return}const[ea,j]=Te(c,p,a(C)),ba=[...k,[ea,j]];await aa({...a(x),temp_points:ba}),n(E,""),n(O,"")}async function Ja(){a(b)&&confirm("Clear all gravity calibration points?")&&await aa({...a(x),points:[]})}async function Wa(){a(b)&&confirm("Clear all temperature calibration points?")&&await aa({...a(x),temp_points:[]})}function Ga(s){return s.toFixed(3)}ue(()=>{Ha()});var fa=Ee();ge("36f20v",s=>{me(()=>{_e.title="Calibration | BrewSignal"})});var qa=r(t(fa),2);{var za=s=>{var o=ke();v(s,o)},Ka=s=>{var o=de(),c=na(o);{var p=h=>{var k=De();v(h,k)},A=h=>{var k=He(),G=na(k),ua=r(t(G),2),ea=t(ua),j=t(ea);j.__change=Ea,ka(j,21,()=>a(w),Da,(i,l)=>{var f=Fe(),P=t(f);e(f);var N={};T(()=>{g(P,`${a(l).color??""} â€” ${a(l).beer_name??""}`),N!==(N=a(l).id)&&(f.value=(f.__value=a(l).id)??"")}),v(i,f)}),e(j);var ba=r(j,2);{var D=i=>{var l=Se(),f=t(l),P=r(f,2),N=t(P,!0);e(P),e(l),T(R=>{ye(f,`background: var(--tilt-${R??""});`),g(N,a(pa).id)},[()=>a(pa).color.toLowerCase()]),v(i,l)};S(ba,i=>{a(pa)&&i(D)})}e(ea),e(ua),e(G);var ta=r(G,2),sa=t(ta),ma=t(sa),Qa=r(t(ma),2);{var Xa=i=>{var l=Ae();l.__click=()=>Ja(),T(()=>l.disabled=a(V)),v(i,l)};S(Qa,i=>{a(ca).length>0&&i(Xa)})}e(ma);var Pa=r(ma,2),Ya=r(t(Pa),2);{var Za=i=>{var l=Ge();v(i,l)},ae=i=>{var l=je(),f=na(l);{var P=u=>{var U=Ne(),X=r(t(U),2);ka(X,17,()=>a(ca),Da,(ia,m)=>{var F=Pe(),L=t(F),Y=t(L,!0);e(L);var ra=r(L,4),la=t(ra,!0);e(ra),e(F),T((ga,ya)=>{g(Y,ga),g(la,ya)},[()=>Ga(a(m)[0]),()=>Ga(a(m)[1])]),v(ia,F)}),e(U),v(u,U)},N=u=>{var U=$e();v(u,U)};S(f,u=>{a(ca).length>0?u(P):u(N,!1)})}var R=r(f,2),K=t(R),M=t(K),I=r(t(M),2);oa(I),e(M);var Q=r(M,4),J=r(t(Q),2);oa(J),e(Q);var W=r(Q,2);W.__click=()=>Oa(a(B),a(H)),e(K),e(R),T(()=>W.disabled=a(V)||!a(B)||!a(H)),va(I,()=>a(B),u=>n(B,u)),va(J,()=>a(H),u=>n(H,u)),v(i,l)};S(Ya,i=>{a(Z)?i(Za):i(ae,!1)})}e(Pa),e(sa);var Na=r(sa,2),_a=t(Na),ha=t(_a),ee=t(ha);e(ha);var te=r(ha,2);{var se=i=>{var l=Re();l.__click=()=>Wa(),T(()=>l.disabled=a(V)),v(i,l)};S(te,i=>{a(da).length>0&&i(se)})}e(_a);var $a=r(_a,2),ie=r(t($a),2);{var re=i=>{var l=Me();v(i,l)},le=i=>{var l=Be(),f=na(l);{var P=m=>{var F=Le(),L=t(F),Y=t(L),ra=t(Y);e(Y);var la=r(Y,4),ga=t(la);e(la),e(L);var ya=r(L,2);ka(ya,17,()=>a(da),Da,(ne,ja)=>{const Ra=q(()=>{const[Ca,Ta]=Ba(a(ja)[0],a(ja)[1],a(C));return{rawDisplay:Ca,actualDisplay:Ta}});var wa=Ue(),xa=t(wa),oe=t(xa);e(xa);var Ma=r(xa,4),ve=t(Ma);e(Ma),e(wa),T((Ca,Ta)=>{g(oe,`${Ca??""}Â°`),g(ve,`${Ta??""}Â°`)},[()=>a(Ra).rawDisplay.toFixed(1),()=>a(Ra).actualDisplay.toFixed(1)]),v(ne,wa)}),e(F),T(()=>{g(ra,`Raw (${a(z)??""})`),g(ga,`Actual (${a(z)??""})`)}),v(m,F)},N=m=>{var F=Ve();v(m,F)};S(f,m=>{a(da).length>0?m(P):m(N,!1)})}var R=r(f,2),K=t(R),M=t(K),I=t(M),Q=t(I);e(I);var J=r(I,2);oa(J),e(M);var W=r(M,4),u=t(W),U=t(u);e(u);var X=r(u,2);oa(X),e(W);var ia=r(W,2);ia.__click=()=>Ia(a(E),a(O)),e(K),e(R),T(()=>{g(Q,`Raw ${a(z)??""}`),Ua(J,"placeholder",a(C)?"20.0":"68.0"),g(U,`Actual ${a(z)??""}`),Ua(X,"placeholder",a(C)?"19.5":"67.5"),ia.disabled=a(V)||!a(E)||!a(O)}),va(J,()=>a(E),m=>n(E,m)),va(X,()=>a(O),m=>n(O,m)),v(i,l)};S(ie,i=>{a(Z)?i(re):i(le,!1)})}e($a),e(Na),e(ta),he(2),T(()=>g(ee,`Temperature (${a(z)??""})`)),we(j,()=>a(b),i=>n(b,i)),v(h,k)};S(c,h=>{a(w).length===0?h(p):h(A,!1)},!0)}v(s,o)};S(qa,s=>{a(Sa)?s(za):s(Ka,!1)})}e(fa),v(_,fa),be()}ce(["change","click"]);export{Ze as component};
