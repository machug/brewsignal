import{d as ce,f as c,a as v,c as de,s as y}from"../chunks/orbuQWWI.js";import{a as pe,s as w,p as fe,o as ue,g as me,A as be,e as r,d as t,ax as _e,h as a,r as e,c as n,f as na,t as D,u as q,n as he}from"../chunks/pAodAtlG.js";import{e as ka,i as Da}from"../chunks/0whDC7Rl.js";import{i as S}from"../chunks/ucc1DXe2.js";import{h as ge}from"../chunks/DJBMpqSf.js";import{r as oa,s as Ua}from"../chunks/CYuZshLQ.js";import{s as ye}from"../chunks/C-5oeV0L.js";import{b as va}from"../chunks/Dh5hCwq1.js";import{b as we}from"../chunks/RboyDiSx.js";import{g as xe,c as Ce}from"../chunks/C54DtTUy.js";function La(g){return(g-32)*(5/9)}function Va(g){return g*9/5+32}function Te(g,$,x){return x?[g,$]:[La(g),La($)]}function Ba(g,$,x){return x?[g,$]:[Va(g),Va($)]}var ke=c('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Devices...</span></div>'),De=c(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Tilt Devices Found</h3> <p class="empty-description svelte-36f20v">Pair a Tilt hydrometer on the Devices page to calibrate it.
				Only Tilt devices appear here (iSpindel/GravityMon calibrate on-device).</p> <a href="/devices" class="btn-primary mt-4 svelte-36f20v">Go to Devices</a></div>`),Fe=c("<option> </option>"),Pe=c('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),Se=c('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all gravity calibration points">Clear All</button>'),Ae=c('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ge=c('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Ne=c('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),$e=c('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),je=c('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Re=c('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all temperature calibration points">Clear All</button>'),Me=c('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ue=c('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Le=c('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ve=c('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Be=c('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),He=c(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Device</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°C internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Tilt Calibration Works</h3> <p class="info-text svelte-36f20v">Tilt calibration is applied in software to raw BLE readings. Add at least two calibration
				points for accurate linear interpolation. Calibration happens app-side, not on the device.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Gravity:</span> <span>Use distilled water (1.000 SG) and a known sugar solution (1.061 or 1.110 SG) for best results.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Temperature:</span> <span>Rarely needed for Tilts (accurate 38Â°F-98Â°F range). Calibrate only if you notice consistent offsets.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">iSpindel/GravityMon:</span> <span>These devices calibrate on-board via polynomial formulas. Configure calibration through the device's web interface.</span></div></div></div>`,1),Ee=c(`<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Tilt Calibration</h1> <p class="page-description svelte-36f20v">Calibrate your Tilt hydrometer's gravity and temperature readings</p></div> <!></div>`);function Ze(g,$){pe($,!0);let x=w(fe([])),_=w(null),C=w(null),Fa=w("none"),Pa=w(!0),Z=w(!1),V=w(!1),B=w(""),H=w(""),E=w(""),O=w(""),z=q(xe),T=q(()=>Ce.config.temp_units==="C"),ca=q(()=>(a(C)?.points||[]).toSorted((s,o)=>s[0]-o[0])),da=q(()=>(a(C)?.temp_points||[]).toSorted((s,o)=>s[0]-o[0])),pa=q(()=>a(x).find(s=>s.id===a(_)));async function Ha(){try{const s=await fetch("/api/devices?device_type=tilt&paired_only=true");s.ok&&(n(x,await s.json(),!0),a(x).length>0&&!a(_)&&(n(_,a(x)[0].id,!0),await Sa()))}catch(s){console.error("Failed to load devices:",s)}finally{n(Pa,!1)}}function Ea(){n(B,""),n(H,""),n(E,""),n(O,""),Sa()}async function Sa(){if(a(_)){n(Z,!0);try{const s=await fetch(`/api/devices/${a(_)}/calibration`);if(s.ok){const o=await s.json();n(Fa,o.calibration_type,!0),n(C,o.calibration_data,!0)}}catch(s){console.error("Failed to load calibration:",s)}finally{n(Z,!1)}}}async function aa(s){if(a(_)){n(V,!0);try{const o=(s.points?.length??0)>0,p=(s.temp_points?.length??0)>0,f=o||p?"linear":"none",k={calibration_type:f,calibration_data:f==="none"?null:s},d=await fetch(`/api/devices/${a(_)}/calibration`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(d.ok){const u=await d.json();n(Fa,u.calibration_type,!0),n(C,u.calibration_data,!0)}else{const u=await d.json().catch(()=>({detail:"Unknown error"}));alert(`Failed to save calibration: ${u.detail||d.statusText}`)}}catch(o){console.error("Failed to save calibration:",o),alert(`Failed to save calibration: ${o instanceof Error?o.message:"Unknown error"}`)}finally{n(V,!1)}}}async function Oa(s,o){if(!a(_))return;const p=parseFloat(s),f=parseFloat(o);if(isNaN(p)||isNaN(f)){alert("Please enter valid numbers for both raw and actual gravity values");return}if(p<.99||p>1.2||f<.99||f>1.2){alert("Gravity values must be between 0.990 and 1.200");return}const k=a(C)?.points||[];if(k.some(A=>Math.abs(A[0]-p)<.001)){alert("A calibration point with this raw value already exists");return}const u=[...k,[p,f]];await aa({...a(C),points:u}),n(B,""),n(H,"")}async function Ia(s,o){if(!a(_))return;const p=parseFloat(s),f=parseFloat(o);if(isNaN(p)||isNaN(f)){alert("Please enter valid numbers for both raw and actual temperature values");return}const k=a(T)?-10:14,d=a(T)?50:122;if(p<k||p>d||f<k||f>d){const F=a(T)?"Â°C":"Â°F";alert(`Temperature values must be between ${k}${F} and ${d}${F}`);return}const u=a(C)?.temp_points||[],A=a(T)?.1:.18;if(u.some(F=>{const[ta,sa]=Ba(F[0],F[1],a(T));return Math.abs(ta-p)<A})){const F=a(T)?"Â°C":"Â°F";alert(`A calibration point with this raw value already exists (within ${A}${F})`);return}const[ea,j]=Te(p,f,a(T)),ma=[...u,[ea,j]];await aa({...a(C),temp_points:ma}),n(E,""),n(O,"")}async function Ja(){a(_)&&confirm("Clear all gravity calibration points?")&&await aa({...a(C),points:[]})}async function Wa(){a(_)&&confirm("Clear all temperature calibration points?")&&await aa({...a(C),temp_points:[]})}function Aa(s){return s.toFixed(3)}ue(()=>{Ha()});var fa=Ee();ge("36f20v",s=>{be(()=>{_e.title="Calibration | BrewSignal"})});var qa=r(t(fa),2);{var za=s=>{var o=ke();v(s,o)},Ka=s=>{var o=de(),p=na(o);{var f=d=>{var u=De();v(d,u)},k=d=>{var u=He(),A=na(u),ua=r(t(A),2),ea=t(ua),j=t(ea);j.__change=Ea,ka(j,21,()=>a(x),Da,(i,l)=>{var m=Fe(),G=t(m);e(m);var N={};D(()=>{y(G,`${a(l).color??""} â€” ${a(l).beer_name??""}`),N!==(N=a(l).id)&&(m.value=(m.__value=a(l).id)??"")}),v(i,m)}),e(j);var ma=r(j,2);{var F=i=>{var l=Pe(),m=t(l),G=r(m,2),N=t(G,!0);e(G),e(l),D(R=>{ye(m,`background: var(--tilt-${R??""});`),y(N,a(pa).id)},[()=>a(pa).color.toLowerCase()]),v(i,l)};S(ma,i=>{a(pa)&&i(F)})}e(ea),e(ua),e(A);var ta=r(A,2),sa=t(ta),ba=t(sa),Qa=r(t(ba),2);{var Xa=i=>{var l=Se();l.__click=()=>Ja(),D(()=>l.disabled=a(V)),v(i,l)};S(Qa,i=>{a(ca).length>0&&i(Xa)})}e(ba);var Ga=r(ba,2),Ya=r(t(Ga),2);{var Za=i=>{var l=Ae();v(i,l)},ae=i=>{var l=je(),m=na(l);{var G=b=>{var U=Ne(),X=r(t(U),2);ka(X,17,()=>a(ca),Da,(ia,h)=>{var P=Ge(),L=t(P),Y=t(L,!0);e(L);var ra=r(L,4),la=t(ra,!0);e(ra),e(P),D((ga,ya)=>{y(Y,ga),y(la,ya)},[()=>Aa(a(h)[0]),()=>Aa(a(h)[1])]),v(ia,P)}),e(U),v(b,U)},N=b=>{var U=$e();v(b,U)};S(m,b=>{a(ca).length>0?b(G):b(N,!1)})}var R=r(m,2),K=t(R),M=t(K),I=r(t(M),2);oa(I),e(M);var Q=r(M,4),J=r(t(Q),2);oa(J),e(Q);var W=r(Q,2);W.__click=()=>Oa(a(B),a(H)),e(K),e(R),D(()=>W.disabled=a(V)||!a(B)||!a(H)),va(I,()=>a(B),b=>n(B,b)),va(J,()=>a(H),b=>n(H,b)),v(i,l)};S(Ya,i=>{a(Z)?i(Za):i(ae,!1)})}e(Ga),e(sa);var Na=r(sa,2),_a=t(Na),ha=t(_a),ee=t(ha);e(ha);var te=r(ha,2);{var se=i=>{var l=Re();l.__click=()=>Wa(),D(()=>l.disabled=a(V)),v(i,l)};S(te,i=>{a(da).length>0&&i(se)})}e(_a);var $a=r(_a,2),ie=r(t($a),2);{var re=i=>{var l=Me();v(i,l)},le=i=>{var l=Be(),m=na(l);{var G=h=>{var P=Le(),L=t(P),Y=t(L),ra=t(Y);e(Y);var la=r(Y,4),ga=t(la);e(la),e(L);var ya=r(L,2);ka(ya,17,()=>a(da),Da,(ne,ja)=>{const Ra=q(()=>{const[Ca,Ta]=Ba(a(ja)[0],a(ja)[1],a(T));return{rawDisplay:Ca,actualDisplay:Ta}});var wa=Ue(),xa=t(wa),oe=t(xa);e(xa);var Ma=r(xa,4),ve=t(Ma);e(Ma),e(wa),D((Ca,Ta)=>{y(oe,`${Ca??""}Â°`),y(ve,`${Ta??""}Â°`)},[()=>a(Ra).rawDisplay.toFixed(1),()=>a(Ra).actualDisplay.toFixed(1)]),v(ne,wa)}),e(P),D(()=>{y(ra,`Raw (${a(z)??""})`),y(ga,`Actual (${a(z)??""})`)}),v(h,P)},N=h=>{var P=Ve();v(h,P)};S(m,h=>{a(da).length>0?h(G):h(N,!1)})}var R=r(m,2),K=t(R),M=t(K),I=t(M),Q=t(I);e(I);var J=r(I,2);oa(J),e(M);var W=r(M,4),b=t(W),U=t(b);e(b);var X=r(b,2);oa(X),e(W);var ia=r(W,2);ia.__click=()=>Ia(a(E),a(O)),e(K),e(R),D(()=>{y(Q,`Raw ${a(z)??""}`),Ua(J,"placeholder",a(T)?"20.0":"68.0"),y(U,`Actual ${a(z)??""}`),Ua(X,"placeholder",a(T)?"19.5":"67.5"),ia.disabled=a(V)||!a(E)||!a(O)}),va(J,()=>a(E),h=>n(E,h)),va(X,()=>a(O),h=>n(O,h)),v(i,l)};S(ie,i=>{a(Z)?i(re):i(le,!1)})}e($a),e(Na),e(ta),he(2),D(()=>y(ee,`Temperature (${a(z)??""})`)),we(j,()=>a(_),i=>n(_,i)),v(d,u)};S(p,d=>{a(x).length===0?d(f):d(k,!1)},!0)}v(s,o)};S(qa,s=>{a(Pa)?s(za):s(Ka,!1)})}e(fa),v(g,fa),me()}ce(["change","click"]);export{Ze as component};
