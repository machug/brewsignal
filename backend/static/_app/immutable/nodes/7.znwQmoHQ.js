import{d as ve,f as d,a as v,c as ce,s as g}from"../chunks/D3BGmjiQ.js";import{a as de,s as y,p as pe,o as fe,ay as ue,i as a,c as n,h as be,e as me,g as r,d as t,aw as _e,j as e,f as na,t as T,l as q,n as he}from"../chunks/qPFz7rcR.js";import{e as ka,i as Fa}from"../chunks/fEN5jtvK.js";import{i as G}from"../chunks/VWvnMYpw.js";import{h as ge}from"../chunks/DUkqxoKv.js";import{r as oa,s as Ma}from"../chunks/D6lThKhy.js";import{s as ye}from"../chunks/DiFo9CWT.js";import{b as va}from"../chunks/DzkFo9Qc.js";import{b as we}from"../chunks/Dx7-pTgU.js";import{g as xe,c as Ce}from"../chunks/DBamZe9H.js";function Ua(_){return(_-32)*(5/9)}function La(_){return _*9/5+32}function Te(_,$,w){return w?[_,$]:[Ua(_),Ua($)]}function Va(_,$,w){return w?[_,$]:[La(_),La($)]}var ke=d('<div class="loading-state svelte-36f20v"><div class="loading-spinner svelte-36f20v"></div> <span>Loading Devices...</span></div>'),Fe=d(`<div class="empty-state svelte-36f20v"><div class="empty-icon svelte-36f20v">ðŸ“Š</div> <h3 class="empty-title svelte-36f20v">No Tilt Devices Found</h3> <p class="empty-description svelte-36f20v">Pair a Tilt hydrometer on the Devices page to calibrate it.
				Only Tilt devices appear here (iSpindel/GravityMon calibrate on-device).</p> <a href="/devices" class="btn-primary mt-4 svelte-36f20v">Go to Devices</a></div>`),De=d("<option> </option>"),Ge=d('<div class="tilt-info svelte-36f20v"><span class="tilt-color-dot svelte-36f20v"></span> <span class="font-mono text-xs text-[var(--text-muted)]"> </span></div>'),Pe=d('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all gravity calibration points">Clear All</button>'),Se=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ae=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Ne=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span>Raw</span> <span>â†’</span> <span>Actual</span></div> <!></div>'),$e=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),je=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="sg-raw" class="svelte-36f20v">Raw SG</label> <input id="sg-raw" type="number" step="0.001" placeholder="1.050" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="sg-actual" class="svelte-36f20v">Actual SG</label> <input id="sg-actual" type="number" step="0.001" placeholder="1.048" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add SG calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),Re=d('<button type="button" class="btn-danger-small svelte-36f20v" aria-label="Clear all temperature calibration points">Clear All</button>'),Me=d('<div class="loading-inline svelte-36f20v"><div class="loading-spinner-small svelte-36f20v"></div> <span>Loading...</span></div>'),Ue=d('<div class="table-row svelte-36f20v"><span class="font-mono"> </span> <span class="text-[var(--text-muted)]">â†’</span> <span class="font-mono text-[var(--accent)]"> </span></div>'),Le=d('<div class="calibration-table svelte-36f20v"><div class="table-header svelte-36f20v"><span> </span> <span>â†’</span> <span> </span></div> <!></div>'),Ve=d('<div class="no-points svelte-36f20v"><span>No calibration points yet</span></div>'),Be=d('<!> <div class="add-point-form svelte-36f20v"><div class="form-row svelte-36f20v"><div class="form-group svelte-36f20v"><label for="temp-raw" class="svelte-36f20v"> </label> <input id="temp-raw" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <div class="form-arrow svelte-36f20v">â†’</div> <div class="form-group svelte-36f20v"><label for="temp-actual" class="svelte-36f20v"> </label> <input id="temp-actual" type="number" step="0.1" class="input-field svelte-36f20v"/></div> <button type="button" class="btn-add svelte-36f20v" aria-label="Add temperature calibration point"><svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg></button></div></div>',1),He=d(`<div class="card mb-6 svelte-36f20v"><div class="card-header svelte-36f20v"><h2 class="card-title svelte-36f20v">Select Device</h2></div> <div class="card-body svelte-36f20v"><div class="tilt-selector svelte-36f20v"><select class="select-input svelte-36f20v"></select> <!></div></div></div> <div class="grid gap-6 md:grid-cols-2"><div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v">Gravity (SG)</h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Add calibration points by measuring with a reference hydrometer.
						The system will interpolate between points.</p> <!></div></div> <div class="card svelte-36f20v"><div class="card-header flex items-center justify-between svelte-36f20v"><h2 class="card-title svelte-36f20v"> </h2> <!></div> <div class="card-body svelte-36f20v"><p class="section-description svelte-36f20v">Calibrate temperature by comparing with a reference thermometer.
						Values are stored in Â°C internally.</p> <!></div></div></div> <div class="info-section mt-6 svelte-36f20v"><h3 class="info-title svelte-36f20v">How Tilt Calibration Works</h3> <p class="info-text svelte-36f20v">Tilt calibration is applied in software to raw BLE readings. Add at least two calibration
				points for accurate linear interpolation. Calibration happens app-side, not on the device.</p> <div class="info-tips svelte-36f20v"><div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Gravity:</span> <span>Use distilled water (1.000 SG) and a known sugar solution (1.061 or 1.110 SG) for best results.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">Temperature:</span> <span>Rarely needed for Tilts (accurate 38Â°F-98Â°F range). Calibrate only if you notice consistent offsets.</span></div> <div class="tip svelte-36f20v"><span class="tip-label svelte-36f20v">iSpindel/GravityMon:</span> <span>These devices calibrate on-board via polynomial formulas. Configure calibration through the device's web interface.</span></div></div></div>`,1),Ee=d(`<div class="page-container svelte-36f20v"><div class="page-header svelte-36f20v"><h1 class="page-title svelte-36f20v">Tilt Calibration</h1> <p class="page-description svelte-36f20v">Calibrate your Tilt hydrometer's gravity and temperature readings</p></div> <!></div>`);function Ze(_,$){de($,!0);let w=y(pe([])),p=y(null),x=y(null),Da=y("none"),Ga=y(!0),Z=y(!1),L=y(!1),V=y(""),B=y(""),H=y(""),E=y(""),z=q(xe),C=q(()=>Ce.config.temp_units==="C"),ca=q(()=>(a(x)?.points||[]).sort((s,o)=>s[0]-o[0])),da=q(()=>(a(x)?.temp_points||[]).sort((s,o)=>s[0]-o[0])),pa=q(()=>a(w).find(s=>s.id===a(p)));async function Ba(){try{const s=await fetch("/api/devices?device_type=tilt&paired_only=true");s.ok&&(n(w,await s.json(),!0),a(w).length>0&&!a(p)&&n(p,a(w)[0].id,!0))}catch(s){console.error("Failed to load devices:",s)}finally{n(Ga,!1)}}async function Ha(){if(a(p)){n(Z,!0);try{const s=await fetch(`/api/devices/${a(p)}/calibration`);if(s.ok){const o=await s.json();n(Da,o.calibration_type,!0),n(x,o.calibration_data,!0)}}catch(s){console.error("Failed to load calibration:",s)}finally{n(Z,!1)}}}async function aa(s){if(a(p)){n(L,!0);try{const o={calibration_type:"linear",calibration_data:s},c=await fetch(`/api/devices/${a(p)}/calibration`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(c.ok){const f=await c.json();n(Da,f.calibration_type,!0),n(x,f.calibration_data,!0)}else{const f=await c.json().catch(()=>({detail:"Unknown error"}));alert(`Failed to save calibration: ${f.detail||c.statusText}`)}}catch(o){console.error("Failed to save calibration:",o),alert(`Failed to save calibration: ${o instanceof Error?o.message:"Unknown error"}`)}finally{n(L,!1)}}}async function Ea(s,o){if(!a(p))return;const c=parseFloat(s),f=parseFloat(o);if(isNaN(c)||isNaN(f)){alert("Please enter valid numbers for both raw and actual gravity values");return}if(c<.99||c>1.2||f<.99||f>1.2){alert("Gravity values must be between 0.990 and 1.200");return}const P=a(x)?.points||[];if(P.some(S=>Math.abs(S[0]-c)<.001)){alert("A calibration point with this raw value already exists");return}const k=[...P,[c,f]];await aa({...a(x),points:k}),n(V,""),n(B,"")}async function Ia(s,o){if(!a(p))return;const c=parseFloat(s),f=parseFloat(o);if(isNaN(c)||isNaN(f)){alert("Please enter valid numbers for both raw and actual temperature values");return}const P=a(C)?-10:14,h=a(C)?50:122;if(c<P||c>h||f<P||f>h){const F=a(C)?"Â°C":"Â°F";alert(`Temperature values must be between ${P}${F} and ${h}${F}`);return}const k=a(x)?.temp_points||[],S=a(C)?.1:.18;if(k.some(F=>{const[ta,sa]=Va(F[0],F[1],a(C));return Math.abs(ta-c)<S})){const F=a(C)?"Â°C":"Â°F";alert(`A calibration point with this raw value already exists (within ${S}${F})`);return}const[ea,I]=Te(c,f,a(C)),ba=[...k,[ea,I]];await aa({...a(x),temp_points:ba}),n(H,""),n(E,"")}async function Oa(){a(p)&&confirm("Clear all gravity calibration points?")&&await aa({...a(x),points:[]})}async function Ja(){a(p)&&confirm("Clear all temperature calibration points?")&&await aa({...a(x),temp_points:[]})}function Pa(s){return s.toFixed(3)}fe(()=>{Ba()}),ue(()=>{if(a(p)){n(V,""),n(B,""),n(H,""),n(E,"");const s=a(p);Ha().catch(o=>{s===a(p)&&console.error("Failed to load calibration:",o)})}});var fa=Ee();ge("36f20v",s=>{me(()=>{_e.title="Calibration | BrewSignal"})});var Wa=r(t(fa),2);{var qa=s=>{var o=ke();v(s,o)},za=s=>{var o=ce(),c=na(o);{var f=h=>{var k=Fe();v(h,k)},P=h=>{var k=He(),S=na(k),ua=r(t(S),2),ea=t(ua),I=t(ea);ka(I,21,()=>a(w),Fa,(i,l)=>{var u=De(),A=t(u);e(u);var N={};T(()=>{g(A,`${a(l).color??""} â€” ${a(l).beer_name??""}`),N!==(N=a(l).id)&&(u.value=(u.__value=a(l).id)??"")}),v(i,u)}),e(I);var ba=r(I,2);{var F=i=>{var l=Ge(),u=t(l),A=r(u,2),N=t(A,!0);e(A),e(l),T(j=>{ye(u,`background: var(--tilt-${j??""});`),g(N,a(pa).id)},[()=>a(pa).color.toLowerCase()]),v(i,l)};G(ba,i=>{a(pa)&&i(F)})}e(ea),e(ua),e(S);var ta=r(S,2),sa=t(ta),ma=t(sa),Ka=r(t(ma),2);{var Qa=i=>{var l=Pe();l.__click=()=>Oa(),T(()=>l.disabled=a(L)),v(i,l)};G(Ka,i=>{a(ca).length>0&&i(Qa)})}e(ma);var Sa=r(ma,2),Xa=r(t(Sa),2);{var Ya=i=>{var l=Se();v(i,l)},Za=i=>{var l=je(),u=na(l);{var A=b=>{var M=Ne(),X=r(t(M),2);ka(X,17,()=>a(ca),Fa,(ia,m)=>{var D=Ae(),U=t(D),Y=t(U,!0);e(U);var ra=r(U,4),la=t(ra,!0);e(ra),e(D),T((ga,ya)=>{g(Y,ga),g(la,ya)},[()=>Pa(a(m)[0]),()=>Pa(a(m)[1])]),v(ia,D)}),e(M),v(b,M)},N=b=>{var M=$e();v(b,M)};G(u,b=>{a(ca).length>0?b(A):b(N,!1)})}var j=r(u,2),K=t(j),R=t(K),O=r(t(R),2);oa(O),e(R);var Q=r(R,4),J=r(t(Q),2);oa(J),e(Q);var W=r(Q,2);W.__click=()=>Ea(a(V),a(B)),e(K),e(j),T(()=>W.disabled=a(L)||!a(V)||!a(B)),va(O,()=>a(V),b=>n(V,b)),va(J,()=>a(B),b=>n(B,b)),v(i,l)};G(Xa,i=>{a(Z)?i(Ya):i(Za,!1)})}e(Sa),e(sa);var Aa=r(sa,2),_a=t(Aa),ha=t(_a),ae=t(ha);e(ha);var ee=r(ha,2);{var te=i=>{var l=Re();l.__click=()=>Ja(),T(()=>l.disabled=a(L)),v(i,l)};G(ee,i=>{a(da).length>0&&i(te)})}e(_a);var Na=r(_a,2),se=r(t(Na),2);{var ie=i=>{var l=Me();v(i,l)},re=i=>{var l=Be(),u=na(l);{var A=m=>{var D=Le(),U=t(D),Y=t(U),ra=t(Y);e(Y);var la=r(Y,4),ga=t(la);e(la),e(U);var ya=r(U,2);ka(ya,17,()=>a(da),Fa,(le,$a)=>{const ja=q(()=>{const[Ca,Ta]=Va(a($a)[0],a($a)[1],a(C));return{rawDisplay:Ca,actualDisplay:Ta}});var wa=Ue(),xa=t(wa),ne=t(xa);e(xa);var Ra=r(xa,4),oe=t(Ra);e(Ra),e(wa),T((Ca,Ta)=>{g(ne,`${Ca??""}Â°`),g(oe,`${Ta??""}Â°`)},[()=>a(ja).rawDisplay.toFixed(1),()=>a(ja).actualDisplay.toFixed(1)]),v(le,wa)}),e(D),T(()=>{g(ra,`Raw (${a(z)??""})`),g(ga,`Actual (${a(z)??""})`)}),v(m,D)},N=m=>{var D=Ve();v(m,D)};G(u,m=>{a(da).length>0?m(A):m(N,!1)})}var j=r(u,2),K=t(j),R=t(K),O=t(R),Q=t(O);e(O);var J=r(O,2);oa(J),e(R);var W=r(R,4),b=t(W),M=t(b);e(b);var X=r(b,2);oa(X),e(W);var ia=r(W,2);ia.__click=()=>Ia(a(H),a(E)),e(K),e(j),T(()=>{g(Q,`Raw ${a(z)??""}`),Ma(J,"placeholder",a(C)?"20.0":"68.0"),g(M,`Actual ${a(z)??""}`),Ma(X,"placeholder",a(C)?"19.5":"67.5"),ia.disabled=a(L)||!a(H)||!a(E)}),va(J,()=>a(H),m=>n(H,m)),va(X,()=>a(E),m=>n(E,m)),v(i,l)};G(se,i=>{a(Z)?i(ie):i(re,!1)})}e(Na),e(Aa),e(ta),he(2),T(()=>g(ae,`Temperature (${a(z)??""})`)),we(I,()=>a(p),i=>n(p,i)),v(h,k)};G(c,h=>{a(w).length===0?h(f):h(P,!1)},!0)}v(s,o)};G(Wa,s=>{a(Ga)?s(qa):s(za,!1)})}e(fa),v(_,fa),be()}ve(["click"]);export{Ze as component};
