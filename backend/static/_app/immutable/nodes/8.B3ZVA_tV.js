import{d as Pe,f as c,a as d,c as Be,s as g}from"../chunks/NSBYmcxh.js";import{aq as J,c as e,s as h,ah as Ee,p as Ue,ao as $e,ak as l,at as ue,aj as Ge,e as Re,am as Ve,al as t,an as a,ar as u,ai as we,as as fe}from"../chunks/DkBf6qYn.js";import{e as he,i as me}from"../chunks/J4k8iyZ5.js";import{i as f}from"../chunks/S0lmOLxe.js";import{h as qe}from"../chunks/Cdr2eubP.js";import{s as je}from"../chunks/mQ7Axk59.js";import{f as He,u as Ie,p as Oe}from"../chunks/gKtBTYkw.js";const ye=300*1e3;class ze{#e=J(null);get cache(){return e(this.#e)}set cache(b){h(this.#e,b,!0)}async getDevices(b=!1){const D=Date.now();if(!b&&this.cache&&D-this.cache.timestamp<ye)return this.cache.data;const x=await He();return this.cache={data:x,timestamp:D},x}invalidate(){this.cache=null}getCachedDevices(){const b=Date.now();return this.cache&&b-this.cache.timestamp<ye?this.cache.data:null}}const z=new ze;var Je=c('<div class="loading-state svelte-j4gi7w">Loading devices...</div>'),Ke=c('<div class="error-state svelte-j4gi7w"><p> </p> <button class="btn-secondary svelte-j4gi7w">Retry</button></div>'),Qe=c('<div class="empty-state svelte-j4gi7w"><p>No paired devices. Pair a device below to start logging readings.</p></div>'),We=c('<div class="device-color-badge svelte-j4gi7w"></div>'),Xe=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),Ye=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Beer Name:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),Ze=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),ea=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),aa=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),ta=c('<div class="device-card paired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status paired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Paired</div></div> <div class="device-details svelte-j4gi7w"><!> <div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-secondary btn-sm svelte-j4gi7w">Unpair Device</button></div>'),sa=c('<div class="device-grid svelte-j4gi7w"></div>'),ia=c('<div class="empty-state svelte-j4gi7w"><p>No unpaired devices detected. Make sure your devices are broadcasting and within range.</p></div>'),ra=c('<div class="device-color-badge svelte-j4gi7w"></div>'),va=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),la=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),na=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),oa=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),da=c('<div class="device-card unpaired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status unpaired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Unpaired</div></div> <div class="device-details svelte-j4gi7w"><div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-primary btn-sm svelte-j4gi7w">Pair Device</button></div>'),ca=c('<div class="device-grid svelte-j4gi7w"></div>'),pa=c('<div class="devices-container svelte-j4gi7w"><section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are actively logging readings</p> <!></section> <section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are detected but not logging readings</p> <!></section></div>'),_a=c('<div class="page-header svelte-j4gi7w"><h1 class="page-title svelte-j4gi7w">Devices</h1> <p class="page-description svelte-j4gi7w">Manage your hydrometer devices (Tilt, iSpindel, GravityMon)</p></div> <!>',1);function ya(ne,b){Ee(b,!0);let D=J(Ue([])),x=J(!0),y=J(null);$e(async()=>{const r=z.getCachedDevices();r&&(h(D,r,!0),h(x,!1)),await H()});async function H(r=!1){h(x,!0),h(y,null);try{h(D,await z.getDevices(r),!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to load devices",!0)}finally{h(x,!1)}}async function be(r){h(y,null);try{await Oe(r),z.invalidate(),await H(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to pair device",!0)}}async function De(r){h(y,null);try{await Ie(r),z.invalidate(),await H(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to unpair device",!0)}}function oe(r){if(!r)return"Never seen";const _=Math.floor((Date.now()-new Date(r).getTime())/1e3);if(_<10)return"just now";if(_<60)return`${_}s ago`;const A=Math.floor(_/60);if(A<60)return`${A}m ago`;const P=Math.floor(A/60);return P<24?`${P}h ago`:`${Math.floor(P/24)}d ago`}function de(r){return r.display_name?r.display_name:r.device_type==="tilt"&&r.color?`${r.color} Tilt`:r.device_type==="ispindel"?`iSpindel ${r.name}`:r.device_type==="gravitymon"?`GravityMon ${r.name}`:r.name}function ce(r){return{tilt:"Tilt",ispindel:"iSpindel",gravitymon:"GravityMon",floaty:"Floaty"}[r]||r}let K=we(()=>e(D).filter(r=>r.paired)),Q=we(()=>e(D).filter(r=>!r.paired));var pe=_a();qe("j4gi7w",r=>{Re(()=>{Ve.title="Devices | BrewSignal"})});var xe=l(ue(pe),2);{var Me=r=>{var _=Je();d(r,_)},Ce=r=>{var _=Be(),A=ue(_);{var P=L=>{var M=Ke(),C=t(M),B=t(C,!0);a(C);var W=l(C,2);W.__click=()=>H(!0),a(M),u(()=>g(B,e(y))),d(L,M)},_e=L=>{var M=pa(),C=t(M),B=t(C),W=t(B);a(B);var Fe=l(B,4);{var ke=w=>{var m=Qe();d(w,m)},Ne=w=>{var m=sa();he(m,21,()=>e(K),me,(Y,s)=>{var F=ta(),k=t(F),E=t(k),U=t(E);{var Z=i=>{var v=We();u(p=>je(v,`background: var(--tilt-${p??""})`),[()=>e(s).color.toLowerCase()]),d(i,v)},ee=i=>{var v=Xe(),p=t(v),j=t(p,!0);a(p),a(v),u(le=>g(j,le),[()=>ce(e(s).device_type)]),d(i,v)};f(U,i=>{e(s).device_type==="tilt"&&e(s).color?i(Z):i(ee,!1)})}var $=l(U,2),N=t($),ae=t(N,!0);a(N);var G=l(N,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(k);var T=l(k,2),S=t(T);{var I=i=>{var v=Ye(),p=l(t(v),2),j=t(p,!0);a(p),a(v),u(()=>g(j,e(s).beer_name)),d(i,v)};f(S,i=>{e(s).beer_name&&i(I)})}var R=l(S,2),V=l(t(R),2),se=t(V,!0);a(V),a(R);var q=l(R,2);{var ie=i=>{var v=Ze(),p=l(t(v),2),j=t(p,!0);a(p),a(v),u(()=>g(j,e(s).mac)),d(i,v)};f(q,i=>{e(s).device_type==="tilt"&&e(s).mac&&i(ie)})}var O=l(q,2);{var re=i=>{var v=ea(),p=l(t(v),2),j=t(p);a(p),a(v),u(le=>g(j,`${le??""}V`),[()=>e(s).battery_voltage.toFixed(2)]),d(i,v)};f(O,i=>{(e(s).device_type==="ispindel"||e(s).device_type==="gravitymon")&&e(s).battery_voltage!==null&&Number.isFinite(e(s).battery_voltage)&&i(re)})}var ve=l(O,2);{var n=i=>{var v=aa(),p=l(t(v),2),j=t(p,!0);a(p),a(v),u(()=>g(j,e(s).firmware_version)),d(i,v)};f(ve,i=>{e(s).firmware_version&&i(n)})}a(T);var o=l(T,2);o.__click=()=>De(e(s).id),a(F),u((i,v)=>{g(ae,i),g(te,e(s).id),g(se,v)},[()=>de(e(s)),()=>oe(e(s).last_seen)]),d(Y,F)}),a(m),d(w,m)};f(Fe,w=>{e(K).length===0?w(ke):w(Ne,!1)})}a(C);var ge=l(C,2),X=t(ge),Te=t(X);a(X);var Le=l(X,4);{var Se=w=>{var m=ia();d(w,m)},Ae=w=>{var m=ca();he(m,21,()=>e(Q),me,(Y,s)=>{var F=da(),k=t(F),E=t(k),U=t(E);{var Z=n=>{var o=ra();u(i=>je(o,`background: var(--tilt-${i??""})`),[()=>e(s).color.toLowerCase()]),d(n,o)},ee=n=>{var o=va(),i=t(o),v=t(i,!0);a(i),a(o),u(p=>g(v,p),[()=>ce(e(s).device_type)]),d(n,o)};f(U,n=>{e(s).device_type==="tilt"&&e(s).color?n(Z):n(ee,!1)})}var $=l(U,2),N=t($),ae=t(N,!0);a(N);var G=l(N,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(k);var T=l(k,2),S=t(T),I=l(t(S),2),R=t(I,!0);a(I),a(S);var V=l(S,2);{var se=n=>{var o=la(),i=l(t(o),2),v=t(i,!0);a(i),a(o),u(()=>g(v,e(s).mac)),d(n,o)};f(V,n=>{e(s).device_type==="tilt"&&e(s).mac&&n(se)})}var q=l(V,2);{var ie=n=>{var o=na(),i=l(t(o),2),v=t(i);a(i),a(o),u(p=>g(v,`${p??""}V`),[()=>e(s).battery_voltage.toFixed(2)]),d(n,o)};f(q,n=>{(e(s).device_type==="ispindel"||e(s).device_type==="gravitymon")&&e(s).battery_voltage!==null&&Number.isFinite(e(s).battery_voltage)&&n(ie)})}var O=l(q,2);{var re=n=>{var o=oa(),i=l(t(o),2),v=t(i,!0);a(i),a(o),u(()=>g(v,e(s).firmware_version)),d(n,o)};f(O,n=>{e(s).firmware_version&&n(re)})}a(T);var ve=l(T,2);ve.__click=()=>be(e(s).id),a(F),u((n,o)=>{g(ae,n),g(te,e(s).id),g(R,o)},[()=>de(e(s)),()=>oe(e(s).last_seen)]),d(Y,F)}),a(m),d(w,m)};f(Le,w=>{e(Q).length===0?w(Se):w(Ae,!1)})}a(ge),a(M),u(()=>{g(W,`Paired Devices (${e(K).length??""})`),g(Te,`Detected Devices (${e(Q).length??""})`)}),d(L,M)};f(A,L=>{e(y)?L(P):L(_e,!1)},!0)}d(r,_)};f(xe,r=>{e(x)?r(Me):r(Ce,!1)})}d(ne,pe),Ge()}Pe(["click"]);export{ya as component};
