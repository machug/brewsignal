import{d as Pe,f as c,a as d,c as Be,s as g}from"../chunks/BPY3LF1i.js";import{s as J,h as e,c as h,a as Ee,p as Ue,o as $e,e as l,f as ue,g as Ge,A as Re,ax as Ve,d as t,r as a,t as u,u as we,n as fe}from"../chunks/WzhiZOZ9.js";import{e as he,i as me}from"../chunks/DnC7am1E.js";import{i as f}from"../chunks/DTo_ih-i.js";import{h as He}from"../chunks/BJzfFUzm.js";import{s as je}from"../chunks/6KfV5OBv.js";import{f as Ie,u as Oe,p as qe}from"../chunks/gKtBTYkw.js";const ye=300*1e3;class ze{#e=J(null);get cache(){return e(this.#e)}set cache(b){h(this.#e,b,!0)}async getDevices(b=!1){const x=Date.now();if(!b&&this.cache&&x-this.cache.timestamp<ye)return this.cache.data;const D=await Ie();return this.cache={data:D,timestamp:x},D}invalidate(){this.cache=null}getCachedDevices(){const b=Date.now();return this.cache&&b-this.cache.timestamp<ye?this.cache.data:null}}const z=new ze;var Je=c('<div class="loading-state svelte-j4gi7w">Loading devices...</div>'),Ke=c('<div class="error-state svelte-j4gi7w"><p> </p> <button class="btn-secondary svelte-j4gi7w">Retry</button></div>'),Qe=c('<div class="empty-state svelte-j4gi7w"><p>No paired devices. Pair a device below to start logging readings.</p></div>'),We=c('<div class="device-color-badge svelte-j4gi7w"></div>'),Xe=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),Ye=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Beer Name:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),Ze=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),ea=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),aa=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),ta=c('<div class="device-card paired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status paired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Paired</div></div> <div class="device-details svelte-j4gi7w"><!> <div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-secondary btn-sm svelte-j4gi7w">Unpair Device</button></div>'),sa=c('<div class="device-grid svelte-j4gi7w"></div>'),ia=c('<div class="empty-state svelte-j4gi7w"><p>No unpaired devices detected. Make sure your devices are broadcasting and within range.</p></div>'),ra=c('<div class="device-color-badge svelte-j4gi7w"></div>'),va=c('<div class="device-type-badge svelte-j4gi7w"><span class="device-type-label svelte-j4gi7w"> </span></div>'),la=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">MAC:</span> <span class="detail-value mono svelte-j4gi7w"> </span></div>'),na=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Battery:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),oa=c('<div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Firmware:</span> <span class="detail-value svelte-j4gi7w"> </span></div>'),da=c('<div class="device-card unpaired svelte-j4gi7w"><div class="device-header svelte-j4gi7w"><div class="device-info svelte-j4gi7w"><!> <div><h3 class="device-name svelte-j4gi7w"> </h3> <p class="device-id svelte-j4gi7w"> </p></div></div> <div class="device-status unpaired svelte-j4gi7w"><span class="status-dot svelte-j4gi7w"></span> Unpaired</div></div> <div class="device-details svelte-j4gi7w"><div class="detail-row svelte-j4gi7w"><span class="detail-label svelte-j4gi7w">Last Seen:</span> <span class="detail-value svelte-j4gi7w"> </span></div> <!> <!> <!></div> <button class="btn-primary btn-sm svelte-j4gi7w">Pair Device</button></div>'),ca=c('<div class="device-grid svelte-j4gi7w"></div>'),pa=c('<div class="devices-container svelte-j4gi7w"><section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are actively logging readings</p> <!></section> <section class="device-section svelte-j4gi7w"><h2 class="section-title svelte-j4gi7w"> </h2> <p class="section-description svelte-j4gi7w">These devices are detected but not logging readings</p> <!></section></div>'),_a=c('<div class="page-header svelte-j4gi7w"><h1 class="page-title svelte-j4gi7w">Devices</h1> <p class="page-description svelte-j4gi7w">Manage your hydrometer devices (Tilt, iSpindel, GravityMon)</p></div> <!>',1);function ya(ne,b){Ee(b,!0);let x=J(Ue([])),D=J(!0),y=J(null);$e(async()=>{const r=z.getCachedDevices();r&&(h(x,r,!0),h(D,!1)),await I()});async function I(r=!1){h(D,!0),h(y,null);try{h(x,await z.getDevices(r),!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to load devices",!0)}finally{h(D,!1)}}async function be(r){h(y,null);try{await qe(r),z.invalidate(),await I(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to pair device",!0)}}async function xe(r){h(y,null);try{await Oe(r),z.invalidate(),await I(!0)}catch(_){h(y,_ instanceof Error?_.message:"Failed to unpair device",!0)}}function oe(r){if(!r)return"Never seen";const _=Math.floor((Date.now()-new Date(r).getTime())/1e3);if(_<10)return"just now";if(_<60)return`${_}s ago`;const S=Math.floor(_/60);if(S<60)return`${S}m ago`;const P=Math.floor(S/60);return P<24?`${P}h ago`:`${Math.floor(P/24)}d ago`}function de(r){return r.display_name?r.display_name:r.device_type==="tilt"&&r.color?`${r.color} Tilt`:r.device_type==="ispindel"?`iSpindel ${r.name}`:r.device_type==="gravitymon"?`GravityMon ${r.name}`:r.name}function ce(r){return{tilt:"Tilt",ispindel:"iSpindel",gravitymon:"GravityMon",floaty:"Floaty"}[r]||r}let K=we(()=>e(x).filter(r=>r.paired)),Q=we(()=>e(x).filter(r=>!r.paired));var pe=_a();He("j4gi7w",r=>{Re(()=>{Ve.title="Devices | BrewSignal"})});var De=l(ue(pe),2);{var Me=r=>{var _=Je();d(r,_)},Ce=r=>{var _=Be(),S=ue(_);{var P=A=>{var M=Ke(),C=t(M),B=t(C,!0);a(C);var W=l(C,2);W.__click=()=>I(!0),a(M),u(()=>g(B,e(y))),d(A,M)},_e=A=>{var M=pa(),C=t(M),B=t(C),W=t(B);a(B);var Fe=l(B,4);{var ke=w=>{var m=Qe();d(w,m)},Ne=w=>{var m=sa();he(m,21,()=>e(K),me,(Y,s)=>{var F=ta(),k=t(F),E=t(k),U=t(E);{var Z=i=>{var v=We();u(p=>je(v,`background: var(--tilt-${p??""})`),[()=>e(s).color.toLowerCase()]),d(i,v)},ee=i=>{var v=Xe(),p=t(v),j=t(p,!0);a(p),a(v),u(le=>g(j,le),[()=>ce(e(s).device_type)]),d(i,v)};f(U,i=>{e(s).device_type==="tilt"&&e(s).color?i(Z):i(ee,!1)})}var $=l(U,2),N=t($),ae=t(N,!0);a(N);var G=l(N,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(k);var T=l(k,2),L=t(T);{var O=i=>{var v=Ye(),p=l(t(v),2),j=t(p,!0);a(p),a(v),u(()=>g(j,e(s).beer_name)),d(i,v)};f(L,i=>{e(s).beer_name&&i(O)})}var R=l(L,2),V=l(t(R),2),se=t(V,!0);a(V),a(R);var H=l(R,2);{var ie=i=>{var v=Ze(),p=l(t(v),2),j=t(p,!0);a(p),a(v),u(()=>g(j,e(s).mac)),d(i,v)};f(H,i=>{e(s).device_type==="tilt"&&e(s).mac&&i(ie)})}var q=l(H,2);{var re=i=>{var v=ea(),p=l(t(v),2),j=t(p);a(p),a(v),u(le=>g(j,`${le??""}V`),[()=>e(s).battery_voltage.toFixed(2)]),d(i,v)};f(q,i=>{(e(s).device_type==="ispindel"||e(s).device_type==="gravitymon")&&e(s).battery_voltage!==null&&Number.isFinite(e(s).battery_voltage)&&i(re)})}var ve=l(q,2);{var n=i=>{var v=aa(),p=l(t(v),2),j=t(p,!0);a(p),a(v),u(()=>g(j,e(s).firmware_version)),d(i,v)};f(ve,i=>{e(s).firmware_version&&i(n)})}a(T);var o=l(T,2);o.__click=()=>xe(e(s).id),a(F),u((i,v)=>{g(ae,i),g(te,e(s).id),g(se,v)},[()=>de(e(s)),()=>oe(e(s).last_seen)]),d(Y,F)}),a(m),d(w,m)};f(Fe,w=>{e(K).length===0?w(ke):w(Ne,!1)})}a(C);var ge=l(C,2),X=t(ge),Te=t(X);a(X);var Ae=l(X,4);{var Le=w=>{var m=ia();d(w,m)},Se=w=>{var m=ca();he(m,21,()=>e(Q),me,(Y,s)=>{var F=da(),k=t(F),E=t(k),U=t(E);{var Z=n=>{var o=ra();u(i=>je(o,`background: var(--tilt-${i??""})`),[()=>e(s).color.toLowerCase()]),d(n,o)},ee=n=>{var o=va(),i=t(o),v=t(i,!0);a(i),a(o),u(p=>g(v,p),[()=>ce(e(s).device_type)]),d(n,o)};f(U,n=>{e(s).device_type==="tilt"&&e(s).color?n(Z):n(ee,!1)})}var $=l(U,2),N=t($),ae=t(N,!0);a(N);var G=l(N,2),te=t(G,!0);a(G),a($),a(E),fe(2),a(k);var T=l(k,2),L=t(T),O=l(t(L),2),R=t(O,!0);a(O),a(L);var V=l(L,2);{var se=n=>{var o=la(),i=l(t(o),2),v=t(i,!0);a(i),a(o),u(()=>g(v,e(s).mac)),d(n,o)};f(V,n=>{e(s).device_type==="tilt"&&e(s).mac&&n(se)})}var H=l(V,2);{var ie=n=>{var o=na(),i=l(t(o),2),v=t(i);a(i),a(o),u(p=>g(v,`${p??""}V`),[()=>e(s).battery_voltage.toFixed(2)]),d(n,o)};f(H,n=>{(e(s).device_type==="ispindel"||e(s).device_type==="gravitymon")&&e(s).battery_voltage!==null&&Number.isFinite(e(s).battery_voltage)&&n(ie)})}var q=l(H,2);{var re=n=>{var o=oa(),i=l(t(o),2),v=t(i,!0);a(i),a(o),u(()=>g(v,e(s).firmware_version)),d(n,o)};f(q,n=>{e(s).firmware_version&&n(re)})}a(T);var ve=l(T,2);ve.__click=()=>be(e(s).id),a(F),u((n,o)=>{g(ae,n),g(te,e(s).id),g(R,o)},[()=>de(e(s)),()=>oe(e(s).last_seen)]),d(Y,F)}),a(m),d(w,m)};f(Ae,w=>{e(Q).length===0?w(Le):w(Se,!1)})}a(ge),a(M),u(()=>{g(W,`Paired Devices (${e(K).length??""})`),g(Te,`Detected Devices (${e(Q).length??""})`)}),d(A,M)};f(S,A=>{e(y)?A(P):A(_e,!1)},!0)}d(r,_)};f(De,r=>{e(D)?r(Me):r(Ce,!1)})}d(ne,pe),Ge()}Pe(["click"]);export{ya as component};
